<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="From a WSL2 distribution it would be great to be able to contact the host computer with IP address of the virtual Network and not with some other network address."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="How to resolve hostname in a WSL instance with internal IP • Codewrecks"><meta property="og:description" content="From a WSL2 distribution it would be great to be able to contact the host computer with IP address of the virtual Network and not with some other network address."><meta property="og:url" content="https://www.codewrecks.com/post/general/wsl-hostname/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="WSL"><meta property="article:published_time" content="2021-06-03T18:40:00+02:00"><meta property="article:modified_time" content="2021-06-03T18:40:00+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>How to resolve hostname in a WSL instance with internal IP • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/general/wsl-hostname/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>How to resolve hostname in a WSL instance with internal IP</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>How to resolve hostname in a WSL instance with internal IP</h1><p class=desc>From a WSL2 distribution it would be great to be able to contact the host computer with IP address of the virtual Network and not with some other network address.</p></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2021-06-03T18:40:00+02:00>2021, Jun 03</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>3 mins read</span></div></div></header><div class="container entry-content"><p>In a WSL2 instance you are running inside a Virtual Environment managed by your Windows Operating system, and the greatest advantage is <strong>the ability to work with a unified filesystem and being able to have a great communication between the two system</strong>. This is perfect but I have a small problem, if I want to use the WSL2 instance to test some software I&rsquo;m developing I&rsquo;d like to access services running on my host operating system.</p><blockquote><p>Lets discuss a typical scenario, I want to access ElasticSearch server running on my host from my WSL2 instance.</p></blockquote><p>The problem is that my WSL2 instance <strong>have an autogenerated /etc/hosts file where the name of the host is set to localhost 127.0.1.1</strong>. While I can agree that, from a perspective of the WSL instance it is part of the same machine, but the problem is that, if I try to connect to http://machinename:9200 I got no response because ElasticSearch runs on the host. <strong>My host windows machine is called shismatrix, and I&rsquo;m expecting my WSL2 instance to use that name for network communication</strong>.</p><p><a target=_blank href=../images/wget-shismatrix.png><img src=../images/wget-shismatrix.png alt="Name of the host was resolved with local IP"></a>
<em><strong>Figure 1:</strong></em> <em>Name of the host was resolved with local IP</em></p><p>As you can see from <strong>Figure 1</strong> when I use shismatrix name, it will refer to loopback. This is the default of WSL, but I do not like this approach, I&rsquo;d like <strong>the name of my host to resolve to the internal IP of my host and not to loopback interface</strong>. Thanks to the WSL2 architecture, I can know the real IP of my host inspecting the /etc/resolv.conf file, because WSL2 infrastructure use my host machine as DNS. This allow for a simple two line shell script to change my /etc/hosts file.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo sed -i <span style=color:#e6db74>&#39;/.localdomain/d&#39;</span> /etc/hosts
tail -1 /etc/resolv.conf | awk <span style=color:#e6db74>&#39;{print $2} &#39;</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39; &#39;</span> | sudo tee -a /etc/hosts
cat /etc/hostname | sudo tee -a /etc/hosts</code></pre></td></tr></table></div></div><p>I know that this will break the convention where the name of the host is used inside WSL2 instance, <strong>but I really prefer to have name of my host to really resolve host, not WSL instance.</strong> Thanks to that two line script I can now use name of the host to really refer to my host machine</p><p><a target=_blank href=../images/wsl2-host-resolved.png><img src=../images/wsl2-host-resolved.png alt="Now name of my host refers correctly to the host machine virtual IP for WSL instance"></a>
<em><strong>Figure 2:</strong></em> <em>Now name of my host refers correctly to the host machine virtual IP for WSL instance</em></p><p>From <strong>Figure 2</strong> you can verify that now the name shismatrix refers to 172.23.144.1 address, that is actually the address of my host machine. This address is not static and can change between reboot, but thanks to the above script I can change /etc/hosts file to fix this situation.</p><p>I know that I can still refer to my hostname with standard names of my local network (I have an internal DNS), but I really <strong>prefer to use internal IP to be able to configure the firewall to allow access to certain port only from IP range of WSL2 machines</strong>. As an example I do not want my ElasticSearch instance to be accessible to every machine in the network, so I can scope a firewall rule for port 9200 to accept only connection from 172.16.0.0/12.</p><blockquote><p>The ability to use internal IP for WSL2 instance allows me to setup firewall rules to open certain services only to my WSL instances.</p></blockquote><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/general/>general</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/wsl/>WSL</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/general/winget-intro/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Winget is finally a thing</a></div><div class="next-entry sep-before"><a href=/post/general/winget-update-selective/><span class=screen-reader-text>Next post: </span>How to create a list of non upgradable software for winget<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>