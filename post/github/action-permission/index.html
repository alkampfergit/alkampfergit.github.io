<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In a GitHub repository you can fine tuning which actions can run in your workflow"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="GitHub Actions permission settings • Codewrecks"><meta property="og:description" content="In a GitHub repository you can fine tuning which actions can run in your workflow"><meta property="og:url" content="https://www.codewrecks.com/post/github/action-permission/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="github"><meta property="article:published_time" content="2021-11-27T06:00:00Z"><meta property="article:modified_time" content="2021-11-27T06:00:00Z"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>GitHub Actions permission settings • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/github/action-permission/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>GitHub Actions permission settings</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>GitHub Actions permission settings</h1><p class=desc>In a GitHub repository you can fine tuning which actions can run in your workflow</p></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2021-11-27T06:00:00Z>2021, Nov 27</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>5 mins read</span></div></div></header><div class="container entry-content"><p>Continuous integration is absolutely vital for a healthy software project, but in many situation <strong>people gave little attention to security</strong>. If you are running CI workflows in your machine where <strong>you control the code that is build and every script that is run by CI engine, you are pretty fine</strong>. In that scenario an attacker should take control of your code to run some malicious script during a CI run, but if you are using a third party task/extension/action, the situation is different.</p><h2 id=risk-of-runninng-code-made-by-others>Risk of runninng code made by others</h2><p>Each time you author a Continuous Integration pipeline, with latest tool you usually use building blocks written by people outside your organization and <strong>outside your control</strong>. As an example, this is a part of the GitHub action workflow that runs on commit to publish this blog.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:#66d9ef>name</span>: Deploy
    <span style=color:#66d9ef>uses</span>: peaceiris/actions-gh-pages@v3
    <span style=color:#66d9ef>if</span>: github.ref == <span style=color:#e6db74>&#39;refs/heads/master&#39;</span>
    <span style=color:#66d9ef>with</span>:
        <span style=color:#66d9ef>deploy_key</span>: ${{ secrets.DEPLOYKEY }}
        <span style=color:#66d9ef>publish_dir</span>: ./codewrecks/public
        <span style=color:#66d9ef>external_repository</span>: alkampfergit/alkampfergit.github.io
        <span style=color:#66d9ef>publish_branch</span>: master 
        <span style=color:#66d9ef>keep_files</span>: <span style=color:#66d9ef>true</span></code></pre></td></tr></table></div></div><p>As you can verify, I&rsquo;m using an action made by peaceiris, another GitHub user that created this fantastic extension that I&rsquo;m using to publish the blog on my GitHub page. <strong>Looking at the code you are specifying only major version (names ended with @v3)</strong>, this will imply that whenever the original developer will publish a new version of the action leaving the major version intact, my workflows will run the new version of the action.</p><blockquote><p>Using GitHub Actions outside your repository means that you are running code outside your control during your Actions</p></blockquote><p>This will pose some question about security. I&rsquo;m not implying that other users are malicious, but what happens if <strong>another developer GitHub credential is stolen and some malicious user pushes another version of the action with a malicous content?</strong>. As usual you should have an appropriate threat model to asses the situation, but ignoring it completely is not a wise thing to do.</p><p>When you asses security of your CI infrastructure there are many things to take into account, but basically you need starting answering some basic question.</p><blockquote><p>Where is the action executed</p></blockquote><p>If your workflow is executed on a machine managed by GitHub or Azure DevOps or generally speaking managed by other, <strong>there is little risk on compromise the machine itself, it will be destroyed after the execution of the action ended</strong>. But on the contrary, if you are using a machine that is inside one of your network, a compromise machine can and will be a problem. Simply starting a reverse TCP shell on your workflow can give an attacker control of the machine and a foot in your network.</p><blockquote><p>How sensitive is the code you are compiling</p></blockquote><p>Even if the machine is handled by someone else and it is destroyed upon script completion, <strong>if the attacker can manipulate what is executed it can simply compress the code and send to a remote server for later inspection</strong>.</p><blockquote><p>Machine time</p></blockquote><p>This is an attack that is real, people started <strong>abusing CI infrastructure to mine cryptocurrencies, like monero</strong>, stealing cycle times from CI agents.</p><p>Luckily for us, GitHub has an integrated way to <strong>restrict actions that can be run inside a workflow for each repository</strong>. Just navigate into repository settings and you will see a nice Actions Tab that allows you to configure Action/Workflow permissions. A first section allows you to restrict Actions.</p><p><a target=_blank href=../images/actions-permissions.png><img src=../images/actions-permissions.png alt="Actions permission in GitHub repository"></a></p><p><em><strong>Figure 1</strong></em>: <em>Actions permission in GitHub repository</em></p><p>As you can see in Figure 1 you have a great deal of options, you can disable Action completely, allow only actions that comes from one of your repository, allow only official GitHub actions, actions created by <a href="https://github.com/marketplace?type=actions&verification=verified_creator">Verified Creators</a> and finally you can also specify <strong>a list of allowed account/actions using wildcards</strong>.</p><p>Default settings is Allow All Actions, a perfect choice for a public repository, but for <strong>a private repository you should check if that settings is ok for you</strong>. Basically, if you are not using GitHub Actions, you should disable them completely. If you use Actions, you should check what action you are using and configure the most strict option you can.</p><h2 id=code-outside-your-control>Code outside your control</h2><p>The situation can be <strong>made worse by Pull Requests</strong>, basically when someone made a pull request, if you have Actions configured to run upon Pull Requests, you are basically <strong>allowing other people to start a workflow in your repository with full control of the code</strong>.</p><p>Even if you configured your CI infrastructure to run only scripts that are inside the repository, <strong>a malicious user can create a PR with a modified version of those script</strong>, ending in running malicious code during CI. For this scenario, you should check PR permission in the Action configuration tab.</p><p><a target=_blank href=../images/actions-pr-permissions.png><img src=../images/actions-pr-permissions.png alt="Pull requests permission in GitHub repository"></a></p><p><em><strong>Figure 2</strong></em>: <em>Pull requests permission in GitHub repository</em></p><p>Since this is a really serious risk, default option is to require approval for <strong>first-time contributors</strong>. If another user creates a PR on your repository, at the first PR that user <strong>must be authorized, subsequent PR will trigger actions normally</strong>. As you can see, default option prevent anyone that has no contribution to the project to create a PR.</p><p>A less restrictive check is allowing any GitHub user that is not recently created (people that opens a GH account to abuse the system). And a third most strict check will require an approval every time a PR <strong>is created by a collaborator that is outside the organization/account</strong>. This setting is really important, because allowing anyone to run Action upon a PR could be a really risky scenario.</p><p>Finally you can choose if the token used in GitHub action has write or only read permission to repository.</p><p><a target=_blank href=../images/actions-write-permission.png><img src=../images/actions-write-permission.png alt="Token permission"></a></p><p><em><strong>Figure 3</strong></em>: <em>Token permission</em></p><p>Thanks to these settings, you can restrict what runs in your CI infrastructure, <strong>be sure to review that settings accordingly for each situation</strong>.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/security/>security</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/github/>github</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/security/writeups/daily-bugle/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>TryHackMe Writeup: Daily Bugle</a></div><div class="next-entry sep-before"><a href=/post/github/security-enforcer/><span class=screen-reader-text>Next post: </span>GitHub Security enforcer action<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>