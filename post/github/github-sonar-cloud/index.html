<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How to use GitHub actions to analyze code with Sonar Cloud"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Sonar Cloud analysis in GitHub • Codewrecks"><meta property="og:description" content="How to use GitHub actions to analyze code with Sonar Cloud"><meta property="og:url" content="https://www.codewrecks.com/post/github/github-sonar-cloud/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="sonarcloud"><meta property="article:published_time" content="2021-03-13T08:00:00+02:00"><meta property="article:modified_time" content="2021-03-13T08:00:00+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Sonar Cloud analysis in GitHub • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/github/github-sonar-cloud/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Sonar Cloud analysis in GitHub</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Sonar Cloud analysis in GitHub</h1><p class=desc>How to use GitHub actions to analyze code with Sonar Cloud</p></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2021-03-13T08:00:00+02:00>2021, Mar 13</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>Well, you know me, I like to have my code analyzed by SonarCloud when possible, and since it is free for open source, I always use Azure DevOps pipeline to <strong>automatically analyze code on each push</strong>. Now that GitHub actions are available, a good solution is to simply <strong>use GitHub actions to analyze code, without disturbing Azure DevOps</strong>.</p><blockquote><p>Azure DevOps pipelines are, in my opinion, more mature than GitHub actions, but for small tasks, it is simpler to go with Actions.</p></blockquote><p>Using GitHub actions avoid the need to have an Azure DevOps organization, connect to GitHub and have your pipeline in another environment. <strong>For big projects it makes sense, but for small repositories with a bunch of open source code, using actions is the way to go</strong>.</p><p>Thanks to great work made by Sonar Cloud, if you create a new project, <strong>Sonar Cloud asks you location of the repository, and clearly GitHub is one of the options</strong></p><p><a target=_blank href=../images/sonarcloud-new-repo.png><img src=../images/sonarcloud-new-repo.png alt="Choose GitHub repository when you create a new Sonar Cloud project"></a>
<em><strong>Figure 1:</strong></em> <em>Choose GitHub repository when you create a new Sonar Cloud project</em></p><p>Once you have selected your repository, SonarCloud tries to setup automatic analysis, but it does not work for a C# project, based on compiled language. Since we need to compile the project, the wizard suggests the use of some Continuous Integration Engines, and <strong>the first choice is GitHub Acions</strong>.</p><p><a target=_blank href=../images/sonarcloud-propose-actions.png><img src=../images/sonarcloud-propose-actions.png alt="Sonar Cloud propose GitHub actions if automatic analysis is not possible"></a>
<em><strong>Figure 2:</strong></em> <em>Sonar Cloud propose GitHub actions if automatic analysis is not possible</em></p><p>To perform analysis, we need to use a Java based tool to perform some tasks after we compiled solution code; GitHub Actions are perfect match for this kind of job.</p><blockquote><p>To analyze a project with a compiled language, you need some CI engine that automates the mundane task to configure and run Sonar Cloud analyzer-</p></blockquote><p>Once you choose GitHub actions, Sonar Cloud wizard asks you to add a secret to you repository.</p><p><a target=_blank href=../images/repository-secret.png><img src=../images/repository-secret.png alt="A wizard walks you into setting your GitHub Action to analyze the project"></a>
<em><strong>Figure 3:</strong></em> <em>A wizard walks you into setting your GitHub Action to analyze the project</em></p><p>In the next step, Sonar Cloud <strong>gives you a complete GitHub action file to perform the analysis</strong>, you can start from this file and customize it for your need, or you can simply copy all needed tasks into an existing action. You can also have more than one action, so you can setup an entire new action <strong>just to perform Sonar Cloud analysis</strong>.</p><p><a target=_blank href=../images/sonarcloud-actions-file-sampe.png><img src=../images/sonarcloud-actions-file-sampe.png alt="Sample GitHub actions file to analyze the project"></a>
<em><strong>Figure 4:</strong></em> <em>Sample GitHub actions file to analyze the project</em></p><p>You just need to create an action file inside .github/workflows directory and complete the action <strong>with the necessary tasks to build your code with language used</strong>.</p><p><a target=_blank href=../images/sonarcloud-build-your-code.png><img src=../images/sonarcloud-build-your-code.png alt="Just add commands to build your code and you are ready to go"></a>
<em><strong>Figure 5:</strong></em> <em>Just add commands to build your code and you are ready to go.</em></p><p>For a simple .NET core project, you can simply add an action that ensure the right version of .NET core is installed, then change the &lt;your build command> section of SonarCloud sample file to add the classic dotnet restore,build,test and you are finished.</p><p>This is the step to ensure that you have desired version of .NET core.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:#66d9ef>name</span>: Setup dotnet
    <span style=color:#66d9ef>uses</span>: actions/setup-dotnet@v1
    <span style=color:#66d9ef>with</span>:
        <span style=color:#66d9ef>dotnet-version</span>: <span style=color:#ae81ff>5.0</span>.x</code></pre></td></tr></table></div></div><p>And this one is the piece of PowerShell script you need to customize <strong>on pre-generated action file of Sonar Cloud</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>run</span>: <span style=color:#e6db74>|
</span><span style=color:#e6db74>    .\.sonar\scanner\dotnet-sonarscanner begin /k:&#34;alkampfergit_DotNetCoreCryptography&#34; /o:&#34;alkampfergit-github&#34; /d:sonar.login=&#34;${{ secrets.SONAR_TOKEN }}&#34; /d:sonar.host.url=&#34;https://sonarcloud.io&#34;</span>
    
<span style=display:block;width:100%;background-color:#3c3d38>    <span style=color:#75715e># Now restore packages and build everything.</span>
</span><span style=display:block;width:100%;background-color:#3c3d38>    dotnet restore src/DotNetCoreCryptography.sln
</span><span style=display:block;width:100%;background-color:#3c3d38>    dotnet test src/DotNetCoreCryptography.sln --collect <span style=color:#e6db74>&#34;Code Coverage&#34;</span>
</span><span style=display:block;width:100%;background-color:#3c3d38>    dotnet build src/DotNetCoreCryptography.sln --configuration release
</span>
    .\.sonar\scanner\dotnet-sonarscanner end /d:sonar.login=<span style=color:#e6db74>&#34;${{ secrets.SONAR_TOKEN }}&#34;</span></code></pre></td></tr></table></div></div><p>Push your changes to your repository and you should immediately start seeing results in Sonar Cloud.</p><blockquote><p>Thanks to tight integration between Sonar Cloud and GitHub, setting up an action to analyze your code is just a matter than no more than 5 minutes.</p></blockquote><p>Even if GitHub actions are less powerful than Azure DevOps pipeline, they are optimal for standard CI work like this, especially <strong>if you have a good integration that gives you a precise set of steps to follow to accomplish your goal</strong>.</p><p>GitHub actions have also some nice tasks to ensure prerequisites on the machine running the action, as an example, Sonar Cloud code starts with a task to ensure JDK is installed in the machine.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>steps</span>:
    - <span style=color:#66d9ef>name</span>: Set up JDK <span style=color:#ae81ff>11</span>
    <span style=color:#66d9ef>uses</span>: actions/setup-java@v1
    <span style=color:#66d9ef>with</span>:
        <span style=color:#66d9ef>java-version</span>: <span style=color:#ae81ff>1.11</span></code></pre></td></tr></table></div></div><blockquote><p>Task that automatically installs pre-requisites are the perfect solution to minimize the pain of preparing agents.</p></blockquote><p>This kind of pre-made steps are a blessing <strong>because remove the need to have preinstalled software in build machines</strong>. In the past, preparing an agent for a build with some other tools could be not so easy, especially if you need to have agents that are capable to build different software. Both GitHub actions and Azure DevOps pipelines have some nice tasks to install prerequisites on build agent.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/github/>github</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/sonarcloud/>sonarcloud</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/general/quick-ftp-upload-for-blog/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Quick ftp upload of multiple files</a></div><div class="next-entry sep-before"><a href=/post/github/code-scanning-result/><span class=screen-reader-text>Next post: </span>CodeQL Scanning in GitHub<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>