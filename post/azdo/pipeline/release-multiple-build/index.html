<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Sometimes you have legacy projects with many solutions that compose a single product. In this scenario you want to build each solution separately but you also need a full release to build everything at the same point in time"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Release a product composed by multiple projects and builds • Codewrecks"><meta property="og:description" content="Sometimes you have legacy projects with many solutions that compose a single product. In this scenario you want to build each solution separately but you also need a full release to build everything at the same point in time"><meta property="og:url" content="https://www.codewrecks.com/post/azdo/pipeline/release-multiple-build/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="AzDo"><meta property="article:tag" content="Pipeline"><meta property="article:published_time" content="2020-05-30T15:12:42+02:00"><meta property="article:modified_time" content="2020-05-30T15:12:42+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Release a product composed by multiple projects and builds • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/azdo/pipeline/release-multiple-build/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="page type-post has-sidebar"><div class=site><div id=sidebar class=sidebar><a class=screen-reader-text href=#main-menu>Skip to Main Menu</a><div class=container><section class="widget widget-about sep-after"><header><div class=logo><a href=/><img src=/images/logo.png></a></div><h2 class="title site-title"><a href=/>Codewrecks</a></h2><div class=desc>Wrecks of code floating in the sea of internet</div></header></section><section class="widget widget-sidebar_menu sep-after"><nav id=sidebar-menu class="menu sidebar-menu" aria-label="Sidebar Menu"><div class=container><ul><li class=item><a href=/>Home</a></li></ul></div></nav></section><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6590055118491660" crossorigin=anonymous></script><section class="widget widget-taxonomy_cloud sep-after"><header><h4 class="title widget-title">Tags</h4></header><div class="container list-container"><ul class="list taxonomy-cloud"><li><a href=/tags/actions/ style=font-size:1.0078740157480315em>Actions</a></li><li><a href=/tags/addin/ style=font-size:1.0078740157480315em>Addin</a></li><li><a href=/tags/agile/ style=font-size:1.0236220472440944em>Agile</a></li><li><a href=/tags/ai/ style=font-size:1em>AI</a></li><li><a href=/tags/alm/ style=font-size:1.0629921259842519em>ALM</a></li><li><a href=/tags/aop/ style=font-size:1.0236220472440944em>Aop</a></li><li><a href=/tags/api/ style=font-size:1.110236220472441em>Api</a></li><li><a href=/tags/applicationinsights/ style=font-size:1.0236220472440944em>ApplicationInsights</a></li><li><a href=/tags/architecture/ style=font-size:1.1023622047244095em>Architecture</a></li><li><a href=/tags/architecture-castle/ style=font-size:1.0078740157480315em>Architecture Castle</a></li><li><a href=/tags/aspnet/ style=font-size:1.3700787401574803em>ASPNET</a></li><li><a href=/tags/aspnet-mvc/ style=font-size:1.031496062992126em>AspNet MVC</a></li><li><a href=/tags/azdo/ style=font-size:1.1653543307086613em>AzDo</a></li><li><a href=/tags/azure/ style=font-size:1.0866141732283465em>Azure</a></li><li><a href=/tags/azure-devops/ style=font-size:1.110236220472441em>Azure Devops</a></li><li><a href=/tags/azure-pipelines/ style=font-size:1.031496062992126em>Azure Pipelines</a></li><li><a href=/tags/azuredevops/ style=font-size:1.0708661417322836em>AzureDevOps</a></li><li><a href=/tags/backup/ style=font-size:1.0078740157480315em>Backup</a></li><li><a href=/tags/blend/ style=font-size:1.0078740157480315em>Blend</a></li><li><a href=/tags/blog/ style=font-size:1.0078740157480315em>Blog</a></li><li><a href=/tags/blogging/ style=font-size:1.0551181102362204em>blogging</a></li><li><a href=/tags/books/ style=font-size:1.015748031496063em>Books</a></li><li><a href=/tags/branch/ style=font-size:1.0078740157480315em>Branch</a></li><li><a href=/tags/build/ style=font-size:1.6220472440944882em>build</a></li><li><a href=/tags/c/ style=font-size:1.0078740157480315em>C</a></li><li><a href=/tags/castle/ style=font-size:1.236220472440945em>castle</a></li><li><a href=/tags/clickonce/ style=font-size:1.0236220472440944em>ClickOnce</a></li><li><a href=/tags/codeanalysis/ style=font-size:1.0078740157480315em>CodeAnalysis</a></li><li><a href=/tags/codespaces/ style=font-size:1.0236220472440944em>Codespaces</a></li><li><a href=/tags/continuos-integration/ style=font-size:1.031496062992126em>Continuos Integration</a></li><li><a href=/tags/continuous-deployment/ style=font-size:1.0393700787401574em>Continuous Deployment</a></li><li><a href=/tags/continuous-integration/ style=font-size:1.031496062992126em>Continuous Integration</a></li><li><a href=/tags/cqrs/ style=font-size:1.0078740157480315em>CQRS</a></li><li><a href=/tags/datadude/ style=font-size:1.0393700787401574em>DataDude</a></li><li><a href=/tags/datagrid/ style=font-size:1.0078740157480315em>DataGrid</a></li><li><a href=/tags/ddd/ style=font-size:1.1181102362204725em>DDD</a></li><li><a href=/tags/debugging/ style=font-size:1.0078740157480315em>Debugging</a></li><li><a href=/tags/dev11/ style=font-size:1.0078740157480315em>dev11</a></li><li><a href=/tags/developing/ style=font-size:1em>developing</a></li><li><a href=/tags/devops/ style=font-size:1.125984251968504em>DevOps</a></li><li><a href=/tags/docker/ style=font-size:1.0078740157480315em>Docker</a></li><li><a href=/tags/dotnet/ style=font-size:1em>dotnet</a></li><li><a href=/tags/ef/ style=font-size:1.0078740157480315em>EF</a></li><li><a href=/tags/ef-code-first/ style=font-size:1.031496062992126em>EF Code First</a></li><li><a href=/tags/ef41/ style=font-size:1.0236220472440944em>EF41</a></li><li><a href=/tags/ef5/ style=font-size:1.015748031496063em>EF5</a></li><li><a href=/tags/enterprise-library/ style=font-size:1.0236220472440944em>Enterprise Library</a></li><li><a href=/tags/entity-framework/ style=font-size:1.094488188976378em>Entity Framework</a></li><li><a href=/tags/everydaylife/ style=font-size:1.047244094488189em>EverydayLife</a></li><li><a href=/tags/excel/ style=font-size:1.0078740157480315em>Excel</a></li><li><a href=/tags/experiences/ style=font-size:1.2440944881889764em>Experiences</a></li><li><a href=/tags/frameworks/ style=font-size:1.0629921259842519em>Frameworks</a></li><li><a href=/tags/general/ style=font-size:2em>General</a></li><li><a href=/tags/git/ style=font-size:1.2283464566929134em>Git</a></li><li><a href=/tags/git-tf/ style=font-size:1.0078740157480315em>git-tf</a></li><li><a href=/tags/github/ style=font-size:1.1574803149606299em>GitHub</a></li><li><a href=/tags/github-actions/ style=font-size:1.015748031496063em>GitHub Actions</a></li><li><a href=/tags/gpt4/ style=font-size:1em>GPT4</a></li><li><a href=/tags/hacking/ style=font-size:1em>Hacking</a></li><li><a href=/tags/hardware/ style=font-size:1.031496062992126em>Hardware</a></li><li><a href=/tags/hql/ style=font-size:1.0078740157480315em>HQL</a></li><li><a href=/tags/html/ style=font-size:1.0078740157480315em>Html</a></li><li><a href=/tags/hugo/ style=font-size:1em>hugo</a></li><li><a href=/tags/icriteria/ style=font-size:1.0078740157480315em>ICriteria</a></li><li><a href=/tags/iis/ style=font-size:1.015748031496063em>IIS</a></li><li><a href=/tags/ioc/ style=font-size:1.015748031496063em>IoC</a></li><li><a href=/tags/javascript/ style=font-size:1.0078740157480315em>Javascript</a></li><li><a href=/tags/jquery/ style=font-size:1.047244094488189em>JQuery</a></li><li><a href=/tags/kali/ style=font-size:1.0078740157480315em>kali</a></li><li><a href=/tags/lab-management/ style=font-size:1.1023622047244095em>Lab Management</a></li><li><a href=/tags/languages/ style=font-size:1.0551181102362204em>Languages</a></li><li><a href=/tags/linq/ style=font-size:1.204724409448819em>LINQ</a></li><li><a href=/tags/linux/ style=font-size:1.0551181102362204em>Linux</a></li><li><a href=/tags/log4net/ style=font-size:1.047244094488189em>log4net</a></li><li><a href=/tags/lucene/ style=font-size:1.0629921259842519em>lucene</a></li><li><a href=/tags/macro/ style=font-size:1.0236220472440944em>Macro</a></li><li><a href=/tags/masstransit/ style=font-size:1.015748031496063em>masstransit</a></li><li><a href=/tags/mef/ style=font-size:1.0236220472440944em>MEF</a></li><li><a href=/tags/metroui/ style=font-size:1.0078740157480315em>MetroUi</a></li><li><a href=/tags/microsoft-test-manager/ style=font-size:1.015748031496063em>Microsoft Test Manager</a></li><li><a href=/tags/mms/ style=font-size:1.015748031496063em>mms</a></li><li><a href=/tags/mongo/ style=font-size:1.0236220472440944em>Mongo</a></li><li><a href=/tags/mongodb/ style=font-size:1.1574803149606299em>MongoDB</a></li><li><a href=/tags/msbuild/ style=font-size:1.031496062992126em>Msbuild</a></li><li><a href=/tags/mstest/ style=font-size:1.0078740157480315em>MsTest</a></li><li><a href=/tags/mvvm/ style=font-size:1.0708661417322836em>MVVM</a></li><li><a href=/tags/nablasoft/ style=font-size:1.0236220472440944em>Nablasoft</a></li><li><a href=/tags/ndepend/ style=font-size:1.0236220472440944em>NDepend</a></li><li><a href=/tags/net/ style=font-size:1.0236220472440944em>Net</a></li><li><a href=/tags/net-core/ style=font-size:1.0078740157480315em>NET Core</a></li><li><a href=/tags/net-framework/ style=font-size:1.5118110236220472em>NET framework</a></li><li><a href=/tags/netcore/ style=font-size:1.0236220472440944em>NETCORE</a></li><li><a href=/tags/nhibernate/ style=font-size:1.5039370078740157em>Nhibernate</a></li><li><a href=/tags/nosql/ style=font-size:1.0629921259842519em>NoSql</a></li><li><a href=/tags/nsm/ style=font-size:1em>nsm</a></li><li><a href=/tags/nuget/ style=font-size:1.0393700787401574em>nuget</a></li><li><a href=/tags/nunit/ style=font-size:1.0393700787401574em>Nunit</a></li><li><a href=/tags/office/ style=font-size:1.0236220472440944em>Office</a></li><li><a href=/tags/oidc/ style=font-size:1em>OIDC</a></li><li><a href=/tags/oop/ style=font-size:1.0236220472440944em>OOP</a></li><li><a href=/tags/openxml/ style=font-size:1.0078740157480315em>OpenXml</a></li><li><a href=/tags/orm/ style=font-size:1.0236220472440944em>ORM</a></li><li><a href=/tags/performance/ style=font-size:1.0393700787401574em>Performance</a></li><li><a href=/tags/pgp/ style=font-size:1em>PGP</a></li><li><a href=/tags/pills/ style=font-size:1.1181102362204725em>Pills</a></li><li><a href=/tags/pipeline/ style=font-size:1.0551181102362204em>Pipeline</a></li><li><a href=/tags/pipelines/ style=font-size:1em>pipelines</a></li><li><a href=/tags/plugin/ style=font-size:1.031496062992126em>Plugin</a></li><li><a href=/tags/power-tools/ style=font-size:1.0236220472440944em>Power Tools</a></li><li><a href=/tags/powershell/ style=font-size:1.1023622047244095em>PowerShell</a></li><li><a href=/tags/process-template/ style=font-size:1.047244094488189em>Process Template</a></li><li><a href=/tags/programming/ style=font-size:1.125984251968504em>Programming</a></li><li><a href=/tags/pullrequests/ style=font-size:1em>PullRequests</a></li><li><a href=/tags/python/ style=font-size:1.015748031496063em>Python</a></li><li><a href=/tags/ravendb/ style=font-size:1.031496062992126em>RavenDB</a></li><li><a href=/tags/release/ style=font-size:1.031496062992126em>release</a></li><li><a href=/tags/releasemanagement/ style=font-size:1.0551181102362204em>ReleaseManagement</a></li><li><a href=/tags/resharper/ style=font-size:1.0236220472440944em>Resharper</a></li><li><a href=/tags/rest-apis/ style=font-size:1.0236220472440944em>Rest APIs</a></li><li><a href=/tags/rhinomock/ style=font-size:1.0078740157480315em>RhinoMock</a></li><li><a href=/tags/scrum/ style=font-size:1.0078740157480315em>Scrum</a></li><li><a href=/tags/searching/ style=font-size:1.0393700787401574em>searching</a></li><li><a href=/tags/security/ style=font-size:1.3622047244094488em>security</a></li><li><a href=/tags/securityonion/ style=font-size:1em>securityonion</a></li><li><a href=/tags/shim/ style=font-size:1.0078740157480315em>shim</a></li><li><a href=/tags/signalr/ style=font-size:1.0078740157480315em>signalr</a></li><li><a href=/tags/silverlight/ style=font-size:1.015748031496063em>Silverlight</a></li><li><a href=/tags/software-architecture/ style=font-size:1.125984251968504em>Software Architecture</a></li><li><a href=/tags/solr/ style=font-size:1.0551181102362204em>Solr</a></li><li><a href=/tags/sonarcloud/ style=font-size:1.0078740157480315em>sonarcloud</a></li><li><a href=/tags/sonarqube/ style=font-size:1.0551181102362204em>sonarqube</a></li><li><a href=/tags/springnet/ style=font-size:1em>SpringNET</a></li><li><a href=/tags/sql-server/ style=font-size:1.236220472440945em>Sql Server</a></li><li><a href=/tags/sqlite/ style=font-size:1.0078740157480315em>SQLite</a></li><li><a href=/tags/ssd/ style=font-size:1.047244094488189em>SSD</a></li><li><a href=/tags/ssis/ style=font-size:1.0078740157480315em>SSIS</a></li><li><a href=/tags/symbols/ style=font-size:1em>Symbols</a></li><li><a href=/tags/team-foundation-server/ style=font-size:1.4330708661417324em>Team Foundation Server</a></li><li><a href=/tags/teamfoundationserver/ style=font-size:1.0236220472440944em>TeamFoundationServer</a></li><li><a href=/tags/terraform/ style=font-size:1em>terraform</a></li><li><a href=/tags/test/ style=font-size:1.0078740157480315em>Test</a></li><li><a href=/tags/testing/ style=font-size:1.5511811023622046em>Testing</a></li><li><a href=/tags/testlab/ style=font-size:1.0078740157480315em>TestLab</a></li><li><a href=/tags/tf-service/ style=font-size:1.047244094488189em>TF Service</a></li><li><a href=/tags/tfs/ style=font-size:1.7716535433070866em>Tfs</a></li><li><a href=/tags/tfs-build/ style=font-size:1.236220472440945em>TFS Build</a></li><li><a href=/tags/tfs-power-tools/ style=font-size:1.0078740157480315em>Tfs Power Tools</a></li><li><a href=/tags/tfs-service/ style=font-size:1.0078740157480315em>Tfs service</a></li><li><a href=/tags/tfs11/ style=font-size:1.015748031496063em>TFS11</a></li><li><a href=/tags/tfsapi/ style=font-size:1.031496062992126em>TfsAPI</a></li><li><a href=/tags/tfsbuild/ style=font-size:1.1023622047244095em>TfsBuild</a></li><li><a href=/tags/tfvc/ style=font-size:1.0078740157480315em>TFVC</a></li><li><a href=/tags/tika/ style=font-size:1.0236220472440944em>tika</a></li><li><a href=/tags/tls/ style=font-size:1.0078740157480315em>TLS</a></li><li><a href=/tags/tools/ style=font-size:1.0078740157480315em>Tools</a></li><li><a href=/tags/tools-and-library/ style=font-size:1.1338582677165354em>Tools and library</a></li><li><a href=/tags/tryhackme/ style=font-size:1em>TryHackMe</a></li><li><a href=/tags/uat/ style=font-size:1.015748031496063em>UAT</a></li><li><a href=/tags/ubuntu/ style=font-size:1em>Ubuntu</a></li><li><a href=/tags/uncategorized/ style=font-size:1.3149606299212597em>Uncategorized</a></li><li><a href=/tags/unit-testing/ style=font-size:1.0551181102362204em>Unit Testing</a></li><li><a href=/tags/unittesting/ style=font-size:1em>UnitTesting</a></li><li><a href=/tags/upgrade/ style=font-size:1.0629921259842519em>Upgrade</a></li><li><a href=/tags/vcs/ style=font-size:1.015748031496063em>VCS</a></li><li><a href=/tags/virtual-machine/ style=font-size:1.031496062992126em>Virtual Machine</a></li><li><a href=/tags/visual-studio/ style=font-size:1.3307086614173227em>Visual Studio</a></li><li><a href=/tags/visual-studio-2013/ style=font-size:1.0078740157480315em>Visual Studio 2013</a></li><li><a href=/tags/visual-studio-alm/ style=font-size:1.2834645669291338em>Visual Studio ALM</a></li><li><a href=/tags/visual-studio-database-edition/ style=font-size:1.031496062992126em>Visual Studio Database Edition</a></li><li><a href=/tags/vnext/ style=font-size:1.0551181102362204em>vNext</a></li><li><a href=/tags/vs11/ style=font-size:1.031496062992126em>VS11</a></li><li><a href=/tags/vs2010/ style=font-size:1.0078740157480315em>VS2010</a></li><li><a href=/tags/vs2012/ style=font-size:1.031496062992126em>VS2012</a></li><li><a href=/tags/vsalm/ style=font-size:1.031496062992126em>VSAlm</a></li><li><a href=/tags/vsdbedition/ style=font-size:1.0078740157480315em>VSDBEdition</a></li><li><a href=/tags/vso/ style=font-size:1.0708661417322836em>VSO</a></li><li><a href=/tags/vsts/ style=font-size:1.3228346456692912em>VSTS</a></li><li><a href=/tags/vstsdbedition/ style=font-size:1.0078740157480315em>VSTSDBEdition</a></li><li><a href=/tags/wcf/ style=font-size:1.125984251968504em>Wcf</a></li><li><a href=/tags/wcf-iis7/ style=font-size:1.0078740157480315em>WCF IIS7</a></li><li><a href=/tags/web-test/ style=font-size:1.015748031496063em>Web Test</a></li><li><a href=/tags/webbrowser/ style=font-size:1.015748031496063em>WebBrowser</a></li><li><a href=/tags/windows/ style=font-size:1.031496062992126em>Windows</a></li><li><a href=/tags/winforms/ style=font-size:1.0236220472440944em>Winforms</a></li><li><a href=/tags/workflow/ style=font-size:1.0236220472440944em>workflow</a></li><li><a href=/tags/wpf/ style=font-size:1.3937007874015748em>WPF</a></li><li><a href=/tags/wsl/ style=font-size:1em>WSL</a></li><li><a href=/tags/wsl2/ style=font-size:1em>wsl2</a></li><li><a href=/tags/xaml/ style=font-size:1.015748031496063em>XAML</a></li><li><a href=/tags/yaml/ style=font-size:1.0236220472440944em>YAML</a></li><li><a href=/tags/zero-trust-security/ style=font-size:1.0078740157480315em>Zero Trust Security</a></li></ul></div></section></div><div class=sidebar-overlay></div></div><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><a class=screen-reader-text href=#content>Skip to Content</a>
<button id=sidebar-toggler class=sidebar-toggler aria-controls=sidebar>
<span class=screen-reader-text>Toggle Sidebar</span>
<span class=open><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></span><span class=close><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></button><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/git-videos/>Git Videos</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Release a product composed by multiple projects and builds</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Release a product composed by multiple projects and builds</h1><p class=desc>Sometimes you have legacy projects with many solutions that compose a single product. In this scenario you want to build each solution separately but you also need a full release to build everything at the same point in time</p></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2020-05-30T15:12:42+02:00>2020, May 30</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>10 mins read</span></div></div></header><div class="container entry-content"><h2 id=situation>Situation</h2><p>We have a legacy project, born when Asp.Net WebForm was still a thing and Asp.NET MVC was still not released. This project grow during the years, in more that one subversion and git repositories. It was finally time to start setting some best practice in action and, to avoid complexity, we end with a <strong>single Git Repositories with six subfolders and six different solutions, each one that contains a part of the final product</strong>.</p><blockquote><p>Even if we are in the era of microservices, sometimes it is just convenient having all solutions in a single repository, let&rsquo;s see how to deal with this scenario for Azure Pipeline context.</p></blockquote><h3 id=build-only-project-that-changes>Build only project that changes</h3><p>We are still on the path of standardizing all the builds, but since some projects are full Framework, some other are in .NET Core, we end having six different YAML definitions, each one that builds a specific project.</p><p>Thanks to <strong>trigger branch filtering</strong>, we were able to implement continuous integration, but only if someone changes code inside specific path.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>trigger</span>:
  <span style=color:#66d9ef>branches</span>:
    <span style=color:#66d9ef>include</span>:
      - master
      - develop
      - release/*
      - hotfix/*
      - feature/*
<span style=display:block;width:100%;background-color:#3c3d38>  <span style=color:#66d9ef>paths</span>:
</span><span style=display:block;width:100%;background-color:#3c3d38>    <span style=color:#66d9ef>include</span>:
</span><span style=display:block;width:100%;background-color:#3c3d38>      - src/Connector</span></code></pre></td></tr></table></div></div><p>In the above piece of YAML build, we impose a continuous integration on standard GitFlow branches, but since <strong>this build target a project called Connector , I&rsquo;ve setup a path filter to include only changes in src/Connetor subfolder</strong>. With this configuration if someone changes other solutions of the repository, this build is not triggered. This is really important, because having six different projects and six different builds in the same repository, we will have six builds triggered at every push, even if only one project was really changed.</p><h3 id=powershell-build>PowerShell build</h3><p>Each build can be done with a different script/technique but essentially every build produces one or more artifacts and each artifact is a 7zip archive containing everything needed to release that specific project and has a name determined from GitVersion. <strong>GitVersion is a key part of the process because it will assure me a unique number for each commit</strong>.</p><p>To simplify the process, we created a simple PowerShell file that uses standard dotnet command line tooling to build / test / publish a project, <strong>this allows each developer to locally run build.ps1 script and have the very same result that you can have from Azure DevOps pipeline</strong>.</p><blockquote><p>Reproducibility of a build in developer machine can be a nice properties of your Continuous Integration infrastructure.</p></blockquote><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>Write-Host <span style=color:#e6db74>&#34;restoring tooling for gitversion&#34;</span>
<span style=display:block;width:100%;background-color:#3c3d38>dotnet tool restore
</span>
Write-Host <span style=color:#e6db74>&#34;Running gitversion to determine version&#34;</span>
<span style=display:block;width:100%;background-color:#3c3d38>$version = dotnet tool run dotnet-gitversion /config GitVersion.yml | Out-String | ConvertFrom-Json
</span>Write-Output $version

$assemblyVer = $version.AssemblySemVer
$assemblyFileVer = $version.AssemblySemFileVer
$nugetVersion = $version.NuGetVersionV2
$assemblyInformationalVersion = $version.FullSemVer + <span style=color:#e6db74>&#34;.&#34;</span> + $version.Sha
$fullSemver = $version.FullSemVer</code></pre></td></tr></table></div></div><p>Using dotnet Core local tools strategy, we can simply use <a href=https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-tool-restore>dotnet restore</a> to use GitVersion and being able to run <em>dotnet tool run dotnet-giversion</em> and piping all the result to <em>ConvertFrom-Json</em> to extract all SemVerNumbers (line 2 and line 5).</p><h3 id=interact-with-devops-pipeline-from-powershell-script>Interact with DevOps Pipeline from PowerShell script</h3><p>If build.ps1 script is executed inside a Azure Devops Build we want to interact with Pipeline engine to basically obtain two noticeable results</p><ol><li>Change name of the build using SemVer numbers</li><li>Dump all environment variables (we use them a lot for testing DB etc)</li></ol><p>To detect if the script is running in a Azure DevOps pipeline we can simply check the existence of environment variable BUILD_BUILDID.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>$buildId = $env:BUILD_BUILDID
Write-Host <span style=color:#e6db74>&#34;Build id variable is $buildId&#34;</span>
$runInBuild = $false
<span style=color:#66d9ef>if</span> (!<span style=color:#66d9ef>[System.String]</span>::IsNullOrEmpty($buildId)) 
{
    $runInBuild = $true
    Write-Host <span style=color:#e6db74>&#34;Running in an Azure Devops Build&#34;</span>

    Write-Host <span style=color:#e6db74>&#34;##vso[build.updatebuildnumber]James OpcUA Simulator - $fullSemver&#34;</span>
    Write-Host <span style=color:#e6db74>&#34;##vso[task.setvariable variable=currentVersion;]$nugetVersion&#34;</span>

    Write-Host <span style=color:#e6db74>&#34;Dumping all environment variable of the build&#34;</span>
    $var = (gci env<span style=color:#960050;background-color:#1e0010>:</span>*).GetEnumerator() | Sort-Object Name
    $out = <span style=color:#e6db74>&#34;&#34;</span>
    <span style=color:#66d9ef>Foreach</span> ($v <span style=color:#66d9ef>in</span> $var) {$out = $out + <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>`t</span><span style=color:#e6db74>{0,-28} = {1,-28}</span><span style=color:#ae81ff>`n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>-f</span> $v.Name, $v.Value}

    write-output <span style=color:#e6db74>&#34;dump variables on $outFolder\test.md&#34;</span>
    $fileName = <span style=color:#e6db74>&#34;$outFolder\test.md&#34;</span>
    set-content $fileName $out

    write-output <span style=color:#e6db74>&#34;##vso[task.addattachment type=Distributedtask.Core.Summary;name=Environment Variables;]$fileName&#34;</span>
}</code></pre></td></tr></table></div></div><p>Code is really simple, outputting <strong>##vso[build.updatebuildnumber]</strong> commands updates the build number. To dump environment variables or whatever information you need, just add a MarkDown file as attachment.</p><blockquote><p>This simple technique allows to run portion of PowerShell script only in the context of a Pipeline.</p></blockquote><h3 id=creating-artifacts>Creating artifacts</h3><p>Once tests run successfully we use <strong>dotnet publish command</strong> to publish every project that needs to be published, we use <strong>Semantic versioning</strong> and a simple function that download (if needed) <strong>and uses 7za.exe tool to compress result</strong> with 7zip</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>dotnet publish James.Connector\James.Connector.csproj --configuration $configuration -o <span style=color:#e6db74>&#34;$outFolder\Service&#34;</span> /p:PackageVersion=$nugetVersion /p:AssemblyVersion=$assemblyVer /p:FileVersion=$assemblyFileVer /p:InformationalVersion=$assemblyInformationalVersion

Write-Output <span style=color:#e6db74>&#34;Compress everything&#34;</span>
$sevenZipExe = Get-7ZipLocation
Write-Output <span style=color:#e6db74>&#34;Exe 7zip used is $sevenZipExe&#34;</span>

set-alias sz $sevenZipExe
$Source = <span style=color:#e6db74>&#34;$outFolder\Service\*.*&#34;</span>
$Target = <span style=color:#e6db74>&#34;$outFolder\Compressed\Connector-$nugetVersion.7z&#34;</span>
Write-Output <span style=color:#e6db74>&#34;Zipping folder $Source in file $Target&#34;</span>
sz a -mx=9 -r -mmt=on $compressionOptions $Target $Source</code></pre></td></tr></table></div></div><p>Nothing really complex here, just publish and 7zipping everything in an archive that contains the version as returned from GitVersion.</p><blockquote><p>For legacy projects not written in .NET core a simple MSBuild publish will practically does the very same thing.</p></blockquote><h3 id=creating-yaml-build>Creating YAML Build</h3><p>Once a complete build.ps1 script is in place, we can create AzDo pipeline composed by only four tasks.</p><ol><li>Install if needed .NET core with desired version</li><li>Run script build.ps1</li><li>Upload test results</li><li>Upload artifacts</li></ol><p>This is the whole build.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  - <span style=color:#66d9ef>task</span>: UseDotNet@<span style=color:#ae81ff>2</span>
    <span style=color:#66d9ef>displayName</span>: <span style=color:#e6db74>&#39;Use .NET Core sdk $(DotNetCoreVersion)&#39;</span>
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>version</span>: $(DotNetCoreVersion)
      <span style=color:#66d9ef>performMultiLevelLookup</span>: <span style=color:#66d9ef>true</span>

  - <span style=color:#66d9ef>task</span>: PowerShell@<span style=color:#ae81ff>2</span>
    <span style=color:#66d9ef>displayName</span>: <span style=color:#e6db74>&#34;Execute build file to create release&#34;</span>
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>targetType</span>: filePath
      <span style=color:#66d9ef>filePath</span>: $(Build.SourcesDirectory)/src/Connector/build.ps1
      <span style=color:#66d9ef>workingDirectory</span>: $(Build.SourcesDirectory)/src/Connector
      <span style=color:#66d9ef>arguments</span>: -outFolder  $(Build.ArtifactStagingDirectory) -configuration ${{parameters.configuration}}
      <span style=color:#66d9ef>failOnStderr</span>: <span style=color:#66d9ef>true</span>

  - <span style=color:#66d9ef>task</span>: PublishTestResults@<span style=color:#ae81ff>2</span>
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>testResultsFormat</span>: <span style=color:#e6db74>&#39;VSTest&#39;</span>
      <span style=color:#66d9ef>testResultsFiles</span>: <span style=color:#e6db74>&#39;*.trx&#39;</span>
      <span style=color:#66d9ef>searchFolder</span>: <span style=color:#e6db74>&#39;$(Build.ArtifactStagingDirectory)&#39;</span>
      <span style=color:#66d9ef>testRunTitle</span>: <span style=color:#e6db74>&#39;Test&#39;</span>
    <span style=color:#66d9ef>condition</span>: succeededOrFailed()

  - <span style=color:#66d9ef>task</span>: PublishBuildArtifacts@<span style=color:#ae81ff>1</span>
    <span style=color:#66d9ef>displayName</span>: <span style=color:#e6db74>&#39;Publish Service Artifacts&#39;</span>
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>PathtoPublish</span>: <span style=color:#e6db74>&#39;$(Build.ArtifactStagingDirectory)\Compressed&#39;</span>
      <span style=color:#66d9ef>ArtifactName</span>: Connector</code></pre></td></tr></table></div></div><p>Once this build runs it produces a nice output, with all tests result and published artifacts.</p><p><a target=_blank href=../images/Connector-build-result-artifacts.png><img src=../images/Connector-build-result-artifacts.png alt="Connector artifacts"></a></p><p><em><strong>Figure 1:</strong></em> *Artifacts produced by Connector pipeline&rdquo;</p><p>As you can see <strong>artifacts name is &ldquo;Connector&rdquo; and it contains a single file, a 7ip archive that contains everything needed to be released</strong>, as packed by build.ps1 script. Archive file name contains software version, this is a legacy requirement, that makes automation of release a little bit more complex, but is indeed nice to avoid version confusion.</p><h3 id=simplify-release-building-every-project-for-a-full-release>Simplify release building every project for a full release</h3><p>With this setup, if a developer pushes a change on one of the six projects only the corresponding pipeline gets executed, it runs tests and produces and publishes artifacts. All green.</p><p>Now we face another small problem, <strong>when we need to do a complete release, we wish to run all pipelines on the very same Git commit, creating all the packages at the same point in time</strong>. This requirement really simplify the deploy because:</p><ol><li>We can be sure that all released code comes from the same point in time</li><li>Every assembly has the very same name</li><li>We are minimizing the risk of deploy with mismatched version</li></ol><blockquote><p>When all the packages can be published at the same moment, with the very same number, deploy is simplified because <strong>you can simply update every project using the very same version number.</strong></p></blockquote><p>Now suppose Connector project was never changed (and never built) from version 6.2 to 6.3. In this scenario if we need to deploy 6.3 version of another service, we could teoretically use version 6.2 of Connector service, <strong>because it is not changed</strong>. This add complexity in the game, because you should check every pipeline to understand what is latest version of every service. <strong>To have a really simple installation, if you compile and publish everything at the very same commit, you can simply have a simple rule where you deploy every service with the very same number</strong>.</p><blockquote><p>Simplicity always win over complexity</p></blockquote><h3 id=creating-a-single-release-pipeline-to-publish-every-project>Creating a single release pipeline to publish every project</h3><p>The obvious solution is <strong>create another pipeline</strong> automatically triggered on master branch (we release master branch as per GitFlow) <strong>that in turn triggers all the other six pipelines, grab artifacts and pack everything together</strong>. While this is indeed a simple approach it is annoying because in the end your release pipeline results is scattered in six distinct pipeline execution plus result of the orchestrating pipeline.</p><p><strong>Thanks to MultiStage pipeline and templates, there is a better solution</strong>. Instead of having a YAML pipeline definition for each project, we created one template for each project with all the steps needed to compile/publish that project. The real final build contains trigger definition, specification of which pool to use and a simple reference to template file containing real steps.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  <span style=color:#66d9ef>trigger</span>:
  <span style=color:#66d9ef>branches</span>:
    <span style=color:#66d9ef>include</span>:
      - master
      - develop
      - release/*
      - hotfix/*
      - feature/*
  <span style=color:#66d9ef>paths</span>:
    <span style=color:#66d9ef>include</span>:
      - src/Connector

<span style=color:#66d9ef>variables</span>:
  <span style=color:#66d9ef>Configuration</span>: release

<span style=color:#66d9ef>jobs</span>:

- <span style=color:#66d9ef>job</span>: build_test_release

  <span style=color:#66d9ef>pool</span>:
    <span style=color:#66d9ef>name</span>: <span style=color:#e6db74>&#39;$(Pool)&#39;</span>
    <span style=color:#66d9ef>demands</span>:
      - vstest
      - msbuild
      - visualstudio

<span style=display:block;width:100%;background-color:#3c3d38>  <span style=color:#66d9ef>steps</span>:
</span><span style=display:block;width:100%;background-color:#3c3d38>  - <span style=color:#66d9ef>template</span>: BuildConnectorTemplate.yaml
</span><span style=display:block;width:100%;background-color:#3c3d38>    <span style=color:#66d9ef>parameters</span>:
</span><span style=display:block;width:100%;background-color:#3c3d38>      <span style=color:#66d9ef>configuration</span>: $(Configuration)</span></code></pre></td></tr></table></div></div><p>The definition does not include any real task, <strong>everything is contained in template file</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>parameters</span>:
  <span style=color:#66d9ef>configuration</span>: release

<span style=color:#66d9ef>steps</span>:
  
  - <span style=color:#66d9ef>task</span>: UseDotNet@<span style=color:#ae81ff>2</span>
    <span style=color:#66d9ef>displayName</span>: <span style=color:#e6db74>&#39;Use .NET Core sdk $(DotNetCoreVersion)&#39;</span>
    <span style=color:#66d9ef>inputs</span>:
      <span style=color:#66d9ef>version</span>: $(DotNetCoreVersion)
      <span style=color:#66d9ef>performMultiLevelLookup</span>: <span style=color:#66d9ef>true</span>
      ...</code></pre></td></tr></table></div></div><blockquote><p>Thanks to pipeline template, we can define the real sequence of steps to compile a project in a single file, then reuse that file in multiple pipelines.</p></blockquote><p>We proceeded converting each of the six pipeline to template + pipeline format.</p><h3 id=creating-the-single-release-pipeline>Creating the single release pipeline</h3><p>At this point we have six template and six pipeline that uses those templates, so we can proceed with the creation of a <strong>single multi staged pipeline that triggers all templates one after another</strong>.
At this point we have six template and six pipeline that uses those templates, so we can proceed with the creation of a <strong>single multi staged pipeline that triggers all templates one after another</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>trigger</span>:
  <span style=color:#66d9ef>branches</span>:
    <span style=color:#66d9ef>include</span>:
      - master

<span style=color:#66d9ef>variables</span>:
  <span style=color:#66d9ef>Configuration</span>: release

<span style=color:#66d9ef>stages</span>:
  - <span style=color:#66d9ef>stage</span>: Excute_all_other_pipelines
  
    <span style=color:#66d9ef>jobs</span>:
<span style=display:block;width:100%;background-color:#3c3d38>      - <span style=color:#66d9ef>job</span>: <span style=color:#e6db74>&#34;trigger_connector&#34;</span>
</span><span style=display:block;width:100%;background-color:#3c3d38>        <span style=color:#66d9ef>pool</span>: 
</span><span style=display:block;width:100%;background-color:#3c3d38>          <span style=color:#66d9ef>name</span>: $(pool)
</span><span style=display:block;width:100%;background-color:#3c3d38>        <span style=color:#66d9ef>steps</span>:
</span><span style=display:block;width:100%;background-color:#3c3d38>        - <span style=color:#66d9ef>template</span>: BuildConnectorTemplate.yaml
</span><span style=display:block;width:100%;background-color:#3c3d38>          <span style=color:#66d9ef>parameters</span>:
</span><span style=display:block;width:100%;background-color:#3c3d38>            <span style=color:#66d9ef>configuration</span>: $(Configuration)
</span>
      - <span style=color:#66d9ef>job</span>: <span style=color:#e6db74>&#34;trigger_OpcSimulator&#34;</span>
        <span style=color:#66d9ef>pool</span>: 
          <span style=color:#66d9ef>name</span>: $(pool)
          ...</code></pre></td></tr></table></div></div><p>In this first version <strong>the pipeline really has a single stage, but in the jobs section we can refer all six different templates</strong>. In previous listing in line 13-19 template for building Connector project is included. Then in line 21 template for OpcSimulator is also included, and this is done for every other template.</p><p>When the pipeline runs it will <strong>execute one after one all the jobs for all projects</strong>. In <strong>Figure 2</strong> you can see the result after I included 5 projects in this final build.</p><p><a target=_blank href=../images/multi-stage-release-pipeline-results.png><img src=../images/multi-stage-release-pipeline-results.png alt="Multi stage pipeline result"></a></p><p><em><strong>Figure 2:</strong></em> <em>Multi stage pipeline result</em></p><p>Since each template takes care of its own artifacts publishing, at the end of the build <strong>I have all artifacts and test results in a single pipeline execution result</strong> with very little effort.</p><blockquote><p>Having a single pipeline with multiple job is the best solution because we have multiple templates result in a single location.</p></blockquote><p>The following picture will show artifacts section of pipeline execution result.</p><p><a target=_blank href=../images/full-release-james-artifacts.png><img src=../images/full-release-james-artifacts.png alt="Multi stage pipeline artifacts result"></a></p><p><em><strong>Figure 3:</strong></em> <em>Multi stage pipeline artifacts result</em></p><p>Looking at <strong>Figure 3</strong> you can notice that all projects are indeed compiled at the very same version, contained in archive name. This will completely avoid risk of deploying incompatible versions, <strong>we can always deploy all the services at a given version from a single pipeline output</strong>.</p><p>Using template approach gives us the following advantages</p><ol><li>The sequence of tasks needed to build/release a single project is defined only in a single place, the template.</li><li>Reusing template in more than one pipeline gives us the ability to run the very same tasks sequence in multiple pipeline</li><li>Avoiding the approach of a pipeline that triggers other pipeline saves us from using two licenses for each run (one for the orchestrating pipeline the other for triggered pipeline)</li><li>Using a build with multiple jobs, we really have one single result page with result for every project run.</li><li>We decoupled the what of the pipeline (sequence of tasks) from pipeline configuration (triggers, pool to use)</li></ol><p>In the end we are satisfied with this solution and as always a great kudo to Azure DevOps team for the flexibility of pipeline engine.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/azuredevops/>AzureDevOps</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/azdo/>AzDo</a>, <a class=tag href=/tags/pipeline/>Pipeline</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/security/play-security-in-a-secure-environment/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Play security in a secure environment</a></div><div class="next-entry sep-before"><a href=/post/general/compile-angular-in-wsl2/><span class=screen-reader-text>Next post: </span>Compiling Angular app in WSL2<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2023 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>