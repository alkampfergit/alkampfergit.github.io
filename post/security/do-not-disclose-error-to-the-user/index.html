<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Returning too much information about error to the user is usually a bad idea."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Do Not Disclose Errors to the User • Codewrecks"><meta property="og:description" content="Returning too much information about error to the user is usually a bad idea."><meta property="og:url" content="https://www.codewrecks.com/post/security/do-not-disclose-error-to-the-user/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="security"><meta property="article:tag" content="programming"><meta property="article:published_time" content="2020-07-03T22:13:30+02:00"><meta property="article:modified_time" content="2020-07-03T22:13:30+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Do Not Disclose Errors to the User • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/security/do-not-disclose-error-to-the-user/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Do Not Disclose Errors to the User</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Do Not Disclose Errors to the User</h1><p class=desc>Returning too much information about error to the user is usually a bad idea.</p></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2020-07-03T22:13:30+02:00>2020, Jul 03</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>This is the fourth article in a series of post dealing on why it is important to strictly validate user input.</p><ol><li><a href=http://www.codewrecks.com/blog/index.php/2020/01/28/do-not-trust-user-input-enforce-whitelists-narrow-allowable-input/>Do not trust user input part 1</a></li><li><a href=http://www.codewrecks.com/blog/index.php/2020/01/29/do-not-trust-user-input-part-2/>Do not trust user input part 2</a></li><li><a href=http://www.codewrecks.com/blog/index.php/2020/02/19/do-not-trust-user-input-part-3/>Do not trust user input part 3</a></li><li><a href=http://localhost:1313/post/security/validate-user-input-4/>Validate User Input part 4</a></li></ol><p>In the last post we analyzed how it is not fully possible to limit user input in some functions like search. The user could almost search for every character and it is not easy to impose a maximum length. Nevertheless <strong>imposing a maximum length of the string to 50 characters seems to break Sql Injection.</strong></p><blockquote><p>Remember, Sql injection is only one of the possible attack, the most obvious one. The purpose of these posts is raise awareness on how important is to whitelist user input when possible, and apply every possible restriction.</p></blockquote><p>The real goal is prevent not only the types of attack that you already know, but even the future ones. <strong>If you let the user input flow uncontrolled in your code you are vulnerable</strong>.</p><p>In this post I want to discuss another typical area where too much information is flowing, lets take the very first function that accepts a string as product Id.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#a6e22e>[SwaggerResponse(typeof(Product))]</span>
<span style=color:#a6e22e>[HttpGet]</span>
<span style=color:#a6e22e>[MapToApiVersion(&#34;1.0&#34;)]</span>
<span style=color:#66d9ef>public</span> IActionResult GetProductString(String productId)
{
    <span style=color:#66d9ef>var</span> query = DataAccess.CreateQuery(<span style=color:#e6db74>$&#34;Select * from dbo.Products where productId = {productId}&#34;</span>);
    <span style=color:#66d9ef>var</span> product = query.ExecuteBuildSingleEntity&lt;Product&gt;(Product.Builder);
    <span style=color:#66d9ef>return</span> Ok(product);
}
</code></pre></td></tr></table></div></div><p>As we saw on the first blog post, this code is indeed vulnerable to Sql Injection.</p><p><a target=_blank href=../images/sqlmap-on-the-run.png><img src=../images/sqlmap-on-the-run.png alt="SQLMAP output shows that the url is vulnerable"></a>
<em><strong>Figure 1:</strong></em> <em>Output of SQLMAP reveals SQL Injection vulnerability</em></p><p>Now let&rsquo;s check what is the answer of the server when you pass a string instead of a number (product id is a number)-</p><p><a target=_blank href=../images/error-shown-to-the-user.png><img src=../images/error-shown-to-the-user.png alt="Error shown to the user"></a>
<em><strong>Figure 2:</strong></em> *Raw error shown to the user&rdquo;</p><p>What you see in <strong>Figure 2</strong> is a standard SqlException returned to the user, a bad practice that reveals too much information to an attacker. This kind of errors is not only giving hint to the attacker to a possible vulnerability, but it is <strong>also used by automated tool to actually exploit the vulnerability</strong>.</p><blockquote><p>An attacker will use every piece of information you are returning to abuse your API, even the average <a href=https://nvisium.com/blog/2015/06/25/time-based-username-enumeration.html>time the function need to answer</a>.</p></blockquote><p>For this reason all frameworks usually have some sort of setting that prevent any information to flow to the user, such as giving a general error page result, but lets modify a little bit the previous function.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#a6e22e>[SwaggerResponse(typeof(Product))]</span>
<span style=color:#a6e22e>[HttpGet]</span>
<span style=color:#a6e22e>[MapToApiVersion(&#34;1.0&#34;)]</span>
<span style=color:#66d9ef>public</span> IActionResult GetProductStringNoException(String productId)
{
    <span style=color:#66d9ef>try</span>
    {
        <span style=color:#66d9ef>var</span> query = DataAccess.CreateQuery(<span style=color:#e6db74>$&#34;Select * from dbo.Products where productId = {productId}&#34;</span>);
        <span style=color:#66d9ef>var</span> product = query.ExecuteBuildSingleEntity&lt;Product&gt;(Product.Builder);
        <span style=color:#66d9ef>return</span> Ok(product);
    }
    <span style=color:#66d9ef>catch</span> (Exception ex)
    {
        _logger.LogError(ex, <span style=color:#e6db74>&#34;Error performing lookup by product id. {message}&#34;</span>, ex.Message);
        <span style=color:#66d9ef>return</span> Ok(<span style=color:#66d9ef>null</span>);
    }
}
</code></pre></td></tr></table></div></div><p>I&rsquo;m not an advocate of try/catch block directly in the API, you should trap an handle exception with middleware or some global hangler, but the above code has two important changes:</p><ol><li>It does not let exception details to the user</li><li>It logs the error with standard logging system.</li></ol><p><strong>Developers MUST learn how to troubleshoot problems using logs</strong> and, most importantly, the code will behave the same both while developing and in production. Now the question is, does such modification affect SQL injection?</p><p><a target=_blank href=../images/sql-map-output-when-exception-is-trapped.png><img src=../images/sql-map-output-when-exception-is-trapped.png alt="SqlMap behavior with exception trapped."></a>
<em><strong>Figure 3:</strong></em> <em>SQLMAP behave a little bit differently if you trapped all exception</em></p><p>From <strong>Figure 3</strong> you can verify that <strong>SQLMAP is finding a little more difficulties exploiting the injection, now that errors are trapped and a simple null is returned</strong>. This means that some of the techniques used are not effective anymore and are based on what the service is returning.</p><p>If you let SQLMAP try other Sql Injection techniques, <strong>it will still find the API to be vulnerable and it is able to exploit</strong>. Nevertheless avoiding returning errors to the user somewhat makes the API slightly more difficult to exploit.</p><p>Avoiding returning error is not a defense used primarly against a tool, <strong>is a defense mainly used against humans, because a human can use error response value to deduce some important consideration about your API.</strong> For this reason you should always avoid returning any error information to the user, either the API return a valid value or it must return a generic error.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/security/>security</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/security/>security</a>, <a class=tag href=/tags/programming/>Programming</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/general/error-in-mongodb-serializer/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Error in mapping MongoDb classes after updating to 2.10 driver</a></div><div class="next-entry sep-before"><a href=/post/azure/azure-bastion/><span class=screen-reader-text>Next post: </span>Access your azure VM with Azure Bastion<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>