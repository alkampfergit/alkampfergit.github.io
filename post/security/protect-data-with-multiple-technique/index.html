<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="You should always put in place multiple protection for your data"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Use multiple techniques to protect your data  • Codewrecks"><meta property="og:description" content="You should always put in place multiple protection for your data"><meta property="og:url" content="https://www.codewrecks.com/post/security/protect-data-with-multiple-technique/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="security"><meta property="article:tag" content="developing"><meta property="article:published_time" content="2020-09-12T08:00:00+02:00"><meta property="article:modified_time" content="2020-09-12T08:00:00+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Use multiple techniques to protect your data • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/security/protect-data-with-multiple-technique/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Use multiple techniques to protect your data</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Use multiple techniques to protect your data</h1><p class=desc>You should always put in place multiple protection for your data</p></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2020-09-12T08:00:00+02:00>2020, Sep 12</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>5 mins read</span></div></div></header><div class="container entry-content"><h2 id=the-problem>The problem</h2><p>Several years ago I had a friend called me for a problem with MongoDb, it turns out that <strong>someone, from an IP geolocated in China, accessed the instances during the night and wiped out everything</strong>.</p><p>The problem was due to some misconfiguration or human error or whatever that:</p><ol><li>turned off Windows firewall and port 27017 was open to the internet</li><li>MongoDb was installed with no password.</li><li>MongoDb was bound to all ip addresses of the machine</li></ol><p>When it is time to protect your data, you <strong>should add as many layers / techniques of protection as you can</strong>, this because, if one if them is failing, another one can still offer protection.</p><blockquote><p>Relaying on a single protection for your data is a single point of failure for security.</p></blockquote><p>Let&rsquo;s see as an exercise how you should approach building software based on MongoDb with a Security Oriented mind. This is not an academic exercise, because <strong>in last years lots of data bread regarded MongoDb and other NoSql database left opened in the wild with little or no protection</strong>.</p><p>Most of the time people left MongoDb bound to public ip with no password.</p><p><a target=_blank href=../images/horrified-eyes.png><img src=../images/horrified-eyes.png alt="Horrified eyes"></a></p><h2 id=stick-to-well-known-plan-made-by-experts>Stick to well known plan made by experts</h2><p>First of all you should check <strong>security guidance offered you by people responsible for the product you are using</strong>. If you check MongoDb site you have a <a href=https://docs.mongodb.com/manual/administration/security-checklist/>good page with a checklist for security.</a> you should read carefully to avoid doing mistakes. Clearly, before the checklist, you <strong>should learn how your <a href=https://docs.mongodb.com/manual/security/>product support security</a></strong>, because if you do not know all security features available in your products, you are in trouble.</p><blockquote><p>Most of the time, producer/maintainer of software publish security guideline for the product.</p></blockquote><p>Always check if there are updated version of Security Guidance for every product you use.</p><h2 id=what-can-you-do-to-enforce-the-plan>What can you do to enforce the plan</h2><p><strong>Problem number 1:</strong> most common error is using database in production without Password.</p><p>A typical solution to this problem is inserting in your software a kill switch that will completely stop everything if MongoDb connection has no password. But the real solution is: take connection string, strip away authentication and try to connect to the DB, <strong>if the connection is OK just stop everything</strong>. This will <strong>prevent anyone to deploy the app connecting to an unauthenticated MongoDb</strong>.</p><p>Then enforce a password complexity, using &ldquo;12345&rdquo; it is like having no password at all, if the password is not secure enough, the software will not start.</p><p><strong>Problem number 2:</strong> having your MongoDb instance bind to public ip</p><p>Never install MongoDb in a machine with a public IP, 99% of the time there is no need for public IP and <strong>if you really need to have a public instance of MongoDb accessible from the internet please have a look at <a href=https://www.mongodb.com/cloud/atlas>Atlas</a></strong>.</p><blockquote><p>Do you really want to take the risk of managing a public instance of mongo instead of paying those who build it to run the instance for you?</p></blockquote><p>Most of the time you have a small software where <strong>everything runs on the very same machine</strong>, be sure to verify that **MongDb bind only to localhost or private addresses. Again, you can do a quick check in your software.</p><p><a target=_blank href=../images/mongodb-check-commandline.png><img src=../images/mongodb-check-commandline.png alt="Check MongoDB configuration at runtime"></a>
<strong>Figure 1:</strong> <em>Check MongoDB configuration at runtime</em></p><p>You can always check actual configuration by code to see all Ip MongoDb is bound to, as usually <strong>you can refuse to start application if MongoDB is bound to public ip</strong>. As you can see in <strong>Figure 1</strong> this instance of mongo bounds to all ip and this is not an optimal situation.</p><p><strong>Problem number 3:</strong> Try to turn down the firewall</p><p>Well, this happens when you let non trained people to configure production machine, the very first time that a developer or an untrained person got a network error, the first thing he/she does is <strong>Lets turn down the firewall to see if it is a firewall issue</strong>. Then the firewall sometimes is never turned on again.</p><blockquote><p>Use the firewall to give MongoDb an extra layer of security</p></blockquote><p>For maximum security configure the firewall to allow access in port 27017 (MongoDb standard port) only from the IP of machines that are running services that can legitimately access MongoDb. <strong>If you have a single machine installation, add an explicit rule to block port 27017 for every ip except loopback</strong>. Use local firewall of the OS and if you have an external firewall use that too. This is valid even if you are in on-premise environment.</p><p>As a developer, create a simple script/program that verifies if the machine has a public IP assigned, try to access 27017 port on that public ip, and if the port is open immediately stop MongoDb services.</p><p>If you have a **machine in the same private subnet of MongoDb cluster that should not have access to MongoDb, install same check to verify that port 27017 is closed, if it is open send an alert.</p><h2 id=conclusion>Conclusion</h2><p>In a DevOps culture, everyone should work together as a single team to create the best outcome for your process and security should be one of the top priority. <strong>Every person of the team should contribute to create a more secure product and help other avoiding mistakes</strong>.</p><p>These suggestions works for MongoDb, but the concept is always valid, put in place how many layer of protection you can to avoid security problem due to misconfiguration, human errors and failure of a component.</p><p>Gian Maria</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/security/>security</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/security/>security</a>, <a class=tag href=/tags/developing/>developing</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/general/github-codespaces-first-impression/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>GitHub Codespaces first impression</a></div><div class="next-entry sep-before"><a href=/post/azdo/pills/update-java-for-sonarcloud-agents/><span class=screen-reader-text>Next post: </span>Azure DevOps Pills: Update java in agent machines if you use SonarCloud integration<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>