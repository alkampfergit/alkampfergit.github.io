<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I’ve already dealt on how to index documents with Solr and Tika and in this article I’ll explain how you can not only search for documents that match your query, but returns even some text extract that shows where the document match the query. To achieve this, you should store the full content of the document inside your index, usually I create a couple of fields, one called Content that will contain the content of the file, and with a copyfield directive ( <copyField source=”content” dest=”text”/> ) automatically copy that value inside the catch all field called text."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Hilight matched text inside documents indexed with Solr plus Tika • Codewrecks"><meta property="og:description" content="I’ve already dealt on how to index documents with Solr and Tika and in this article I’ll explain how you can not only search for documents that match your query, but returns even some text extract that shows where the document match the query. To achieve this, you should store the full content of the document inside your index, usually I create a couple of fields, one called Content that will contain the content of the file, and with a copyfield directive ( <copyField source=”content” dest=”text”/> ) automatically copy that value inside the catch all field called text."><meta property="og:url" content="https://www.codewrecks.com/post/old/2013/05/hilight-matched-text-inside-documents-indexed-with-solr-plus-tika/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="lucene"><meta property="article:tag" content="Solr"><meta property="article:tag" content="tika"><meta property="article:published_time" content="2013-05-27T07:00:37+02:00"><meta property="article:modified_time" content="2013-05-27T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Hilight matched text inside documents indexed with Solr plus Tika • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2013/05/hilight-matched-text-inside-documents-indexed-with-solr-plus-tika/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Hilight matched text inside documents indexed with Solr plus Tika</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Hilight matched text inside documents indexed with Solr plus Tika</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2013-05-27T07:00:37+02:00>2013, May 27</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>3 mins read</span></div></div></header><div class="container entry-content"><p>I’ve already dealt on how to <a href=http://www.codewrecks.com/blog/index.php/2013/05/25/import-folder-of-documents-with-apache-solr-4-0-and-tika/>index documents with Solr and Tika</a> and in this article I’ll explain how you can not only search for documents that match your query, but <strong>returns even some text extract that shows where the document match the query</strong>. To achieve this, you should store the full content of the document inside your index, usually I create a couple of fields, one called Content that will contain the content of the file, and with a copyfield directive (  &lt;copyField source=”content” dest=”text”/> ) automatically copy that value inside the catch all field called text.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>   <span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;content&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;text_general&#34;</span> <span style=color:#a6e22e>indexed=</span><span style=color:#e6db74>&#34;false&#34;</span> <span style=color:#a6e22e>stored=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>multiValued=</span><span style=color:#e6db74>&#34;false&#34;</span><span style=color:#f92672>/&gt;</span>
   <span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;text_general&#34;</span> <span style=color:#a6e22e>indexed=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>stored=</span><span style=color:#e6db74>&#34;false&#34;</span> <span style=color:#a6e22e>multiValued=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>/&gt;</span></code></pre></td></tr></table></div></div><p><em>Text field is multivalued and not stored, it is only indexed to permit search inside various field of the document</em>. Content field store the extracted text from Tikaand it is useful both for highlighting and to troubleshoot extraction problems, because it contains the exact text extracted by Tika.</p><p>Now suppose <strong>you want to search for the term Branch and want also to highlight the part of the text where you find that term</strong> , you can simply issue a query that ask for highlighting, it is really simple.</p><p>http://localhost:8080/TestInstance/tikacrawl/select?q=text%3Abranch&fl=id%2Ctitle%2Cauthor&wt=xml&hl=true&hl.snippets=20&hl.fl=content&hl.usePhraseHighlighter=true</p><p>This simple query  ask for document with text that contains word branch, I want to extract (fl=) only title and author fields, want xml format and with <strong>hl=true</strong> I’m asking for snippet of matching text, <strong>hl.snippets=20</strong> instruct solr to search for a maximum of 20 snippet and <strong>hl.usePhraseHighlighter=true</strong> use a specific highlighter that try to extract a single phrase from the text. The most important parameter is the <strong>hl.fl=content</strong> that specify the field of the document that contains the text used for highlight.  In the results, after all matching documents there is a new section that contains all the highlights for each document</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/05/image13.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/05/image_thumb13.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/05/image_thumb13.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Hilight for the TFS Branching Guid – Scenarios 2.0.pdf file</em></p><p>The name of the element match the id of the document (in my configuration full path of the file), and there a list of highlights that follows. But <strong>the true power of Solr comes out if you start to use languages specific fields</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>   <span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;content&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;text_en&#34;</span> <span style=color:#a6e22e>indexed=</span><span style=color:#e6db74>&#34;false&#34;</span> <span style=color:#a6e22e>stored=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>multiValued=</span><span style=color:#e6db74>&#34;false&#34;</span><span style=color:#f92672>/&gt;</span>
   <span style=color:#f92672>&lt;field</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;text_en&#34;</span> <span style=color:#a6e22e>indexed=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>stored=</span><span style=color:#e6db74>&#34;false&#34;</span> <span style=color:#a6e22e>multiValued=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>/&gt;</span></code></pre></td></tr></table></div></div><p>I’ve just <strong>changed in schema.xml the type of Content and Text from general_text to text_en</strong> and this simple modification enables a more specific tokenizer, capable of doing full-text searches. Suppose you want to know all documents that deal with branching strategies, here is a possible query</p><p>http://localhost:8080/TestInstance/tikacrawl/select?q=text%3A%22branch+strategy%22~3&fl=id%2Ctitle&wt=xml&hl=true&hl.snippets=5&hl.fl=content&hl.usePhraseHighlighter=true&hl.fragsize=300</p><p>The key is in the search query <strong>text:”branch strategy”~3</strong> that states I’m interested in documents containing both branch and strategy terms and with a relative distance of no more than three words. Since text was indexed with text_en field type I got full-text search, and I have a confirmation looking at the highlights.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/05/image14.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/05/image_thumb14.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/05/image_thumb14.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Highlights for a proximity query with full text, as you can see word branching matches even if I searched for branch</em></p><p>And voilà!! You have full-text searching inside file content with minimal amount of work and a simple REST interface for querying the index</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/solr/>Solr</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/lucene/>lucene</a>, <a class=tag href=/tags/solr/>Solr</a>, <a class=tag href=/tags/tika/>tika</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2013/05/import-folder-of-documents-with-apache-solr-4-0-and-tika/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Import folder of documents with Apache Solr 40 and tika</a></div><div class="next-entry sep-before"><a href=/post/old/2013/05/install-solr-4-3-pay-attention-to-log-libraries/><span class=screen-reader-text>Next post: </span>Install Solr 43 pay attention to log libraries<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>