<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="To fully understand this article you need to read previous articles of the series
 Deploy on Azure Web Sites from on-premise TFS Deploy Asp.net web site on IIS from TFS Build Manage Test Data in Visual Studio Database Project  In those articles I’ve explained how you can automatically publish your web site to a standard IIS hosted web site or to an Azure Web Site. The cool part is that you just need to add extra MsBuild arguments to TFS Build process definition and the game is done."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Build Deploy Web Performance test with TFS build • Codewrecks"><meta property="og:description" content="To fully understand this article you need to read previous articles of the series
 Deploy on Azure Web Sites from on-premise TFS Deploy Asp.net web site on IIS from TFS Build Manage Test Data in Visual Studio Database Project  In those articles I’ve explained how you can automatically publish your web site to a standard IIS hosted web site or to an Azure Web Site. The cool part is that you just need to add extra MsBuild arguments to TFS Build process definition and the game is done."><meta property="og:url" content="https://www.codewrecks.com/post/old/2013/08/build-deploy-web-performance-test-with-tfs-build/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Continuous Deployment"><meta property="article:published_time" content="2013-08-16T07:00:37+02:00"><meta property="article:modified_time" content="2013-08-16T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Build Deploy Web Performance test with TFS build • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2013/08/build-deploy-web-performance-test-with-tfs-build/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Build Deploy Web Performance test with TFS build</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Build Deploy Web Performance test with TFS build</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2013-08-16T07:00:37+02:00>2013, Aug 16</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>9 mins read</span></div></div></header><div class="container entry-content"><p>To fully understand this article you need to read previous articles of the series</p><ul><li><a href=http://www.codewrecks.com/blog/index.php/2013/07/05/deploying-on-azure-web-sites-from-on-premise-tfs/>Deploy on Azure Web Sites from on-premise TFS</a></li><li><a href=http://www.codewrecks.com/blog/index.php/2013/08/01/deploy-asp-net-web-site-on-iis-from-tfs-build/>Deploy Asp.net web site on IIS from TFS Build</a></li><li><a href=http://www.codewrecks.com/blog/index.php/2013/08/05/manage-test-data-in-visual-studio-database-project/>Manage Test Data in Visual Studio Database Project</a></li></ul><p>In those articles I’ve explained how you can <strong>automatically publish your web site to a standard IIS hosted web site or to an Azure Web Site</strong>. The cool part is that you just need to add extra MsBuild arguments to TFS Build process definition and the game is done. For Azure Web Sites you also have a dedicated template for publishing that will also manage an integration with the Azure Web site dashboard (as you can see in the following figure)</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image11.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb11.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb11.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Azure web site deployments tab</em></p><p>If you use the standard DefaultTemplate workflow (with MsBuild arguments) Deployments Tab will not be populated, but you can use it to also deploy TF Service project that uses Git (actually not supported by the standard azure deploy template).</p><p>But the main question is: <em>why I should care of creating a structure for Automatic Deploy and where are the Benefits?</em></p><p>One of the <strong>main purpose of Continuous Deployment is to deploy to test environment and execute a series of integration test to find problems as soon as possible</strong>. The goal is:</p><ul><li><strong>Fail as early as possible</strong> *</li></ul><p>Even if your team is committed to Unit Testing, we all know that many problems arise from wrong deployment, wrong configuration files in production, bug with production data and so on. All these problems cannot be addressed by standard Unit Testing, and there is the need for <strong>a suite of Integration tests, that exercise the whole software deployed to an environment</strong>. Another reason is: some of the errors we discovered in production are related to manual deploy. People can make errors, especially if: deploy is a task that is done infrequently, it is poor documented and it is a real boring process (bored people tend to have less attention). The most common situation of failure is new undocumented configuration created by developers; the symptom is: you follow all the instructions of deploy document, but a section of the software is failing for apparently no reason. After a little bit of investigation you will find that some new settings introduced a couple of months ago is misconfigured (including calling developers in the night to understand what went wrong)</p><p>In this scenario the first advantage of an Automatic Deployment environment is: <strong>engineering team is forced to maintain automatic deployment scripts healthy.</strong> When it is time to deploy in production, operations team can use the same automatic procedure to minimize deploy errors. Another advantage of automatic deployment is detailed log of every operation done from the scriptsthat allows you to diagnose problems quickly.</p><p>One <strong>key part of the process is automatic validation of deploy</strong> , where the focus is: spotting as much errors as possible with automatic procedures. Having a good set of integration test, capable of validating a deploy, can save a lot of time and also give to the whole team a <strong>good confidence on the deploy process so they can deploy often</strong>.</p><p><em>This is a simple scenario: Asp.net application with a Sql Server Database.</em></p><p>Thanks to Sql Server database project, it is easy to automate the creation / upgrade of database schema, as well as <a href=http://www.codewrecks.com/blog/index.php/2013/08/05/manage-test-data-in-visual-studio-database-project/>preloading some test data</a> to being able to do some test after the deploy. If you do not use database project, or if you want to run integration test against some production data, the team should maintain a backup of a dedicated test database and you should personalize build deployment scripts, to automatically restore databases from well-known backup after the deploy of the web site.</p><p>Apart from technique used to manage test databases, you will need to exercise deployed software and with Web Site one of the best solution is using Visual Studio Web Performance tests. A <strong>Web Performance Test is meant to be used in load test, but it contains also assertion and rules to verify that the site is responding as expected</strong>. Another interesting aspect of Web Performance Tests is that they can be run with a standard MsTest runner, so you need no personalization of the TFS Build script to run them after an automatic deploy. Moreover it is a recording of HTTP calls and can be performed without the need of an UI. The drawback of this technique is that he does not run javascript code. If your site has a lot of javascript code you should use different technique, like Coded UI Test.</p><p>I’ve started this demo creating a couple of WPT.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image12.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb12.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb12.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>A couple of Web Performance Tests in a integration test project</em></p><p>The <strong>SmokeCallPages is a simple test that basically click on every page of the site</strong> , thanks to the IE recorder plugin, recording such a test is really simple. Once recorded you should add some assertion, in production configuration I have CustomErrors=”on” in the web.config file, so even if the site raise some exception, the user is redirected to a standard page with a warning “we are experiencing some mechanical problem”. This will lead to adding a rule that fail test if the HTML of the page contains this string. The rule is then applied to each response of the Test.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image13.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb13.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb13.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>A validation rule that makes the test fails if a certain string is contained in the HTML.</em></p><p>You can write complex tests, you can create base web performance tests that performs login and use them to create a series of tests that exercise private part of the site, write plugins and many other features. Once tests are finished, <strong>you should parameterize web sites, as you can see in Figure 3</strong> , where the url of the site to test is {{TailspinToysTestSite}} and not a real address. <strong>Everything enclosed in {{ }} is a context parameter, in test definition its value is set to</strong> <a href=http://localhost:13230><strong>http://localhost:13230</strong></a> <strong>, but it can be changed with Environment variables</strong>. If you setup an environment variable for the computer called * <strong>Test.</strong> *TailspinToysTestSite (name of your context parameter prefixed by Test.) it will override the value stored in the test.</p><p>Once everything is in place, I use a Build Agent inside a Virtual Machine, (where I’ve set the Test.TailspinToysTestSite environment variable to point to my Azure Test Site), then I configured a <strong>standard tfs build</strong> , added right MsBuild arguments to deploy web site and finally I specified the integration tests to run.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image14.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb14.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb14.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Configuring integration test to be run during the build</em></p><p>All you need to do is going to Automated Tests Section. He you will find a standard test run configuration that runs all tests that are in assemblies that contains the word “test” in it. If you execute the build you will find that the integration tests will not execute, this because TFS 2012 has a new agile test runner that is not capable of running Web Performance Test. The solution is <strong>adding another test run, specify MSTest.exe runner (VS2010 compatible) as the Test Runner and changing the Test Assmbly file specification to run everything that has an extension of.webtest</strong> ( <strong>Figure 4</strong> ). Now you have two distinct test configuration.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image15.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb15.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb15.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>The two test runs specified in the build.</em></p><p>I also <strong>set to true the Fail Build on Test Failure parameter</strong> , because I can tolerate a standard unit test failing, but if a single integration test fails it means that something basic is broken in the deploy and I want to react immediately. Since all test results are automatically pushed to TFS it is simple to understand the reason of a failure as you can see in the following build Summary.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image7.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb7.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb7.png alt=image></a></a></p><p><em><strong>Figure 6</strong></em>: <em>Build summary contains all test run information</em></p><p>There are two distinct test runs, the first one is using the standard agile test runner and runs standard unit test, it is then followed by the results of integration testing. The nice aspect of <strong>build summary is that it shows immediately the name of the test that is failing (SmokeCallPages )</strong> , the whole test result can also downloaded locally to better identify the cause of the problem.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/SNAGHTML544bdf.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/SNAGHTML544bdf_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/SNAGHTML544bdf_thumb.png alt=SNAGHTML544bdf></a></a></p><p><em><strong>Figure 7</strong></em>: <em>Test results can be downloaded locally to examine the root cause of the problem and the exact request that is failing.</em></p><p>From test result you can spot immediately the request that failed and if you have some form of logging enabled, like Elmah, you can have a better clue on what is happened simply looking at log page. Test Results contains also a lot of information like full request and full response, so dev team can insert some diagnostic information in the page response visible only when the site is deployed in Test environment (like an hiddenfield with the full exception error or some internal error code). Even if you do not use such technique, <strong>Elmah can give at least full exception details in a dedicated web page</strong>.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image8.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb8.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb8.png alt=image></a></a></p><p><em><strong>Figure 8</strong></em>: <em>Elmah handler is showing the error.</em></p><p>Thanks to this simple Build / Deploy / Integration Test workflow integration errors are immediately spotted during developing cycle. The more integration tests are written by the team, the more <strong>bugs are discovered automatically so the team can immediately react and fix them</strong>. Having integration Tests allows also to spot builds that are good to send to the Test Team, because it is not worthy to waste time of your Test Team into testing a really bugged build.</p><p>In this example the problem was a malformed XML file that contains the “About Us” text (easy spotted by the elmah log), now the team can fix Xml file, verify the fix running the integration test that failed locally and finally check-in the code. The next build run will verify if everything is good.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image9.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb9.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb9.png alt=image></a></a></p><p><em><strong>Figure 9</strong></em>: <em>Check-in fixed the problem, the build is now green.</em></p><p>The cool part of Integration Tests with Web Performance Tests is that you can download test results even for green build to gather metrics: see page timing, response size, etc.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image10.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb10.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2013/08/image_thumb10.png alt=image></a></a></p><p><em><strong>Figure 10</strong></em>: <em>Build summary shows all test passed.</em></p><p>Remember that with Web Performance Test you can create assertion on response size, response time and write plugin to verify whatever you want, so they are a real powerful tool in your toolset to test your Web Application.</p><p>Gian Maria</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/continuous-deployment/>Continuous Deployment</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2013/08/domain-driven-design-for-security/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Domain Driven Design for security</a></div><div class="next-entry sep-before"><a href=/post/old/2013/08/continuous-delivery-in-agile-procedures/><span class=screen-reader-text>Next post: </span>Continuous Delivery in Agile procedures<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>