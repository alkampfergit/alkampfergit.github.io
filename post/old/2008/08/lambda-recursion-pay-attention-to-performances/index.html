<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This morning I stumble across this old post, that shows how to create a recursive function with lambda. The article is very interesting and has a second part that deal with memoization. These two articles are really great ones, but I want to point out that you need really pay attention to performance each time you speak about recursion. This piece of code shows an interesting thing
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  class Program { private static Stopwatch sw = new Stopwatch(); static void TestSpeed(Func<int, int> f, int i, string msg) { sw."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Lambda recursion pay attention to performances • Codewrecks"><meta property="og:description" content="This morning I stumble across this old post, that shows how to create a recursive function with lambda. The article is very interesting and has a second part that deal with memoization. These two articles are really great ones, but I want to point out that you need really pay attention to performance each time you speak about recursion. This piece of code shows an interesting thing
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  class Program { private static Stopwatch sw = new Stopwatch(); static void TestSpeed(Func<int, int> f, int i, string msg) { sw."><meta property="og:url" content="https://www.codewrecks.com/post/old/2008/08/lambda-recursion-pay-attention-to-performances/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Uncategorized"><meta property="article:published_time" content="2008-08-13T09:00:37+02:00"><meta property="article:modified_time" content="2008-08-13T09:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Lambda recursion pay attention to performances • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2008/08/lambda-recursion-pay-attention-to-performances/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Lambda recursion pay attention to performances</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Lambda recursion pay attention to performances</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2008-08-13T09:00:37+02:00>2008, Aug 13</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>This morning I stumble across <a href=http://blogs.msdn.com/wesdyer/archive/2007/02/02/anonymous-recursion-in-c.aspx>this old post</a>, that shows how to create a recursive function with lambda. The article is very interesting and has a <a href=http://blogs.msdn.com/wesdyer/archive/2007/02/05/memoization-and-anonymous-recursion.aspx>second part</a> that deal with <a href=http://en.wikipedia.org/wiki/Memoization>memoization</a>. These two articles are really great ones, but I want to point out that you need really pay attention to performance each time you speak about recursion. This piece of code shows an interesting thing</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-CSharp data-lang=CSharp><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Program</span>
{
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Stopwatch sw = <span style=color:#66d9ef>new</span> Stopwatch();

    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> TestSpeed(Func&lt;<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>&gt; f, <span style=color:#66d9ef>int</span> i, <span style=color:#66d9ef>string</span> msg)
    {
        sw.Reset();
        sw.Start();
        <span style=color:#66d9ef>int</span> res = f(i);
        sw.Stop();
        Console.WriteLine(<span style=color:#e6db74>&#34;{0,-9}{1,7} = {2,10} =&gt; {3,8:f3} ms&#34;</span>,
            msg, <span style=color:#e6db74>&#34;(&#34;</span> + i + <span style=color:#e6db74>&#34;)&#34;</span>, res, sw.ElapsedMilliseconds);
    }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Main()
    {
        Func&lt;<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>&gt; fib = Extend.Y&lt;<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>&gt;(f =&gt; n =&gt; n &gt; <span style=color:#ae81ff>1</span> ? f(n - <span style=color:#ae81ff>1</span>) + f(n - <span style=color:#ae81ff>2</span>) : n);
        TestSpeed(fib, <span style=color:#ae81ff>37</span>, <span style=color:#e6db74>&#34;fib&#34;</span>);

        Func&lt;<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>int</span>&gt; fib2 = <span style=color:#66d9ef>null</span>;
        fib2 = n =&gt; n &gt; <span style=color:#ae81ff>1</span> ? fib2(n - <span style=color:#ae81ff>1</span>) + fib2(n - <span style=color:#ae81ff>2</span>) : n;
        TestSpeed(fib2, <span style=color:#ae81ff>37</span>, <span style=color:#e6db74>&#34;fib2&#34;</span>);
</code></pre></td></tr></table></div></div><p>I use the <a href=http://blogs.msdn.com/wesdyer/archive/2007/02/02/anonymous-recursion-in-c.aspx>Y</a> function described in that article, so the previous code creates two functions: the first, called fib, is the real recursive one, the other, called fib2, is the standard one that is not really recursive, as explained in the first article, if we look at the output we see that fib is much more slower than fib2.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>fib         (<span style=color:#ae81ff>37</span>) =   <span style=color:#ae81ff>24157817</span> =&gt; <span style=color:#ae81ff>7807.000</span> ms
fib2        (<span style=color:#ae81ff>37</span>) =   <span style=color:#ae81ff>24157817</span> =&gt;  <span style=color:#ae81ff>822.000</span> ms
</code></pre></td></tr></table></div></div><p>The reason is that the Y function creates a recursive lambda inserting an intermediate delegate into the call chain, it is clear if you modify the code in this way</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>Func<span style=color:#f92672>&lt;int</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#960050;background-color:#1e0010>int</span><span style=color:#f92672>&gt;</span> fib3 = Extend.Y<span style=color:#f92672>&lt;int</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#960050;background-color:#1e0010>int</span><span style=color:#f92672>&gt;</span>(f =&gt; n =&gt;
{
    StackTrace st = new StackTrace();
    Console.Write(&#34;{0}-{1} &#34;, n, st.FrameCount);
    return n &gt; 1 ? f(n - 1) + f(n - 2) : n;
});
TestSpeed(fib3, 5, &#34;fib3&#34;);
Console.WriteLine();
Func<span style=color:#f92672>&lt;int</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#960050;background-color:#1e0010>int</span><span style=color:#f92672>&gt;</span> fib4 = null;
fib4 = n =&gt;
{
    StackTrace st = new StackTrace();
    Console.Write(&#34;{0}-{1} &#34;, n, st.FrameCount);
    return n &gt; 1 ? fib4(n - 1) + fib4(n - 2) : n;
};
TestSpeed(fib4, 5, &#34;fib2&#34;);
Console.WriteLine();</code></pre></td></tr></table></div></div><p>I simply write the value of n and the frameCount of the stack, the result is</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#ae81ff>5</span>-<span style=color:#ae81ff>4</span> <span style=color:#ae81ff>4</span>-<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>3</span>-<span style=color:#ae81ff>8</span> <span style=color:#ae81ff>2</span>-<span style=color:#ae81ff>10</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>12</span> <span style=color:#ae81ff>0</span>-<span style=color:#ae81ff>12</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>10</span> <span style=color:#ae81ff>2</span>-<span style=color:#ae81ff>8</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>10</span> <span style=color:#ae81ff>0</span>-<span style=color:#ae81ff>10</span> <span style=color:#ae81ff>3</span>-<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>2</span>-<span style=color:#ae81ff>8</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>10</span> <span style=color:#ae81ff>0</span>-<span style=color:#ae81ff>10</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>8</span> 
<span style=color:#ae81ff>5</span>-<span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>-<span style=color:#ae81ff>4</span> <span style=color:#ae81ff>3</span>-<span style=color:#ae81ff>5</span> <span style=color:#ae81ff>2</span>-<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>7</span> <span style=color:#ae81ff>0</span>-<span style=color:#ae81ff>7</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>2</span>-<span style=color:#ae81ff>5</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>0</span>-<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>3</span>-<span style=color:#ae81ff>4</span> <span style=color:#ae81ff>2</span>-<span style=color:#ae81ff>5</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>0</span>-<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>1</span>-<span style=color:#ae81ff>5</span>
</code></pre></td></tr></table></div></div><p>It is quite cryptic, but in the higher row you can see that the FrameCount is higher than the lower line, if instead of printing st.FrameCount you print st.ToString (the full stack) you obtain a lot of output. This is the part of the real recursive function</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>[4]-   at ConsoleApplication1.Program.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClass6.<span style=color:#f92672>&lt;Main&gt;</span>b__1(Int32 n)
   at ConsoleApplication1.Extend.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClassb`2.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClassd.<span style=color:#f92672>&lt;Y&gt;</span>b__a(A a)
   at ConsoleApplication1.Program.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClass6.<span style=color:#f92672>&lt;Main&gt;</span>b__1(Int32 n)
   at ConsoleApplication1.Extend.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClassb`2.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClassd.<span style=color:#f92672>&lt;Y&gt;</span>b__a(A a)
   at ConsoleApplication1.Program.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClass6.<span style=color:#f92672>&lt;Main&gt;</span>b__1(Int32 n)
   at ConsoleApplication1.Extend.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClassb`2.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClassd.<span style=color:#f92672>&lt;Y&gt;</span>b__a(A a)
   at ConsoleApplication1.Program.TestSpeed(Func`2 f, Int32 i, String msg)
   at ConsoleApplication1.Program.Main()</code></pre></td></tr></table></div></div><p>Compare it with the corresponding run of the fib4 (not real recursive lambda).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>[4]-   at ConsoleApplication1.Program.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClass4.<span style=color:#f92672>&lt;Main&gt;</span>b__2(Int32 n)
   at ConsoleApplication1.Program.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClass4.<span style=color:#f92672>&lt;Main&gt;</span>b__2(Int32 n)
   at ConsoleApplication1.Program.<span style=color:#960050;background-color:#1e0010>&lt;</span>&gt;c__DisplayClass4.<span style=color:#f92672>&lt;Main&gt;</span>b__2(Int32 n)
   at ConsoleApplication1.Program.TestSpeed(Func`2 f, Int32 i, String msg)
   at ConsoleApplication1.Program.Main()</code></pre></td></tr></table></div></div><p>As you can see in the first listing, for each recursion step, we have two function calls in the stack, this is due to the Y operator used to create the real recursive lambda function.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-CSharp data-lang=CSharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Func&lt;A, R&gt; Y&lt;A, R&gt;(Func&lt;Func&lt;A, R&gt;, Func&lt;A, R&gt;&gt; f)
{
    Recursive&lt;A, R&gt; rec = r =&gt; a =&gt; f(r(r))(a);
    <span style=color:#66d9ef>return</span> rec(rec);
}
</code></pre></td></tr></table></div></div><p>This function takes the original lambda and convert it into a real recursive one, but it creates another lambda that actually does the magic.</p><p>Let’s see with Reflector what happens, this is the disassembling for the fib2 (not real recursive function)</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2008/08/image4.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2008/08/image-thumb5.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2008/08/image-thumb5.png alt=image></a></a></p><p>The compiler generate a class that holds the fib2 lambda and in the b__0 function it simply uses the delegate we defined. From this code you can see that the function is not really recursive, because b__0 simply invoke the fib2 delegate. A very different situation happens when we use the Y function, I let you use reflector to check generated code.</p><p>Remember also that recursion is a beautiful technique, but it is really slower than a non recursive algorithm, here is a standard implementation for the fibonacci that is not recursive.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>Func<span style=color:#f92672>&lt;int</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#960050;background-color:#1e0010>int</span><span style=color:#f92672>&gt;</span> fib3 = n =&gt;
    {
        Int32 result = 1;
        Int32 previous = -1;
        for (Int32 num = 0; num <span style=color:#960050;background-color:#1e0010>&lt;</span>= n; ++num)
        {
            Int32 newFibNumber = result + previous;
            previous = result;
            result = newFibNumber;
        }
        return result;
    };</code></pre></td></tr></table></div></div><p>Compare the timing with the recursive ones</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>fib         (<span style=color:#ae81ff>37</span>) =   <span style=color:#ae81ff>24157817</span> =&gt; <span style=color:#ae81ff>7874.000</span> ms
fib2        (<span style=color:#ae81ff>37</span>) =   <span style=color:#ae81ff>24157817</span> =&gt;  <span style=color:#ae81ff>829.000</span> ms
fib3        (<span style=color:#ae81ff>37</span>) =   <span style=color:#ae81ff>24157817</span> =&gt;    <span style=color:#ae81ff>0.000</span> ms
</code></pre></td></tr></table></div></div><p>The non recursive version is almost instantaneous.</p><p>alk</p><p>Tags: <a href=http://technorati.com/tag/Lambda>Lambda</a> <a href=http://technorati.com/tag/Lambda%20Recursion>Lambda Recursion</a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/general/>general</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/uncategorized/>Uncategorized</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2008/08/linq-and-extending-it-with-cross-product/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>LINQ and extending it with cross product</a></div><div class="next-entry sep-before"><a href=/post/old/2008/08/how-to-implement-inotifypropertychanged-with-codedom/><span class=screen-reader-text>Next post: </span>How to implement INotifyPropertyChanged with CodeDom<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>