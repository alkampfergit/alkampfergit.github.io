<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Everyone knows that invoking method through reflection is slower than direct invocation, here is a little test.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  Int32 iterations = 100000; Stopwatch watch = new Stopwatch(); MyObject obj = new MyObject(); obj.Prop = 0; watch.Start(); for (Int32 I = 0; I < iterations; ++I) { obj."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Expression Tree vs reflection • Codewrecks"><meta property="og:description" content="Everyone knows that invoking method through reflection is slower than direct invocation, here is a little test.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  Int32 iterations = 100000; Stopwatch watch = new Stopwatch(); MyObject obj = new MyObject(); obj.Prop = 0; watch.Start(); for (Int32 I = 0; I < iterations; ++I) { obj."><meta property="og:url" content="https://www.codewrecks.com/post/old/2008/10/expression-tree-vs-reflection/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="General"><meta property="article:published_time" content="2008-10-04T07:00:37+02:00"><meta property="article:modified_time" content="2008-10-04T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Expression Tree vs reflection • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2008/10/expression-tree-vs-reflection/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Expression Tree vs reflection</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Expression Tree vs reflection</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2008-10-04T07:00:37+02:00>2008, Oct 04</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>5 mins read</span></div></div></header><div class="container entry-content"><p>Everyone knows that invoking method through reflection is slower than direct invocation, here is a little test.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>Int32 iterations = <span style=color:#ae81ff>100000</span>;
Stopwatch watch = <span style=color:#66d9ef>new</span> Stopwatch();
MyObject obj = <span style=color:#66d9ef>new</span> MyObject();
obj.Prop = <span style=color:#ae81ff>0</span>;
watch.Start();
<span style=color:#66d9ef>for</span> (Int32 I = <span style=color:#ae81ff>0</span>; I &lt; iterations; ++I)
{
    obj.Prop = obj.Prop + <span style=color:#ae81ff>1</span>;
}
watch.Stop();
Console.WriteLine(<span style=color:#e6db74>&#34;Direct invocation {0} iterations {1} ms&#34;</span>,
    iterations, watch.ElapsedMilliseconds);

PropertyInfo pinfo = <span style=color:#66d9ef>typeof</span>(MyObject).GetProperty(<span style=color:#e6db74>&#34;Prop&#34;</span>, BindingFlags.Public | BindingFlags.Instance);
obj.Prop = <span style=color:#ae81ff>0</span>;
Object[] nullobj = <span style=color:#66d9ef>new</span> Object[] { };
watch.Reset();
watch.Start();
<span style=color:#66d9ef>for</span> (Int32 I = <span style=color:#ae81ff>0</span>; I &lt; iterations; ++I)
{
    pinfo.SetValue(
        obj,
        ((Int32)pinfo.GetValue(obj, nullobj)) + <span style=color:#ae81ff>1</span>,
        nullobj);
}
watch.Stop();
Console.WriteLine(<span style=color:#e6db74>&#34;Reflection invocation {0} iterations {1} ms&#34;</span>,
   iterations, watch.ElapsedMilliseconds);
</code></pre></td></tr></table></div></div><p>This snippet creates an object with an int property, then it make a simple increment of the property, the first time with standard code, the second time with reflection, every iteration needs two invocation through reflection, one to get the actual value, the other to set the new value, here is the output.</p><p>Direct invocation 100000 iterations 2 ms</p><p>Reflection invocation 100000 iterations 1307 ms</p><p>This simple example shows that reflection is really, really slower, but reflection makes possible to modify a property whose name is known only at runtime, so it is unavoidable in certain situation.</p><p>A simple alternative approach exists, it relay on using Expression Trees. For those who does not knows Expression Trees I suggest reading <a href="http://www.amazon.com/Programming-Microsoft%C2%AE-PRO-Developer-Paolo-Pialorsi/dp/0735624003/ref=pd_bbs_sr_1?ie=UTF8&s=books&qid=1223116217&sr=8-1">this book</a>, in short an expression tree is simple a way to represent an expression through an object model. Now lets look at this code.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml> 1 MethodInfo SetterMethodInfo = pinfo.GetSetMethod();
 2 ParameterExpression param = Expression.Parameter(typeof(MyObject), &#34;param&#34;);
 3 Expression GetPropertyValueExp = Expression.Lambda(
 4     Expression.Property(param, &#34;Prop&#34;), param);
 5 Expression<span style=color:#f92672>&lt;Func</span><span style=color:#960050;background-color:#1e0010>&lt;MyObject,</span> <span style=color:#960050;background-color:#1e0010>Int32</span><span style=color:#f92672>&gt;</span>&gt; GetPropertyValueLambda =
 6     (Expression<span style=color:#f92672>&lt;Func</span><span style=color:#960050;background-color:#1e0010>&lt;MyObject,</span> <span style=color:#960050;background-color:#1e0010>Int32</span><span style=color:#f92672>&gt;</span>&gt;)GetPropertyValueExp;
 7 
 8 ParameterExpression paramo = Expression.Parameter(typeof(MyObject), &#34;param&#34;);
 9 ParameterExpression parami = Expression.Parameter(typeof(Int32), &#34;newvalue&#34;);
10 
11 MethodCallExpression MethodCallSetterOfProperty = Expression.Call(paramo, SetterMethodInfo, parami);
12 Expression SetPropertyValueExp =  Expression.Lambda(MethodCallSetterOfProperty, paramo, parami);
13 Expression<span style=color:#f92672>&lt;Action</span><span style=color:#960050;background-color:#1e0010>&lt;MyObject,</span> <span style=color:#960050;background-color:#1e0010>Int32</span><span style=color:#f92672>&gt;</span>&gt; SetPropertyValueLambda = (Expression<span style=color:#f92672>&lt;Action</span><span style=color:#960050;background-color:#1e0010>&lt;MyObject,</span> <span style=color:#960050;background-color:#1e0010>Int32</span><span style=color:#f92672>&gt;</span>&gt;)SetPropertyValueExp;
14 obj.Prop = 0;
15 Func<span style=color:#f92672>&lt;MyObject</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#960050;background-color:#1e0010>Int32</span><span style=color:#f92672>&gt;</span> Getter = GetPropertyValueLambda.Compile();
16 Action<span style=color:#f92672>&lt;MyObject</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#960050;background-color:#1e0010>Int32</span><span style=color:#f92672>&gt;</span> Setter = SetPropertyValueLambda.Compile();
17 watch.Reset();
18 watch.Start();
19 for (Int32 I = 0; I <span style=color:#f92672>&lt; iterations</span><span style=color:#960050;background-color:#1e0010>;</span> <span style=color:#960050;background-color:#1e0010>++I)</span>
<span style=color:#960050;background-color:#1e0010>20</span> <span style=color:#960050;background-color:#1e0010>{</span>
<span style=color:#960050;background-color:#1e0010>21</span>     <span style=color:#960050;background-color:#1e0010>Setter(obj,</span> <span style=color:#960050;background-color:#1e0010>Getter(obj)</span> <span style=color:#960050;background-color:#1e0010>+</span> <span style=color:#960050;background-color:#1e0010>1);</span>
<span style=color:#960050;background-color:#1e0010>22</span> <span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#960050;background-color:#1e0010>23</span> <span style=color:#960050;background-color:#1e0010>watch.Stop();</span>
<span style=color:#960050;background-color:#1e0010>24</span> <span style=color:#960050;background-color:#1e0010>Console.WriteLine(&#34;Reflection</span> <span style=color:#960050;background-color:#1e0010>setter</span> <span style=color:#960050;background-color:#1e0010>with</span> <span style=color:#960050;background-color:#1e0010>expression</span> <span style=color:#960050;background-color:#1e0010>getter</span> <span style=color:#960050;background-color:#1e0010>{0}</span> <span style=color:#960050;background-color:#1e0010>iterations</span> <span style=color:#960050;background-color:#1e0010>{1}</span> <span style=color:#960050;background-color:#1e0010>ms&#34;,</span>
<span style=color:#960050;background-color:#1e0010>25</span>    <span style=color:#960050;background-color:#1e0010>iterations,</span> <span style=color:#960050;background-color:#1e0010>watch.ElapsedMilliseconds);</span>
<span style=color:#960050;background-color:#1e0010>26</span> </code></pre></td></tr></table></div></div><p>The code seems really complicated but it is simple once you knows the structure of an expression tree. We need to represent the expression obj.Prop = obj.Prop + 1, but if you try to convert this into an expression you see that the compiler generates the error <em>An expression tree may not contain an assignment operator</em>, but this is not a problem, because obj.Prop = something means calling the setter method of the property. Armed with this knowledge I create two distinct expression, one for the Get part and the other for the Set part. The good thing of having an ExpressionTree is that he has a method called Compile(), that creates a code block that represents the expression. In line 15 16 I use this functionality to create two delegate.</p><p>Now the fun part, suppose you does not known the type at compile time (in the code included with this post I created a type on different assembly) you can still apply this technique.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>1 Type otherType = Type.GetType(&#34;Other.OtherMyObject, Other&#34;);
2 PropertyInfo ISomePinfo = otherType.GetProperty(&#34;Prop&#34;, BindingFlags.Public | BindingFlags.Instance);
3 
4 param = Expression.Parameter(typeof(Object), &#34;param&#34;);
5 Expression convertedParam = Expression.Convert(param, otherType);
6 GetPropertyValueExp = Expression.Lambda(Expression.Property(convertedParam, &#34;Prop&#34;), param);
7 Expression<span style=color:#f92672>&lt;Func</span><span style=color:#960050;background-color:#1e0010>&lt;Object,</span> <span style=color:#960050;background-color:#1e0010>Int32</span><span style=color:#f92672>&gt;</span>&gt; dynamicGetterExpression = (Expression<span style=color:#f92672>&lt;Func</span><span style=color:#960050;background-color:#1e0010>&lt;Object,</span> <span style=color:#960050;background-color:#1e0010>Int32</span><span style=color:#f92672>&gt;</span>&gt;)GetPropertyValueExp;
8 Func<span style=color:#f92672>&lt;Object</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#960050;background-color:#1e0010>Int32</span><span style=color:#f92672>&gt;</span> dynamicGetter = dynamicGetterExpression.Compile();</code></pre></td></tr></table></div></div><p>In line 1 I get the type through reflection, and in line 2 get the property Prop with reflection too. Now I begin to create the expression I need for the Getter. If I want to get a property from an object that I do not know at compile time, I need to create a function of type <strong>Func&lt;Object, Int32></strong> , a function that gets an object and return an Int32 value, since the property is Int32. In line 4 I create the parameter for the expression of type object, then I create a Convert expression in line 5 (it is a cast) then I create the lambda that access the property. Finally I use the Compile method to obtain a Func&lt;Object, Int32>.</p><p>This expression is the same of this instruction <strong>((OtherMyObject) obj).Prop</strong> but since I does not know the type at compile time Expression Tree is the only way to write such a function. The setter part is similar, you can check on the source code. The fun part is that now I can write this code.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>Object otherObj = Activator.CreateInstance(otherType);
<span style=color:#66d9ef>for</span> (Int32 I = <span style=color:#ae81ff>0</span>; I &lt; iterations; ++I)
{
    Int32 actualValue = dynamicGetter(otherObj);
    dynamicSetter(otherObj, actualValue + <span style=color:#ae81ff>1</span>);
}
</code></pre></td></tr></table></div></div><p>The instance is created with Activator.CreateInstance because I really does not know the type at compile time, but I can use dynamicGetter and dynamicSetter with no problem. Here is the output of the timing.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>Direct invocation <span style=color:#ae81ff>100000</span> iterations <span style=color:#ae81ff>1</span> ms
Reflection invocation <span style=color:#ae81ff>100000</span> iterations <span style=color:#ae81ff>616</span> ms
Expression Tree getter <span style=color:#ae81ff>100000</span> iterations <span style=color:#ae81ff>1</span> ms
Expression tree with unknown <span style=color:#66d9ef>object</span> getter <span style=color:#ae81ff>100000</span> iterations <span style=color:#ae81ff>2</span> ms
</code></pre></td></tr></table></div></div><p>You can see that the using this technique permits to completely bypass performance penalties that you have with reflection.</p><p>Source code <a href=http://www.codewrecks.com/blog/storage/expTreeSample.zip>can be found here</a>.</p><p>alk.</p><p>Tags: <a href=http://technorati.com/tag/Expression%20Tree>Expression Tree</a> <a href=http://technorati.com/tag/.NET%20Framework>.NET Framework</a></p><p><a href="http://www.dotnetkicks.com/kick/?url=http://www.codewrecks.com/blog/index.php/2008/10/04/expression-tree-vs-reflection/"><a target=_blank href="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http://www.codewrecks.com/blog/index.php/2008/10/04/expression-tree-vs-reflection/&amp;amp;bgcolor=0080C0&amp;amp;fgcolor=FFFFFF&amp;amp;border=000000&amp;amp;cbgcolor=D4E1ED&amp;amp;cfgcolor=000000"><img src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=http://www.codewrecks.com/blog/index.php/2008/10/04/expression-tree-vs-reflection/&amp;amp;bgcolor=0080C0&amp;amp;fgcolor=FFFFFF&amp;amp;border=000000&amp;amp;cbgcolor=D4E1ED&amp;amp;cfgcolor=000000" alt="DotNetKicks Image"></a></a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/general/>general</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/general/>General</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2008/10/use-extension-methods-to-create-a-safe-enumerate/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Use Extension methods to create a safe enumerate</a></div><div class="next-entry sep-before"><a href=/post/old/2008/10/faster-invoke-method-of-unknown-objects-with-expression-tree-part2/><span class=screen-reader-text>Next post: </span>Faster invoke method of unknown objects with Expression tree part2<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>