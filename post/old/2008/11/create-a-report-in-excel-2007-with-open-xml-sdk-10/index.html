<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I need a program that send by email some reports each day to a certain number of recipients. The first thing I need to solve is the format of the report, a pdf could be a good thing, but I need to find a library to generate pdf etc etc. The best solution is to use Excel 2007 and send the whole excel file by email. The good thing about excel is that he already possess an incredible number of graph style, and thanks to the open Xml format creating a report is a breeze."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Create a report in excel 2007 with Open Xml SDK 10 • Codewrecks"><meta property="og:description" content="I need a program that send by email some reports each day to a certain number of recipients. The first thing I need to solve is the format of the report, a pdf could be a good thing, but I need to find a library to generate pdf etc etc. The best solution is to use Excel 2007 and send the whole excel file by email. The good thing about excel is that he already possess an incredible number of graph style, and thanks to the open Xml format creating a report is a breeze."><meta property="og:url" content="https://www.codewrecks.com/post/old/2008/11/create-a-report-in-excel-2007-with-open-xml-sdk-10/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="General"><meta property="article:published_time" content="2008-11-28T02:00:37+02:00"><meta property="article:modified_time" content="2008-11-28T02:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Create a report in excel 2007 with Open Xml SDK 10 • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2008/11/create-a-report-in-excel-2007-with-open-xml-sdk-10/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Create a report in excel 2007 with Open Xml SDK 10</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Create a report in excel 2007 with Open Xml SDK 10</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2008-11-28T02:00:37+02:00>2008, Nov 28</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>7 mins read</span></div></div></header><div class="container entry-content"><p>I need a program that send by email some reports each day to a certain number of recipients. The first thing I need to solve is the format of the report, a pdf could be a good thing, but I need to find a library to generate pdf etc etc. The best solution is to use Excel 2007 and send the whole excel file by email. The good thing about excel is that he already possess an incredible number of graph style, and thanks to the open Xml format creating a report is a breeze.</p><p>The first step is create a master document, the master document will contain a single row of data, and you can create the graphics the way you like.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2008/11/image12.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2008/11/image-thumb12.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2008/11/image-thumb12.png alt=image></a></a></p><p>Now we only need to modify the file adding real data and updating graphics range to accommodate the new data. My first tentative is to build an ExcelFiller class that can do this for me with simple syntax. You can find the <a href=http://www.codewrecks.com/blog/storage/excelfiller.txt>whole file here</a>, you can use as starting point if you need.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> ExcelFiller(String originalDocumentPath, String destinationDocumentPath)
{
    <span style=color:#75715e>//Make a copy of the template file
</span><span style=color:#75715e></span>    File.Copy(originalDocumentPath, destinationDocumentPath, <span style=color:#66d9ef>true</span>);

    <span style=color:#75715e>//Open up the copied template workbook
</span><span style=color:#75715e></span>    myWorkbook = SpreadsheetDocument.Open(destinationDocumentPath, <span style=color:#66d9ef>true</span>);
}
</code></pre></td></tr></table></div></div><p>As usual in the constructor you need to copy the original file in another position to be able to modify the document. Then you can call the method FillSheet that return a ExcelFillerSheet, a simple class that is used to phisically do the substitution. In the constructor of ExcelFillerSheet I simply create some Linq 2 XML structure of the basic part of the documetn</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>WorkbookPart workbookPart = document.WorkbookPart;
<span style=color:#66d9ef>using</span> (XmlReader xmlr = XmlReader.Create(workbookPart.GetStream()))
    XmlWorkBook = XElement.Load(xmlr);

WorksheetPart = GetWorksheetByName(sheetName);
<span style=color:#66d9ef>using</span> (XmlReader xmlr = XmlReader.Create(<span style=color:#66d9ef>this</span>.WorksheetPart.GetStream()))
    XmlData = XElement.Load(xmlr);
</code></pre></td></tr></table></div></div><p>Thanks to the GetStream() methods of the SDK objects I can read the whole xml content in one step, so I first get the WorkBookPart of the whole excel file. In this file there are all the informations on contained sheets, and more. Then I call GetWorksheetByName function to grab the XML content of a worksheet given its name.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>private WorksheetPart GetWorksheetByName(String name)
<span style=color:#960050;background-color:#1e0010>{</span>
    XElement relNode <span style=color:#f92672>=</span> (<span style=color:#66d9ef>from</span> XElement e <span style=color:#66d9ef>in</span> XmlWorkBook.Descendants(ExcelFiller.ns_s <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;sheet&#34;</span>)
                              <span style=color:#66d9ef>where</span> e.Attribute(<span style=color:#e6db74>&#34;name&#34;</span>).Value <span style=color:#f92672>==</span> name
                              <span style=color:#66d9ef>select</span> e).Single();

    WorkbookPart workbookPart <span style=color:#f92672>=</span> document.WorkbookPart;
    WorksheetPart retvalue <span style=color:#f92672>=</span> (WorksheetPart)workbookPart.GetPartById(
        relNode.Attribute(ExcelFiller.ns_r <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;id&#34;</span>).Value);
    <span style=color:#66d9ef>return</span> retvalue;
<span style=color:#960050;background-color:#1e0010>}</span></code></pre></td></tr></table></div></div><p>Thanks to Linq 2 XML finding the id of the worksheet is really simple, I look for all descendants nodes named &lt;sheet> (do not forget the namespace), then I filter the only one with the name attribute equal to desidered name and take the Single node. When you have the id of the sheet you can simply use GetPartById to grab a reference to the desidered sheet.</p><p>To make the code simple I store all new values in a List&lt;List&lt;Object>> structure, this is not the best option, but it works :D. When you finished to insert data you can call the SaveData routine.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml> 1 public ExcelFiller SaveData(Int32 numOfRowsToSkip)
 2 {
 3 XElement sheetData = XmlData.Descendants(ExcelFiller.ns_s + &#34;sheetData&#34;).Single();
 4 //now we have a series of row, first of all build the new data
 5 List<span style=color:#f92672>&lt;XElement&gt;</span> elements = new List<span style=color:#f92672>&lt;XElement&gt;</span>();
 6 elements.AddRange(sheetData.Elements().Take(numOfRowsToSkip));
 7 Int32 currentRowNum = numOfRowsToSkip + 1;
 8 Char currentColumn;
 9 foreach (List<span style=color:#f92672>&lt;Object&gt;</span> lo in values)
10 {
11     //this is a line
12     currentColumn = &#39;A&#39;;
13     XElement row = new XElement(ExcelFiller.ns_s + &#34;row&#34;,
14      new XAttribute(ExcelFiller.ns_s + &#34;r&#34;, currentRowNum),
15      new XAttribute(ExcelFiller.ns_s + &#34;spans&#34;, &#34;1:&#34; + lo.Count));
16     foreach (var obj in lo)
17     {
18         row.Add(new XElement(ExcelFiller.ns_s + &#34;c&#34;,
19                                     new XAttribute(ExcelFiller.ns_s + &#34;r&#34;, currentColumn + currentRowNum),
20                                     new XElement(ExcelFiller.ns_s + &#34;v&#34;, new XText(obj.ToString()))));
21         currentColumn++;
22     }
23     elements.Add(row);
24 }
25 //Now we have all elements
26 sheetData.Elements().Remove();
27 sheetData.Add(elements);
28 using (Stream s = GetWorksheetByName(SheetName).GetStream(FileMode.Create, FileAccess.Write))
29 {
30     using (XmlWriter xmlw = XmlWriter.Create(s))
31     {
32         XmlData.WriteTo(xmlw);
33     }
34 }
35 return Filler;
36 }</code></pre></td></tr></table></div></div><p>Modifying the document is a two phase process. In the first part I create a new list of XElement that will be filled with all the rows of the sheet. In line 6 I copy into this array the first X lines of the graph (since I need to open a graph and add data to some other existing data). The next step is creating an XElement for each row you want to insert. In line 3 I used LINQ 2 XML to grab a reference to the &lt;sheetData> node, in line 26 I remove all actual elements (all the rows) and reinsert the new list of row. The final step is grabbing again the stream associated with the worksheet, and this time write down the new content.</p><p>The operation is still not completed, if you open the document you can see that new data are there, but the graph still shows old numbers. This happens because the graph stores a reference of the original range of values, you need to update it.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>public</span> ExcelFillerSheet AdjustGraphData(Int32 numRows)
 <span style=color:#ae81ff>2</span> <span style=color:#960050;background-color:#1e0010>{</span>
 <span style=color:#ae81ff>3</span>     ChartPart part <span style=color:#f92672>=</span> WorksheetPart.DrawingsPart.ChartParts.<span style=color:#66d9ef>First</span>();
 <span style=color:#ae81ff>4</span>     XElement XmlChart;
 <span style=color:#ae81ff>5</span>     <span style=color:#66d9ef>using</span> (XmlReader xmlr <span style=color:#f92672>=</span> XmlReader.<span style=color:#66d9ef>Create</span>(part.GetStream()))
 <span style=color:#ae81ff>6</span>         XmlChart <span style=color:#f92672>=</span> XElement.<span style=color:#66d9ef>Load</span>(xmlr);
 <span style=color:#ae81ff>7</span>     <span style=color:#f92672>//</span>now we can manipulate the charts value, find the category
 <span style=color:#ae81ff>8</span>     var  catrange <span style=color:#f92672>=</span> <span style=color:#66d9ef>from</span> cat <span style=color:#66d9ef>in</span> XmlChart.Descendants(ExcelFiller.ns_c <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;cat&#34;</span>)
 <span style=color:#ae81ff>9</span>                          <span style=color:#66d9ef>from</span> f <span style=color:#66d9ef>in</span> cat.Descendants(ExcelFiller.ns_c <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;f&#34;</span>)
<span style=color:#ae81ff>10</span>                          <span style=color:#66d9ef>select</span> f;
<span style=color:#ae81ff>11</span>     <span style=color:#f92672>//</span>ora ho i nodi
<span style=color:#ae81ff>12</span>     foreach (var element <span style=color:#66d9ef>in</span> catrange )
<span style=color:#ae81ff>13</span>     <span style=color:#960050;background-color:#1e0010>{</span>
<span style=color:#ae81ff>14</span>         String basevalue <span style=color:#f92672>=</span> element.Value.Split(<span style=color:#e6db74>&#39;$&#39;</span>)[<span style=color:#ae81ff>0</span>];
<span style=color:#ae81ff>15</span>         element.Value <span style=color:#f92672>=</span> basevalue <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$A$2:$A$&#34;</span> <span style=color:#f92672>+</span> (numRows <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
<span style=color:#ae81ff>16</span>     <span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#ae81ff>17</span> 
<span style=color:#ae81ff>18</span>     var valrange <span style=color:#f92672>=</span> <span style=color:#66d9ef>from</span> cat <span style=color:#66d9ef>in</span> XmlChart.Descendants(ExcelFiller.ns_c <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;val&#34;</span>)
<span style=color:#ae81ff>19</span>                         <span style=color:#66d9ef>from</span> f <span style=color:#66d9ef>in</span> cat.Descendants(ExcelFiller.ns_c <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;f&#34;</span>)
<span style=color:#ae81ff>20</span>                         <span style=color:#66d9ef>select</span> f;
<span style=color:#ae81ff>21</span>     <span style=color:#f92672>//</span>ora ho i nodi
<span style=color:#ae81ff>22</span>     Char startChar <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;B&#39;</span>;
<span style=color:#ae81ff>23</span>     foreach (var element <span style=color:#66d9ef>in</span> valrange)
<span style=color:#ae81ff>24</span>     <span style=color:#960050;background-color:#1e0010>{</span>
<span style=color:#ae81ff>25</span>         String basevalue <span style=color:#f92672>=</span> element.Value.Split(<span style=color:#e6db74>&#39;$&#39;</span>)[<span style=color:#ae81ff>0</span>];
<span style=color:#ae81ff>26</span>         element.Value <span style=color:#f92672>=</span> basevalue <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$&#34;</span> <span style=color:#f92672>+</span> startChar <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$2:$&#34;</span> <span style=color:#f92672>+</span> startChar <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;$&#34;</span> <span style=color:#f92672>+</span> (numRows <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
<span style=color:#ae81ff>27</span>         startChar<span style=color:#f92672>++</span>;
<span style=color:#ae81ff>28</span>     <span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#ae81ff>29</span> 
<span style=color:#ae81ff>30</span>     <span style=color:#66d9ef>using</span> (Stream s <span style=color:#f92672>=</span> part.GetStream(FileMode.<span style=color:#66d9ef>Create</span>, FileAccess.<span style=color:#66d9ef>Write</span>))
<span style=color:#ae81ff>31</span>     <span style=color:#960050;background-color:#1e0010>{</span>
<span style=color:#ae81ff>32</span>         <span style=color:#66d9ef>using</span> (XmlWriter xmlw <span style=color:#f92672>=</span> XmlWriter.<span style=color:#66d9ef>Create</span>(s))
<span style=color:#ae81ff>33</span>         <span style=color:#960050;background-color:#1e0010>{</span>
<span style=color:#ae81ff>34</span>             XmlChart.WriteTo(xmlw);
<span style=color:#ae81ff>35</span>         <span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#ae81ff>36</span>     <span style=color:#960050;background-color:#1e0010>}</span>
<span style=color:#ae81ff>37</span> 
<span style=color:#ae81ff>38</span>     <span style=color:#66d9ef>return</span> this;
<span style=color:#ae81ff>39</span> <span style=color:#960050;background-color:#1e0010>}</span></code></pre></td></tr></table></div></div><p>Now it is finally done. In line 3 I grab the first ChartParts of the worksheet, this because I know that the graphs is the only one included in the worksheet. In the first part I cycle through the elements of type &lt;cat> where categories are stored. The value numRows is passed by the caller, and it is the number of rows you want to include in the graph. in line 15 you can see that I simply change the range of the graph to accommodate new data. Since my graph have two distinct sets of values, in line 18 I select all nodes &lt;val>, then I change the range in line 26, starting from column B. Here it is a simple test.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>ExcelFiller ef = <span style=color:#66d9ef>new</span> ExcelFiller(<span style=color:#e6db74>@&#34;samples\test.xlsx&#34;</span>, <span style=color:#e6db74>@&#34;samples\testc.xlsx&#34;</span>);
ef.FillASheet(<span style=color:#e6db74>&#34;RilevazioniPerCliente7GG&#34;</span>)
   .AddData(<span style=color:#ae81ff>1</span>).AddData(<span style=color:#ae81ff>5</span>).AddData(<span style=color:#ae81ff>44</span>)
   .CloseRow().AddData(<span style=color:#ae81ff>2</span>).AddData(<span style=color:#ae81ff>100</span>).AddData(<span style=color:#ae81ff>5</span>)
   .CloseRow().AddData(<span style=color:#ae81ff>3</span>).AddData(<span style=color:#ae81ff>200</span>).AddData(<span style=color:#ae81ff>10</span>)
   .CloseRow().AddData(<span style=color:#ae81ff>4</span>).AddData(<span style=color:#ae81ff>300</span>).AddData(<span style=color:#ae81ff>15</span>)
   .CloseRow().AddData(<span style=color:#ae81ff>5</span>).AddData(<span style=color:#ae81ff>400</span>).AddData(<span style=color:#ae81ff>10</span>)
   .CloseRow().AddData(<span style=color:#ae81ff>6</span>).AddData(<span style=color:#ae81ff>50</span>).AddData(<span style=color:#ae81ff>50</span>)
   .CloseRow().AddData(<span style=color:#ae81ff>7</span>).AddData(<span style=color:#ae81ff>60</span>).AddData(<span style=color:#ae81ff>22</span>)
   .AdjustGraphData(<span style=color:#ae81ff>7</span>)
   .SaveData(<span style=color:#ae81ff>1</span>);
ef.Dispose();
</code></pre></td></tr></table></div></div><p>If you run it with the original document the result is this.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2008/11/image13.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2008/11/image-thumb13.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2008/11/image-thumb13.png alt=image></a></a></p><p>As you can check all values are inserted correctly, and the graph is updated with the new data.</p><p>Some people asked me why I do not use the 2.0 SDK that has some strongly typed classes to manipulate data the answer is. I need to put this code in production and cannot use a CTP library. Moreover using the old 1.0 SDK you have full control over XML data, and there is no limit to the complexity of the documents you can create.</p><p>alk.</p><p>Tags: <a href=http://technorati.com/tag/OpenXml>OpenXml</a> <a href=http://technorati.com/tag/Excel>Excel</a> <a href=http://technorati.com/tag/Graphics>Graphics</a> <a href=http://technorati.com/tag/Report>Report</a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/general/>general</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/general/>General</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2008/11/extend-bindinglist-with-filter-functionality/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Extend BindingList with filter functionality</a></div><div class="next-entry sep-before"><a href=/post/old/2008/12/always-check-for-objects-thread-safety-when-you-are-doing-multi-thread-programs/><span class=screen-reader-text>Next post: </span>Always check for objects thread safety when you are doing multi thread programs<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>