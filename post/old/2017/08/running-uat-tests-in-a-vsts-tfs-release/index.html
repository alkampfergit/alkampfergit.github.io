<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I’ve blogged on how to run UAT and integration tests during a VSTS Build; that solution works quite well but probably is not the right way to proceed. Generally speaking that build does its work but I have two main concerns.
  Executing test with remote execution requires installation of test agent and involves WinRm , a beast that is not so easy to tame outside a domain
  I’m deploying the new version of the application with an XCopy deployment, that is different from a real deploy to production."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Running UAT tests in a VSTS  TFS release • Codewrecks"><meta property="og:description" content="I’ve blogged on how to run UAT and integration tests during a VSTS Build; that solution works quite well but probably is not the right way to proceed. Generally speaking that build does its work but I have two main concerns.
  Executing test with remote execution requires installation of test agent and involves WinRm , a beast that is not so easy to tame outside a domain
  I’m deploying the new version of the application with an XCopy deployment, that is different from a real deploy to production."><meta property="og:url" content="https://www.codewrecks.com/post/old/2017/08/running-uat-tests-in-a-vsts-tfs-release/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="release"><meta property="article:tag" content="UAT"><meta property="article:tag" content="VSTS"><meta property="article:published_time" content="2017-08-17T07:00:37+02:00"><meta property="article:modified_time" content="2017-08-17T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Running UAT tests in a VSTS TFS release • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2017/08/running-uat-tests-in-a-vsts-tfs-release/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Running UAT tests in a VSTS TFS release</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Running UAT tests in a VSTS TFS release</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2017-08-17T07:00:37+02:00>2017, Aug 17</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>7 mins read</span></div></div></header><div class="container entry-content"><p>I’ve blogged on how to <a href=http://www.codewrecks.com/blog/index.php/2017/08/05/running-uat-and-integration-tests-during-a-vsts-build/>run UAT and integration tests during a VSTS Build</a>; that solution works quite well but probably is not the right way to proceed. Generally speaking that build does its work but I have two main concerns.</p><ol><li><p>Executing test with remote execution <strong>requires installation of test agent and involves WinRm</strong> , a beast that is not so easy to tame outside a domain</p></li><li><p><strong>I’m deploying the new version of the application with an XCopy deployment, that is different from a real deploy to production</strong>.</p></li></ol><p>The second point is the one that bothers me, because we already deploy in production with PowerShell scripts and I’d like to use the very same scripts to deploy on the machine used for the UAT testing. <strong>Using the same script used for real release will put those script also under testing.</strong> > If you want to run UAT and integration testing, the best scenario is when you install the new version of the application with the very same script you use to deploy on production.</p><p>If you have a (script, whatever) to automatically release a new version of your application, it is really better to use a different strategy to run the UAT test in VSTS / TFS: <strong>instead of using a build you should use release management</strong>. If you still do not have scripts or whatever to automatically release your application, but you have UAT tests to run automatically, <strong>it is time to allocate time to automate your deployment. This is a needed prerequisite to automate running of UAT and will simplify your life</strong>.</p><p>The first step is a build that prepare the package with all the files that are needed by the installation, in my situation I have a couple of.7z files: the first contains all the binaries and the other contains all updated configurations. These are the two files that I use for deployment with PowerShell script. The script is quite simple, it stops services, backup actual version, deletes everything, replace binaries with latest version, then update configuration with the new default values if any. It is not rocket science, it is a simple script that automate everything we have on our release list.</p><p>Once you have prerequisites (build creating binaries and installation scripts), running UAT tests in a release is really simple, <strong>a simple dependency from build artifacts, a single environment and the game is done.</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image-4.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-4.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-4.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>General schema for the release that will run UAT tests.</em></p><p>I’m depending by the artifact of a single build, specially crafted for UAT. To run UAT testing I need the.7z files with the new release of the software, but <strong>I need also a.7z file with all the UAT tests (nunit dll files and test adapter) needed to run the tests and all installation scripts</strong>.</p><p>To simplify everything I’ve cloned the original build that I used to create package for new release and I’ve added a couple of tasks to package UAT test files.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image-5.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-5.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-5.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Package section of the build</em></p><p>I’ve blogged a lot in the past of my love with PowerShell scripts to create package used for release. This technique is really simple, you can test scripts outside of build management, it is super easy to integrate in whatever build engine you are using and with PowerShell you can do almost everything. In my source code I have two distinct PowerShell package script, the first creates package with the new binaries the second one creates a package with all UAT assemblies as well as NUnit tests adapters. All the installation scripts are simply included in the artifacts directly from source code.</p><blockquote><p>Build for UAT produces three distinct artifacts, a compressed archive with new version to release, a compressed archive with everything needed to run UAT tests and the uncompressed folder with all installation scripts.</p></blockquote><p>When the build is stable, the next step is configuring a Deployment Group to run UAT. <strong>The concept of Deployment Group is new in VSTS and allows you to specify a set of machines, called deployment group, that will be used in a release definition</strong>. Once you create a new Deployment Group you can simply go to the details page to copy a script that you can run on any machine to join it to that deployment group.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/SNAGHTML52853f7.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/SNAGHTML52853f7_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/SNAGHTML52853f7_thumb.png alt=SNAGHTML52853f7></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Script to join a machine to a Deployment Group</em></p><p>As you can see from <strong>Figure 3</strong> , you can join Windows machines or a Ubuntu or RedHat machines to that group. Once you run the script that machine will be listed as part of the Group as you can see in <strong>Figure 4</strong>.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image-6.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-6.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-6.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Deployment groups to run UAT tests.</em></p><p>The concept of Deployment Group is really important, because it allows for <em>pull deployment</em> instead of <em>push deployment</em>. Instead of having an agent that will remotely configure machines, we have the machines of Deployment Group that will download artifacts of the build and runs the build locally. <strong>This deployment method will completely remove all WinRM issues, because the release scripts are executed locally.</strong> > When designing a release, a pull model allows you to run installation scripts locally and this lead to more stability of the release process.</p><p>There are another advantages of Deployment Groups, like executing in parallel to all machines of a group. <a href=https://www.visualstudio.com/en-us/docs/build/concepts/definitions/release/deployment-groups/>This MSDN post</a> is a good starting point to learn of all the goodness of DG.</p><p>Once the Deployment Group is working, creating a release is really simple if you already created PowerShell scripts for deployment. The whole release definition is represented in <strong>Figure 5.</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/SNAGHTML52522c4.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/SNAGHTML52522c4_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/SNAGHTML52522c4_thumb.png alt=SNAGHTML52522c4></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Release definition to run UAT testing</em></p><p>First of all I run the installer script (it is an artifacts of the build so it is downloaded locally), then I uncompress the archive that contains UAT tests and delete the app_offline.htm files that was generated by the script to bring the IIS website offline during the installation.</p><p>Then I need to modify a special.application files that is used to point to a specific configuration set in the UAT machine. That step is used because the same machine is used to run UAT tests during a release or during a Build (with the technique discussed in previous post) so I need to run the UAT testing with two different sets of parameters.</p><p>Then I run another PowerShell script that will change the Web.config of the application to use Forms Authentication instead of Integrated authentication (we use fake users during UAT). After this steps everything is ready to run UAT tests and now <strong>I can run them using standard Visual Studio Test task, because the release script will be run locally in the machines belonging to deployment Group</strong>.</p><p>Most of the steps are peculiar to this specific application, if your application is simpler, like a simple IIS application, probably the release will be even simpler, in my situation I need to install several windows services, updating an IIS application another angular application, etc etc.</p><p><strong>If you configure that release to start automatically as soon as new artifacts is present, you can simply trigger the build and everything will run automatically for you</strong>. Just queue the build and you will end with a nice release that contains results of your UAT tests.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image-7.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-7.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-7.png alt=image></a></a></p><p><em><strong>Figure 6</strong></em>: <em>Test result summary in release detail.</em></p><p>This technique is superior respect running UAT tests during a standard build; first of all you do not need to deal with WinRM, but the real advantage is continuously testing your installation scripts. If for some reason a release script does not work anymore, you will end with a failing release, or all UAT tests will fail because the application was not installed correctly.</p><p>The other big advantage is having the tests running locally with the standard Visual Studio Test runner, instead of dealing with remote test execution, that is slow and more error prone.</p><p><strong>The final great advantage of this approach, is that you gain confidence of your installation scripts, because they are run constantly against your code, instead of being run only when you are actually releasing a new version.</strong> As a final notice, Deployment Groups is a feature that, at the time I’m writing this post, is available only for VSTS and not for TFS.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/azure-devops/>Azure DevOps</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/release/>release</a>, <a class=tag href=/tags/uat/>UAT</a>, <a class=tag href=/tags/vsts/>VSTS</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2017/08/net-core-2-0-errors-installing-on-linux/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>NET core 20 errors installing on linux</a></div><div class="next-entry sep-before"><a href=/post/old/2017/08/error-with-dotnet-restore-corrupted-header/><span class=screen-reader-text>Next post: </span>Error with dotnet restore corrupted header<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>