<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="If you have a dotnetcore project, it is a good idea to setup continuous integration on a Linux machine. This will guarantee that the solution actually compiles correctly and all the tests run perfectly, even in Linux environment. If you are 100% sure that, if a dotnetcore project runs fine under Windows it should run fine under Linux, you will have some interesting surprises. The first and trivial difference is that Linux filesystem is case sensitive."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Dotnetcore CI Linux and VSTS • Codewrecks"><meta property="og:description" content="If you have a dotnetcore project, it is a good idea to setup continuous integration on a Linux machine. This will guarantee that the solution actually compiles correctly and all the tests run perfectly, even in Linux environment. If you are 100% sure that, if a dotnetcore project runs fine under Windows it should run fine under Linux, you will have some interesting surprises. The first and trivial difference is that Linux filesystem is case sensitive."><meta property="og:url" content="https://www.codewrecks.com/post/old/2017/09/dotnetcore-ci-linux-and-vsts/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="General"><meta property="article:published_time" content="2017-09-30T07:00:37+02:00"><meta property="article:modified_time" content="2017-09-30T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Dotnetcore CI Linux and VSTS • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2017/09/dotnetcore-ci-linux-and-vsts/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Dotnetcore CI Linux and VSTS</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Dotnetcore CI Linux and VSTS</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2017-09-30T07:00:37+02:00>2017, Sep 30</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>If you have a <strong>dotnetcore project, it is a good idea to setup continuous integration on a Linux machine.</strong> This will guarantee that the solution actually compiles correctly and all the tests run perfectly, even in  Linux environment. If you are 100% sure that, if a dotnetcore project runs fine under Windows it should run fine under Linux, you will have some interesting surprises. The first and trivial difference is that Linux filesystem is case sensitive.</p><blockquote><p>If you use dotnetcore, it is  always a good idea to immediately setup a Build against a Linux environment to ensure portability.</p></blockquote><p>I’m starting creating a dedicated pool for Linux machines. Actually having a dedicated pool is not necessary, because the build can require Linux capability, but <strong>I’d like to start having all the Linux build agent in a single place for easier management.</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image-12.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-12.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-12.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Create a pool dedicated to build agents running Linux operating system</em></p><p>Pressing the button “download agent” you are prompted with a nice UI that explain in a really easy way how you should deploy your agent under your linux machine.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/09/image-7.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/09/image_thumb-7.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/09/image_thumb-7.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>You can easily download the agent from VSTS / TFS web interface</em></p><p>Instruction are detailed, and it is really easy to start your agent in this way: just running a configure shell script and then you can run the agent with another run.sh shell script.</p><p>There is also another interesting approach, you can give a shot to the <strong>official docker image that you can find here:</strong> <a href=https://github.com/Microsoft/vsts-agent-docker title=https://github.com/Microsoft/vsts-agent-docker><strong>https://github.com/Microsoft/vsts-agent-docker</strong></a>. The only thing I need to do is running the docker image with the command.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo docker run   -e VSTS_ACCOUNT<span style=color:#f92672>=</span>prxm -d -e VSTS_TOKEN<span style=color:#f92672>=</span>my_PAT_TOKEN-e VSTS_AGENT<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;schismatrix&#39;</span> -e VSTS_POOL<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Linux&#39;</span> -it microsoft/vsts-agent</code></pre></td></tr></table></div></div><p>Please be patient on the first run <strong>because the download can take a little bit, the docker image is pretty big, so you need to patiently wait for the download to finish</strong>. Once the docker image is running, you should verify with sudo docker ps that the image is really running fine and you should check on the Agent Pool page if the agent is really connected. The drawback of this approach is that currently only Ubuntu is supported with Docker, but the situation will surely change in the future.</p><blockquote><p>Docker is surely the most simple way to run a VSTS / TFS linux build agent.</p></blockquote><p>Another things to pay attention is running the image with the –d option, because whenever you create a new instance of vsts agent from the docker base image, <strong>the image will download the latest agent and this imply that you need to wait a decent amount of time before the agent is up and running,</strong> especially if you, like me, are on a standard ADSL connection with max download speed of 5 Mbps.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image-14.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-14.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-14.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Without the –d option, the image will run interactively and you need to wait for the agent to be downloaded</em></p><p>As you can see from the image, running a new docker instance starts from the base docker image, contacts the VSTS server and download and install the latest version of the agent.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/09/image15.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/09/image15_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/09/image15_thumb.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>After the agent is downloaded the image automatically configure and run the agent and you are up and running.</em></p><p>Only when the output of the docker image states Listening for Jobs the agent should be online and usable.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image-16.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-16.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-16.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Agent is alive and kicking</em></p><p>Another interesting behavior is that, when you press CTRL+C to stop the interactive container instance, the docker image remove the agent from the server, avoiding the risk to left orphan registration in your VSTS Server.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image-17.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-17.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/08/image_thumb-17.png alt=image></a></a></p><p><em><strong>Figure 6</strong></em>: <em>When you stop docker image, the agent is de-registered to avoid orphan agents registration.</em></p><p>Please remember that, whenever you stop the container with CTRL+C, the container will stop, and when you will restart it, it will download again the VSTS agent.</p><p>This happens because, whenever the container stop and run again, it need to redownload everything that is not included in the state of the container itself. This is usually not a big problem, and I need to admit that this little nuance is overcome by the tremendous simplicity you have, <strong>just run a container and you have your agent up and running, with latest version of dotnetcore (2.0) and other goodness.</strong> The real only drawback of this approach, is that you have little control on what is available on the image. As an example, if you need to have some special software installed in the build machine, probably you need to fork the container and configure the docker machine for your need.</p><p>Once everything is up and running (docker or manual run.sh) just fire a build and watch it to be executed in your linux machine.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2017/09/image-8.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2017/09/image_thumb-8.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2017/09/image_thumb-8.png alt=image></a></a></p><p><em><strong>Figure 7</strong></em>: <em>Build with tests executed in Linux machine.</em></p><p>Gian Maria</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/general/>general</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/general/>General</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2017/09/check-angular-aot-with-a-tfs-build/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Check Angular AoT with a TFS Build</a></div><div class="next-entry sep-before"><a href=/post/old/2017/10/pause-build-and-clear-long-build-queue/><span class=screen-reader-text>Next post: </span>Pause build and clear long build queue<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>