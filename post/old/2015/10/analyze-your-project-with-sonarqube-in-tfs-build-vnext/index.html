<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="When you have your SonarQube server up and runinng it is time to put some data into it. You will be amazed to know how simple it is with build vNext and Visual Studio Online.
Installing the analyzer As a prerequisite, you need to install Java on the machine where the agent is running, then download the Msbuild.SonarQube.Runner, unblock the zip and unzip everything in a folder of your HD. Make sure that PATH contains that folder so you are able to launch the runner from any command prompt."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Analyze your project with SonarQube in TFS Build vNext • Codewrecks"><meta property="og:description" content="When you have your SonarQube server up and runinng it is time to put some data into it. You will be amazed to know how simple it is with build vNext and Visual Studio Online.
Installing the analyzer As a prerequisite, you need to install Java on the machine where the agent is running, then download the Msbuild.SonarQube.Runner, unblock the zip and unzip everything in a folder of your HD. Make sure that PATH contains that folder so you are able to launch the runner from any command prompt."><meta property="og:url" content="https://www.codewrecks.com/post/old/2015/10/analyze-your-project-with-sonarqube-in-tfs-build-vnext/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Agile"><meta property="article:tag" content="sonarqube"><meta property="article:published_time" content="2015-10-31T10:00:37+02:00"><meta property="article:modified_time" content="2015-10-31T10:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Analyze your project with SonarQube in TFS Build vNext • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2015/10/analyze-your-project-with-sonarqube-in-tfs-build-vnext/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Analyze your project with SonarQube in TFS Build vNext</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Analyze your project with SonarQube in TFS Build vNext</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2015-10-31T10:00:37+02:00>2015, Oct 31</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>When you have your SonarQube <a href=http://www.codewrecks.com/blog/index.php/2015/10/30/installing-sonarqube-on-windows-and-sql-server/>server up and runinng</a> it is time to put some data into it. You will be amazed to know how simple it is with build vNext and Visual Studio Online.</p><h2 id=installing-the-analyzer>Installing the analyzer</h2><p>As a prerequisite, you need to install Java on the machine where the agent is running, then download the <a href=http://docs.sonarqube.org/display/SONAR/Installing+and+Configuring+MSBuild+SonarQube+Runner>Msbuild.SonarQube.Runner</a>, unblock the zip and unzip everything in a folder of your HD. <strong>Make sure that PATH contains that folder so you are able to launch the runner from any command prompt</strong>.</p><p>Then open the SonarQube.Analysis.xml file, and change configuration.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image26.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb26.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb26.png alt></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Configuration of Msbuild SonarQube runner</em></p><p>Remember that you need to open firewall port of the server where SonarQube database is running, because <strong>the agent will connect directly to the database to save result of the analysis</strong>. This is a common source of errors, because you can incorrectly think that the agent is capable to talk with the server through an endpoint (it will be available in next versions of SonarQube)</p><blockquote><p>Pay attention because the Agent directly save result on Database.</p></blockquote><p>Remember also to install the <a href=http://redirect.sonarsource.com/plugins/csharp.html>C# plugin</a> or whatever plugin you need (Ex Visual Basic.NET) to support the language/technology you are using.</p><h2 id=manual-analysis>Manual analysis</h2><p>On the machine where the vNext agent is running you need to be sure that everything is ok. Just open a command prompt and navigate on a folder where you have the project you want to analyze (you can use _work folder of the agent). Once you are in a folder where you have a.sln file you should start analysis with this command.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>msbuild.sonarqube.runner /key:JarvisConfigurationManager /name:JarvisConfigurationManager 
   /v:1.1</code></pre></td></tr></table></div></div><p><strong>This command will connect to SonarQube server and will download analysis profile</strong>. Then you should launch msbuild to compile the solution and <strong>finally you should do the real analysis running the end command</strong><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>msbuild.sonarqube.runner /key:JarvisConfigurationManager end</code></pre></td></tr></table></div></div></p><blockquote><p>Be sure to verify that everything works with manual analysis, because it will require less time to troubleshoot problems</p></blockquote><p>If everything goes well you should see some data inside your SonarQube server. Doing manual analysis is a must so you are sure that Java is installed correctly, firewall ports are ok, DNS names are ok and so on. <strong>Once you can do a manual analysis you are 99% sure that the analysis will be good even during the build</strong>.</p><h2 id=running-in-buid-vnext>Running in Buid vNext</h2><p>If everything is ok, I just suggest tagging the agent with SonarQube tag, to identify this agent as capable of doing SonarQube analysis.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image27.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb27.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb27.png alt="With custom capability we can identify the agents that can do specific tasks"></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Adding custom capability to the agent</em></p><p>Now the build must be changed to require this specific capability for the agent.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image28.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb28.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb28.png alt></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Adding Demands on the build to request specific capabilities</em></p><p>Using custom capability is a good way to communicate to people that someone did manual testing of SonarQube runner on that machine, so you can be pretty sture that the build will not encounter problems.</p><blockquote><p>Using custom demands will make your life easier because you are explicitly telling what that agent can do.</p></blockquote><p>Now you can customize the build to launch the above two command line script to do the analysis, as you manually did before. You can do similar steps if you are using XAML Build, just add a script to launch start analysis pre build and the end after tests ran.</p><p>But if you are using build vNext you will be happy to know that <strong>SonarQube runner tasks were already present in VSO/TFS vNext.</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image29.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb29.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb29.png alt></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Configure SonarQube analysis in your build.</em></p><p>Only begin analysis task needs configuration, and you needs only to specify the same informations you saved in SonarQube.Analysis.Xml file. Since I’m using the build where I’ve configured <a href=http://www.codewrecks.com/blog/index.php/2015/10/17/integrating-gitversion-and-gitflow-in-your-vnext-build/>Semantic Versioning with GitVersion</a>  <strong>I’ve also a build variable called AssemblyVerision that is automatically set by GitVersion and I can use it to specify the version to SonarQube</strong>.</p><p>I can now schedule a build, and verify the output. First of all the output of the Begin Analysis task should connect correctly to the server and download the profile.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image30.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb30.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb30.png alt></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Output of the Start task for SonarQube Analysis</em></p><p>The output of the end step, should contains a really longer log, because it is when the Real Analysis is done on your code.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image31.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb31.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb31.png alt></a></a></p><p><em><strong>Figure 6</strong></em>: <em>Analysis took 45 seconds to complete</em></p><p>It is important that the end analysis task is the last one, because <strong>sonar analyzer is capable of understanding code coverage result from your unit testing</strong> , a metric that is controversial, but gives you a nice idea on the amount of Unit Testing that the project contains.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image32.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb32.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb32.png alt></a></a></p><p><em><strong>Figure 7</strong></em>: <em>Code coverage result is correctly saved in Sonar Qube</em></p><blockquote><p>Thanks to automatic versioning, you have also a better timeline of the status of your project.</p></blockquote><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image33.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb33.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2015/10/image_thumb33.png alt></a></a></p><p><em><strong>Figure 8</strong></em>: <em>Versioning correctly stored inside Sonar Qube</em></p><p>The entire setup should not take you more than 30 minutes.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/agile/>Agile</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/agile/>Agile</a>, <a class=tag href=/tags/sonarqube/>sonarqube</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2015/10/installing-sonarqube-on-windows-and-sql-server/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Installing SonarQUBE on windows and SQL Server</a></div><div class="next-entry sep-before"><a href=/post/old/2015/11/facebook-code-generator-on-windows-phone/><span class=screen-reader-text>Next post: </span>Facebook Code Generator on Windows Phone<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>