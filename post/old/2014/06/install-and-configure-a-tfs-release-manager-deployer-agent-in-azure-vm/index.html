<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The Problem  You have a domain with TFS and -release management, there are no problems deploying agents on machines inside the domain, but you are not able to configure an agent for machines outside the domain.
 Es: you have some Azure VMs you want to use for your release pipeline and you do not want to join them to the domain with VPN or other mechanism.
This scenario usually ends in being not able to configure Deployment Agents in those machines due to various authorization problems."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Install and configure a TFS Release Manager Deployer Agent in Azure VM • Codewrecks"><meta property="og:description" content="The Problem  You have a domain with TFS and -release management, there are no problems deploying agents on machines inside the domain, but you are not able to configure an agent for machines outside the domain.
 Es: you have some Azure VMs you want to use for your release pipeline and you do not want to join them to the domain with VPN or other mechanism.
This scenario usually ends in being not able to configure Deployment Agents in those machines due to various authorization problems."><meta property="og:url" content="https://www.codewrecks.com/post/old/2014/06/install-and-configure-a-tfs-release-manager-deployer-agent-in-azure-vm/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Azure"><meta property="article:tag" content="ReleaseManagement"><meta property="article:published_time" content="2014-06-11T07:00:37+02:00"><meta property="article:modified_time" content="2014-06-11T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Install and configure a TFS Release Manager Deployer Agent in Azure VM • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2014/06/install-and-configure-a-tfs-release-manager-deployer-agent-in-azure-vm/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Install and configure a TFS Release Manager Deployer Agent in Azure VM</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Install and configure a TFS Release Manager Deployer Agent in Azure VM</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2014-06-11T07:00:37+02:00>2014, Jun 11</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><h2 id=the-problem>The Problem</h2><blockquote><p>You have a domain with TFS and -release management, there are no problems deploying agents on machines inside the domain, but you are not able to configure an agent for machines outside the domain.</p></blockquote><p>Es: you have some Azure VMs you want to use for your release pipeline and you do not want to join them to the domain with VPN or other mechanism.</p><p>This scenario usually ends in being not able to configure Deployment Agents in those machines due to various authorization problems. The exact symptom range from getting 401 errors when you try to configure Agent on the VM. Another symptom is being able to configure the Deployment Agent, but whenever the service starts you do not see any heartbeat on the server and in the Event viewer of VM you got error like these ones</p><p><em>Timestamp: 6/10/2014 6:17:12 AM<br>Message: Error loading profile for current user: nabla-dep1\inreleasedeployer<br>Category: General<br>Priority: -1<br>EventId: 0<br>Severity: Error<br>Title:<br>Machine: NABLA-DEP1</em></p><h2 id=the-usual-cause>The usual cause</h2><p>The most common cause of the problem is a bad configuration of Shadow Accounts and authentication problem between the machine outside the domain and the machines inside the domain. <strong>I want to share with you the sequence of operation that finally made my Azure VM runs a Deployer Agent and connect to Release Management Server</strong>.</p><p>Here is my scenario</p><p>My domain is called * <strong>CYBERPUNK</strong> *and the user used to run deployment agents is called * <strong>InReleaseDeployer</strong> *.</p><p>The machine where TFS and RM Server is installed is called <strong>TFS2013PREVIEWO</strong> and Azure VM is called <strong>NABLA-DEP1</strong>.</p><p>I’ve already the user <strong>CYBERPUNK\InReleaseDeployer</strong> added as a Service user to Release Manager, and I already used to deploy an agent for a machine in the domain with no problem.</p><p>Now head for configuring everything for an Azure VM.</p><h2 id=the-solution>The solution</h2><p>This is the solution:</p><blockquote><p>You need * <strong>THREE ACCOUNTS</strong> *:</p></blockquote><ol><li><ul><li><strong>CYBERPUNK\InReleaseDeployer</strong> *: You already have this because is the standard domain account used for Domain Agent in machine joined to your domain.</li></ul></li><li><ul><li><strong>TFS2013PREVIEWO\InReleaseDeployer</strong> *: this is the shadow account on RM serve machine. It is a local user that should be created in the machine running Release Management server.</li></ul></li><li><ul><li><strong>NABLA-DEP1\InReleaseDeployer</strong> *: this is the shadow account on the Azure VM Machine, is a local user on the Azure VM Machine</li></ul></li></ol><p>Now be sure that these account satisfy these conditions:</p><ol><li>All three accounts * <strong>must have same password</strong> *</li><li><strong>NABLA-DEP1\InReleaseDeployer must be <em>administrator of NABLA-DEP1 machine</em></strong>, it must also have the right o <em>logon as a service</em>.</li><li>All three account should be added to Release Management Users with these permissions.</li></ol><p>Domain user should have the standard Service User flagged</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image3.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb3.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb3.png alt=image></a></a>ù</p><p>Then the shadow account in the RM machine should be also Release Manager and not only Service User, here is the setting.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image4.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb4.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb4.png alt=image></a></a></p><p>Please note that the user is expressed in the form MACHINENAME\username, so it is TFS2013PREVIEWO\InReleaseDeployer, and it is a Release Manager and a Service User.</p><p>Finally you need to add the user of the Azure VM.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image5.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb5.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb5.png alt=image></a></a></p><p>Even for this user you need to express it in the form MACHINENAME\UserName, so it is NABLA-DEP1\InReleaseDeployer. This completes the setup of the shadow account for your RM Server.</p><p>Now it is the turn of the Azure VM so **connect in Remote Desktop on Azure VM, and <em>login with credentials NABLA-DEP1\InReleaseDeployer user, do not use other users</em> and finally configure the agent **. Before configuring the agent, open credential manager and specify credentials to connect to the public address of RM Server. You need to add a Windows Credential specifying the Credentials that should be used upon connection to the Remote Release Management Server. Be sure to prefix the user with domain specification, as in the following picture (CYBERPUNK\InReleaseDeployer).</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image6.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb6.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb6.png alt=image></a></a></p><p>You should now see the credentials you just entered.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image7.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb7.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb7.png alt=image></a></a></p><p>Actually adding Credentials in Windows Credentials is required only if you want to use RM Client to connect to the server, but I noticed that my user had problem connecting to the server if I miss this part, so I strongly suggest you to add RM Server to Windows Credentials to avoid problem.</p><p>Now the last step is configuring the agent.** You must specify Nabla-dep1\InReleaseDeployer as the user used to run the service and the public address of your Release Management Server**.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image8.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb8.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb8.png alt=image></a></a></p><p>Press Apply settings and the configuration should complete with no error.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image9.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb9.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb9.png alt=image></a></a></p><p>Once the Deployer Agent is configured you should be able to find the new agent from Release Management Client, in Configure Path –> Servers –> New –> Scan For New.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image10.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb10.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb10.png alt=image></a></a></p><p>Everything is ok, my RM Server is able to see the deployer on the VM even if the VM is outside the network and not joined to corporate domain. Now you can select the new agent and Press Register to register with the list of valid Deployer Agents.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image11.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb11.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/06/image_thumb11.png alt=image></a></a></p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/azure/>Azure</a>, <a class=tag href=/tags/releasemanagement/>ReleaseManagement</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2014/06/video/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Detect Client-side reconnection with SignalR</a></div><div class="next-entry sep-before"><a href=/post/old/2014/06/how-to-deploy-a-web-site-with-powershell-part-2/><span class=screen-reader-text>Next post: </span>How to deploy a Web Site with Powershell Part 2<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>