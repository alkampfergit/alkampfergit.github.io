<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Previous post on the series
 Versioning assembly during TFS 2013 build with Powershell Scripts Automatically Build and Publish NuGet Packages during TFS Build Manage Symbol Server on Azure (or on-premise) VM and TF Service  After you set automatic publishing of NuGet packages with automatic assembly and NuGet version numbering in a TFS Build, you surely want to * enable publishing symbols on a Symbol Server *. This will permits you to put a reference to your NuGet Package and then being able to debug the code thanks to Symbol Server support with TFS."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Publish NuGet Package to a private NuGet Server with TFS Build and Symbol Server • Codewrecks"><meta property="og:description" content="Previous post on the series
 Versioning assembly during TFS 2013 build with Powershell Scripts Automatically Build and Publish NuGet Packages during TFS Build Manage Symbol Server on Azure (or on-premise) VM and TF Service  After you set automatic publishing of NuGet packages with automatic assembly and NuGet version numbering in a TFS Build, you surely want to * enable publishing symbols on a Symbol Server *. This will permits you to put a reference to your NuGet Package and then being able to debug the code thanks to Symbol Server support with TFS."><meta property="og:url" content="https://www.codewrecks.com/post/old/2014/02/publish-nuget-package-to-a-private-nuget-server-with-tfs-build-and-symbol-server/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Continuous Deployment"><meta property="article:tag" content="nuget"><meta property="article:tag" content="TfsBuild"><meta property="article:published_time" content="2014-02-13T21:00:37+02:00"><meta property="article:modified_time" content="2014-02-13T21:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Publish NuGet Package to a private NuGet Server with TFS Build and Symbol Server • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2014/02/publish-nuget-package-to-a-private-nuget-server-with-tfs-build-and-symbol-server/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Publish NuGet Package to a private NuGet Server with TFS Build and Symbol Server</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Publish NuGet Package to a private NuGet Server with TFS Build and Symbol Server</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2014-02-13T21:00:37+02:00>2014, Feb 13</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>Previous post on the series</p><ul><li><a href=http://www.codewrecks.com/blog/index.php/2014/01/11/customize-tfs-2013-build-with-powershell-scripts/>Versioning assembly during TFS 2013 build with Powershell Scripts</a></li><li><a href=http://www.codewrecks.com/blog/index.php/2014/02/01/automatically-build-and-publish-nuget-packages-during-tfs-build/>Automatically Build and Publish NuGet Packages during TFS Build</a></li><li><a href=http://www.codewrecks.com/blog/index.php/2013/07/04/manage-symbol-server-on-azure-or-on-premise-vm-and-tf-service/>Manage Symbol Server on Azure (or on-premise) VM and TF Service</a></li></ul><p>After you set automatic publishing of NuGet packages with automatic assembly and NuGet version numbering in a TFS Build, you surely want to * <strong>enable publishing symbols on a Symbol Server</strong> *. This will permits you to <strong>put a reference to your NuGet Package and then being able to debug the code thanks to Symbol Server support with TFS</strong>. Publishing symbols is just a matter of specifying a shared folder to store symbols in build configuration, but if you enable it in previous build where you publish with Powershell, it does not work. The reason is, <strong>you are running PowerShell script that publish NuGet package after build (or after test), but in the build Workflow, source indexing happens after these steps</strong>.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image11.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb11.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb11.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Build workflow sequence showing that publish of symbols takes place after NuGet package is published</em></p><p>The problem happens because <strong>you should publish your NuGet package after publishing took place and your.pdb files are modified</strong> to point to sources in TFS. To fix this problem you simply need first to download the Build Workflow, (in TFS 2013 default build Workflows are not stored directly in Source Control and they should be downloaded if you want to customize them) and create a custom build.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image12.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb12.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb12.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Downloading the standard Workflow Template in your machine to create a custom Workflow</em></p><p>You can just download to your computer, change name of the file, change inner workflow and check-in in Source Control as you would have done with previous version of TFS. My goal is <strong>adding the ability to run another script at the very end of the workflow</strong> , so I opened the workflow and simply copy and paste the Run optional script after Test in the end of the sequence and change name to Run optional script at the end of the Build.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image13.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb13.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb13.png alt=image></a></a></p><p><strong>figure 3:</strong> <em>Copy and paste script execution block to enable executing script at the end of the Workflow</em></p><p>Now I added two other Workflow Arguments , to allow the user to specify the location and arguments of this script.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image14.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb14.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb14.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Adding arguments to pass to the new script execution block.</em></p><p>Now you should change the <em>Run optional script at the end of the Build</em>block to reference these two new arguments instead of the original ones.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image15.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb15.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb15.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Referencing the new arguments in copied block</em></p><p>Finally you need to return to Arguments of the Workflow and change the Metadata argument, to specify some additional data about these two arguments.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image16.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb16.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb16.png alt=image></a></a></p><p><em><strong>Figure 6</strong></em>: <em>Adding Metadata for your custom arguments.</em></p><p>Here you can give name and description to your arguments, but <strong>the most important part is giving a category and the Editor</strong>. In this example the PostExecutionScriptPath should be a Source Control path like $/TeamProjectName/xxx and if you specify</p><p>Microsoft.TeamFoundation.Build.Controls.ServerFileBrowserEditor, Microsoft.TeamFoundation.Build.Controls</p><p>As Editor, the user would be able to browse the source control as for the other script in the build. You should check-in the new workflow in source control, edit the build definition and in Process tab choose the new workflow. You should be able now to see the new arguments to specify the script that should be run at the end of the Build.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image17.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb17.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb17.png alt=image></a></a></p><p><em><strong>Figure 7</strong></em>: <em>You can now specify a script that will be executed at the very end of the build.</em></p><p>Thanks to the Editor, if you select the Post Execution Script Path, you will find an ellipsis button that permits you to browse the source to specify file location.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image18.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb18.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2014/02/image_thumb18.png alt=image></a></a></p><p><em><strong>Figure 8</strong></em>: <em>Thanks to the Editor property in metadata you are able to browse the source to specify the script.</em></p><p>You can now use the very same script of NuGet publishing, but since it is executed after symbols publishing, now your NuGet package contains indexed pdb and everything works as expected.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/continuous-deployment/>Continuous Deployment</a>, <a class=tag href=/tags/nuget/>nuget</a>, <a class=tag href=/tags/tfsbuild/>TfsBuild</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2014/02/moving-between-different-vcs-to-team-foundation-server/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Moving between different VCS to Team Foundation Server</a></div><div class="next-entry sep-before"><a href=/post/old/2014/02/application-insights-on-visual-studio-online/><span class=screen-reader-text>Next post: </span>Application Insights on Visual Studio Online<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>