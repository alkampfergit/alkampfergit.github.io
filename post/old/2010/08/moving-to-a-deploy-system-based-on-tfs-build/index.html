<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Now that I&rsquo;m able to deploy to a remote machine a web application thanks to a customized build workflow it is time to move to a real scenario. I&rsquo;ve blogged about two distinct tasks
 executing arbitrary code with a tfs build deploy an application to a remote server with a custom tfs workflow  Now I want to move to a real scenario:executing the deploy when build quality of a specific build changes to ready for deployment."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Moving to a deploy system based on Tfs Build • Codewrecks"><meta property="og:description" content="Now that I&rsquo;m able to deploy to a remote machine a web application thanks to a customized build workflow it is time to move to a real scenario. I&rsquo;ve blogged about two distinct tasks
 executing arbitrary code with a tfs build deploy an application to a remote server with a custom tfs workflow  Now I want to move to a real scenario:executing the deploy when build quality of a specific build changes to ready for deployment."><meta property="og:url" content="https://www.codewrecks.com/post/old/2010/08/moving-to-a-deploy-system-based-on-tfs-build/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="TFS Build"><meta property="article:published_time" content="2010-08-10T08:00:37+02:00"><meta property="article:modified_time" content="2010-08-10T08:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Moving to a deploy system based on Tfs Build • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2010/08/moving-to-a-deploy-system-based-on-tfs-build/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Moving to a deploy system based on Tfs Build</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Moving to a deploy system based on Tfs Build</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2010-08-10T08:00:37+02:00>2010, Aug 10</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>Now that I&rsquo;m able to deploy to a remote machine a web application thanks to a customized build workflow it is time to move to a real scenario. I&rsquo;ve blogged about two distinct tasks</p><ol><li><a href=http://www.codewrecks.com/blog/index.php/2010/07/07/use-tfs-2010-build-to-execute-arbitrary-task/>executing arbitrary code with a tfs build</a></li><li><a href=http://www.codewrecks.com/blog/index.php/2010/07/10/deploy-remotely-with-tfs-build/>deploy an application to a remote server with a custom tfs workflow</a></li></ol><p>Now I want to move to a real scenario:<em>executing the deploy when build quality of a specific build changes to <em>ready for deployment</em>.</em> To accomplish this task you first need to understand how to register for event subscription in TFS, thanks to the <strong><a href=http://msdn.microsoft.com/en-us/magazine/cc507647.aspx>bisubscribe.exe</a></strong> tool. Subscription is made through webservices.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/08/image1.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/08/image_thumb1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/08/image_thumb1.png alt=image></a></a></p><p>You register to TFS event submitting ad url where your service is listening, and whenever the event fires, TFS calls your service. To find all events you can register to, you can simply browse the service</p><p><a href=http://win-y4onzs094up:8080/tfs/services/v1.0/registration.asmx title=http://win-y4onzs094up:8080/tfs/services/v1.0/registration.asmx>http://win-y4onzs094up:8080/tfs/services/v1.0/registration.asmx</a></p><p>Then click GetRegistrationEntries, and invoke the service. The result value is a long XML where you can find the eventType node that specifies the type of events you can register to. Since I want to be notified when a build changes quality, I need to register to BuildStatusChangeEvent</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>- &lt;EventType&gt;
&lt;Name&gt;BuildStatusChangeEvent&lt;/Name&gt;
&lt;Schema&gt;&lt;?xml version=<span style=color:#e6db74>&#34;1.0&#34;</span> encoding=<span style=color:#e6db74>&#34;utf-8&#34;</span>?&gt;
&lt;xs:schema elementFormDefault=<span style=color:#e6db74>&#34;qualified&#34;</span> xmlns:xs=<span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema&#34;</span>&gt;
&lt;xs:element name=<span style=color:#e6db74>&#34;BuildStatusChangeEvent&#34;</span> nillable=<span style=color:#e6db74>&#34;true&#34;</span> type=<span style=color:#e6db74>&#34;BuildStatusChangeEvent&#34;</span> /&gt;
&lt;xs:complexType name=<span style=color:#e6db74>&#34;BuildStatusChangeEvent&#34;</span>&gt;
&lt;xs:sequence&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;TeamFoundationServerUrl&#34;</span> type=<span style=color:#e6db74>&#34;xs:anyURI&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;TeamProject&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;Title&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;Subscriber&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;Id&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;Url&#34;</span> type=<span style=color:#e6db74>&#34;xs:anyURI&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;TimeZone&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;TimeZoneOffset&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;ChangedTime&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;StatusChange&#34;</span> type=<span style=color:#e6db74>&#34;Change&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;ChangedBy&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;xs:complexType name=<span style=color:#e6db74>&#34;Change&#34;</span>&gt;
&lt;xs:sequence&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;FieldName&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;OldValue&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;xs:element minOccurs=<span style=color:#e6db74>&#34;0&#34;</span> maxOccurs=<span style=color:#e6db74>&#34;1&#34;</span> name=<span style=color:#e6db74>&#34;NewValue&#34;</span> type=<span style=color:#e6db74>&#34;xs:string&#34;</span> /&gt;
&lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
&lt;/xs:schema&gt;
&lt;/Schema&gt;
&lt;/EventType&gt;
</code></pre></td></tr></table></div></div><p>The command I issue to the tfs service to register my service for changing of <em>BuildStatusChangeEvent</em> is the following one.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>C:<span style=color:#960050;background-color:#1e0010>\</span>Program Files<span style=color:#960050;background-color:#1e0010>\</span>Microsoft Team Foundation Server <span style=color:#ae81ff>2010</span><span style=color:#960050;background-color:#1e0010>\</span>Tools&gt;
BisSubscribe.exe
/EventType BuildStatusChangeEvent
/address http:<span style=color:#75715e>//10.0.0.2/Bisubscribe.Test/BuildMachine.svc
</span><span style=color:#75715e></span>/collection http:<span style=color:#75715e>//win-y4onzs094up:8080/tfs/DefaultCollection
</span><span style=color:#75715e></span> 
BisSubscribe - Team Foundation Server BisSubscribe Tool
Copyright (c) Microsoft Corporation.  All rights reserved.
 
TF50001:  Created or found an existing subscription. The subscription ID <span style=color:#66d9ef>is</span> <span style=color:#ae81ff>2.</span>
</code></pre></td></tr></table></div></div><p>You need simply to specify: <em>EventType, address and collection</em> and you are done. Now for those ones that have no idea on how to implement the <em>BuildMachine.svc</em> service here is the details.</p><p>First of all check <a href=http://mskold.blogspot.com/2010/02/upgrading-tfs-event-subscriptions-to.html>this post</a> that explains in detail how to use WCF to create a service that is compatible with TFS subscription system, then it is matters of minute because the service needs only a function called <em>Notify</em>. First of all I created service interface</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>namespace</span> Bisubscribe.Test.Services
{
<span style=color:#a6e22e>[ServiceContract(Namespace = &#34;http://schemas.microsoft.com/TeamFoundation/2005/06/Services/Notification/03&#34;)]</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> INotificationService
{
<span style=color:#a6e22e> 
</span><span style=color:#a6e22e>[OperationContract(Action = &#34;http://schemas.microsoft.com/TeamFoundation/2005/06/Services/Notification/03/Notify&#34;)]</span>
<span style=color:#a6e22e>[XmlSerializerFormat(Style = OperationFormatStyle.Document)]</span>
<span style=color:#66d9ef>void</span> Notify(<span style=color:#66d9ef>string</span> eventXml, <span style=color:#66d9ef>string</span> tfsIdentityXml);
 
}
}
</code></pre></td></tr></table></div></div><p>Then the concrete class to simply dump content of the messages to verify that the event system is called.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>namespace</span> Bisubscribe.Test.Services
{
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BuildMachine</span> : INotificationService
{
<span style=color:#66d9ef>private</span> ILogger Logger { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
 
<span style=color:#66d9ef>public</span> BuildMachine(ILogger logger)
{
Logger = logger;
}
 
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Notify(<span style=color:#66d9ef>string</span> eventXml, <span style=color:#66d9ef>string</span> tfsIdentityXml)
{
Logger.Debug(<span style=color:#e6db74>&#34;Called eventXML:\n{0}&#34;</span>,  eventXml );
Logger.Debug(<span style=color:#e6db74>&#34;Called tfsIdentityXml:\n{0}&#34;</span>, tfsIdentityXml);
}
}
}
</code></pre></td></tr></table></div></div><p>Since I&rsquo;m using castle log4net integration and castle wcf integration I&rsquo;m able to declare dependency to a ILogger interface to simply log every information that the server receives. Then I create a simple web application and insert the BuildMachine.Svc file with this content</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>&lt;%   <span style=color:#ae81ff>1</span>:  @ServiceHost Service=<span style=color:#e6db74>&#34;Bisubscribe.Test.Services.BuildMachine&#34;</span>
Factory=<span style=color:#e6db74>&#34;Castle.Facilities.WcfIntegration.DefaultServiceHostFactory, Castle.Facilities.WcfIntegration&#34;</span>
%&gt;
</code></pre></td></tr></table></div></div><p>I&rsquo;m using the Castle WcfIntegration facility so I need to register the class in the castle config file, and finally, the only really critical step, is creating the right configuration for WCF to expose the service with SOAP 1.2 as described in <a href=http://mskold.blogspot.com/2010/02/upgrading-tfs-event-subscriptions-to.html>this article</a>. Now I changed the build quality of one of the build and check log file to verify if service is called. Here is the result.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#ae81ff>2010</span>-<span style=color:#ae81ff>08</span>-<span style=color:#ae81ff>07</span> <span style=color:#ae81ff>11</span>:<span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>39</span>,<span style=color:#ae81ff>666</span> [<span style=color:#ae81ff>7</span>] DEBUG Bisubscribe.Test.Services.BuildMachine [(<span style=color:#66d9ef>null</span>)] - Called eventXML:
&lt;?xml version=<span style=color:#e6db74>&#34;1.0&#34;</span> encoding=<span style=color:#e6db74>&#34;utf-16&#34;</span>?&gt;&lt;BuildStatusChangeEvent xmlns:xsi=<span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> xmlns:xsd=<span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema&#34;</span>&gt;
&lt;BuildUri&gt;vstfs:<span style=color:#75715e>///Build/Build/34&lt;/BuildUri&gt;
</span><span style=color:#75715e></span>&lt;TeamFoundationServerUrl&gt;http:<span style=color:#75715e>//win-y4onzs094up:8080/tfs/DefaultCollection&lt;/TeamFoundationServerUrl&gt;
</span><span style=color:#75715e></span>&lt;TeamProject&gt;WebDeploy&lt;/TeamProject&gt;
&lt;Title&gt;WebDeploy Build Demo_20100709.<span style=color:#ae81ff>7</span> Quality Changed To Initial Test Passed&lt;/Title&gt;
&lt;Subscriber&gt;WIN-Y4ONZS094UP<span style=color:#960050;background-color:#1e0010>\</span>Administrator&lt;/Subscriber&gt;
&lt;Id&gt;Demo_20100709.<span style=color:#ae81ff>7</span>&lt;/Id&gt;
&lt;Url&gt;http:<span style=color:#75715e>//win-y4onzs094up:8080/tfs/web/build.aspx?pcguid=ab718f2c-b4ab-499e-98c1-0a9766e3ddf6&amp;amp;builduri=vstfs:///Build/Build/34&lt;/Url&gt;
</span><span style=color:#75715e></span>&lt;TimeZone&gt;Pacific Daylight Time&lt;/TimeZone&gt;
&lt;TimeZoneOffset&gt;-<span style=color:#ae81ff>07</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>&lt;/TimeZoneOffset&gt;
&lt;ChangedTime&gt;<span style=color:#ae81ff>8</span>/<span style=color:#ae81ff>7</span>/<span style=color:#ae81ff>2010</span> <span style=color:#ae81ff>2</span>:<span style=color:#ae81ff>12</span>:<span style=color:#ae81ff>37</span> AM&lt;/ChangedTime&gt;
&lt;StatusChange&gt;
&lt;FieldName&gt;Quality&lt;/FieldName&gt;
&lt;OldValue&gt;Ready <span style=color:#66d9ef>for</span> Deployment&lt;/OldValue&gt;
&lt;NewValue&gt;Initial Test Passed&lt;/NewValue&gt;
&lt;/StatusChange&gt;
&lt;ChangedBy&gt;WIN-Y4ONZS094UP<span style=color:#960050;background-color:#1e0010>\</span>gianmaria.ricci&lt;/ChangedBy&gt;
&lt;/BuildStatusChangeEvent&gt;
</code></pre></td></tr></table></div></div><p>This is simple XML that can be parsed with Linq2SQL, you can find the id of the build and in StatusChange node you are notified of the field name that changes (Quality) the old and new value and this is enough information to implement the requested functionality.</p><p>Next step is <a href=http://www.codewrecks.com/blog/index.php/2010/07/10/deploy-remotely-with-tfs-build/>triggering the execution of the remote build script</a> to deploy the right build into the test server.</p><p>alk.</p><p><a href=http://www.codewrecks.com/Files/bisubscribe.zip>Sample code is here</a>.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/tfs-build/>TFS Build</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2010/08/aop-with-castlepart-3-the-first-interceptor/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>AOP With castle-Part 3-The first interceptor</a></div><div class="next-entry sep-before"><a href=/post/old/2010/08/nhibernate-query-only-properties-and-many-to-one/><span class=screen-reader-text>Next post: </span>Nhibernate query only properties and many-to-one<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>