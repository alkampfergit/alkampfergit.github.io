<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="If you want to deploy a database project into a target sql server instance during a tfs 2010 build, you can use with success the basic MsBuildTask, similar to tfs2008.
I decided to deploy the database, only if the tests are ok and the build is ok, so I place a condition activity under the test phase and I set the condition to pass only if the test and build status are different from Failed"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Deploy a database project with tfs build 2010 • Codewrecks"><meta property="og:description" content="If you want to deploy a database project into a target sql server instance during a tfs 2010 build, you can use with success the basic MsBuildTask, similar to tfs2008.
I decided to deploy the database, only if the tests are ok and the build is ok, so I place a condition activity under the test phase and I set the condition to pass only if the test and build status are different from Failed"><meta property="og:url" content="https://www.codewrecks.com/post/old/2010/01/deploy-a-database-project-with-tfs-build-2010/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="DataDude"><meta property="article:tag" content="TFS Build"><meta property="article:tag" content="workflow"><meta property="article:published_time" content="2010-01-04T15:00:37+02:00"><meta property="article:modified_time" content="2010-01-04T15:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Deploy a database project with tfs build 2010 • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2010/01/deploy-a-database-project-with-tfs-build-2010/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Deploy a database project with tfs build 2010</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Deploy a database project with tfs build 2010</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2010-01-04T15:00:37+02:00>2010, Jan 04</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>3 mins read</span></div></div></header><div class="container entry-content"><p>If you want to deploy a database project into a target sql server instance during a tfs 2010 build, you can use with success the basic MsBuildTask, <a href=http://www.codewrecks.com/blog/index.php/2009/10/23/automatic-deployment-of-a-web-application-with-tfs-build/>similar to tfs2008</a>.</p><p>I decided to deploy the database, only if the tests are ok and the build is ok, so I place a condition activity under the test phase and I set the condition to pass only if the test and build status are different from Failed</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb.png alt=image></a></a></p><p>Now I need to know where the dbproj will be located in the disk during the build, and since I know the repository path, I can use a specific TFS build action to convert the source control path into physical path. The source control path is <em>$/Experiments/NorthwindTest/NorthwindTest.Database/NorthwindTest.Database.dbproj</em> so I can drop a * <strong>ConvertWorkspaceItem</strong> * activity to convert this path to the physical one. First of all I need to declare a variable where to put the result.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image1.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb1.png alt=image></a></a></p><p>I called this variable <em>dbProject</em> (String type). Now I can configure my <strong>ConvertWorkspaceItem</strong> activity I dropped in the <em>then</em> part of my condition activity.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image2.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb2.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb2.png alt=image></a></a></p><p>This activity needs three variables, the first is the source control path you want to translate, the second is the name of the variable that will contain the result and the third is the Workspace to use (is stored into the global variable <strong>Workspace</strong> ).</p><p>Following this activity I dropped a WriteBuildMessage activity, used to write something into the build log (I wrote the exact path of the database project that is to be deployed)</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image3.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb3.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb3.png alt=image></a></a></p><p>This is only informational, but it is useful to check during the build process.</p><p>The most important activity is the <strong>MsBuildActivity</strong> that will do the real work. This activity invokes Msbuild.exe that in turns will target the database project to deploy. The most important property is the <strong>CommandLineArgument</strong> where you must specify all details of the deploy</p><p><em>"/p:TargetDatabase=NorthwindTest&rdquo; +<br>" /p:&ldquo;&ldquo;DefaultDataPath=C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA&rdquo;&rdquo;&rdquo; +<br>" /p:&ldquo;&ldquo;TargetConnectionString=Data Source=10.0.0.99\SQL2008,49400%3Buser=sa%3Bpwd=Pa$$w0rd&rdquo;&rdquo;&rdquo; +<br>" /p:DeployToDatabase=true&rdquo;</em></p><p>These properties are used to specify the name of the database, the datapath, the connectionstring where to deploy the database, and they override the standard one defined on the project. As you can see in connection string I used the sa password, that is strongly discouraged for security reasons in production environment. You can use integrated security if the user used to run the team agent has the right to create a database in the target instance.</p><p>Finally these are all the properties of the msbuild activity.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image4.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb4.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb4.png alt=image></a></a></p><p>LogFile is really important, because you want a msbuild log file of what is happened during the deploy. You can check this file in the logs\ subfolder of the drop location</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image5.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb5.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb5.png alt=image></a></a></p><p>If you open deploydatabase.log, you can find all the information you need on what is happened, here is a little extract.</p><p><em>Build started 1/4/2010 7:08:38 AM.<br>Project &ldquo;C:\Builds\1\Experiments\DeployDatabase\Sources\NorthwindTest\NorthwindTest.Database\NorthwindTest.Database.dbproj&rdquo; on node 1 (Deploy target(s)).<br>DspDeploy:<br>  Deployment script generated to:<br>  C:\Builds\1\Experiments\DeployDatabase\Binaries\NorthwindTest.Database.sql<br>  Creating NorthwindTest…<br>  Creating [dbo].[Categories]…<br>  Creating PK_Categories…<br>  Creating [dbo].[Categories].[CategoryName]…<br>  Creating [dbo].[CustomerCustomerDemo]…<br>  Creating PK_CustomerCustomerDemo…<br>  Creating [dbo].[CustomerDemographics]…<br>  Creating PK_CustomerDemographics…<br>  Creating [dbo].[Customers]…<br>  Creating PK_Customers…</em></p><p>A really important property is the Target, that is set to <strong>New String() {<em>Deploy</em>}</strong>. A database project supports some different targets, as an example the build, deploy, dataGeneration and StaticCodeAnalysis, each of them will perform a different task.</p><p>The project to deploy is specified in the <strong>Project</strong> property, and as you can see I use the variable dbProject that was populated with the ConvertWorkspaceItem.</p><p>If you check build details you can find all the information you need about the build process</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image6.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb6.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/01/image_thumb6.png alt=image></a></a></p><p>From here you can verify project directory, and all the options that are passed to the msbuild.exe. You can now schedule the build and verify that the database is deployed on target server.</p><p>alk.</p><p>Tags: <a href=http://technorati.com/tag/TfsBuild>TfsBuild</a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/datadude/>DataDude</a>, <a class=tag href=/tags/tfs-build/>TFS Build</a>, <a class=tag href=/tags/workflow/>workflow</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2010/01/sata-and-e-sata/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>SATA and E-Sata</a></div><div class="next-entry sep-before"><a href=/post/old/2010/01/again-on-ioc-windsor-and-release/><span class=screen-reader-text>Next post: </span>Again on IoC windsor and Release<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>