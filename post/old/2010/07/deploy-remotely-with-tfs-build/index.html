<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="It is time to connect together a couple of posts of mine, in the first I simply explained how to deploy a web application to a remote machine with the use of Beyondexec2, in another one I explained how to create a simple tfs build, that actually does not build anything, but execute a simple workflow.
In this post I&rsquo;ll cover a primitive build workflow to deploy the result of another build."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Deploy remotely with TFS build • Codewrecks"><meta property="og:description" content="It is time to connect together a couple of posts of mine, in the first I simply explained how to deploy a web application to a remote machine with the use of Beyondexec2, in another one I explained how to create a simple tfs build, that actually does not build anything, but execute a simple workflow.
In this post I&rsquo;ll cover a primitive build workflow to deploy the result of another build."><meta property="og:url" content="https://www.codewrecks.com/post/old/2010/07/deploy-remotely-with-tfs-build/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Continuous Integration"><meta property="article:tag" content="TFS Build"><meta property="article:published_time" content="2010-07-10T05:00:37+02:00"><meta property="article:modified_time" content="2010-07-10T05:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Deploy remotely with TFS build • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2010/07/deploy-remotely-with-tfs-build/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Deploy remotely with TFS build</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Deploy remotely with TFS build</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2010-07-10T05:00:37+02:00>2010, Jul 10</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>It is time to connect together a couple of posts of mine, <a href=http://www.codewrecks.com/blog/index.php/2010/07/06/deploy-on-remote-machine-during-builds/>in the first</a> I simply explained how to deploy a web application to a remote machine with the use of Beyondexec2, <a href=http://www.codewrecks.com/blog/index.php/2010/07/07/use-tfs-2010-build-to-execute-arbitrary-task/>in another one</a> I explained how to create a simple tfs build, that actually does not build anything, but execute a simple workflow.</p><p>In this post I&rsquo;ll cover a primitive build workflow to deploy the result of another build. The starting point is having a build called <em>Demo</em> that builds a web site and create the installer package, plus the script described <a href=http://www.codewrecks.com/blog/index.php/2010/07/06/deploy-on-remote-machine-during-builds/>here</a>. You need to insert the scripts and the PsExec utility in the source code of your team project, to be available from the build agent during the build, as shown in <strong>Figure 1</strong>. Note: in this example I&rsquo;ll use the <a href=http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx>PsExec</a> tools instead of beyondexecv2, but they are exactly equivalent, PsExex is more maintained tool and works better when execute in services.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitled4.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitled_thumb2.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitled_thumb2.png alt=Untitled></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Include deploy related files into source control system</em></p><p>Now you need to modify the deploy script created in the other blog post, adding all the operations needed to deploy a build, first of all you need to define some more parameters ( <strong>Figure 2</strong> ). These one are the number of the build to use (Es. demo_20100607.3) machine name where you want to install and the password of the administrator account of that machine.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/image11.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/image_thumb11.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/image_thumb11.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Parameters of the workflow</em></p><p>Now, since the tools and script to do remote deploy are stored in source control system, the build scripts needs to create a workspace and do a getlatest; to do this, you can reuse the relative section of the standard workflow showed in <strong>Figure 3</strong>.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitled21.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitled2_thumb1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitled2_thumb1.png alt=Untitled2></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Details of workspace management</em></p><p>The steps from <strong>Figure 3</strong> is taken from the standard workflow, and it is a common sequence of operation to create a workspace and do a getlatest plus managing some variables. If you run this workflow, as is, you can verify that in the build machine a new workspace is created, and you can browse to the build directory (usually c:\builds\1\teamprojectname\etcetc) to see downloaded files. But before doing this, you need to specify folder to grab in the workspace section of build configuration. As you can see in <strong>Figure 4</strong> , I simply need to grab the BuildTools subdirectory, because there is no need to do a get latest of project sources, but only of the deploy scripts.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/image12.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/image_thumb12.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/image_thumb12.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Configuration of the workspace</em><br>Now I need only to execute the PsExec process to do a remote execution of the script in the machine where I want my web application to be deployed, and this can be done thanks to a simple Invoke Process Activity, as shown in <strong>Figure 5</strong>.<br><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitled5.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitled_thumb3.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitled_thumb3.png alt=Untitled></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Invoke Process activity permits execution of an external process.</em></p><p>FileName property specify the process to execute, for this example is</p><p><em>SourcesDirectory + "\psexec.exe"</em></p><p>Since SourcesDirectory is the one used to map the workspace, I can execute the psexec directly from there. The other important property is the Arguments one:</p><p><em>"\&rdquo; + DeployMachine +  " -u " + DeployMachine + &ldquo;\administrator -p " + DeployMachinePassword +<br>" /accepteula -i -f -h -c " + SourcesDirectory + &ldquo;\deploy\Deployweb.bat " + BuildToUse</em></p><p>This is only a combination of Workflow Parameters to create the argument list, the /accepteula parameter is needed because the psexec shows an eula that should be accepted, and clearly there is noone to click on accept when executed on a service <a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/wlEmoticonsmile1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/wlEmoticonsmile1.png alt=Smile></a>, then the option –c force a file to be copied to remote computer and executed. After the Invoke process, in <strong>Figure 6</strong> I showed the end of the workflow, with a condition that verifies if the PsExec return value is zero (success) or greater than zero (error).</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitledw.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitledw_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/Untitledw_thumb.png alt=Untitledw></a></a></p><p><em><strong>Figure 6</strong></em>: <em>Check return value of PsExec and fail the build if greater than zero.</em></p><p>The SetBuildProperties activity permits to set a property of the build, in this situation I set the status as Failed. Now you can configure a build, configure parameters and see the result.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/image13.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/image_thumb13.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2010/07/image_thumb13.png alt=image></a></a></p><p><em><strong>Figure 7</strong></em>: <em>Log of a successful build.</em></p><p>The only drawback is that you only see output of the psexec program and does not see the output of the execution of DeployWeb.Bat on remote machine. Since you can specify, machine and build number to use, this is a good build script to deploy something on remote machine with a simple click.</p><p>alk.</p><p>P.S. this is the first post following Adam Cogan&rsquo;s SSW Rules (thanks Adam, you rock)</p><p>– the balloon rule, instead of walls of text</p><p><a href=http://sharepoint.ssw.com.au/Standards/Communication/RulesToBetterEmail/Pages/HowToUseBalloons.aspx>http://sharepoint.ssw.com.au/Standards/Communication/RulesToBetterEmail/Pages/HowToUseBalloons.aspx</a></p><p>– the figure/caption rule</p><p><a href=http://www.ssw.com.au/ssw/Standards/Rules/RulesToBetterWebsitesLayout.aspx#AlwaysAddFiguretoImages>http://www.ssw.com.au/ssw/Standards/Rules/RulesToBetterWebsitesLayout.aspx#AlwaysAddFiguretoImages</a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/continuous-integration/>Continuous Integration</a>, <a class=tag href=/tags/tfs-build/>TFS Build</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2010/07/cache-layer/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Cache layer</a></div><div class="next-entry sep-before"><a href=/post/old/2010/07/error-during-clickonce-deploy-with-mshtml-strong-name-signature-not-valid-for-this-assembly/><span class=screen-reader-text>Next post: </span>Error during clickonce deploy with mshtml 8211 Strong name signature not valid for this assembly<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>