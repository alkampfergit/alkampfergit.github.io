<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I have a project with a complex user control used to select some values in hierarchic categories, it was realized with the UpdatePanel, it supports searching, selection by cascade of combo and much more, everything works great, but performances are not so good.
Now I decide to create another version that use jQuery to do real ajax calls and manage json data to maximize performances, but I face a problem"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="PopupControlExtender set focus to a control on popup • Codewrecks"><meta property="og:description" content="I have a project with a complex user control used to select some values in hierarchic categories, it was realized with the UpdatePanel, it supports searching, selection by cascade of combo and much more, everything works great, but performances are not so good.
Now I decide to create another version that use jQuery to do real ajax calls and manage json data to maximize performances, but I face a problem"><meta property="og:url" content="https://www.codewrecks.com/post/old/2010/03/popupcontrolextender-set-focus-to-a-control-on-popup/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="ASPNET"><meta property="article:published_time" content="2010-03-05T16:00:37+02:00"><meta property="article:modified_time" content="2010-03-05T16:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>PopupControlExtender set focus to a control on popup • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2010/03/popupcontrolextender-set-focus-to-a-control-on-popup/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>PopupControlExtender set focus to a control on popup</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>PopupControlExtender set focus to a control on popup</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2010-03-05T16:00:37+02:00>2010, Mar 05</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>I have a project with a complex user control used to select some values in hierarchic categories, it was realized with the UpdatePanel, it supports searching, selection by cascade of combo and much more, everything works great, but performances are not so good.</p><p>Now I decide to create another version that use jQuery to do real ajax calls and manage json data to maximize performances, but I face a problem</p><ul><li>I need to create a UserControl.</li><li>I can have more than one instance of this user control in a single page (but I want a single jquery script)</li><li>The user want to move the focus on a specific part of my control when the popup opens.</li></ul><p>This is an interesting problem, because the popup logic is done with the <a href=http://www.asp.net/AJAX/AjaxControlToolkit/Samples/PopupControl/PopupControl.aspx>PopupControlExtender</a> and I do not want to change it. My goal is to be able to execute some jQuery code when the popup appears and move the focus on a control contained in the popup. Since Microsoft Ajax library, used by the PCE, creates a client side javascript object for each PopupControlExtender, my first problem is *how can I select the javascript object that correspond to my server side control, when I can have more than one instance of the user control in the page (this means multiple PCE)?</p><p>If you know the microsoft ajax library you already know the <a href=http://www.asp.net/AJAX/Documentation/Live/ClientReference/Global/FindShortcutMethod.aspx>$find()</a> function, and you should know also that you can use a particular property called BehaviorID to give a unique Id to the client part of a component. A partial solution to my problem <a href=http://forums.asp.net/t/1440825.aspx>can be found here</a> (look in the end of the post). In that post the PopupControlExtender was declared in this way</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>&lt;AjaxControlToolkit:PopupControlExtender ID=<span style=color:#e6db74>&#34;TextBox1_PopupControlExtender&#34;</span> BehaviorID=<span style=color:#e6db74>&#34;pce&#34;</span> runat=<span style=color:#e6db74>&#34;server&#34;</span>
TargetControlID=<span style=color:#e6db74>&#34;tbPrompt&#34;</span> PopupControlID=<span style=color:#e6db74>&#34;popupPanel&#34;</span> Position=<span style=color:#e6db74>&#34;Bottom&#34;</span>&gt;
</code></pre></td></tr></table></div></div><p><em>As you can see the BehaviorID property is set to <em>pce</em>.</em> Now you can write this client side javascript code.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>function pageLoad() {
<span style=color:#75715e>//find the PopupControlExtender&#39;s client behavior
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> pce = <span style=color:#960050;background-color:#1e0010>$</span>find(<span style=color:#e6db74>&#34;pce&#34;</span>);
<span style=color:#75715e>//add the shown event handler
</span><span style=color:#75715e></span>pce.add_shown(pceShownHandler);
}
function pceShownHandler(sender, args) {
<span style=color:#66d9ef>var</span> pce = <span style=color:#960050;background-color:#1e0010>$</span>find(<span style=color:#e6db74>&#34;pce&#34;</span>);
<span style=color:#75715e>//find the popup Panel of the PopupControlExtender
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> popup = pce._popupElement;
<span style=color:#66d9ef>var</span> input = popup.getElementsByTagName(<span style=color:#e6db74>&#34;input&#34;</span>);
<span style=color:#66d9ef>for</span> (i = <span style=color:#ae81ff>0</span>; i &lt; input.length; i++) {
<span style=color:#75715e>// To check whether the TextBox is the &#34;setFocusToMeOnPopup&#34;.
</span><span style=color:#75715e>// This is just a sample, please modify this condition yourself.
</span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (input[i].id == <span style=color:#e6db74>&#34;FocusTextBox1_setFocusToMeOnPopup&#34;</span>) {
input[i].focus();
input[i].<span style=color:#66d9ef>select</span>();
}
}
}
</code></pre></td></tr></table></div></div><p>As you can verify from line3,<em>the $find(<em>pce</em>) finds the javascript object that contains the client side scripting function of the PopupControlExtender</em>, so you can use the <strong>add_shown</strong> method <em>to register a client side script to execute when the popup opens</em>. If I use the same technique, when I drop two instance of my usercontrol in the page I obtain this javascript error.</p><blockquote><ul><li><strong>Error: Sys.InvalidOperationException: Two components with the same id ‘pce’ can’t be added to the application.</strong> *</li></ul></blockquote><p>The reason is that BehaviorID must be unique in the page. The solution is quite simple, first of all I insert this function in the jQuery script.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>function pceShownHandler(sender, args) {
<span style=color:#66d9ef>var</span> txtControl = sender._parentElement;
<span style=color:#960050;background-color:#1e0010>$</span>(txtControl).parents(<span style=color:#960050;background-color:#1e0010>&#39;</span>.hierarchicmaindiv<span style=color:#960050;background-color:#1e0010>&#39;</span>).find(<span style=color:#960050;background-color:#1e0010>&#39;#</span>txtSearch<span style=color:#960050;background-color:#1e0010>&#39;</span>).focus();
}
</code></pre></td></tr></table></div></div><p>This is the function I want to register with the <strong>add_shown</strong> method, it simply get the textbox control with the _parentElement field of the pce object, then it is time of some magical jQuery selector. <em>Each of my usercontrol instance is rendered inside a div with the class hierarchicmaindiv</em>, now I want to find the textbox wiht <em>txtSearch</em> id, but I want only the one related to the specific popup.</p><p>To reach this goal we need to find the containing div with the parents jQuery function, then with find() function we look for a textbox with the <em>txtSearch</em> id but that is also contained in the div. With this little trick I&rsquo;m sure that you can drop multiple instance of the control in the page without any problem because when the popup opens, I can find the txtSearch textbox inside the popup even when there are multiple txtSearch textbox in the whole page.</p><p>Now I need to wireup this function to the <strong>add_shown</strong> method of the popupcontrolextender, and this can be obtained with this little snippet on the PreRender server events of the UserControl</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>hierarchicPce.BehaviorID = Guid.NewGuid.ToString()
 
Dim script As String = _
<span style=color:#e6db74>&#34;Sys.Application.add_load(function() {&#34;</span> &amp; _
<span style=color:#e6db74>&#34;var pce = $find(&#39;&#34;</span> &amp; hierarchicPce.BehaviorID &amp; <span style=color:#e6db74>&#34;&#39;);&#34;</span> &amp; _
<span style=color:#e6db74>&#34;pce.add_shown(pceShownHandler);&#34;</span> &amp; _
<span style=color:#e6db74>&#34;});&#34;</span>
 
Page.ClientScript.RegisterStartupScript(Me.GetType(), hierarchicPce.BehaviorID, script, True)
</code></pre></td></tr></table></div></div><p>To avoid duplication of BehaviorID I use a guid, then I create a stupid and little script that uses Sys.Application.add_load() method of Microsoft Ajax library  to register a couple of javascript lines of code :), the first finds the PopupControlExtender client side object using the guid assigned to BehaviorId and the second one cals the add_shown function to register the function to give focus to correct control.</p><p>alk.</p><p>Tags: <a href=http://technorati.com/tag/asp.net>asp.net</a> <a href=http://technorati.com/tag/Microsoft%20Ajax>Microsoft Ajax</a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/general/>general</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/aspnet/>ASPNET</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2010/02/lab-management-vdh-up-and-running/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Lab Management VDH Up and running</a></div><div class="next-entry sep-before"><a href=/post/old/2010/03/power-of-hql-condition-on-a-collection/><span class=screen-reader-text>Next post: </span>Power of HQL - Condition on a collection<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>