<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Entity Framework is quite a good product, but in my opinion still misses some point to be called an ORM. I must admit that I never used the 4.1 Code first in real project, but there are some stuff that still does not convince me when using EF.
When I decide to use EF (and not NH) Sometimes I need to access small legacy databases to do a small amount of operations and I must admit that adding a EF Model from Visual Studio is a matter of seconds and the LINQ provider of EF is quite good so it is a valuable alternative to create a quick DAL."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Entity Framework a super dataset • Codewrecks"><meta property="og:description" content="Entity Framework is quite a good product, but in my opinion still misses some point to be called an ORM. I must admit that I never used the 4.1 Code first in real project, but there are some stuff that still does not convince me when using EF.
When I decide to use EF (and not NH) Sometimes I need to access small legacy databases to do a small amount of operations and I must admit that adding a EF Model from Visual Studio is a matter of seconds and the LINQ provider of EF is quite good so it is a valuable alternative to create a quick DAL."><meta property="og:url" content="https://www.codewrecks.com/post/old/2011/06/entity-framework-a-super-dataset/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Entity Framework"><meta property="article:tag" content="Nhibernate"><meta property="article:tag" content="ORM"><meta property="article:published_time" content="2011-06-09T07:00:37+02:00"><meta property="article:modified_time" content="2011-06-09T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Entity Framework a super dataset • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2011/06/entity-framework-a-super-dataset/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Entity Framework a super dataset</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Entity Framework a super dataset</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2011-06-09T07:00:37+02:00>2011, Jun 09</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>Entity Framework is quite a good product, but in my opinion still misses some point to be called an ORM. I must admit that I never used the 4.1 Code first in real project, but there are some stuff that still does not convince me when using EF.</p><h3 id=when-i-decide-to-use-ef-and-not-nh>When I decide to use EF (and not NH)</h3><p>Sometimes I need to access small legacy databases to do a small amount of operations and I must admit that adding a EF Model from Visual Studio is a matter of seconds and the LINQ provider of EF is quite good so it is a valuable alternative to create a quick DAL. I have a simple database (four tables), I created an EF model, and then issue this query.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/image7.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/image_thumb7.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/image_thumb7.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>A very simple piece of code that query database with EF</em></p><p>This is a very super simple piece of code, in the first line I grab an instance of Term from the database (actually I grab the first one, in real code I have a complex query that returns a specific term). Then I want to grab all instance of Verbs that are related to this term, so I issue the second query, what will be the result?</p><p><a target=_blank href="http://t0.gstatic.com/images?q=tbn:ANd9GcSdyTdE26j7X1A04CUg2PNg9VAWxnxfX6mIRYKgv_6jpdSKN7cCEQ&amp;amp;t=1"><img src="http://t0.gstatic.com/images?q=tbn:ANd9GcSdyTdE26j7X1A04CUg2PNg9VAWxnxfX6mIRYKgv_6jpdSKN7cCEQ&amp;amp;t=1" alt></a></p><p>This image exceptionally capture my face the first time I ran this query.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/SNAGHTML4bb74e.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/SNAGHTML4bb74e_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/SNAGHTML4bb74e_thumb.png alt=SNAGHTML4bb74e></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Strange error in the query.</em></p><p>I&rsquo;m really disappointed from this exception for many reasons. First of all I do not know why it does not work, because this is a perfectly and reasonable query to issue.</p><h3 id=fix-the-query-to-make-it-works>Fix the query to make it works</h3><p>To verify that the query is indeed ok lets modify it in this way.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/image8.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/image_thumb8.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/image_thumb8.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Modified version of the query, now it works.</em></p><p>This version works simply changing the order of the <em>Where</em> and <em>ToList</em> operators. It now works because it <em>loads the entire Verbs table in memory</em> and then filters out with LINQ to Object. This clearly makes me sick, because this creates a big memory pressure. The second issue with the above error is the error message, that is really obscure. <em>Unable to create a constraint value of type xxxxxxxx</em>. If you read with caution you could eventually understand that you cannot put a condition based on equality of objects, but only primitive type.</p><p>This error could have a good reason to exists: if the Term entity overrides the Equality method, it could be impossible to create an equivalent query in SQL to mimic the same behavior by the EF LINQ provider. Suppose that the Term overrides the Equal operator comparing two entities by checking for equality of the <strong>Value</strong> and <strong>Type</strong> properties, how could the EF provider understand this behavior to issue an equivalent query to the database? I can agree with this reason, but only if the error would be something like <em>Could not issue a comparison between two entities in a EF query because it is impossible to mimic the semantic of equals operator.. bla bla bla</em>.</p><h3 id=a-real-solution-but-you-need-to-make-your-hands-dirty>A real solution, but you need to make your hands dirty</h3><p>But working with objects in DDD or Domain Model or even with Active Record pattern, the programmer in 99.99% of the situation, translate the condition * <strong>V.Term == term</strong> *with: **gives me all <strong>verbs</strong> that are <strong>connected</strong> with <strong>term</strong> *.*This because we are used to the fact that a reference from Verb entity to Term entity is part of the object graph and this can easily be translated with a comparison between identity operators. Given that, you can rewrite the above query in this way.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/image9.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/image_thumb9.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2011/06/image_thumb9.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>The right way to issue the EF query</em></p><p>Now the query runs fine, but you can have two completely different opinion about it.</p><p>The first opinion is negative, because I need to understand the name of the property/properties used as id by the ORM. I know that by convention you can use a property named <strong>Id</strong> for every entity, but sometimes, especially with legacy database you can have entities with composite key or identity property named differently. LINQ is great to express query in the object model, but in this situation I need to be aware of details of the ORM Mapping to issue the right query and this is bad.</p><p><a target=_blank href=http://www.mydswa.org/wp-content/uploads/2010/09/negative-attitude.gif><img src=http://www.mydswa.org/wp-content/uploads/2010/09/negative-attitude.gif alt></a></p><p>The second type of opinion is positive, because this query does not suffer from mismatch between the LINQ to entities counterpart when someone redefines the equals operator for the entity.</p><p><a target=_blank href=http://www.tigweb.org/images/express/panorama/articles/26121.jpg><img src=http://www.tigweb.org/images/express/panorama/articles/26121.jpg alt></a></p><h3 id=conclusion>Conclusion</h3><p>I tend to agree with the dislike part, because I want my ORM to permit me to express query without being aware of the details. So I tend to consider EF not a real ORM but something like a * <strong>SuperDataset</strong> *, it is quick to use with database first approach, it permits you to create a DAL quickly, but it forces you to know the detail of the database, like a dataset. Clearly EF has <strong>really a lot of interesting feature respect to a dataset</strong> , but it still miss something to be considered an ORM.</p><p>Alk.</p><p>Tags: <a href=http://technorati.com/tag/ORM>ORM</a> <a href=http://technorati.com/tag/Entity%20Framework>Entity Framework</a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/entity-framework/>Entity Framework</a>, <a class=category href=/categories/nhibernate/>Nhibernate</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/entity-framework/>Entity Framework</a>, <a class=tag href=/tags/nhibernate/>Nhibernate</a>, <a class=tag href=/tags/orm/>ORM</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2011/06/witch-version-of-browser-is-used-by-the-webbrowser-control/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Witch version of browser is used by the WebBrowser control</a></div><div class="next-entry sep-before"><a href=/post/old/2011/06/if-you-need-tfs-hosting-you-can-consider-azure/><span class=screen-reader-text>Next post: </span>If you need Tfs Hosting you can consider Azure<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>