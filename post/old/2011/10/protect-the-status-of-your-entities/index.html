<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Encapsulation is one of the key concept of OOP, the status of an entity should be protected from external direct manipulation, state of an object can be changed only by the object itself so the object is always in Valid State. One of the classic example is protecting property that contains collection of elements in.NET, like properties of type ILIST<T>.
Suppose that your * Character *entity has a property called Weapons of type IList<Weapon>, directly exposed to the outside world; this is the perfect example of broken encapsulation, because the entity has no control over what it got added to that collection."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Protect the status of your entities • Codewrecks"><meta property="og:description" content="Encapsulation is one of the key concept of OOP, the status of an entity should be protected from external direct manipulation, state of an object can be changed only by the object itself so the object is always in Valid State. One of the classic example is protecting property that contains collection of elements in.NET, like properties of type ILIST<T>.
Suppose that your * Character *entity has a property called Weapons of type IList<Weapon>, directly exposed to the outside world; this is the perfect example of broken encapsulation, because the entity has no control over what it got added to that collection."><meta property="og:url" content="https://www.codewrecks.com/post/old/2011/10/protect-the-status-of-your-entities/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="DDD"><meta property="article:published_time" content="2011-10-20T06:00:37+02:00"><meta property="article:modified_time" content="2011-10-20T06:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Protect the status of your entities • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2011/10/protect-the-status-of-your-entities/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Protect the status of your entities</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Protect the status of your entities</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2011-10-20T06:00:37+02:00>2011, Oct 20</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>5 mins read</span></div></div></header><div class="container entry-content"><p>Encapsulation is one of the key concept of <a href=http://en.wikipedia.org/wiki/Object-oriented_programming>OOP</a>, the status of an entity should be protected from external direct manipulation, state of an object can be changed only by the object itself so the object is always in <strong>Valid State.</strong> One of the classic example is protecting property that contains collection of elements in.NET, like properties of type <em>ILIST&lt;T>.</em></p><p>Suppose that your * <strong>Character</strong> *entity has a property called Weapons of type <em>IList&lt;Weapon></em>, directly exposed to the outside world; this is the perfect example of broken encapsulation, because the entity has <em>no control over what it got added to that collection</em>. This will mean that this code is perfectly valid and compile</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Oh_my_god_wizards_can_use_swords()
{
Wizard curumir = CharacterFactory.Wizard(<span style=color:#e6db74>&#34;Curumir&#34;</span>)
.AddAvailableSpell(<span style=color:#66d9ef>new</span> Spell())
.WithHealth(<span style=color:#ae81ff>10</span>)
.Create();
curumir.Weapons.Add(<span style=color:#66d9ef>new</span> Sword());
}
</code></pre></td></tr></table></div></div><p>This violates a <em>domain rule</em>  because a <em>sword is not a permitted weapon for a wizard character</em>. This trivial example show the risks of not applying a good encapsulation of the state of your domain entity. The really wrong aspect of this kind of design, is that you should enforce the application of Domain Rules outside the object itself, in this specific situation, whenever some code should add a <strong>Weapon</strong> to a <strong>Character</strong> it should check if this is valid assignment. The usual symptom of this problem is that you have Domain Logic scattered around the world.</p><p>The solution to this problem is quite simple, first of all the <em>Weapons</em>property should be exposed as IEnumerable&lt;T>, then you can add a couple of methods: <strong>AddWeapon()</strong> and <strong>RemoveWeapon()</strong> to implement the two Domain Operation of adding and removing a weapon to a <strong>Character</strong>. Now the entity has the ability to check the weapon that got assigned and can validate all the Domain Rules. We are still really far from an optimal solution, but this is far better than giving to the outside full access to the collection.</p><p>Now lets change a little bit this example, suppose you have a different Domain where each Character is allowed to use only a single weapon. Now we can write this.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>curumir.Weapon = <span style=color:#66d9ef>new</span> Weapon();
</code></pre></td></tr></table></div></div><p>Since you can can put logic inside the setter part of the property, you can enforce the invariant of the above code and maintaining encapsulation, so the above snippet looks like a perfect valid encapsulated object.</p><p>Putting logic inside the setter is not the best option, mainly because it has no return value, so we cannot understand if the assignment was successful or not. Throwing an exception is not an option, since exception should not be used to signal that a business rule was violated and if you need to catch an exception for each assignment to verify if some rule was violated…. your code soon becomes unreadable.</p><p>Another possible solution is: if the weapon assigned to the Character is not valid, it maintains the old weapon he has (or null if he previously had no weapon). This leads to this ugly snippet of code.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>var</span> oldWeapon = curumir.Weapon;
curumir.Weapon = <span style=color:#66d9ef>new</span> Sword();
<span style=color:#66d9ef>if</span> (curumir.Weapon != oldWeapon)
{
<span style=color:#75715e>//code to handle error here
</span><span style=color:#75715e></span>}
</code></pre></td></tr></table></div></div><p>A possible solution is using * <strong><a href=http://martinfowler.com/eaaDev/DomainEvent.html>DOMAIN EVENTS</a></strong> *, you can register for: <em>WeaponAssigned</em>and <em>WeaponAssignementRejected</em> events, assign the weapon and check the * <strong>DOMAIN EVENT</strong> *that was actually raised to verify the assignment outcome, or you can simply assign the weapon and let other handlers to take the appropriate action.</p><p>In the end using an explicit <em>AssignWeapon()</em> method is probably the best alternative, this method can return a Boolean telling us if the operation succeeded or not and we can listen to * <strong>DOMAIN EVENTS</strong> *only if we are really interested on the real outcome of the operation.</p><p>As an example, if the User drag a Weapon in the UI to a character, the UI can simple send a COMMAND <strong>AssignWeapon(charachterid, weapon)</strong> to the Domain and got a Boolean that basically states if the command was executed or not. This boolean value permits the UI to react accordingly (as an example removing the weapon from the <em>unassigned weapon list</em>, and adding to the character graphical representation. You can use another handler that runs in the UI that is listening for the even <strong>WeaponAssignementRejected</strong> that inform the user on the exact reason why the weapon was rejected. A really improved implementation have the <strong>AssignWeapon(charachterid, weapon)</strong> returns void, so the UI call this method asynchronously, then you have a couple of Domain Events handlers, the first intercepts the <em>WeaponAssigned</em> domain event, and update the UI accordingly, the other intercepts the <em>WeaponAssignementRejected</em> and shows some detailed error message to the user. This second type of implementation follow the <a href=http://martinfowler.com/bliki/CommandQuerySeparation.html>CQS pattern</a>, where all method that can change the state of an object should not return value.</p><p>Another benefit of using an explicit method to change properties instead of a plain setter, is reducing interface complexity of the object. If you usually insert complex logic in property Setters, whenever you assign something to each property of a domain object, you should check for failure.</p><p>All these considerations lead to removing completely all setters from your domain objects, excepts for trivial properties like *CharachterBackground, Age, Name, etc.*The rule is: use a setter only if the property has no logic in it and it does not take part in any business rule. If you discover later than you need to apply a business rule on some property that actually has a setter, you should: remove the setter, add a ChangeAge() method and fix all compiler errors.</p><p>In the end, we can state that in a Domain Object property setter is an antipattern and should be avoided if possible.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/domain-driven-design/>Domain Driven Design</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/ddd/>DDD</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2011/10/power-point-storyboarding-and-feedback-tool/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Power point storyboarding and Feedback Tool</a></div><div class="next-entry sep-before"><a href=/post/old/2011/10/subversion-1-7-and-the-new-workspace/><span class=screen-reader-text>Next post: </span>Subversion 17 and the new workspace<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>