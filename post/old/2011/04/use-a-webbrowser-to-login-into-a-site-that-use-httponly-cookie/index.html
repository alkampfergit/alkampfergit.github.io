<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Suppose you need to programmatically analyze some web pages that are protected by a login procedure and you have a valid login to the site. A simple solution is issuing a POST request to the login page with the correct credentials, then continue to use the same cookie container to issue subsequent downloads, but in some situation this is not enough. Suppose the site uses some strange login procedure that uses redirect"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Use a WebBrowser to login into a site that use HttpOnly cookie • Codewrecks"><meta property="og:description" content="Suppose you need to programmatically analyze some web pages that are protected by a login procedure and you have a valid login to the site. A simple solution is issuing a POST request to the login page with the correct credentials, then continue to use the same cookie container to issue subsequent downloads, but in some situation this is not enough. Suppose the site uses some strange login procedure that uses redirect"><meta property="og:url" content="https://www.codewrecks.com/post/old/2011/04/use-a-webbrowser-to-login-into-a-site-that-use-httponly-cookie/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="API"><meta property="article:tag" content="WebBrowser"><meta property="article:published_time" content="2011-04-12T09:00:37+02:00"><meta property="article:modified_time" content="2011-04-12T09:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Use a WebBrowser to login into a site that use HttpOnly cookie • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2011/04/use-a-webbrowser-to-login-into-a-site-that-use-httponly-cookie/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Use a WebBrowser to login into a site that use HttpOnly cookie</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Use a WebBrowser to login into a site that use HttpOnly cookie</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2011-04-12T09:00:37+02:00>2011, Apr 12</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>5 mins read</span></div></div></header><div class="container entry-content"><p>Suppose you need to programmatically analyze some web pages that are protected by a login procedure and you have a valid login to the site. A simple solution is issuing a POST request to the login page with the correct credentials, then continue to use the same cookie container to issue subsequent downloads, but in some situation this is not enough. Suppose the site uses some strange login procedure that uses redirect</p><p><a target=_blank href="http://t0.gstatic.com/images?q=tbn:ANd9GcT7_byhJBQvWqRvzdPwFg5Rde08pVFFMESgBThHrOaBYz3f1ol2&amp;amp;t=1"><img src="http://t0.gstatic.com/images?q=tbn:ANd9GcT7_byhJBQvWqRvzdPwFg5Rde08pVFFMESgBThHrOaBYz3f1ol2&amp;amp;t=1" alt></a></p><p>This sometimes happens: you do a postback with your credentials, then a page is rendered where a javascript code automatically do another postback to another page, and finally another javascript finally takes you to the landing page for successful login. Other example happens when the login procedure involves some javascript code that needs to be executed before a postback.</p><p>A possible solution is using the <a href=http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.aspx>WebBrowser</a> control to navigate to login page, then locate the texboxes controls for UserName and password, locate the <em>submit</em> button, wait for all redirect and finally grab the cookie from the webbrowser control. This solution is simple, because login procedure is executed inside a real Browser and we only need to grab the cookies when the whole procedure ends.</p><p>This is a sample of possible code.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>hiddenBrowser = <span style=color:#66d9ef>new</span> WebBrowser();
hiddenBrowser.DocumentCompleted += webBrowser1_DocumentCompleted;
hiddenBrowser.Navigate(<span style=color:#e6db74>&#34;myloginsite&#34;</span>);
</code></pre></td></tr></table></div></div><p><strong>Step 1:</strong> <em>create a webbrowser control, handle DocumentCompleted event and then navigate to the login pag</em>e.</p><p><a href="http://msdn.microsoft.com/en-us/library/cxy27k39%28v=VS.100%29.aspx">DocumentCompleted</a> is raised when the page is fully loaded, and is where we need to issue the login procedure.</p><p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>var</span> theBrowser = (WebBrowser)sender;
HtmlElement inputElementByName = GetInputElementByName(<span style=color:#e6db74>&#34;name_of_the_input_control_for_username&#34;</span>, theBrowser);
<span style=color:#66d9ef>if</span> (inputElementByName == <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>return</span>;
inputElementByName.SetAttribute(<span style=color:#e6db74>&#34;value&#34;</span>, <span style=color:#e6db74>&#34;username&#34;</span>);
HtmlElement elementByName = GetInputElementByName(<span style=color:#e6db74>&#34;name_of_the_input_control_for_password&#34;</span>, theBrowser);
elementByName.SetAttribute(<span style=color:#e6db74>&#34;value&#34;</span>, <span style=color:#e6db74>&#34;****** **&#34;</span>);
HtmlElement htmlElement = GetInputElementByName(<span style=color:#e6db74>&#34;name_of_submit_button&#34;</span>, theBrowser);
htmlElement.InvokeMember(<span style=color:#e6db74>&#34;click&#34;</span>);
</code></pre></td></tr></table></div></div>** Step 2:***Locate the two input controls for username and password, fill them with right values, then locate the submit button and finally invoke the *click* method*</p><p>As you can see the code is really simple, input control can be located by name, by id, or by classes, for this simple example I locate them by name with this simple function.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>private</span> HtmlElement GetInputElementByName(
<span style=color:#66d9ef>string</span> fieldName,
WebBrowser webBrowser)
{
HtmlElementCollection allInput =
webBrowser.Document.GetElementsByTagName(<span style=color:#e6db74>&#34;input&#34;</span>);
<span style=color:#66d9ef>foreach</span> (HtmlElement htmlElement <span style=color:#66d9ef>in</span> allInput)
{
<span style=color:#66d9ef>if</span> (htmlElement.Name.Equals(fieldName, StringComparison.InvariantCultureIgnoreCase))
{
<span style=color:#66d9ef>return</span> htmlElement;
}
}
<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
}
</code></pre></td></tr></table></div></div><p><strong>Step 3:</strong> <em>Function to locate an input control by name.</em></p><p>This function is really simple, it iterates on all <a href="http://msdn.microsoft.com/en-us/library/204hxbb2%28v=VS.100%29.aspx">HTMLElement</a> of type <em>input</em> present in the page, for each of them check if the name is equal to desidered one, and simply returns the element.</p><p>Ok, now we simplylet the WebBrowser control navigates to the login page, wait for every possible redirect, and finally grab the cookie. One of the problem you face when you try to get cookie is due to <a href=http://www.codinghorror.com/blog/2008/08/protecting-your-cookies-httponly.html>HttpOnly</a> cookies. HttpOnly cookes lives only inside the browser, and cannot be managed by javascript or other browser code, but we really need to grab them to be able to use a WebRequest to download pages protected by login. Huston, we have a cookie problem</p><p><a target=_blank href=http://media.tumblr.com/tumblr_kxd6p1bmi71qaqkpq.jpg><img src=http://media.tumblr.com/tumblr_kxd6p1bmi71qaqkpq.jpg alt></a></p><p>HttpOnly cookie are meant to prevent malicious javascript code to access them, but clearly they are stored somewhere in the system, so we need to resort to windows API to retrieve them.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>String hostName = _webBrowser.Url.Scheme + Uri.SchemeDelimiter +
_webBrowser.Url.Host;
Uri hostUri = <span style=color:#66d9ef>new</span> Uri(hostName);
CookieContainer container = CookieHelpers.GetUriCookieContainer(hostUri);
CookieCollection cookieCollection = container.GetCookies(hostUri);
_container.Add(cookieCollection);
</code></pre></td></tr></table></div></div><p><strong>Step 4:</strong> <em>Determine base uri of the site and grab all cookies thanks to the function CookieHelpers.GetUriCookieContainer</em></p><p>All the work is done inside the <a href="http://msdn.microsoft.com/en-us/library/aa384714%28v=vs.85%29.aspx">GetUriCookieContainer</a> method, that use windows API to retrieve cookie, once the CookieContainer used by the WebBrowser is grabbed, you can simply get the CookieCollection and set to another CookieContainer that will be used by subsequent WebRequest object.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#a6e22e>[DllImport(&#34;wininet.dll&#34;, SetLastError = true)]</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>bool</span> InternetGetCookieEx(
<span style=color:#66d9ef>string</span> url,
<span style=color:#66d9ef>string</span> cookieName,
StringBuilder cookieData,
<span style=color:#66d9ef>ref</span> <span style=color:#66d9ef>int</span> size,
Int32  dwFlags,
IntPtr  lpReserved);
 
<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>const</span> Int32 InternetCookieHttponly = <span style=color:#ae81ff>0</span>x2000;
</code></pre></td></tr></table></div></div><p><strong>Step 5:</strong> <em>declare import to use Windows API</em></p><p>Now we can use the InternetGetCookieEx to grab all the cookie.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>/// &lt;summary&gt;
</span><span style=color:#75715e>/// Gets the URI cookie container.
</span><span style=color:#75715e>/// &lt;/summary&gt;
</span><span style=color:#75715e>/// &lt;param name=&#34;uri&#34;&gt;The URI.&lt;/param&gt;
</span><span style=color:#75715e>/// &lt;returns&gt;&lt;/returns&gt;
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> CookieContainer GetUriCookieContainer(Uri uri)
{
CookieContainer cookies = <span style=color:#66d9ef>null</span>;
<span style=color:#75715e>// Determine the size of the cookie
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> datasize = <span style=color:#ae81ff>8192</span> * <span style=color:#ae81ff>16</span>;
StringBuilder cookieData = <span style=color:#66d9ef>new</span> StringBuilder(datasize);
<span style=color:#66d9ef>if</span> (!InternetGetCookieEx(uri.ToString(), <span style=color:#66d9ef>null</span>, cookieData, <span style=color:#66d9ef>ref</span> datasize, InternetCookieHttponly, IntPtr.Zero))
{
<span style=color:#66d9ef>if</span> (datasize &lt; <span style=color:#ae81ff>0</span>)
<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
<span style=color:#75715e>// Allocate stringbuilder large enough to hold the cookie
</span><span style=color:#75715e></span>cookieData = <span style=color:#66d9ef>new</span> StringBuilder(datasize);
<span style=color:#66d9ef>if</span> (!InternetGetCookieEx(
uri.ToString(),
<span style=color:#66d9ef>null</span>, cookieData,
<span style=color:#66d9ef>ref</span> datasize,
InternetCookieHttponly,
IntPtr.Zero))
<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
}
<span style=color:#66d9ef>if</span> (cookieData.Length &gt; <span style=color:#ae81ff>0</span>)
{
cookies = <span style=color:#66d9ef>new</span> CookieContainer();
cookies.SetCookies(uri, cookieData.ToString().Replace(<span style=color:#e6db74>&#39;;&#39;</span>, <span style=color:#e6db74>&#39;,&#39;</span>));
}
<span style=color:#66d9ef>return</span> cookies;
}
</code></pre></td></tr></table></div></div><p><strong>Step 6:</strong> <em>Grab all cookie with InternetGetCookieEx api, this is needed to retrieve HttpOnly cookie</em></p><p>Now the game is done. As a last warning I suggest you to clear all WebBrowser cookie before starting the login procedure, because it could lead to problems. I found this solution on StackOverflow (I do not remember the link sorry <a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2011/04/wlEmoticon-smile.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2011/04/wlEmoticon-smile.png alt=Smile></a> )</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> INTERNET_OPTION_END_BROWSER_SESSION = <span style=color:#ae81ff>42</span>;
<span style=color:#a6e22e> 
</span><span style=color:#a6e22e>[DllImport(&#34;wininet.dll&#34;, SetLastError = true)]</span>
<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>bool</span> InternetSetOption(IntPtr hInternet, <span style=color:#66d9ef>int</span> dwOption, IntPtr lpBuffer, <span style=color:#66d9ef>int</span> lpdwBufferLength);
 
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> ClearCookie()
{
InternetSetOption(IntPtr.Zero, INTERNET_OPTION_END_BROWSER_SESSION, IntPtr.Zero, <span style=color:#ae81ff>0</span>);
}
</code></pre></td></tr></table></div></div><p><strong>Snippet 1:</strong> <em>Method to clear all the cookie, this is needed to be sure that the webControl has no cookies when login procedure begins.</em></p><p>alk.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/programming/>Programming</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/api/>API</a>, <a class=tag href=/tags/webbrowser/>WebBrowser</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2011/04/visual-studio-macro-to-the-rescue/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Visual studio Macro to the rescue</a></div><div class="next-entry sep-before"><a href=/post/old/2011/04/mshtml-and-click-once-the-saga-continues/><span class=screen-reader-text>Next post: </span>Mshtml and Click-Once the saga continues<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>