<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I need to change the default icon of Windows Explorer for some special folder inside a my application, I know that it could be done Through Desktop.Ini file, but after some frustrating tentative I did not succeed in using a custom.ico file stored as resource inside the assembly.
It was my fault, because the first resource you should check is MSDN, and when I read the whole page dedicate to this argument I found my error, I forgot to set the System Bit of the folder."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Change the icon of a folder • Codewrecks"><meta property="og:description" content="I need to change the default icon of Windows Explorer for some special folder inside a my application, I know that it could be done Through Desktop.Ini file, but after some frustrating tentative I did not succeed in using a custom.ico file stored as resource inside the assembly.
It was my fault, because the first resource you should check is MSDN, and when I read the whole page dedicate to this argument I found my error, I forgot to set the System Bit of the folder."><meta property="og:url" content="https://www.codewrecks.com/post/old/2011/04/change-the-icon-of-a-folder/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Programming"><meta property="article:published_time" content="2011-04-28T07:00:37+02:00"><meta property="article:modified_time" content="2011-04-28T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Change the icon of a folder • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2011/04/change-the-icon-of-a-folder/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Change the icon of a folder</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Change the icon of a folder</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2011-04-28T07:00:37+02:00>2011, Apr 28</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>3 mins read</span></div></div></header><div class="container entry-content"><p>I need to change the default icon of Windows Explorer for some special folder inside a my application, I know that it could be done Through Desktop.Ini file, but after some frustrating tentative I did not succeed in using a custom.ico file stored as resource inside the assembly.</p><p>It was my fault, because the first resource you should check is MSDN, and when I read the <a href="http://msdn.microsoft.com/en-us/library/cc144102%28v=vs.85%29.aspx">whole page dedicate to this argument</a> I found my error, I forgot to set the System Bit of the folder. Documentation states that</p><blockquote><p>Use <a href="http://msdn.microsoft.com/en-us/library/bb773726%28v=vs.85%29.aspx"><strong>PathMakeSystemFolder</strong></a> to make the folder a system folder. This sets the read-only bit on the folder to indicate that the special behavior reserved for Desktop.ini should be enabled.</p></blockquote><p>Then the docs explain how you must set file permission</p><blockquote><p>Create a Desktop.ini file for the folder. You should mark it as <em>hidden</em> and <em>system</em> to ensure that it is hidden from normal users.</p><p>Make sure the Desktop.ini file that you create is in the Unicode format. This is necessary to store the localized strings that can be displayed to users.</p></blockquote><p>Then you should finish reading all the page because there are the instruction on how to use an ico file stored inside the folder</p><blockquote><p><strong>IconFile</strong> > If you want to specify a custom icon for the folder, set this entry to the icon’s file name. The.ico file name extension is preferred, but it is also possible to specify.bmp files, or.exe and.dll files that contain icons. If you use a relative path, the icon is available to people who view the folder over the network. You must also set the <strong>IconIndex</strong> entry.</p><p><strong>IconIndex</strong> > Set this entry to specify the index for a custom icon. If the file assigned to <strong>IconFile</strong> only contains a single icon, set <strong>IconIndex</strong> to 0.</p></blockquote><p>Ok after reading this I wrote the code in a couple of minutes (And I curse myself for wasting half an hour in stupid tentative without reading first the whole documentation)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>string</span> iconFileName = Path.Combine(keypath, <span style=color:#e6db74>&#34;Folder.ico&#34;</span>);
FileInfo icon = <span style=color:#66d9ef>new</span> FileInfo(iconFileName);
<span style=color:#66d9ef>if</span> (!Directory.Exists(keypath))
{
Directory.CreateDirectory(keypath);
DirectoryInfo info = <span style=color:#66d9ef>new</span> DirectoryInfo(keypath);
info.Attributes = info.Attributes | FileAttributes.System;
}
</code></pre></td></tr></table></div></div><p>With this code I create the name of the Folder.ico, and if the Directory does not exist, the routine creates it, and set the attribute System (Line 7) this is <strong>really important,</strong> if you forget to change the attribute, the Destkop.ini file is <strong>ignored</strong>.</p><p>Then I need to create the ini file.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>using</span> (FileStream fs = <span style=color:#66d9ef>new</span> FileStream(iconFileName, FileMode.CreateNew))
{
Properties.Resources.SqlIcon.Save(fs);
}
File.SetAttributes(iconFileName, File.GetAttributes(iconFileName) | FileAttributes.Hidden);
String deskopIniFile = Path.Combine(keypath, <span style=color:#e6db74>&#34;Desktop.ini&#34;</span>);
File.WriteAllText(deskopIniFile,
<span style=color:#e6db74>@&#34;[.ShellClassInfo]
</span><span style=color:#e6db74>IconFile=Folder.ico
</span><span style=color:#e6db74>IconIndex=0
</span><span style=color:#e6db74>&#34;</span>);
File.SetAttributes(deskopIniFile, FileAttributes.System | FileAttributes.Hidden);
</code></pre></td></tr></table></div></div><p>First of all I save the icon file thanks to the Save method of the resource, then I hide the icon file (this is not needed, but I do not want the user to see the icon). Then save a simple DesktopIni file, but pay attention to the line 11 <strong>because you need to set IconIndex to 0</strong> , if you forget this, the icon file <strong>will be ignored</strong>.</p><p>Finally you need to hide and set the System attribute to Destkop.ini file, if you forget to set the system attribute the file <strong>will be ignored</strong>.</p><p>The motto of this story is, when you need to do something related to windows, always read with care MSDN documentation, avoiding to do stupid tentatives. (As I said I lost half an hour because I forgot to set the System bit of the Folder <a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2011/04/wlEmoticon-smile1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2011/04/wlEmoticon-smile1.png alt=Smile></a>, this was because I simply change an icon to a folder, then look at generated Desktop.ini file, and replicate in code&mldr; but it did not work because the folder was not set to system. )</p><p>Alk.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/programming/>Programming</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/programming/>Programming</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2011/04/changing-language-specification-is-a-risky-business/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Changing language specification is a risky business</a></div><div class="next-entry sep-before"><a href=/post/old/2011/05/persistent-cache-management-with-managed-esent/><span class=screen-reader-text>Next post: </span>Persistent cache management with Managed Esent<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>