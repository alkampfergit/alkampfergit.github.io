<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="When it is time to design topology of a TFS installation, for small team the single server is usually the best choice in term of licensing (one one Windows Server license is needed) and simplicity of maintenance. Traditionally the only problem that can occur is: some component (especially the Analysis and Reporting services) starts to slow down the machine if the amount of data starts to become consistent.
 Single machine TFS installation is probably the best choice for small teams."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="TFS 2018 search components in different server • Codewrecks"><meta property="og:description" content="When it is time to design topology of a TFS installation, for small team the single server is usually the best choice in term of licensing (one one Windows Server license is needed) and simplicity of maintenance. Traditionally the only problem that can occur is: some component (especially the Analysis and Reporting services) starts to slow down the machine if the amount of data starts to become consistent.
 Single machine TFS installation is probably the best choice for small teams."><meta property="og:url" content="https://www.codewrecks.com/post/old/2018/01/tfs-2018-search-components-in-different-server/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="searching"><meta property="article:tag" content="Tfs"><meta property="article:published_time" content="2018-01-06T10:00:37+02:00"><meta property="article:modified_time" content="2018-01-06T10:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>TFS 2018 search components in different server • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2018/01/tfs-2018-search-components-in-different-server/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>TFS 2018 search components in different server</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>TFS 2018 search components in different server</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2018-01-06T10:00:37+02:00>2018, Jan 06</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>5 mins read</span></div></div></header><div class="container entry-content"><p>When it is time to design topology of a TFS installation, for small team the <strong>single server is usually the best choice in term of licensing (one one Windows Server license is  needed) and simplicity of maintenance.</strong> Traditionally the only problem that can occur is: some component (especially the Analysis and Reporting services) starts to slow down the machine if the amount of data starts to become consistent.</p><blockquote><p>Single machine TFS installation is probably the best choice for small teams..</p></blockquote><p><strong>The usual solution is moving Analysis Service, cube and Warehouse database on a different server.</strong> With such a configuration if the analysis service has a spike in CPU, Disk or Memory usage, the main machine with operational DB and AT continue to work with standard performance. The trick is leaving the core services in a server that is not overloaded with other tasks, this is the reason why running a build agent in TFS machine is usually a bad idea.</p><p>With TFS 2017 a new search component is introduced, based on ElasticSearch. ES is de facto the most used and most advanced Search Engine on the market, but <strong>it tends to eat CPU RAM and Disk if the workload is big.</strong> The suggestion is to start configuring search on the very same machine with AT and DB (Single server installation) and move search components if you start to notice that ES uses too many RAM or is using too much CPU when it is indexing data. Moving search components on another machine is a really simple process.</p><p><strong>First of all you need to remove the search feature, using the remove feature wizard as shown in Figure 1</strong> (select the first node in administration console to find the Remove Feature Link)</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/SNAGHTML1521f72.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/SNAGHTML1521f72_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/SNAGHTML1521f72_thumb.png alt=SNAGHTML1521f72></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Remove feature from TFS instance</em></p><p>Now you should choose to remove the search feature.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Removing the Search Service functionality</em></p><p>After the wizard finished, you should go to the folder C:\Program Files\Microsoft Team Foundation Server 2018\Search\zip and with powershell run the command</p><p><strong>Configure-TFSSearch.ps1 -Operation remove</strong> to completely remove Elastic Search from your TFS instance.</p><blockquote><p>Do not forget to use Configure-TFSSEarch PowerShell script to completely remove any trace of Elastic Search from the TFS machine</p></blockquote><p>Now search component is not working anymore, if you issue a search you should get a message like shown in <strong>Figure 3</strong> :</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image-1.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-1.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Search component is not operational anymore.</em></p><p>At this point you open TFS administration console and start the wizard to configure the search, but this time, <strong>instead of configuring everything on the current machine, you will choose to use an existing Search Service</strong>.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image-2.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-2.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-2.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Use an existing search service instead of install locally the search service</em></p><p>If you see in <strong>Figure 4</strong> , the instructions to install search service on another computer are really simple, you need to click the “search service package” link in the wizard to open a local folder that contains everything to setup ElasticSearch and the search service. <strong>Just copy content of that folder on another machine, install java and set the JAVA_HOME environment variable and you are ready to install Search Service.</strong> You can find a README.txt file that explain how to configure the search service, just open a PowerShell console and then run the command</p><p>Configure-TFSSearch.ps1 -Operation install -TFSSearchInstallPath C:\ES -TFSSearchIndexPath C:\ESDATA</p><p>Please change the two folder if you want to change the location of ElasticSearch binary and ElasticSearch data. After the script ran without any error, it is time to verify that ElasticSearch is correctly installed and started. As usual, <strong>please create a DNS entry to avoid using the real name of the machine where you installed the service</strong>. In my installation I’ve configured the name tfssearch.cyberpunk.local to point to the real machine where I configured search services. Just open a browser and issue a request to <a href=http://tfssearch.cyberpunk.local:9200>http://tfssearch.cyberpunk.local:9200</a></p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image-3.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-3.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-3.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Try to access local instance of ElasticSearch using DNS name</em></p><blockquote><p>Please pay attention at firewall configuration, because ElasticSearch has no security in base installation and everyone can mess up and read data just browsing in port 9200</p></blockquote><p><strong>Now you should open your firewall to allow connection to port 9200 from every machine where an Application Tier is running.</strong> In my situation the machine with TFS installation has IP number 10.0.0.116. Remember that Elastic Search has NO Authentication (it is a module that is not free, called shield), thus it is really better to allow connections only from the TFS machine. All you need to do is creating a rule to open port 9200, but allowing connection only from the IP of the TFS machines.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image-5.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-5.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-5.png alt=image></a></a></p><p><em><strong>Figure 6</strong></em>: <em>Firewall configuration, the machine with the search service opens port 9200 only from the IP of the TFS machine.</em></p><p>Now remote desktop to TFS machine, and verify that you are indeed able to browse <a href=http://tfssearch.cyberpunk.local:9200>http://tfssearch.cyberpunk.local:9200</a>, this confirm that configuration of the firewall allows TFS to contact the search service. Then <strong>try to access the very same address from another computer in the network and verify that it CANNOT access ElasticSearch instance</strong>. This guarantees that no one in the network can access Elastic Search directly and mess up with its data.</p><p>Now you can proceed with the Configuration Wizard in TFS instance, specifying the address of your new Search Server</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image-6.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-6.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/01/image_thumb-6.png alt=image></a></a></p><p><em><strong>Figure 7</strong></em>: <em>Configure new search service in TFS.</em></p><p>Proceed and finish the wizard. At the end TFS machine will re-index all the data in the new search server, just wait some minutes and you will be able to use again search, but now all Search Components are on a dedicated server.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/searching/>searching</a>, <a class=tag href=/tags/tfs/>Tfs</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2017/12/configure-visual-studio-2017-15-5-for-pull-rebase/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Configure Visual Studio 2017 155 for pull 8211rebase</a></div><div class="next-entry sep-before"><a href=/post/old/2018/01/monitor-tfs-search-data-usage/><span class=screen-reader-text>Next post: </span>Monitor TFS Search data Usage<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>