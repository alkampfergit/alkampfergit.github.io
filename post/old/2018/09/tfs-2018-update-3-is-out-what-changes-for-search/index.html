<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="TFS 2018 Update 3 is finally out and in release notes there is a nice news for Search functionality, basic security now enforced through a custom plugin. Here is what you can read in release notes
 Basic authorization is now enabled on the communication between the TFS and Search services to make it more secure. Any user installing or upgrading to Update 3 will need to provide a user name / password while configuring Search (and also during Search Service setup in case of remote Search Service)."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="TFS 2018 Update 3 is out what changes for Search • Codewrecks"><meta property="og:description" content="TFS 2018 Update 3 is finally out and in release notes there is a nice news for Search functionality, basic security now enforced through a custom plugin. Here is what you can read in release notes
 Basic authorization is now enabled on the communication between the TFS and Search services to make it more secure. Any user installing or upgrading to Update 3 will need to provide a user name / password while configuring Search (and also during Search Service setup in case of remote Search Service)."><meta property="og:url" content="https://www.codewrecks.com/post/old/2018/09/tfs-2018-update-3-is-out-what-changes-for-search/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="searching"><meta property="article:tag" content="Tfs"><meta property="article:published_time" content="2018-09-18T19:00:37+02:00"><meta property="article:modified_time" content="2018-09-18T19:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>TFS 2018 Update 3 is out what changes for Search • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2018/09/tfs-2018-update-3-is-out-what-changes-for-search/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>TFS 2018 Update 3 is out what changes for Search</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>TFS 2018 Update 3 is out what changes for Search</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2018-09-18T19:00:37+02:00>2018, Sep 18</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p><a href=https://docs.microsoft.com/en-us/visualstudio/releasenotes/tfs2018-update3>TFS 2018 Update 3 is finally out</a> and in release notes there is a nice news for Search functionality, <strong>basic security now enforced through a custom plugin</strong>. Here is what you can read in release notes</p><blockquote><p>Basic authorization is now enabled on the communication between the TFS and Search services to make it more secure. Any user installing or upgrading to Update 3 will need to provide a user name / password while configuring Search (and also during Search Service setup in case of remote Search Service).</p></blockquote><p><strong>ES is not secured by default, anyone can access port 9200 and interact with all the data without restriction</strong>. There is a commercial product made by ElasticSearch Inc to add security (Called Shield), but it is not free.</p><p><strong>Traditionally for TFS search servers, it is usually enough to completely close port 9200 in the firewall (if the search is installed in the same machine of Application Tier)</strong> or to <strong>open the port 9200 of Search Server only for Application Tiers instances if Search services are installed on different machine</strong> , disallowing every other computer of the network to directly access Elastic Search instance.</p><blockquote><p>Remember to always ensure minimum attack surfaces with a good Firewall Configuration. For ElasticSearch the port 9200 should be opened only for TFS Application Tiers.</p></blockquote><p>Here is the step you need to perform when you upgrade to Update 3 to install and configure search services: first <strong>of all in your search configuration you can notice a warning sign</strong> , nothing was really marked as wrong, so you can teoretically move on with configuration.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-14-38.jpg><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-14-38_thumb.jpg><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-14-38_thumb.jpg alt=2018-09-05_13-14-38></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Search configuration page in TFS Upgrade wizard, notice the warning sign and User and Password fields</em></p><p>When you are in the review pane, the update process complain for missing password in the Search configuration (Figure 1). At this point people get a little bit puzzled because they do not know what to user as username and password.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-15-00.jpg><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-15-00_thumb.jpg><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-15-00_thumb.jpg alt=2018-09-05_13-15-00></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Summary of upgrade complains that you did not specified user and password in search configuration (Figure 1)</em></p><p>If you move on, you find that it is Impossible to prosecute with the update because the installer complains of a missing ElasticSearch plugin installed.</p><blockquote><p>The error ElasticSearch does not have a plugin AlmSearchAuthPlugin installed is a clear indication that installation on Search server was outdated.</p></blockquote><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-22-37.jpg><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-22-37_thumb.jpg><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-22-37_thumb.jpg alt=2018-09-05_13-22-37></a></a></p><p><em><strong>Figure 3</strong></em>: <em>During Readiness check, the upgrade wizard detect that search services installed in the search server (separate machine) missed some needed components.</em></p><p><strong>The solution is really simple, you need to upgrade the Search component installation before you move on with Upgrading the AT instance.</strong> In my situation the search server was configured in a separate machine (a typical scenario to avoid ES to suck up too resource in the AT).</p><p>All you need to do is to <strong>copy search installation package</strong> (You have a direct link in search configuration page shown in Figure 1) <strong>to the machine devoted to search services and simply run the update command.</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-25-32.jpg><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-25-32_thumb.jpg><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-25-32_thumb.jpg alt=2018-09-05_13-25-32></a></a></p><p><em><strong>Figure 4</strong></em>: <em>With a simple PowerShell command you can upgrade the installation of ElasticSearch in the Search Server.</em></p><p>The * <strong>–Operation update</strong> *parameter is needed because I’ve already configured Search services in this server, but for <strong>Update 3 I needed also to specify a user and password to secure your ES instance.</strong> User and password could be whatever combination you want, <strong>just choose a secure and long password.</strong> After the installer finished, all search components are installed and configured correctly; now  you should <strong>reopen the Search configuration page (Figure 1) in the upgrade wizard, specify the same username and password you used during the Search Configuration and simply re-run readiness checks.</strong> Now all the readiness checks should pass, and you can verify that your ElasticSearch instance is secured simply browsing port 9200 of your search server. Instead of being greeted with server information you will be first ask for user and password. Just type user and password chosen during Search component configuration and the server will respond.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-29-08.jpg><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-29-08_thumb.jpg><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/09/2018-09-05_13-29-08_thumb.jpg alt=2018-09-05_13-29-08></a></a></p><p>This is a huge step to have a more secure TFS Configuration, because without resorting to commercial plugin, ElasticSearch is at least protected with basic authentication.</p><blockquote><p>Remember to always double check your TFS environment for potential security problems and always try to minimize attack surface with a good local firewall configuration.</p></blockquote><p>I still strongly encourage you to configure firewall to allow for connection in port 9200 only from TFS Application Tier machines, because is always a best practice not to leave ports accessible to every computer in the organization.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/searching/>searching</a>, <a class=tag href=/tags/tfs/>Tfs</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2018/09/welcome-azure-devops/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Welcome Azure DevOps</a></div><div class="next-entry sep-before"><a href=/post/old/2018/09/the-dreadful-iis-loopback-check/><span class=screen-reader-text>Next post: </span>The Dreadful IIS Loopback Check<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>