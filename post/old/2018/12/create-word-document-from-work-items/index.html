<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Post in the series:
 API Connection Retrieve Work Items Information Azure DevOps API, Embed images into HTML  Now we have all the prerequisites in place to connect to an Azure DevOps account, execute a query to grab all work items of a sprint and modifying HTML of Rich Edit fields to embed images. It is time to create a word document.
To have a better look and feel of exported document, the best approach is using the concept of Templates created by simple Word documents."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Create Word document from Work Items • Codewrecks"><meta property="og:description" content="Post in the series:
 API Connection Retrieve Work Items Information Azure DevOps API, Embed images into HTML  Now we have all the prerequisites in place to connect to an Azure DevOps account, execute a query to grab all work items of a sprint and modifying HTML of Rich Edit fields to embed images. It is time to create a word document.
To have a better look and feel of exported document, the best approach is using the concept of Templates created by simple Word documents."><meta property="og:url" content="https://www.codewrecks.com/post/old/2018/12/create-word-document-from-work-items/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="API"><meta property="article:tag" content="Azure Devops"><meta property="article:published_time" content="2018-12-31T11:00:37+02:00"><meta property="article:modified_time" content="2018-12-31T11:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Create Word document from Work Items • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2018/12/create-word-document-from-work-items/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Create Word document from Work Items</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Create Word document from Work Items</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2018-12-31T11:00:37+02:00>2018, Dec 31</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>7 mins read</span></div></div></header><div class="container entry-content"><p>Post in the series:</p><ol><li>API <a href=http://www.codewrecks.com/blog/index.php/2018/12/28/azure-devops-api-connection/>Connection</a></li><li><a href=http://www.codewrecks.com/blog/index.php/2018/12/28/azure-devops-api-retrieve-work-items-information/>Retrieve Work Items Information</a></li><li><a href=http://www.codewrecks.com/blog/index.php/2018/12/31/azure-devops-api-embed-images-into-html/>Azure DevOps API, Embed images into  HTML</a></li></ol><p>Now we have all the prerequisites in place to connect to an Azure DevOps account, execute a query to grab all work items of a sprint and modifying HTML of Rich Edit fields to embed images. It is time to create a word document.</p><p>To have a better look and feel of exported document, <strong>the best approach is using the concept of Templates created by simple Word documents</strong>. With this technique we can use all the styles, formatting directly in Word, then use some placeholder to specify where you want to include fields of work Items.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/12/image-12.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/12/image_thumb-12.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/12/image_thumb-12.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>A simple example of a Word Template used to export content of a Work Item</em></p><p>As you can see from <strong>Figure 1</strong> , a template is a simple word file where I have some special placeholder like {{title}} in the text to identify the point where I want to insert content taken from Work Items. This approach is really useful because <strong>Open XML format has a really nice feature that allows you to embed word documents inside other Word documents.</strong> This will allows me to open the template, perform substitution keeping all formatting, finally save everything to a temp file and append to the main document. With this approach I do not need to do any formatting in code, while giving the user of the tool the ability to decide the template of the output simply editing a word file.</p><blockquote><p>The concept of template made extremely simple for a user to specify the formatting while keeping the code simple because it should only look for specific tokens and perform substitution.</p></blockquote><p>I will really thanks <a href=https://github.com/ProximoSrl><strong>Proximo S.r.L.</strong></a> <strong>a</strong> <a href=http://prxm.it><strong>company</strong></a> <strong>I’m collaborating with for giving me the permission to share the code to manipulate Word Document</strong> , and to publish it open source. The whole code is in the example hosted in <a href=https://github.com/alkampfergit/AzureDevopsWordPlayground>GitHub</a>,</p><p>If take an high level look to the routine, I simply grab a reference to a list of WorkItems object, then proceed to generate a new Word Document with the help of an object called WordManipulator that contains all the routines I needs to generate a word starting from templates.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>var</span> fileName = Path.GetTempFileName() + <span style=color:#e6db74>&#34;.docx&#34;</span>;
<span style=color:#66d9ef>using</span> (WordManipulator manipulator = <span style=color:#66d9ef>new</span> WordManipulator(fileName, <span style=color:#66d9ef>true</span>))
{
    <span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> workItem <span style=color:#66d9ef>in</span> workItems)
    {
        manipulator.InsertWorkItem(workItem, <span style=color:#e6db74>@&#34;Templates\WorkItem.docx&#34;</span>, <span style=color:#66d9ef>true</span>);
    }
}
</code></pre></td></tr></table></div></div><p>WordManipulator class simply accept a name of a file, and a boolean value to specify if we need to create a new file, <strong>in this example I request for creation of a new file, then InsertWorkItem method will accept the template file and a boolean value that specify if you want to add a page break after the Work Item.</strong><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> InsertWorkItem(WorkItem workItem, String workItemTemplateFile, Boolean insertPageBreak = <span style=color:#66d9ef>true</span>)
{
    <span style=color:#75715e>//ok we need to open the template, give it a new name, perform substitution and finally append to the existing document
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> tempFile = Path.GetTempFileName();
    File.Copy(workItemTemplateFile, tempFile, <span style=color:#66d9ef>true</span>);
    <span style=color:#66d9ef>using</span> (WordManipulator m = <span style=color:#66d9ef>new</span> WordManipulator(tempFile, <span style=color:#66d9ef>false</span>))
    {
        m.SubstituteTokens(CreateDictionaryFromWorkItem(workItem));
    }

    AppendOtherWordFile(tempFile, insertPageBreak);
    File.Delete(tempFile);
}
</code></pre></td></tr></table></div></div></p><p>As promised the routine is really simple, just create a temporary file name, copy the template file over it, then open with another instance of WordManipulator and call the SubstituteTokens function, passing a dictionary with all the fields of Work Items we want to export.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>private</span> Dictionary CreateDictionaryFromWorkItem(WorkItem workItem)
{
    <span style=color:#66d9ef>var</span> retValue = <span style=color:#66d9ef>new</span> Dictionary();
    retValue[<span style=color:#e6db74>&#34;title&#34;</span>] = workItem.Title;
    retValue[<span style=color:#e6db74>&#34;description&#34;</span>] = <span style=color:#66d9ef>new</span> HtmlSubstitution(workItem.EmbedHtmlContent(workItem.Description));
    retValue[<span style=color:#e6db74>&#34;assignedto&#34;</span>] = workItem.Fields[<span style=color:#e6db74>&#34;System.AssignedTo&#34;</span>].Value?.ToString() ?? String.Empty;
    retValue[<span style=color:#e6db74>&#34;createdby&#34;</span>] = workItem.Fields[<span style=color:#e6db74>&#34;System.CreatedBy&#34;</span>].Value?.ToString() ?? String.Empty;
    <span style=color:#66d9ef>return</span> retValue;
}
</code></pre></td></tr></table></div></div><p>For this first example I export only four fields, but what it is interesting is that use an helper class called HmlSubstitution for the WorkItem.Description field, <strong>to specify to the substitution engine that I do not want a simple text substitution but I need a piece of HTML to be inserted into the document.</strong> The helper method <a href=http://www.codewrecks.com/blog/index.php/2018/12/31/azure-devops-api-embed-images-into-html/>EmbedHtmlContent was previously discussed</a> and it is needed only to have an HTML with all the image embedded as base64.</p><blockquote><p>Thanks to the concept of templates, creating a Word Document from Work Items it is just a series of  simple operations: open template, perform substitution and append to the main document.</p></blockquote><p>The SubstituteTokens is a slightly more complex, because <strong>it scans all</strong> <a href=https://docs.microsoft.com/en-us/office/open-xml/working-with-paragraphs><strong>paragraphs</strong></a> <strong>of the document looking for keys of the substitution dictionary; when a key is found it will perform substitution using corresponding value.</strong> The code is complex because when you put a token like {{token}} inside a word file, it could be stored in XML format using more than one simple <a href=https://docs.microsoft.com/en-us/office/open-xml/working-with-runs>Run</a> object (consult the <a href=https://www.ecma-international.org/publications/standards/Ecma-376.htm>ECMA</a> for specifications). Given this premise, the code will try to find all run objects that contains the token, then perform substitution.</p><blockquote><p>Even if a paragraphs seems really simple in Word, it could be saved with many Runs in OpenXml format, thus when you perform substitution you should never assume that a token will fit into an entire run.</p></blockquote><p>Some of the routine are really interesting, the AppendOtherWordFile will simply append another file to the current one, and <strong>it is using the concept of the</strong> <a href="https://docs.microsoft.com/en-us/dotnet/api/documentformat.openxml.wordprocessing.altchunk?view=openxml-2.8.1"><strong>AltChunk</strong></a> <strong>an object in the SDK that allows me to embed one document into another</strong>. The trick about AltChunk is that it is a simple object where you can store complex data with the FeedData method, simply passing a stream as argument.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> WordManipulator AppendOtherWordFile(String wordFilePath, Boolean addPageBreak = <span style=color:#66d9ef>true</span>)
{
    MainDocumentPart mainPart = _document.MainDocumentPart;
    <span style=color:#66d9ef>string</span> altChunkId = <span style=color:#e6db74>&#34;AltChunkId&#34;</span> + Guid.NewGuid().ToString();
    AlternativeFormatImportPart chunk = mainPart.AddAlternativeFormatImportPart(AlternativeFormatImportPartType.WordprocessingML, altChunkId);

    <span style=color:#66d9ef>using</span> (FileStream fileStream = File.Open(wordFilePath, FileMode.Open))
    {
        chunk.FeedData(fileStream);
        AltChunk altChunk = <span style=color:#66d9ef>new</span> AltChunk();
        altChunk.Id = altChunkId;
        mainPart.Document
           .Body
           .InsertAfter(altChunk, mainPart.Document.Body
           .Elements().LastOrDefault());
        mainPart.Document.Save();
    }
    <span style=color:#66d9ef>if</span> (addPageBreak)
    {
        _body.Append(
            <span style=color:#66d9ef>new</span> Paragraph(
            <span style=color:#66d9ef>new</span> Run(
                <span style=color:#66d9ef>new</span> Break() { Type = BreakValues.Page })));
    }
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
}
</code></pre></td></tr></table></div></div><p>The real magic is in the <strong>AddAlternativeFormatImportPart</strong> of the MainDocumentPart of the destination document, that <strong>allows you to specify the creation of a special chunk, containing a AlternativeFormatImportPartType.WorprocessingML (another word document).</strong> Thanks to this method we can create an alternate part, copying the entire content of the word document to attach and finally add this part to the original document (at the last position).</p><p>This method is so powerful that it can be used to create an alternate Import part of HTML type.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>private</span> AltChunk CreateChunkForHtmlPage(<span style=color:#66d9ef>string</span> htmlPage)
{
    <span style=color:#66d9ef>var</span> realHtml = <span style=color:#e6db74>$&#34;{htmlPage}&#34;</span>;
    <span style=color:#66d9ef>string</span> altChunkId = <span style=color:#e6db74>&#34;myid&#34;</span> + Guid.NewGuid().ToString();
    <span style=color:#66d9ef>using</span> (MemoryStream ms = <span style=color:#66d9ef>new</span> MemoryStream(Encoding.UTF8.GetBytes(realHtml)))
    {
        <span style=color:#75715e>// Create alternative format import part.
</span><span style=color:#75715e></span>        AlternativeFormatImportPart formatImportPart = _document.MainDocumentPart.AddAlternativeFormatImportPart(
            AlternativeFormatImportPartType.Html,
            altChunkId);

        <span style=color:#75715e>// Feed HTML data into format import part (chunk).
</span><span style=color:#75715e></span>        formatImportPart.FeedData(ms);
    }
    <span style=color:#66d9ef>var</span> altChunk = <span style=color:#66d9ef>new</span> AltChunk();
    altChunk.Id = altChunkId;
    <span style=color:#66d9ef>return</span> altChunk;
}
</code></pre></td></tr></table></div></div><p>OpenXML format is really fascinating and it is a real fantastic effort made by Microsoft to create a standard that is easy to use. As you can see from the above snippet, inserting HTML code inside a Word Document is done with a couple of calls.</p><p>All the rest of the code in the example is boilerplate, and here is the result of a test export. The code relating to this example is in <a href=https://github.com/alkampfergit/AzureDevopsWordPlayground/tree/0.2.0>GitHub with the tag 0.2.0</a>. Here is an example of an exported document</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2018/12/image-13.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2018/12/image_thumb-13.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2018/12/image_thumb-13.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>An exported document with complex description</em></p><p>The original Work Item in <strong>Figure 2</strong> was created with <a href="https://marketplace.visualstudio.com/items?itemName=vs-publisher-99152.AITWordToTFS">AIT WordToTfs</a> tools, that allows bidirectional editing of Work Item in Word. As you can see, thanks to this tool I was able to change font in the Work Item description, and you can also verify to the Rigth that exported document maintains the formatting, and it is also using the Word template file.</p><blockquote><p>Output Word Document still maintain all formatting of the template (color, bold, font etc) but also the Work Item description maintains its formatting, so the export is high fidelity.</p></blockquote><p><strong>To run this example I used this command line that allows me to specify all the information needed by the tool to export everything</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>--address https:<span style=color:#75715e>//gianmariaricci.visualstudio.com 
</span><span style=color:#75715e></span>--tokenfile C:<span style=color:#960050;background-color:#1e0010>\</span>develop<span style=color:#960050;background-color:#1e0010>\</span>Crypted<span style=color:#960050;background-color:#1e0010>\</span>patOri.txt 
--teamproject <span style=color:#e6db74>&#34;zoalord insurance&#34;</span> 
--iterationpath <span style=color:#e6db74>&#34;zoalord insurance\Release 1\Sprint 6&#34;</span>
--areapath <span style=color:#e6db74>&#34;zoalord insurance&#34;</span>
</code></pre></td></tr></table></div></div><p>Happy new Year and Happy Azure DevOps.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/azure-devops/>Azure DevOps</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/api/>API</a>, <a class=tag href=/tags/azure-devops/>Azure Devops</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2018/12/azure-devops-api-embed-images-into-html/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Azure DevOps API Embed images into html</a></div><div class="next-entry sep-before"><a href=/post/old/2019/01/sonar-analysis-of-python-with-azure-devops-pipeline/><span class=screen-reader-text>Next post: </span>Sonar Analysis of Python with Azure DevOps pipeline<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>