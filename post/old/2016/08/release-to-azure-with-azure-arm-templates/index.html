<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Thanks to new Release Management system in VSTS / TFS creating a release to your on-premise environment is really simple (I’ve described the process here). Another option is creating a test environment in Windows Azure, and if you choose this option life can be even easier.
In this example I’m using Azure as IAAS, deploying a software on a Windows Virtual Machine. While this is probably not the best approach to cloud (PAAS is surely a better approach) to create a test environment it can be perfectly acceptable."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Release to Azure with Azure ARM templates • Codewrecks"><meta property="og:description" content="Thanks to new Release Management system in VSTS / TFS creating a release to your on-premise environment is really simple (I’ve described the process here). Another option is creating a test environment in Windows Azure, and if you choose this option life can be even easier.
In this example I’m using Azure as IAAS, deploying a software on a Windows Virtual Machine. While this is probably not the best approach to cloud (PAAS is surely a better approach) to create a test environment it can be perfectly acceptable."><meta property="og:url" content="https://www.codewrecks.com/post/old/2016/08/release-to-azure-with-azure-arm-templates/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="ReleaseManagement"><meta property="article:tag" content="VSTS"><meta property="article:published_time" content="2016-08-16T08:00:37+02:00"><meta property="article:modified_time" content="2016-08-16T08:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Release to Azure with Azure ARM templates • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2016/08/release-to-azure-with-azure-arm-templates/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style></head><body class="page type-post has-sidebar"><div class=site><div id=sidebar class=sidebar><a class=screen-reader-text href=#main-menu>Skip to Main Menu</a><div class=container><section class="widget widget-about sep-after"><header><div class=logo><a href=/><img src=/images/logo.png></a></div><h2 class="title site-title"><a href=/>Codewrecks</a></h2><div class=desc>Wrecks of code floating in the sea of internet</div></header></section><section class="widget widget-sidebar_menu sep-after"><nav id=sidebar-menu class="menu sidebar-menu" aria-label="Sidebar Menu"><div class=container><ul><li class=item><a href=/>Home</a></li></ul></div></nav></section><section class="widget widget-taxonomy_cloud sep-after"><header><h4 class="title widget-title">Tags</h4></header><div class="container list-container"><ul class="list taxonomy-cloud"><li><a href=/tags/actions/ style=font-size:1.0078740157480315em>Actions</a></li><li><a href=/tags/addin/ style=font-size:1.0078740157480315em>Addin</a></li><li><a href=/tags/agile/ style=font-size:1.0236220472440944em>Agile</a></li><li><a href=/tags/alm/ style=font-size:1.0629921259842519em>ALM</a></li><li><a href=/tags/aop/ style=font-size:1.0236220472440944em>Aop</a></li><li><a href=/tags/api/ style=font-size:1.0708661417322836em>Api</a></li><li><a href=/tags/applicationinsights/ style=font-size:1.0236220472440944em>ApplicationInsights</a></li><li><a href=/tags/architecture/ style=font-size:1.1023622047244095em>Architecture</a></li><li><a href=/tags/architecture-castle/ style=font-size:1.0078740157480315em>Architecture Castle</a></li><li><a href=/tags/aspnet/ style=font-size:1.3700787401574803em>ASPNET</a></li><li><a href=/tags/aspnet-mvc/ style=font-size:1.031496062992126em>AspNet MVC</a></li><li><a href=/tags/azdo/ style=font-size:1.125984251968504em>AzDo</a></li><li><a href=/tags/azure/ style=font-size:1.0866141732283465em>Azure</a></li><li><a href=/tags/azure-devops/ style=font-size:1.110236220472441em>Azure Devops</a></li><li><a href=/tags/azure-pipelines/ style=font-size:1.031496062992126em>Azure Pipelines</a></li><li><a href=/tags/azuredevops/ style=font-size:1.0551181102362204em>AzureDevOps</a></li><li><a href=/tags/backup/ style=font-size:1.0078740157480315em>Backup</a></li><li><a href=/tags/blend/ style=font-size:1.0078740157480315em>Blend</a></li><li><a href=/tags/blog/ style=font-size:1.0078740157480315em>Blog</a></li><li><a href=/tags/blogging/ style=font-size:1.047244094488189em>blogging</a></li><li><a href=/tags/books/ style=font-size:1.015748031496063em>Books</a></li><li><a href=/tags/branch/ style=font-size:1.0078740157480315em>Branch</a></li><li><a href=/tags/build/ style=font-size:1.6220472440944882em>build</a></li><li><a href=/tags/c/ style=font-size:1.0078740157480315em>C</a></li><li><a href=/tags/castle/ style=font-size:1.2283464566929134em>Castle</a></li><li><a href=/tags/clickonce/ style=font-size:1.0236220472440944em>ClickOnce</a></li><li><a href=/tags/codeanalysis/ style=font-size:1.0078740157480315em>CodeAnalysis</a></li><li><a href=/tags/codespaces/ style=font-size:1.015748031496063em>Codespaces</a></li><li><a href=/tags/continuos-integration/ style=font-size:1.031496062992126em>Continuos Integration</a></li><li><a href=/tags/continuous-deployment/ style=font-size:1.0393700787401574em>Continuous Deployment</a></li><li><a href=/tags/continuous-integration/ style=font-size:1.031496062992126em>Continuous Integration</a></li><li><a href=/tags/cqrs/ style=font-size:1.0078740157480315em>CQRS</a></li><li><a href=/tags/datadude/ style=font-size:1.0393700787401574em>DataDude</a></li><li><a href=/tags/datagrid/ style=font-size:1.0078740157480315em>DataGrid</a></li><li><a href=/tags/ddd/ style=font-size:1.1181102362204725em>DDD</a></li><li><a href=/tags/debugging/ style=font-size:1.0078740157480315em>Debugging</a></li><li><a href=/tags/dev11/ style=font-size:1.0078740157480315em>dev11</a></li><li><a href=/tags/developing/ style=font-size:1em>developing</a></li><li><a href=/tags/devops/ style=font-size:1.125984251968504em>DevOps</a></li><li><a href=/tags/docker/ style=font-size:1.0078740157480315em>Docker</a></li><li><a href=/tags/dotnet/ style=font-size:1em>dotnet</a></li><li><a href=/tags/ef/ style=font-size:1.0078740157480315em>EF</a></li><li><a href=/tags/ef-code-first/ style=font-size:1.031496062992126em>EF Code First</a></li><li><a href=/tags/ef41/ style=font-size:1.0236220472440944em>EF41</a></li><li><a href=/tags/ef5/ style=font-size:1.015748031496063em>EF5</a></li><li><a href=/tags/enterprise-library/ style=font-size:1.0236220472440944em>Enterprise Library</a></li><li><a href=/tags/entity-framework/ style=font-size:1.094488188976378em>Entity Framework</a></li><li><a href=/tags/everydaylife/ style=font-size:1.047244094488189em>EverydayLife</a></li><li><a href=/tags/excel/ style=font-size:1.0078740157480315em>Excel</a></li><li><a href=/tags/experiences/ style=font-size:1.2440944881889764em>Experiences</a></li><li><a href=/tags/frameworks/ style=font-size:1.0629921259842519em>Frameworks</a></li><li><a href=/tags/general/ style=font-size:2em>General</a></li><li><a href=/tags/git/ style=font-size:1.2283464566929134em>Git</a></li><li><a href=/tags/git-tf/ style=font-size:1.0078740157480315em>git-tf</a></li><li><a href=/tags/github/ style=font-size:1.1338582677165354em>GitHub</a></li><li><a href=/tags/github-actions/ style=font-size:1.015748031496063em>GitHub Actions</a></li><li><a href=/tags/hacking/ style=font-size:1em>Hacking</a></li><li><a href=/tags/hardware/ style=font-size:1.031496062992126em>Hardware</a></li><li><a href=/tags/hql/ style=font-size:1.0078740157480315em>HQL</a></li><li><a href=/tags/html/ style=font-size:1.0078740157480315em>Html</a></li><li><a href=/tags/hugo/ style=font-size:1em>hugo</a></li><li><a href=/tags/icriteria/ style=font-size:1.0078740157480315em>ICriteria</a></li><li><a href=/tags/iis/ style=font-size:1.015748031496063em>IIS</a></li><li><a href=/tags/ioc/ style=font-size:1.015748031496063em>IoC</a></li><li><a href=/tags/javascript/ style=font-size:1.0078740157480315em>Javascript</a></li><li><a href=/tags/jquery/ style=font-size:1.047244094488189em>JQuery</a></li><li><a href=/tags/kali/ style=font-size:1.0078740157480315em>kali</a></li><li><a href=/tags/lab-management/ style=font-size:1.1023622047244095em>Lab Management</a></li><li><a href=/tags/languages/ style=font-size:1.0551181102362204em>Languages</a></li><li><a href=/tags/linq/ style=font-size:1.204724409448819em>LINQ</a></li><li><a href=/tags/linux/ style=font-size:1.0551181102362204em>Linux</a></li><li><a href=/tags/log4net/ style=font-size:1.047244094488189em>log4net</a></li><li><a href=/tags/lucene/ style=font-size:1.0629921259842519em>lucene</a></li><li><a href=/tags/macro/ style=font-size:1.0236220472440944em>Macro</a></li><li><a href=/tags/masstransit/ style=font-size:1.015748031496063em>masstransit</a></li><li><a href=/tags/mef/ style=font-size:1.0236220472440944em>MEF</a></li><li><a href=/tags/metroui/ style=font-size:1.0078740157480315em>MetroUi</a></li><li><a href=/tags/microsoft-test-manager/ style=font-size:1.015748031496063em>Microsoft Test Manager</a></li><li><a href=/tags/mms/ style=font-size:1.015748031496063em>mms</a></li><li><a href=/tags/mongo/ style=font-size:1.0236220472440944em>Mongo</a></li><li><a href=/tags/mongodb/ style=font-size:1.1496062992125984em>MongoDB</a></li><li><a href=/tags/msbuild/ style=font-size:1.031496062992126em>Msbuild</a></li><li><a href=/tags/mstest/ style=font-size:1.0078740157480315em>MsTest</a></li><li><a href=/tags/mvvm/ style=font-size:1.0708661417322836em>MVVM</a></li><li><a href=/tags/nablasoft/ style=font-size:1.0236220472440944em>Nablasoft</a></li><li><a href=/tags/ndepend/ style=font-size:1.0236220472440944em>NDepend</a></li><li><a href=/tags/net/ style=font-size:1.0236220472440944em>Net</a></li><li><a href=/tags/net-core/ style=font-size:1.0078740157480315em>NET Core</a></li><li><a href=/tags/net-framework/ style=font-size:1.5118110236220472em>NET framework</a></li><li><a href=/tags/netcore/ style=font-size:1.0236220472440944em>NETCORE</a></li><li><a href=/tags/nhibernate/ style=font-size:1.5039370078740157em>Nhibernate</a></li><li><a href=/tags/nosql/ style=font-size:1.0629921259842519em>NoSql</a></li><li><a href=/tags/nsm/ style=font-size:1em>nsm</a></li><li><a href=/tags/nuget/ style=font-size:1.0393700787401574em>nuget</a></li><li><a href=/tags/nunit/ style=font-size:1.0393700787401574em>Nunit</a></li><li><a href=/tags/office/ style=font-size:1.0236220472440944em>Office</a></li><li><a href=/tags/oop/ style=font-size:1.0236220472440944em>OOP</a></li><li><a href=/tags/openxml/ style=font-size:1.0078740157480315em>OpenXml</a></li><li><a href=/tags/orm/ style=font-size:1.0236220472440944em>ORM</a></li><li><a href=/tags/performance/ style=font-size:1.0393700787401574em>Performance</a></li><li><a href=/tags/pills/ style=font-size:1.047244094488189em>Pills</a></li><li><a href=/tags/pipeline/ style=font-size:1.0393700787401574em>Pipeline</a></li><li><a href=/tags/plugin/ style=font-size:1.031496062992126em>Plugin</a></li><li><a href=/tags/power-tools/ style=font-size:1.0236220472440944em>Power Tools</a></li><li><a href=/tags/powershell/ style=font-size:1.1023622047244095em>PowerShell</a></li><li><a href=/tags/process-template/ style=font-size:1.047244094488189em>Process Template</a></li><li><a href=/tags/programming/ style=font-size:1.1181102362204725em>Programming</a></li><li><a href=/tags/python/ style=font-size:1.015748031496063em>Python</a></li><li><a href=/tags/ravendb/ style=font-size:1.031496062992126em>RavenDB</a></li><li><a href=/tags/release/ style=font-size:1.031496062992126em>release</a></li><li><a href=/tags/releasemanagement/ style=font-size:1.0551181102362204em>ReleaseManagement</a></li><li><a href=/tags/resharper/ style=font-size:1.0236220472440944em>Resharper</a></li><li><a href=/tags/rest-apis/ style=font-size:1.0236220472440944em>Rest APIs</a></li><li><a href=/tags/rhinomock/ style=font-size:1.0078740157480315em>RhinoMock</a></li><li><a href=/tags/scrum/ style=font-size:1.0078740157480315em>Scrum</a></li><li><a href=/tags/searching/ style=font-size:1.0393700787401574em>searching</a></li><li><a href=/tags/security/ style=font-size:1.3307086614173227em>security</a></li><li><a href=/tags/securityonion/ style=font-size:1em>securityonion</a></li><li><a href=/tags/shim/ style=font-size:1.0078740157480315em>shim</a></li><li><a href=/tags/signalr/ style=font-size:1.0078740157480315em>signalr</a></li><li><a href=/tags/silverlight/ style=font-size:1.015748031496063em>Silverlight</a></li><li><a href=/tags/software-architecture/ style=font-size:1.125984251968504em>Software Architecture</a></li><li><a href=/tags/solr/ style=font-size:1.0551181102362204em>Solr</a></li><li><a href=/tags/sonarcloud/ style=font-size:1.0078740157480315em>sonarcloud</a></li><li><a href=/tags/sonarqube/ style=font-size:1.0551181102362204em>sonarqube</a></li><li><a href=/tags/springnet/ style=font-size:1em>SpringNET</a></li><li><a href=/tags/sql-server/ style=font-size:1.236220472440945em>Sql Server</a></li><li><a href=/tags/sqlite/ style=font-size:1.0078740157480315em>SQLite</a></li><li><a href=/tags/ssd/ style=font-size:1.047244094488189em>SSD</a></li><li><a href=/tags/ssis/ style=font-size:1.0078740157480315em>SSIS</a></li><li><a href=/tags/symbols/ style=font-size:1em>Symbols</a></li><li><a href=/tags/team-foundation-server/ style=font-size:1.4330708661417324em>Team Foundation Server</a></li><li><a href=/tags/teamfoundationserver/ style=font-size:1.0236220472440944em>TeamFoundationServer</a></li><li><a href=/tags/terraform/ style=font-size:1em>terraform</a></li><li><a href=/tags/test/ style=font-size:1.0078740157480315em>Test</a></li><li><a href=/tags/testing/ style=font-size:1.5511811023622046em>Testing</a></li><li><a href=/tags/testlab/ style=font-size:1.0078740157480315em>TestLab</a></li><li><a href=/tags/tf-service/ style=font-size:1.047244094488189em>TF Service</a></li><li><a href=/tags/tfs/ style=font-size:1.7716535433070866em>Tfs</a></li><li><a href=/tags/tfs-build/ style=font-size:1.236220472440945em>TFS Build</a></li><li><a href=/tags/tfs-power-tools/ style=font-size:1.0078740157480315em>Tfs Power Tools</a></li><li><a href=/tags/tfs-service/ style=font-size:1.0078740157480315em>Tfs service</a></li><li><a href=/tags/tfs11/ style=font-size:1.015748031496063em>TFS11</a></li><li><a href=/tags/tfsapi/ style=font-size:1.031496062992126em>TfsAPI</a></li><li><a href=/tags/tfsbuild/ style=font-size:1.1023622047244095em>TfsBuild</a></li><li><a href=/tags/tfvc/ style=font-size:1.0078740157480315em>TFVC</a></li><li><a href=/tags/tika/ style=font-size:1.0236220472440944em>tika</a></li><li><a href=/tags/tls/ style=font-size:1em>TLS</a></li><li><a href=/tags/tools/ style=font-size:1.0078740157480315em>Tools</a></li><li><a href=/tags/tools-and-library/ style=font-size:1.1338582677165354em>Tools and library</a></li><li><a href=/tags/tryhackme/ style=font-size:1em>TryHackMe</a></li><li><a href=/tags/uat/ style=font-size:1.015748031496063em>UAT</a></li><li><a href=/tags/ubuntu/ style=font-size:1em>Ubuntu</a></li><li><a href=/tags/uncategorized/ style=font-size:1.3149606299212597em>Uncategorized</a></li><li><a href=/tags/unit-testing/ style=font-size:1.0551181102362204em>Unit Testing</a></li><li><a href=/tags/unittesting/ style=font-size:1em>UnitTesting</a></li><li><a href=/tags/upgrade/ style=font-size:1.0629921259842519em>Upgrade</a></li><li><a href=/tags/vcs/ style=font-size:1.015748031496063em>VCS</a></li><li><a href=/tags/virtual-machine/ style=font-size:1.031496062992126em>Virtual Machine</a></li><li><a href=/tags/visual-studio/ style=font-size:1.3307086614173227em>Visual Studio</a></li><li><a href=/tags/visual-studio-2013/ style=font-size:1.0078740157480315em>Visual Studio 2013</a></li><li><a href=/tags/visual-studio-alm/ style=font-size:1.2834645669291338em>Visual Studio ALM</a></li><li><a href=/tags/visual-studio-database-edition/ style=font-size:1.031496062992126em>Visual Studio Database Edition</a></li><li><a href=/tags/vnext/ style=font-size:1.0551181102362204em>vNext</a></li><li><a href=/tags/vs11/ style=font-size:1.031496062992126em>VS11</a></li><li><a href=/tags/vs2010/ style=font-size:1.0078740157480315em>VS2010</a></li><li><a href=/tags/vs2012/ style=font-size:1.031496062992126em>VS2012</a></li><li><a href=/tags/vsalm/ style=font-size:1.031496062992126em>VSAlm</a></li><li><a href=/tags/vsdbedition/ style=font-size:1.0078740157480315em>VSDBEdition</a></li><li><a href=/tags/vso/ style=font-size:1.0708661417322836em>VSO</a></li><li><a href=/tags/vsts/ style=font-size:1.3228346456692912em>VSTS</a></li><li><a href=/tags/vstsdbedition/ style=font-size:1.0078740157480315em>VSTSDBEdition</a></li><li><a href=/tags/wcf/ style=font-size:1.125984251968504em>Wcf</a></li><li><a href=/tags/wcf-iis7/ style=font-size:1.0078740157480315em>WCF IIS7</a></li><li><a href=/tags/web-test/ style=font-size:1.015748031496063em>Web Test</a></li><li><a href=/tags/webbrowser/ style=font-size:1.015748031496063em>WebBrowser</a></li><li><a href=/tags/windows/ style=font-size:1.031496062992126em>Windows</a></li><li><a href=/tags/winforms/ style=font-size:1.0236220472440944em>Winforms</a></li><li><a href=/tags/workflow/ style=font-size:1.0236220472440944em>workflow</a></li><li><a href=/tags/wpf/ style=font-size:1.3937007874015748em>WPF</a></li><li><a href=/tags/wsl/ style=font-size:1em>WSL</a></li><li><a href=/tags/wsl2/ style=font-size:1em>wsl2</a></li><li><a href=/tags/xaml/ style=font-size:1.015748031496063em>XAML</a></li><li><a href=/tags/yaml/ style=font-size:1.0236220472440944em>YAML</a></li><li><a href=/tags/zero-trust-security/ style=font-size:1.0078740157480315em>Zero Trust Security</a></li></ul></div></section></div><div class=sidebar-overlay></div></div><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><a class=screen-reader-text href=#content>Skip to Content</a>
<button id=sidebar-toggler class=sidebar-toggler aria-controls=sidebar>
<span class=screen-reader-text>Toggle Sidebar</span>
<span class=open><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></span><span class=close><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></button><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/git-videos/>Git Videos</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Release to Azure with Azure ARM templates</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Release to Azure with Azure ARM templates</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2016-08-16T08:00:37+02:00>2016, Aug 16</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>8 mins read</span></div></div></header><div class="container entry-content"><p>Thanks to new Release Management system in VSTS / TFS creating a release to your on-premise environment is really simple (<a href=http://www.codewrecks.com/blog/index.php/2016/06/18/create-a-release-in-tfs-2015-vsts-release-management/>I’ve described the process here</a>). Another option is creating a test environment in Windows Azure, and if you choose this option life can be even easier.</p><p>In this example <strong>I’m using Azure as IAAS, deploying a software on a Windows Virtual Machine.</strong> While this is probably not the best approach to cloud (PAAS is surely a better approach) to create a test environment it can be perfectly acceptable.</p><p>I’m not going to give you an introduction or explanation of <a href=https://azure.microsoft.com/en-us/documentation/articles/resource-group-overview/>Azure Resource Manager</a> because there are tons of resources on the web and Azure moves so quickly that every information I’m going to give you will probably will be old by the time I press “publish” :). The purpose of this post is giving you a general idea on <strong>how to use Azure ARM to create a release definition that automatically generates the resource in azure and deploy your software on it.</strong> My goal is using Azure ARM for DevOps and Automatic / Continuous Deployment and the first step is creating a template file that describes exactly all the Azure resource needed to host my application. <strong>Instead of starting to write such template file I start checking on</strong> <a href=https://github.com/Azure/azure-quickstart-templates><strong>GitHub becuse there are tons of template file</strong></a> <strong>s ready to use.</strong> As an example I took one of the simplest, called 101-vm-simple-windows. It creates a simple Windows Virtual Machine and nothing else. That template has various parameters that can allow you to specify VM Names and other properties, and it can be directly used by a Release Management definition.  I’ve done simple modification to the template file and <strong>in this situation it is better to first check if everything is working as expected triggering the deploy process directly from command line</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>New-AzureRmResourceGroupDeployment -Name JarvisRm -ResourceGroupName JarvisRm-TemplateFile <span style=color:#e6db74>&#34;azuredeploy.json&#34;</span> -adminUsername alkampfer -adminPassword ******** **-vmName JarvisCmTest -storageAccount jarvisrmstorage -dnsLabelPrefix jarvisrm</code></pre></td></tr></table></div></div><p>As you can see I need to choose the name of the resource group (JarvisRm) specify the template file (azuredeploy.json) and finally all the paramters of the template as if they are parameter of the PowerShell cmdlet.** Once the script finished verify that the resource group was created correctly and all the resources are suitable to deploy your software **.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/08/image-5.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/08/image_thumb-5.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/08/image_thumb-5.png alt=image></a></a>** Figure 1: ***Your Resource group was correctly created.*</p><p>Once everything is correct, I deleted the JarvisRm resource group and I’m ready to use the template on a release definition.</p><blockquote><p>Always test your ARM template directly from command line, to verify that everything is allright. When the resource are created try to use them as manually target of a deploy and only once everything is ok start automating with Release Management.</p></blockquote><p>When you have a good template file <strong>the best place to store it is in your source control, this allow you to version this file along with the version of the code that is supposed to use it</strong>. If you do not need versioning you can simply store in a network share, but to avoid problem it is better to have Release Management Agent run the template from a local disk and not from a network share.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-5.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-5.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-5.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Copy template file from a network share to a local folder of the agent.</em></p><p>First step of the release process is copying template files from a network share to $(System.DefaultWorkingDirectory)\ARM folder so PowerShell can run against script that are placed on local disk. <strong>The second task is Azure Resource Group Deployment that uses the template to deploy all Resources to Azure</strong>.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-6.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-6.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-6.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>The Azure Deployment task is used to create a Resource Group from a Template definition.</em></p><p>You should specify only template file (1) and  all the parameters of the template (2) such as userName, password, dns name of the VM etc. <strong>As a nice option you can choose to Enable Deployment Prerequisites (3) to have your VM being able to be used as a target for Deploy Action.</strong> <a href=https://blogs.msdn.microsoft.com/muthus_blog/2015/11/04/pre-requisites-for-using-azure-vms-in-winrm-based-tasks-in-build-and-release-management-workflows/>You can read more about prerequisites on MSDN blog</a>, basically when you select this action the script will configure PowerShell and other option on the target machine to being able to execute script remotely.</p><blockquote><p>Virtual machines need to be configured to be used as target of deploy tasks such as remote PowerShell execution, but the Azure deployment task can take care of everything for you.</p></blockquote><p>This task requires that you already connected the target Azure subscription with your VSTS account. <strong>If you never connected your TFS / VSTS account to your Azure subscription with ARM, you can follow the</strong> <a href=https://blogs.msdn.microsoft.com/visualstudioalm/2015/10/04/automating-azure-resource-group-deployment-using-a-service-principal-in-visual-studio-online-buildrelease-management/><strong>instruction at this link</strong></a> <strong>, that contains a PowerShell script that does EVERYTHING for you</strong>. Just run the script, and annotate in a safe place all the data you should insert to your TFS / VSTS instance to connect to Azure with ARM.</p><p>Antoher aspect you need to take care of, is the version of PowerShell azure tools installed in the machine where the Release Agent is running. Release Management script are tested agains specific version of Azure PowerShell tools, and since the Azure team is constantly upgrading the Tools, it coudl happen that TFS / VSTS Release Management Tasks are not compatible with the latest version of the Azure Tools.</p><p>All of these tasks are open sourced, and you can find information directly on GitHub. As an example <a href=https://github.com/Microsoft/vsts-tasks/tree/master/Tasks/DeployAzureResourceGroup>at this link tjere are the information about the DeployAzureResourceGroup task</a>. If you go to the bottom you can verify the PowerShell tools version suggested to run that task.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-7.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-7.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-7.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Supported version of AzureRM module version</em></p><p>Clearly you should install a compatible version in the machine where the Agent is installed. If you are unsure if the agents has a suitable version of Azure PowerShell tools, you can go to TFS Admin page and verify capabilities of the agent directly from VSTS / TFS</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-8.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-8.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-8.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Agent capabilities contains the version of Azure PowerShell tools installed</em></p><p>Demand for Azure PS is present on Release Definition, but it does not specify the version, so it is not guarantee that your release is going to be successful.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-9.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-9.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-9.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Release process has a demands for Azure PowerShell tools but not to a specific version.</em></p><p>As a result I had problem in setting up the Release Process because my agents has PowerShell tools version 1.4 installed, but they are not fully compatible with Release Manager Task. Downgrading the tools solved the problem.</p><blockquote><p>If your release fails with strange errors (such as NullReferenceException) you need to check in GitHub the version of PowerShell tools needed to run that task and install the right version in the agent (or at least you can try to change the version until you find the most recent that works)</p></blockquote><p>The Azure Resource Group Deployments takes care of everything, I’ve modified the base script to apply a specific Network Security Group to the VM but the general concept is that it configures every Azure Resource you need to use. <strong>At the end of the script you have everything you need to deploy your software</strong> (Virtual Machines, sites, databases, etc).</p><p>In my example I need only a VM, and once it is configured I can simply use Copy to Azure VM task and Execute PowerShell on Azure VM Task to release my software, as I did for my on-premise environment.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-10.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-10.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-10.png alt=image></a></a></p><p><em><strong>Figure 6</strong></em>: <em>Configuration of the Task used to copy files to Azure VM</em></p><p>You can specify files you want to copy (1) login to the machine (2) and thanks to Enable Copy Prerequisites (3) option you can let the Task takes care of every step needed to allow copy file to the VM. <strong>This option is not needed if you already choosen it in the Azure Deployment task, but it can be really useful if you have a pre-existing Virtual Machine you want to use</strong>.</p><p>Final Step is executing the release script on target machine, and it has the same option you specify to run a script on a machine on-premise.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-11.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-11.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-11.png alt=image></a></a></p><p><em><strong>Figure 7</strong></em>: <em>Run the installation PowerShell script on target Azure VM</em></p><p>Once everything is in place you only need to create a release and wait for it to be finished.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-12.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-12.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-12.png alt=image></a></a></p><p><em><strong>Figure 8</strong></em>: <em>Output of release definition with Azure ARM</em></p><blockquote><p>With this example, since I’m using a Virtual Machine, deploy script is the same I used for on-premise release, with PAAS approach, usually you have a different script that target Azure specific resources (WebSites, DocumentDb, etc)</p></blockquote><p>If the release succeeded you can login to portal.azure.com to verify that your new resource group was correctly created <strong>Figure 1</strong> , and check that in the resource group there are all the expected resources <strong>Figure 9</strong>.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-13.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-13.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-13.png alt=image></a></a></p><p><em><strong>Figure 9</strong></em>: <em>Resources created inside the group.</em></p><p>To verify that everything is ok you should check the exact version of the software that is actually deployed on the environment. From <strong>Figure 10</strong> I can see that the release deployed the version 1.5.2.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-14.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-14.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-14.png alt=image></a></a></p><p><em><strong>Figure 10</strong></em>: <em>List of all most recents releases.</em></p><p>Now I can login to the VM and try to use the software to verify that it is correctly installed and that the version installed is correct.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image-15.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-15.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/07/image_thumb-15.png alt=image></a></a></p><p><em><strong>Figure 11</strong></em>: <em>Software is correctly installed and the version corresponds to the version of the release.</em></p><p>Azure Resource Management is a powerful feature that can dramatically simplify releasing your software to Azure, because you can just download scripts from GitHub to automatically creates all Azure Resources needed by your application, and lets VSTS Release Management tasks takes care of everything.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/releasemanagement/>ReleaseManagement</a>, <a class=tag href=/tags/vsts/>VSTS</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2016/08/upgrading-sonarqube-from-5-1-to-6-0/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Upgrading SonarQube from 51 to 60</a></div><div class="next-entry sep-before"><a href=/post/old/2016/09/use-different-excel-tfs-vsts-addin-at-the-same-time/><span class=screen-reader-text>Next post: </span>Use different Excel TFS VSTS Addin at the same time<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>