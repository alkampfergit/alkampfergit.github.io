<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="To avoid creating unnecessary build definition, it is a best practice to allow for parameter overriding in every task that can be executed from a build. I’ve dealt on how to parametrize tests to use a different connection string when tests are executed during the build and I’ve used Environment variables for a lot of reasons.
Environment variables are not source controlled, this allows every developer to override settings in own machine without disturbing other developers."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Manage Environment Variables during a TFS  VSTS Build • Codewrecks"><meta property="og:description" content="To avoid creating unnecessary build definition, it is a best practice to allow for parameter overriding in every task that can be executed from a build. I’ve dealt on how to parametrize tests to use a different connection string when tests are executed during the build and I’ve used Environment variables for a lot of reasons.
Environment variables are not source controlled, this allows every developer to override settings in own machine without disturbing other developers."><meta property="og:url" content="https://www.codewrecks.com/post/old/2016/08/manage-environment-variables-during-a-tfs-vsts-build/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="build"><meta property="article:tag" content="Testing"><meta property="article:published_time" content="2016-08-06T07:00:37+02:00"><meta property="article:modified_time" content="2016-08-06T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Manage Environment Variables during a TFS VSTS Build • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2016/08/manage-environment-variables-during-a-tfs-vsts-build/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Manage Environment Variables during a TFS VSTS Build</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Manage Environment Variables during a TFS VSTS Build</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2016-08-06T07:00:37+02:00>2016, Aug 06</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>3 mins read</span></div></div></header><div class="container entry-content"><p>To avoid creating unnecessary build definition, it is <strong>a best practice to allow for parameter overriding in every task that can be executed from a build</strong>. I’ve dealt on how to <a href=http://www.codewrecks.com/blog/index.php/2016/06/25/create-parametrized-test-to-allow-for-simpler-builds/>parametrize tests</a> to use a different connection string when tests are executed during the build and I’ve used Environment variables for a lot of reasons.</p><p>Environment variables are not source controlled, this allows every developer to override settings in own machine without disturbing other developers. If I do not have a MongoDb in my machine I can simply choose to use some other instance in my network.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/06/image-16.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/06/image_thumb-16.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/06/image_thumb-16.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Overriding settings with environment variables.</em></p><p>Noone in the team is affected by this settings, and <strong>everyone has the freedom of changing this value to whatever he/she like</strong>. This is important because you can have different version of MongoDb installed in your network, with various different configuration (MMapV1 or Wired Tiger) and you want the freedom to choose the instance you want to use.</p><p>Another interesting aspect of Environment variables, is that <strong>they can be set during a VSTS/TFS build directly from build definition</strong>. This is possible because Variables defined for a build were set as environment variables when the build runs.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/08/image.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/08/image_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/08/image_thumb.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Specifing environment variables directly from Variables tab of a bulid</em></p><p>If you allow this value to be allowed at Queue Time, you can set the value when you manually queue a build.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/08/image-1.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/08/image_thumb-1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/08/image_thumb-1.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Specifying variables value at Queue Time</em></p><p>If you look at Figure 3, you can verify that I’m able to change the value at queue time, but also, I can simply press “Add variable” to add any variable, even if it is not included in build definition. In this specific situation I can trigger a build and have my tests run against a specific MongoDb instance.</p><p>Remember that the value specified in the build definition <strong>overrides any value that is set on environment variables on build machine.</strong> This imply that, once you set a value in the Build definition, you are not able to change the value for a specific build agent.</p><p>It you want to be able to choose a different value for each build agent machine you can simply avoid setting the value on the Variables tab and instead define the variable on each build machine to have a different value for each agent. Another alternate approach is using two Environment variables, Es: TEST_MONGODB and TEST_MONGODB_OVERRIDE, and configure your tests to use TEST_MONGODB_OVERRIDE if present, if not present use TEST_MONGODB. This allows you to use TEST_MONGODB on build definition, but if you set TEST_MONGODB_OVERRIDE for a specific test agent, that agent will use that value.</p><p><strong>Another interesting aspect of Environment Variable is that they are included in agent capabilities, as you can see</strong> from Figure 4.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/06/SNAGHTMLd39383.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/06/SNAGHTMLd39383_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/06/SNAGHTMLd39383_thumb.png alt=SNAGHTMLd39383></a></a></p><p><em><strong>Figure 4</strong></em>: <em>All environment variables are part of agent Capabilities</em></p><p>This is an important aspect because if you want that variable to be set in the agent, you can avoid to include in Variables tab, and <strong>you can require this build to be run on an agent that has TEST_MONGODB environment variable specified</strong>.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/06/image-18.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/06/image_thumb-18.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/06/image_thumb-18.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Add a demand for a specific Environment Variable to be defined in Agent Machine</em></p><p>Setting the demands is not always necessary, in my example if the TEST_MONGODB variable is not definied, tests are executed against local MongDb instance. It is always a good strategy to use a reasonable default if some setting is not present in Environment Variables.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/build/>build</a>, <a class=tag href=/tags/testing/>Testing</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2016/07/scale-out-deployment-error-when-migrating-reporting-services/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Scale out deployment error when migrating Reporting Services</a></div><div class="next-entry sep-before"><a href=/post/old/2016/08/upgrading-sonarqube-from-5-1-to-6-0/><span class=screen-reader-text>Next post: </span>Upgrading SonarQube from 51 to 60<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>