<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Scenario: you have a repository in Git, both open source or in private repository and you want to keep a synchronized mirror in VSTS / TFS.
 There are some legitimate reason to have a mirrored repository between Github or some external provider and an instance of VSTS / TFS, probably the most common one is keeping all development of a repository private and publish in open source only certain branches."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Keep Git repository in sync between VSTS  TFS and Git • Codewrecks"><meta property="og:description" content="Scenario: you have a repository in Git, both open source or in private repository and you want to keep a synchronized mirror in VSTS / TFS.
 There are some legitimate reason to have a mirrored repository between Github or some external provider and an instance of VSTS / TFS, probably the most common one is keeping all development of a repository private and publish in open source only certain branches."><meta property="og:url" content="https://www.codewrecks.com/post/old/2016/10/keep-git-repository-in-sync-between-vsts-tfs-and-git/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Git"><meta property="article:tag" content="VSTS"><meta property="article:published_time" content="2016-10-22T08:00:37+02:00"><meta property="article:modified_time" content="2016-10-22T08:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Keep Git repository in sync between VSTS TFS and Git • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2016/10/keep-git-repository-in-sync-between-vsts-tfs-and-git/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Keep Git repository in sync between VSTS TFS and Git</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Keep Git repository in sync between VSTS TFS and Git</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2016-10-22T08:00:37+02:00>2016, Oct 22</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><blockquote><p>Scenario: you have a repository in Git, both open source or in private repository and you want to keep a synchronized mirror in VSTS / TFS.</p></blockquote><p>There are some legitimate reason to have a mirrored repository between Github or some external provider and an instance of VSTS / TFS, probably the most common one is <strong>keeping all development of a repository private and publish in open source only certain branches.</strong> Another reason is having all the code in Github completely in open source, but internally use VSTS Work Item to manage work with all the advanced tooling VSTS has to offer.</p><p>The solution to this problem is really simple, <strong>just use a build in VSTS that push new commits from GitHub to VSTS or the opposite.</strong> Lets suppose that you have a GitHub repository and you want it to be mirrored in VSTS.</p><h4 id=heading></h4><h2 id=step-1--install-extension-to-manipulate-variables>Step 1 – install extension to manipulate variables</h2><p>Before creating the build you should install <a href="https://marketplace.visualstudio.com/items?itemName=jessehouwing.jessehouwing-vsts-variable-tasks">Variable Toolbox</a> extension from the marketplace. This extension allows you to manipulate build variable and it is necessary if you use GitFlow.</p><p>From the <a href=https://www.visualstudio.com/ru-RU/docs/build/define/variables#predefined-variables>list of Build Variables available in the build system</a> there are two variables that contains information about the branch that is to be build. They are  called Build.SourceBranch and Build.SourceBranchName, but noone of them contains the real name of the branch. <strong>The SourceBranch contains the full name refs/heads/branchname while SourceBranchName contains the last path segment in the ref.</strong> If you use gitflow and have a branch called hotfix/1.2.3 the full name of the branch is refs/heads/hotfix/1.2.3 and the variable SourceBranchName contains the value 1.2.3 …. not really useful.</p><p>Thanks to the Variable Toolbox Extension you can simple configure the task to replace the refs/heads part with null string, so you can have a simple way to have a variable that contains the real name of the build even if it contains a slash character.</p><h2 id=step-2--configure-the-build>Step 2 – configure the build</h2><p>The entire build is composed by three simple task, the very first is a Transform Value task (from <a href="https://marketplace.visualstudio.com/items?itemName=jessehouwing.jessehouwing-vsts-variable-tasks">Variable Toolbox</a> ) followed by two simple command line.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/SNAGHTML3a85c0.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/SNAGHTML3a85c0_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/SNAGHTML3a85c0_thumb.png alt=SNAGHTML3a85c0></a></a></p><p><em><strong>Figure 1</strong></em>: <em>The entire build is three simple tasks.</em></p><p><strong>The first task is used to remove the refs/heads/ part from the $(Build.SourceBranch) and copy the result to the GitBranchName variable</strong> (you should have it defined in the variables tab).</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image-13.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-13.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-13.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Transformation variable configured to remove refs/heads</em></p><p>Now we need a first command line task that checkout the directory, because the build does not issue a checkout in git, but it simple works in detatched HEAD.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image-14.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-14.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-14.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Checkout git through commandline</em></p><p>As you can see in Figure 3 this operation is really simple,**you can invoke git in command line, issuing the command <em>checkout $(GitBranchName)</em> created in precedent step, finally you should specify that this command should be executed in $(Build.SourcesDirectory) **.</p><p>The last command line pushes the branch to a local VSTS Repository.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image-15.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-15.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-15.png alt=image></a></a>** Figure 4: ***Git command line to push everything on VSTS*</p><p>The configuration is really simple, I decided to push to address <a href=https://$%28token%29@myaddress.visualstudio.com>https://$(token)@myaddress.visualstudio.com</a>. Token variable (2) is a custom secret variable where I store a valid Personal Access Token that has right to access the code. To push on remote repository the syntax $(GitBranchName):$(GitBranchName) to push local branch on remote repository with –force option to allow forcing the push.</p><p>Do not forget to make your token variable as a secret variable and configure the continuous integration to keep syncronized only the branch you are interested to.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image-16.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-16.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-16.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Configure branches you want to keep syncronized</em></p><p>If you need also to keep tags syncronized between builds you can just add another command line git invokation that pushes all tags with the push –tags option.</p><h2 id=the-result>The result</h2><blockquote><p>Thanks to this simple build, whenever we push something on GitHub, a build starts that automatically replicate that branch in VSTS without any user intervention.</p></blockquote><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image-17.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-17.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2016/10/image_thumb-17.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Build result that shows command line in action during a build.</em></p><p>Thanks to the free build minutes on the hosted build, we have a complete copy in VSTS of a GitHub repository with automatic sync running in few minutes.</p><p><strong>The very same configuration can be reversed to automatically push to GitHub some branches of your VSTS account</strong> , useful if you want to publish only some branches in open source, automatically.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/git/>Git</a>, <a class=tag href=/tags/vsts/>VSTS</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2016/10/re-indexing-source-in-tfs-15-preview/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Re-indexing source in TFS '15' preview</a></div><div class="next-entry sep-before"><a href=/post/old/2016/11/bulk-insert-in-mongodb-with-c-driver/><span class=screen-reader-text>Next post: </span>Bulk insert in MongoDb with C driver<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>