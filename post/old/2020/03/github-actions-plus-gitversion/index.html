<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="One of the nice aspect of GitHub actions is that you can automate stuff simply with command line tools. If you want to do continuous release of your software and you want to use GitVersion tool to determine a unique SemVer version from the history, here is the sequence of steps.
 Iinstall/update gitversion tool with commandline tools Run GitVersio to determine SemVer numbers Issue a standard build/test using SemVerNumbers of step 2 If tests are ok, use dotnet publish command (with SemVer numbers) to publish software Zip and upload publish result It the branch is Master publish a GitHub release of your software."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Release software with GitHub actions and GitVersion • Codewrecks"><meta property="og:description" content="One of the nice aspect of GitHub actions is that you can automate stuff simply with command line tools. If you want to do continuous release of your software and you want to use GitVersion tool to determine a unique SemVer version from the history, here is the sequence of steps.
 Iinstall/update gitversion tool with commandline tools Run GitVersio to determine SemVer numbers Issue a standard build/test using SemVerNumbers of step 2 If tests are ok, use dotnet publish command (with SemVer numbers) to publish software Zip and upload publish result It the branch is Master publish a GitHub release of your software."><meta property="og:url" content="https://www.codewrecks.com/post/old/2020/03/github-actions-plus-gitversion/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="General"><meta property="article:published_time" content="2020-03-22T10:00:37+02:00"><meta property="article:modified_time" content="2020-03-22T10:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Release software with GitHub actions and GitVersion • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2020/03/github-actions-plus-gitversion/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Release software with GitHub actions and GitVersion</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Release software with GitHub actions and GitVersion</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2020-03-22T10:00:37+02:00>2020, Mar 22</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>8 mins read</span></div></div></header><div class="container entry-content"><p>One of the nice aspect of GitHub actions is that you can automate stuff simply with command line tools. <strong>If you want to do continuous release of your software and you want to use GitVersion tool to determine a unique SemVer version</strong> from the history, here is the sequence of steps.</p><ol><li>Iinstall/update gitversion tool with commandline tools</li><li>Run GitVersio to determine SemVer numbers</li><li>Issue a standard build/test using SemVerNumbers of step 2</li><li>If tests are ok, use dotnet publish command (with SemVer numbers) to publish software</li><li>Zip and upload publish result</li><li>It the branch is Master publish a GitHub release of your software.</li></ol><blockquote><p>Automating your CI pipeline using only CommandLine tools makes your build not dependent on the Engine you are using.</p></blockquote><p>I’ve done such small exercise on a public project you can found here (<a href=https://github.com/AlkampferOpenSource/StupidFirewallManager title=https://github.com/AlkampferOpenSource/StupidFirewallManager>https://github.com/AlkampferOpenSource/StupidFirewallManager</a>) and it is composed by two command line tools, one is server version the other is the client.</p><p>Complete workflow definition can be found here (<a href=https://github.com/AlkampferOpenSource/StupidFirewallManager/blob/master/.github/workflows/dotnetcore.yml title=https://github.com/AlkampferOpenSource/StupidFirewallManager/blob/master/.github/workflows/dotnetcore.yml>https://github.com/AlkampferOpenSource/StupidFirewallManager/blob/master/.github/workflows/dotnetcore.yml</a>).</p><p>In this example I’m simply using some open source tasks to automate the whole process with GitHub Actions. <strong>The first step is being sure that right version of DotNetCore Sdk is used, and that GitVersion tool is installed.</strong><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    <span style=color:#66d9ef>steps</span>:
    - <span style=color:#66d9ef>uses</span>: actions/checkout@v1
    - <span style=color:#66d9ef>name</span>: Fetch all history for all tags and branches
      <span style=color:#66d9ef>run</span>: git fetch --prune
    - <span style=color:#66d9ef>name</span>: Setup.NET Core
      <span style=color:#66d9ef>uses</span>: actions/setup-dotnet@v1
      <span style=color:#66d9ef>with</span>:
        <span style=color:#66d9ef>dotnet-version</span>: <span style=color:#e6db74>&#39;5.0.100-preview.1.20155.7&#39;</span>  

    - <span style=color:#66d9ef>name</span>: Install GitVersion
      <span style=color:#66d9ef>uses</span>: gittools/actions/gitversion/setup@v0<span style=color:#ae81ff>.9</span>
      <span style=color:#66d9ef>with</span>:
          <span style=color:#66d9ef>versionSpec</span>: <span style=color:#e6db74>&#39;5.1.x&#39;</span></code></pre></td></tr></table></div></div></p><p>The cool part is that I do not need to have anything preinstalled on the machine that runs the action, everything will be downloaded and installed by action definition. In this specific example my software is build with a pre-release of.NET Sdk (5.0.100-preview), a tooling that probably is not preinstalled in the action machine, but thanks to the capability of GitHub actions I can simply require installation on the fly before compiling everything.</p><blockquote><p>Being able to install required toolchain directly from Action definition allows you to run your action on public available GitHub agents.</p></blockquote><p>Point 2 is achieved simply running GitVersion tool (installed from point 1) with a dedicated action. <strong>Another cool part of GitHub action is that you can simply refer custom action directly from your definition, no need to install anything.</strong><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#66d9ef>name</span>: Use GitVersion
      <span style=color:#66d9ef>id</span>: gitversion <span style=color:#75715e># step id used as reference for output values</span>
      <span style=color:#66d9ef>uses</span>: gittools/actions/gitversion/execute@v0<span style=color:#ae81ff>.9</span>
    - <span style=color:#66d9ef>run</span>: <span style=color:#e6db74>|
</span><span style=color:#e6db74>        echo &#34;Major: ${{ steps.gitversion.outputs.major }}&#34;</span>
        echo <span style=color:#e6db74>&#34;Minor: ${{ steps.gitversion.outputs.minor }}&#34;</span>
        echo <span style=color:#e6db74>&#34;Patch: ${{ steps.gitversion.outputs.patch }}&#34;</span>
        echo <span style=color:#e6db74>&#34;PreReleaseTag: ${{ steps.gitversion.outputs.preReleaseTag }}&#34;</span>
        echo <span style=color:#e6db74>&#34;PreReleaseTagWithDash: ${{ steps.gitversion.outputs.preReleaseTagWithDash }}&#34;</span>
        echo <span style=color:#e6db74>&#34;PreReleaseLabel: ${{ steps.gitversion.outputs.preReleaseLabel }}&#34;</span>
        echo <span style=color:#e6db74>&#34;PreReleaseNumber: ${{ steps.gitversion.outputs.preReleaseNumber }}&#34;</span>
        echo <span style=color:#e6db74>&#34;WeightedPreReleaseNumber: ${{ steps.gitversion.outputs.weightedPreReleaseNumber }}&#34;</span>
        echo <span style=color:#e6db74>&#34;BuildMetaData: ${{ steps.gitversion.outputs.buildMetaData }}&#34;</span>
        echo <span style=color:#e6db74>&#34;BuildMetaDataPadded: ${{ steps.gitversion.outputs.buildMetaDataPadded }}&#34;</span>
        echo <span style=color:#e6db74>&#34;FullBuildMetaData: ${{ steps.gitversion.outputs.fullBuildMetaData }}&#34;</span>
        echo <span style=color:#e6db74>&#34;MajorMinorPatch: ${{ steps.gitversion.outputs.majorMinorPatch }}&#34;</span>
        echo <span style=color:#e6db74>&#34;SemVer: ${{ steps.gitversion.outputs.semVer }}&#34;</span>
        echo <span style=color:#e6db74>&#34;LegacySemVer: ${{ steps.gitversion.outputs.legacySemVer }}&#34;</span>
        echo <span style=color:#e6db74>&#34;LegacySemVerPadded: ${{ steps.gitversion.outputs.legacySemVerPadded }}&#34;</span>
        echo <span style=color:#e6db74>&#34;AssemblySemVer: ${{ steps.gitversion.outputs.assemblySemVer }}&#34;</span>
        echo <span style=color:#e6db74>&#34;AssemblySemFileVer: ${{ steps.gitversion.outputs.assemblySemFileVer }}&#34;</span>
        echo <span style=color:#e6db74>&#34;FullSemVer: ${{ steps.gitversion.outputs.fullSemVer }}&#34;</span>
        echo <span style=color:#e6db74>&#34;InformationalVersion: ${{ steps.gitversion.outputs.informationalVersion }}&#34;</span>
        echo <span style=color:#e6db74>&#34;BranchName: ${{ steps.gitversion.outputs.branchName }}&#34;</span>
        echo <span style=color:#e6db74>&#34;Sha: ${{ steps.gitversion.outputs.sha }}&#34;</span>
        echo <span style=color:#e6db74>&#34;ShortSha: ${{ steps.gitversion.outputs.shortSha }}&#34;</span>
        echo <span style=color:#e6db74>&#34;NuGetVersionV2: ${{ steps.gitversion.outputs.nuGetVersionV2 }}&#34;</span>
        echo <span style=color:#e6db74>&#34;NuGetVersion: ${{ steps.gitversion.outputs.nuGetVersion }}&#34;</span>
        echo <span style=color:#e6db74>&#34;NuGetPreReleaseTagV2: ${{ steps.gitversion.outputs.nuGetPreReleaseTagV2 }}&#34;</span>
        echo <span style=color:#e6db74>&#34;NuGetPreReleaseTag: ${{ steps.gitversion.outputs.nuGetPreReleaseTag }}&#34;</span>
        echo <span style=color:#e6db74>&#34;VersionSourceSha: ${{ steps.gitversion.outputs.versionSourceSha }}&#34;</span>
        echo <span style=color:#e6db74>&#34;CommitsSinceVersionSource: ${{ steps.gitversion.outputs.commitsSinceVersionSource }}&#34;</span>
        echo <span style=color:#e6db74>&#34;CommitsSinceVersionSourcePadded: ${{ steps.gitversion.outputs.commitsSinceVersionSourcePadded }}&#34;</span>
        echo <span style=color:#e6db74>&#34;CommitDate: ${{ steps.gitversion.outputs.commitDate }}&#34;</span></code></pre></td></tr></table></div></div></p><p>Point 3 requires only a run of dotnet restore followed by a dotnet test, to verify that code compiles and all tests are green.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:#66d9ef>name</span>: Restore nuget with dotnet
      <span style=color:#66d9ef>run</span>: dotnet restore src/StupidFirewallManager.sln
    - <span style=color:#66d9ef>name</span>: dotnet tests
      <span style=color:#66d9ef>run</span>: dotnet test src/StupidFirewallManager.sln /p:AssemblyVersion=${{ steps.gitversion.outputs.assemblySemFileVer }} /p:FileVersion=${{ steps.gitversion.outputs.assemblySemFileVer }} /p:InformationalVersion=${{ steps.gitversion.outputs.Sha }}</code></pre></td></tr></table></div></div><p>A special mention is made to dotnet test parameters, where I <strong>specified AssemblyVersion, FileVersion and InformationalVersion directly from command line, using the SemVer number of GitVersion as assembly and file version, but full SHA for informational version.</strong> You have various method to choose version number of the software during build phase, <strong>with full Framework you are forced to modify attributes in AssemblyInfo.cs (or AssemblyInfo.vb) before issuing the build.</strong> That options is available in GitVersion with UpdateAssemblyInfo options, but it is really clumsy because it does not gave you the ability to <a href=https://gitversion.readthedocs.io/en/latest/input/docs/usage/command-line/>choose exactly what number goes in InformationalVersion</a>, that, in my opinion, is most important of all the three. This is why in the past I’ve always use a PowerShell version to update AssemblyInfo.cs.</p><p>To be fair, GitVersion does an excellent work in updating AssemblyInfo.cs, but I’ve found a couple of problems, the first is that it actually only Updates the attributes, so you should not forget to insert an AssemblyInformationalVersion in your source code. The second problem is that <strong>it uses a too long name for that value, something like 0.5.0-alpha.11+Branch.develop.Sha.21fa38932256d7b64661e6363982dda39eb48b23. While it contains the Sha of the repository, that in my opinion is the most important value, it should be at first position of the string</strong> , due to limiting space you have when you look at file property in windows ( <strong>Figure 5</strong> ).</p><blockquote><p>Using full Git Sha as informational version gives you the exact version of the code used to produce that artifacts. No way to alter the code and have the same Git Sha makes that number really important and usually it is the only information you need as Informational Version.</p></blockquote><p>Points 4 and 5 are a simple set of Publish/compress/upload artifacts steps, made easy by the presence of 7zip in all machines (thanks <a href=http://blog.casavian.eu/>Giulio</a> for pointing me in the right direction).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:#66d9ef>name</span>: dotnet publish server
      <span style=color:#66d9ef>run</span>: dotnet publish src/StupidFirewallManager/StupidFirewallManager.csproj --configuration release /p:AssemblyVersion=${{ steps.gitversion.outputs.assemblySemFileVer }} /p:FileVersion=${{ steps.gitversion.outputs.assemblySemFileVer }} /p:InformationalVersion=${{ steps.gitversion.outputs.Sha }}

    - <span style=color:#66d9ef>name</span>: dotnet publish client
      <span style=color:#66d9ef>run</span>: dotnet publish src/StupidFirewallManager.Client/StupidFirewallManager.Client.csproj --configuration release /p:AssemblyVersion=${{ steps.gitversion.outputs.assemblySemFileVer }} /p:FileVersion=${{ steps.gitversion.outputs.assemblySemFileVer }} /p:InformationalVersion=${{ steps.gitversion.outputs.Sha }}
    - <span style=color:#66d9ef>name</span>: 7Zip client
      <span style=color:#66d9ef>run</span>: 7z a -t7z -mx=<span style=color:#ae81ff>9</span> client.7z./src/StupidFirewallManager.Client/bin/release/netcoreapp5<span style=color:#ae81ff>.0</span>/publish/
    - <span style=color:#66d9ef>name</span>: 7Zip server
      <span style=color:#66d9ef>run</span>: 7z a -t7z -mx=<span style=color:#ae81ff>9</span> server.7z./src/StupidFirewallManager/bin/release/netcoreapp5<span style=color:#ae81ff>.0</span>/publish/

    - <span style=color:#66d9ef>uses</span>: actions/upload-artifact@v1
      <span style=color:#66d9ef>with</span>:
        <span style=color:#66d9ef>name</span>: <span style=color:#e6db74>&#34;StupidFirewallManagerServer-${{ steps.gitversion.outputs.fullSemVer }}&#34;</span>
        <span style=color:#66d9ef>path</span>: server.7z

    - <span style=color:#66d9ef>uses</span>: actions/upload-artifact@v1
      <span style=color:#66d9ef>with</span>:
        <span style=color:#66d9ef>name</span>: <span style=color:#e6db74>&#34;StupidFirewallManagerClient-${{ steps.gitversion.outputs.fullSemVer }}&#34;</span>
        <span style=color:#66d9ef>path</span>: client.7z</code></pre></td></tr></table></div></div><p>I’ve chosen to always create 7zip file with the same name (client.7z and server.7z) but <strong>when it is time to upload to pipeline as artifacts, it is nice to change name and give a full SemVer number.</strong> As you can verify, since we are in.NET Core, I was able to specify Assembly, File and Informational version directly in command line, without any need to have attributes in AssemblyInfo.cs files. An approach that I really like and prefer (no file to search and modify before the build).</p><p>In <strong>Figure 1</strong> you can finally find how the artifacts are named in Action run summary page.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image-24.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image_thumb-24.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image_thumb-24.png alt="Artifacts uploaded by action run, you can notice the full semver."></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Artifacts uploaded by action run, you can notice the full semver.</em></p><p><strong>For final step (release) I’ve chosen to use a custom action to publish file on GitHub release and to automatically create release if no one with that name was created</strong>. I know that there are now official actions (from GitHub team) but this custom action worked perfectly in the past and it is still perfectly working today, so why change.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>    - <span style=color:#66d9ef>name</span>: Upload server binaries to release
      <span style=color:#66d9ef>if</span>: contains(github.ref, <span style=color:#e6db74>&#39;master&#39;</span>)
      <span style=color:#66d9ef>uses</span>: svenstaro/upload-release-action@v1-release
      <span style=color:#66d9ef>with</span>:
        <span style=color:#66d9ef>repo_token</span>: ${{ secrets.GITHUB_TOKEN }}
        <span style=color:#66d9ef>file</span>: server.7z
        <span style=color:#66d9ef>asset_name</span>: Server.7z
        <span style=color:#66d9ef>tag</span>: <span style=color:#e6db74>&#34;${{ steps.gitversion.outputs.fullSemVer }}&#34;</span>
        <span style=color:#66d9ef>overwrite</span>: <span style=color:#66d9ef>true</span>
    - <span style=color:#66d9ef>name</span>: Upload client binaries to release
      <span style=color:#66d9ef>if</span>: contains(github.ref, <span style=color:#e6db74>&#39;master&#39;</span>)
      <span style=color:#66d9ef>uses</span>: svenstaro/upload-release-action@v1-release
      <span style=color:#66d9ef>with</span>:
        <span style=color:#66d9ef>repo_token</span>: ${{ secrets.GITHUB_TOKEN }}
        <span style=color:#66d9ef>file</span>: client.7z
        <span style=color:#66d9ef>asset_name</span>: Client.7z
        <span style=color:#66d9ef>tag</span>: <span style=color:#e6db74>&#34;${{ steps.gitversion.outputs.fullSemVer }}&#34;</span>
        <span style=color:#66d9ef>overwrite</span>: <span style=color:#66d9ef>true</span></code></pre></td></tr></table></div></div><p>The only peculiarity of these two steps <strong>is the if clause, that allows me to ask Action engine to run this step only if the the ref is master</strong>. If you look at execution steps of a branch different from master, those two steps are not executed.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image3.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image3_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image3_thumb.png alt="Action ran on branch different from master, upload release steps are skipped"></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Action ran on branch different from master, upload release steps are skipped</em></p><p>If you instead look at logs from an execution of master branch, the two steps are executed. As usual the name of the release is taken from SemVer numbers returned by GitVersion.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image6.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image6_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image6_thumb.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Publish artifacts to a standard GitHub release output</em></p><p>After the action ran on master, you should see a brand new release of your Repository, containing not only source code, but also published artifacts. As you can see, <strong>I’ve decided to upload artifacts with current name (server.7z and client.7z) because number was already present in Release Number</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image9.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image9_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image9_thumb.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Release created by action run for branch master.</em></p><blockquote><p>You can choose to release whatever branch you like, usually you release hotfix, release and master branch, but you can always grab the artifacts directly from action run output, so I’ve opted to create a real release only from master and stable version.</p></blockquote><p>As final check you should download the release and <strong>verify that AssemblyVersion, FileVersion and InformationalVersion were correctly set in the assembly</strong>. As you can see in <strong>Figure 5</strong> my released software was correctly marked with the correct version.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image12.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image12_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2020/03/image12_thumb.png alt="Versioning of the assembly is present and correct"></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Versioning of the assembly is present and correct</em></p><p>This last check is especially important, not only for software that will be release with Nuget Packages, but also for executable, because <strong>it can immediately tells you the exact version and the exact source code that was used to compile that specific version of the software.</strong> Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/general/>general</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/general/>General</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2020/03/one-team-project-to-rule-them-all/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>One Team Project to rule them all</a></div><div class="next-entry sep-before"><a href=/post/old/2020/03/strange-error-disallow-my-net-core-application-to-start/><span class=screen-reader-text>Next post: </span>Strange error disallow my NET core application to start<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>