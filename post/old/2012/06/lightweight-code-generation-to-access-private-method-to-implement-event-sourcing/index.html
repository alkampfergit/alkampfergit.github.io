<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I like really much to play with Expression Tree or Dynamic Code Generation, a couple of techniques useful to do fast reflection, to maintain all the coolness of reflection (Es. invoking non public members) but without incurring in the penalties of calling methods through pure reflection calls. There are really good libraries around the web, like FastReflect that internally uses the power of LCG to invoke private methods, but the main question is: why you should be use such a dirty technique ?"><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Lightweight code generation to access private method to implement Event Sourcing • Codewrecks"><meta property="og:description" content="I like really much to play with Expression Tree or Dynamic Code Generation, a couple of techniques useful to do fast reflection, to maintain all the coolness of reflection (Es. invoking non public members) but without incurring in the penalties of calling methods through pure reflection calls. There are really good libraries around the web, like FastReflect that internally uses the power of LCG to invoke private methods, but the main question is: why you should be use such a dirty technique ?"><meta property="og:url" content="https://www.codewrecks.com/post/old/2012/06/lightweight-code-generation-to-access-private-method-to-implement-event-sourcing/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="DDD"><meta property="article:published_time" content="2012-06-04T15:00:37+02:00"><meta property="article:modified_time" content="2012-06-04T15:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Lightweight code generation to access private method to implement Event Sourcing • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2012/06/lightweight-code-generation-to-access-private-method-to-implement-event-sourcing/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Lightweight code generation to access private method to implement Event Sourcing</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Lightweight code generation to access private method to implement Event Sourcing</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2012-06-04T15:00:37+02:00>2012, Jun 04</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>5 mins read</span></div></div></header><div class="container entry-content"><p>I like really much to play with <a href=http://www.codewrecks.com/blog/index.php/2008/10/09/again-on-expression-tree-vs-reflection/>Expression Tree or Dynamic Code Generation</a>, a couple of techniques useful to do fast reflection, to maintain all the coolness of reflection (Es. invoking non public members) but without incurring in the penalties of calling methods through pure reflection calls. There are really good libraries around the web, like <a href=http://fasterflect.codeplex.com/>FastReflect</a> that internally uses the power of LCG to invoke private methods, but the main question is: <strong>why you should be use such a dirty technique</strong> ?? After all <em>if a method is Non Public the declaring type probably has lots of reason for having it declared this way and it is not a good practice to break this rule</em>. So lets see a scenario where such functionality can be useful.</p><p>If you download and have a look at <a href=http://codebetter.com/gregyoung/>Greg Young</a>’s <a href=https://github.com/gregoryyoung/m-r>example on CQRS called m-r</a> you can find that the AggregateRoot base class actually exposes an ApplyChange method defined in this way.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> ApplyChange(Event @event, <span style=color:#66d9ef>bool</span> isNew)
{
    <span style=color:#66d9ef>this</span>.AsDynamic().Apply(@event);
    <span style=color:#66d9ef>if</span>(isNew) _changes.Add(@event);
}
</code></pre></td></tr></table></div></div><p>Basically the AsDynamic() is an extension <a href=http://blogs.msdn.com/b/davidebb/archive/2010/01/18/use-c-4-0-dynamic-to-drastically-simplify-your-private-reflection-code.aspx>taken from this article</a> that shows how to create a simple library to call private method with dynamic syntax and is used by the AggregateRoot class to call the right Apply method defined by child class that will change the status <a href=http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/>accordingly to the EVENT SOURCING</a> pattern. <strong>Event Sourcing is a pattern where change of the status of a domain entity is driven by a DOMAIN EVENT and whenever an entity raise a DOMAIN EVENT the eventual change of internal status happens only in a method that is able to elaborate the event that was raised</strong>.</p><p>Here is an example, in an hypothetical Character class of a role playing game, we have these methods defined inside the Character class.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> Apply(CharacteristicAugmented domainEvent)
{
  ...
}

<span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> Apply(CharacteristicAugmentBlocked domainEvent)
{
  ...
}
</code></pre></td></tr></table></div></div><p>When I call a method of Character class and some Domain Rules were violated, one of his characteristic will be blocked and cannot be augmented anymore, so <strong>the object raises a CharacteristicAugmentBlocked event through a specific method of the AggregateRoot base class</strong> , that in turns should call the right Apply method that finally will change the status of the object. The key aspect is that the internal change of status is made in the correct Apply method, this means that in the future, if we want to reconstruct the status of an entity, we can simply ask them to reapply all the domain events he raised in the past.</p><p><strong>Those two methods are non public because they should not be called from external code, but only from the base class AggregateRoot</strong>. The situation is the following, the AggregateRoot class has this method.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>void</span> ApplyHistory(IEnumerable&lt;DomainEvent&gt; listOfEvents)
{
    <span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> domainEvent <span style=color:#66d9ef>in</span> listOfEvents)
    {
        applyInvokers.Invoke(<span style=color:#66d9ef>this</span>, domainEvent);
    }
}
</code></pre></td></tr></table></div></div><p>Each class should have the ability to reconstruct the internal status from the list of events he raised in the past, but since this code is implemented in the base AggregateRoot class, he cannot be aware of the real method to call for each derived class, so you need to use reflection and Convention Over Configuration: *each method that is capable of handling should be named <strong>Apply</strong> and he should return void and accepts a single parameter that inherits from <strong>DomainEvent</strong> *. With these rules in mind I can build the ApplyInvokers class (this version is not thread safe, it serves only demo purpose).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LcgApplyInvoker</span> : IApplyInvoker
{
    <span style=color:#75715e>/// &lt;summary&gt;
</span><span style=color:#75715e></span>    <span style=color:#75715e>/// Cache of appliers, for each domain object I have a dictionary of actions
</span><span style=color:#75715e></span>    <span style=color:#75715e>/// &lt;/summary&gt;
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> Dictionary&lt;Type, Dictionary&lt;Type, Action&lt;Object, Object&gt;&gt;&gt; lcgCache = 
        <span style=color:#66d9ef>new</span> Dictionary&lt;Type, Dictionary&lt;Type, Action&lt;Object, Object&gt;&gt;&gt;();

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ObjectApplier</span>
    {

        <span style=color:#66d9ef>private</span> Dictionary&lt;Type, RuntimeMethodHandle&gt; appliers =
            <span style=color:#66d9ef>new</span> Dictionary&lt;Type, RuntimeMethodHandle&gt;();
    }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Invoke(Object obj, DomainEvent domainEvent)
    {
        <span style=color:#66d9ef>if</span> (!lcgCache.ContainsKey(obj.GetType()))
        {
            <span style=color:#66d9ef>var</span> typeCache = <span style=color:#66d9ef>new</span> Dictionary&lt;Type, Action&lt;Object, Object&gt;&gt;(); 

            <span style=color:#66d9ef>var</span> applyMethods = obj.GetType().GetMethods(
                BindingFlags.NonPublic |
                BindingFlags.Instance);

            <span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> item <span style=color:#66d9ef>in</span> applyMethods
               .Where(am =&gt; am.Name.Equals(<span style=color:#e6db74>&#34;apply&#34;</span>, StringComparison.OrdinalIgnoreCase))
               .Select(am =&gt; <span style=color:#66d9ef>new</span> { parameters = am.GetParameters(), minfo = am })
               .Where(p =&gt; p.parameters.Length == <span style=color:#ae81ff>1</span> &amp;&amp;
                    <span style=color:#66d9ef>typeof</span>(DomainEvent).IsAssignableFrom(p.parameters[<span style=color:#ae81ff>0</span>].ParameterType)))
            {
                <span style=color:#66d9ef>var</span> localItem = item;
                Action&lt;Object, Object&gt; applier = ReflectionExtension.ReflectAction(obj.GetType(), item.minfo);
                typeCache[localItem.parameters[<span style=color:#ae81ff>0</span>].ParameterType] = applier;
            }
            lcgCache[obj.GetType()] = typeCache;
        }
        <span style=color:#66d9ef>var</span> thisTypeCache = lcgCache[obj.GetType()];
        Action&lt;Object, Object&gt; invoker;
        <span style=color:#66d9ef>if</span> (thisTypeCache.TryGetValue(domainEvent.GetType(), <span style=color:#66d9ef>out</span> invoker)) {
            invoker(obj, domainEvent);
        }
    }
}
</code></pre></td></tr></table></div></div><p>This class is composed of a primary dictionary where, for each type (domain object type), it stores another dictionary that in turn, for each type of concrete DomainEvent (domain event type), contains an Action&lt;Object, Object> to invoke dynamically the relative apply method of the right type of domain object that is capable to handle that domain object. The only strange part of this class is the ReflectionExtension class, that is used to create a DynamicMethod to access the right apply code given a MethodInfo. Basically <strong>for each type of domain object I search with reflection all Apply methods that satisfy the convention and create a fast invoker to call it in the future</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> Action&lt;Object, Object&gt; ReflectAction(Type objType, MethodInfo methodinfo)
{

    DynamicMethod retmethod = <span style=color:#66d9ef>new</span> DynamicMethod(
        <span style=color:#e6db74>&#34;Invoker&#34;</span> + methodinfo.Name,
        (Type) <span style=color:#66d9ef>null</span>,
        <span style=color:#66d9ef>new</span> Type[] { <span style=color:#66d9ef>typeof</span>(Object), <span style=color:#66d9ef>typeof</span>(Object) },
        objType,
        <span style=color:#66d9ef>true</span>); <span style=color:#75715e>//methodinfo.GetParameters().Single().ParameterType
</span><span style=color:#75715e></span>    ILGenerator ilgen = retmethod.GetILGenerator();
    ilgen.Emit(OpCodes.Ldarg_0);
    ilgen.Emit(OpCodes.Castclass, objType);
    ilgen.Emit(OpCodes.Ldarg_1);
    ilgen.Emit(OpCodes.Callvirt, methodinfo);
    ilgen.Emit(OpCodes.Ret);
    <span style=color:#66d9ef>return</span> (Action&lt;Object, Object&gt;)retmethod.CreateDelegate(<span style=color:#66d9ef>typeof</span>(Action&lt;Object, Object&gt;));
}
</code></pre></td></tr></table></div></div><p>This method uses LCG, it just creates a DynamicMethod that is capable of invoking the method identified by the MethodInfo passed as argument. The key is in the declaration of the DynamicMethod, because I passed true as the last parameter to tell CLR to skip the check visibility because the method I want to call can be non public, and the game is done.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/domain-driven-design/>Domain Driven Design</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/ddd/>DDD</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2012/06/visual-studio-2012-and-tfs-2012-rc-is-finally-out/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Visual Studio 2012 and TFS 2012 RC is finally out</a></div><div class="next-entry sep-before"><a href=/post/old/2012/06/news-in-the-tfs-2012-rc/><span class=screen-reader-text>Next post: </span>News in the TFS 2012 RC<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>