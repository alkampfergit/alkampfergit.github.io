<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Example can be downloaded here . I previously described a scenario where the customer needs a really basic Request Response service in WCF, the goal is being able to take advantage of a request / response structure, but with an approach like: “the simpliest thing that could possibly works”. This technique is usually needed to introduce new architectural concepts in a team without requiring people to learn a huge amount of concepts in a single shot, a scenario that could ends in a team that actively * fight the new architecture because it is too complex *."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Evolving Request Response service to separate contract and business logic • Codewrecks"><meta property="og:description" content="Example can be downloaded here . I previously described a scenario where the customer needs a really basic Request Response service in WCF, the goal is being able to take advantage of a request / response structure, but with an approach like: “the simpliest thing that could possibly works”. This technique is usually needed to introduce new architectural concepts in a team without requiring people to learn a huge amount of concepts in a single shot, a scenario that could ends in a team that actively * fight the new architecture because it is too complex *."><meta property="og:url" content="https://www.codewrecks.com/post/old/2012/04/evolving-request-response-service-to-separate-contract-and-business-logic/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Architecture"><meta property="article:tag" content="MEF"><meta property="article:tag" content="Wcf"><meta property="article:published_time" content="2012-04-23T11:00:37+02:00"><meta property="article:modified_time" content="2012-04-23T11:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Evolving Request Response service to separate contract and business logic • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2012/04/evolving-request-response-service-to-separate-contract-and-business-logic/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Evolving Request Response service to separate contract and business logic</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Evolving Request Response service to separate contract and business logic</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2012-04-23T11:00:37+02:00>2012, Apr 23</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>7 mins read</span></div></div></header><div class="container entry-content"><p>Example <a href=http://www.codewrecks.com/Files/requestresponsemef.zip><strong>can be downloaded here</strong></a> <strong>.</strong> I previously described a scenario where the customer needs a <a href=www.codewrecks.com/blog/index.php/2012/03/12/basic-request-response-wcf-service/>really basic Request Response service in WCF</a>, the goal is being able to take <a href=http://www.codewrecks.com/blog/index.php/2012/04/05/reson-behind-request-responseservice-in-wc/>advantage of a request / response structure</a>, but with an approach like: “<em>the simpliest thing that could possibly works</em>”. This technique is usually needed to <strong>introduce new architectural concepts in a team</strong> without requiring people to learn a huge amount of concepts in a single shot, a scenario that could ends in a  team that actively * <strong>fight the new architecture because it is too complex</strong> *.</p><p>Once the team is used to the basic version of the Request/response service and understand the advantage of this approach, it is time to evolve it towards a more mature implementation, and since the grounding concepts are now clear, <em>adding a little bit of extra complexity</em> is usually a simple step. This is the concept of Evolving Architecture or <a href=http://en.wikipedia.org/wiki/Emergent_Design>Emergent Design</a>, the goal is to introduce functionality and adding extra complexity only <strong>to answer a requirement need and not for the sake of having a Complete/Complex architecture</strong>. After a little bit of usage of the basic version of the Request Response service, some new requirements lead to an improvement of the basic architecture. The very first problem of the actual basic architecture is: * <strong>contract and implementation are contained in the same class</strong> *.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2012/04/image.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2012/04/image_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2012/04/image_thumb.png alt="Class diagram of a sample Request class"></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Class diagram of a sample Request class</em></p><p>In <strong>Figure 1</strong> you can see a sample request, it is called <em>AddTwoNumber</em>and it contains both the contract definition and the business logic that execute the request. <em>This coupling is too high</em> and the new requirement ask to separate contract from the business logic and also <strong>requires to evolve the architecture to make it possible loading contracts and business logic from separate assembly using the concept of</strong> * <strong>Plugin</strong>.*</p><p>This new requirement can be solved easily with MEF, a library that will take care of everything about discovering and loading all <em>request / response / handler</em> objects that compose our service. I started <strong>removing the Execute method from the basic Request class and moving it to another class Called Handler</strong> , that will take care of the execution of a request.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2012/04/image1.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2012/04/image_thumb1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2012/04/image_thumb1.png alt="New version of the base Request and Response classes"></a></a></p><p><em><strong>Figure 2</strong></em>: <em>New version of the base Request and Response classes</em></p><p>As you can see from <strong>Figure 2</strong> Request and Response class are now only just base contract classes, with no method related to execution; they contains only properties. <strong>To execute a request and return a Response we need another class called Handler</strong> , that is capable of *Handling a request and returning a response.*The key concept is that <strong>for each request we have a separate handler that is capable of executing that request</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2012/04/image2.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2012/04/image_thumb2.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2012/04/image_thumb2.png alt=image></a></a></p><p>I decided to introduce a <em>basic abstract class with no generic</em>, <strong>this base class is able to handle a Request object</strong> and then I inherited another abstract class called <em>Handler&lt;T></em>**** **capable of handling a specific type of request** , here is the full code.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#a6e22e>[InheritedExport]</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Handler</span>
{
    <span style=color:#66d9ef>public</span> Response Handle(Request request)
    {
        <span style=color:#66d9ef>return</span> OnHandle(request);
    }
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>abstract</span> Response OnHandle(Request request);
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> Type RequestHandledType();
}
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Handler</span>&lt;T&gt; : Handler <span style=color:#66d9ef>where</span> T : Request
{
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> Response OnHandle(Request request)
    {
        <span style=color:#66d9ef>return</span> HandleRequest((T) request);
    }
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>abstract</span> Response HandleRequest(T request);
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> Type RequestHandledType()
    {
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>typeof</span>(T);
    }
}
</code></pre></td></tr></table></div></div><p>The key point in this structure is: <strong>the base Handler class has MEF Specific</strong> <a href=http://msdn.microsoft.com/en-us/library/ee388321.aspx><strong>InheritedExport</strong></a> <strong>attribute</strong> , that basically <strong>tells to MEF engine to automatically Export all types that inherit from this base type</strong>. The basic Handler class has a <em>RequestHandledType()</em> method to specify the concrete Request class executed by this handler, this permits me to override it in the Handler&lt;T> just returning typeof(T). <strong>The same InheritedExport attribute is then added to Request and Response class</strong> to make them loadable by MEF. The cool part is that everything related to discovering Requests, Responses and Handlers is done by MEF. All MEF functionalities are shielded by a simple MefHelper class.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-as3 data-lang=as3><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> MefHelper
<span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> CompositionContainer theContainer<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> DirectoryCatalog catalog<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>static</span> MefHelper<span style=color:#f92672>()</span>
    <span style=color:#f92672>{</span>
        catalog <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>DirectoryCatalog</span><span style=color:#f92672>(</span>Path<span style=color:#f92672>.</span><span style=color:#a6e22e>GetDirectoryName</span><span style=color:#f92672>(</span>Assembly<span style=color:#f92672>.</span><span style=color:#a6e22e>GetExecutingAssembly</span><span style=color:#f92672>().</span>Location<span style=color:#f92672>));</span>
        theContainer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>CompositionContainer</span><span style=color:#f92672>(</span>catalog<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Compose<span style=color:#f92672>(</span>Object obj<span style=color:#f92672>)</span>
    <span style=color:#f92672>{</span>
        var cb <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>CompositionBatch</span><span style=color:#f92672>();</span>
        cb<span style=color:#f92672>.</span><span style=color:#a6e22e>AddPart</span><span style=color:#f92672>(</span>obj<span style=color:#f92672>);</span>
        theContainer<span style=color:#f92672>.</span><span style=color:#a6e22e>Compose</span><span style=color:#f92672>(</span>cb<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> T Create<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;()</span>
    <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> theContainer<span style=color:#f92672>.</span><span style=color:#a6e22e>GetExportedValue</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;();</span>
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> CoreService CreateService<span style=color:#f92672>()</span>
    <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> Create<span style=color:#f92672>&lt;</span>CoreService<span style=color:#f92672>&gt;();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span></code></pre></td></tr></table></div></div><p>Code is minimal, I simply create a MEF catalog to scan all assemblies that are in the same directory of the executing assembly and a couple of helper methods to simplify composition and exporting value. The <strong>key method here is the CreateService() that internally uses MEF to create a concrete implementation of the CoreService class,</strong> where CoreService is the class that is exposed as a WCF service.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#a6e22e>[Export(typeof(ICoreService))]</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CoreService</span> : ICoreService
{
    <span style=color:#75715e>#region ICoreService Members
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> Dictionary&lt;Type, IList&lt;Handler&gt;&gt; HandlerForTypes = <span style=color:#66d9ef>new</span> Dictionary&lt;Type, IList&lt;Handler&gt;&gt;();
    <span style=color:#66d9ef>private</span> IList&lt;Handler&gt; GetHandlersForType(Type type) {
        <span style=color:#66d9ef>if</span> (!HandlerForTypes.ContainsKey(type)) {
            HandlerForTypes.Add(type, <span style=color:#66d9ef>new</span> List&lt;Handler&gt;());
        }
        <span style=color:#66d9ef>return</span> HandlerForTypes[type];
    }
<span style=color:#a6e22e>    [ImportingConstructor]</span>
    <span style=color:#66d9ef>public</span> CoreService([ImportMany(<span style=color:#66d9ef>typeof</span>(Handler))] IEnumerable&lt;Handler&gt; handlers)
    {
        <span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> handler <span style=color:#66d9ef>in</span> handlers)
        {
            GetHandlersForType(handler.RequestHandledType()).Add(handler);
        }
    }
</code></pre></td></tr></table></div></div><p>CoreService class was modified to use this new architecture, <strong>first of all I added the Export attribute</strong> to tell MEF that this class is an Export for the ICoreService class service, <strong>then I added a simple Dictionary to associate each request with the corresponding handler</strong> and finally <strong>I added a Cosntructor with the <em>ImportingConstructorAttribute</em> and the <em>ImportMany</em> attribute on the single parameter of IEnumerable&lt;Handler></strong>. This specific constructor tells MEF that CoreService class needs the list of all Handlers discovered by MEF and it is the magic attribute that permits you to make MEF scan all dll in the current directory to find every class that inherit Handler basic abstract class. In the constructor there is a simple foreach used to associate each handler to the concrete Request that it is capable to handle, this is accomplished with <em>RequestHandledType()</em> discussed previously.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> Infrastructure.Response Execute(Request request)
{
    <span style=color:#66d9ef>try</span>
    {
        <span style=color:#66d9ef>var</span> handlerList = GetHandlersForType(request.GetType());
        <span style=color:#66d9ef>if</span> (handlerList.Count == <span style=color:#ae81ff>0</span>)
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Response() { IsSuccess = <span style=color:#66d9ef>false</span> };
        <span style=color:#66d9ef>if</span> (handlerList.Count == <span style=color:#ae81ff>1</span>) 
            <span style=color:#66d9ef>return</span> handlerList[<span style=color:#ae81ff>0</span>].Handle(request);
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NotSupportedException();
    }
    <span style=color:#66d9ef>catch</span> (Exception ex)
    {
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Response() { IsSuccess = <span style=color:#66d9ef>false</span>, ErrorMessage = <span style=color:#e6db74>&#34;Exception during execution&#34;</span> };
    }
}
</code></pre></td></tr></table></div></div><p>The execute method is really simple, <em>for each request I verify if an appropriate Handler was available, if I have no handler I return an error, if I have a single Handler I simply use it to execute the Request and finally if I have more than one single Handler I throw an Exception because this is an unsupported scenario for this version</em>. <strong>Thanks to MEF and very few lines of code I was able to evolve the basic structure in a more complex architecture where the CoreService dynamically loads Request/Response/Handlers of the concrete implementation</strong>.</p><p>Now you can take the old <em>AddTwoNumber</em> request from previous example and evolve it to fit this new architecture. The only operation we need to do is removing the Execute() method from the request and move in an appropriate Handler as shown in this simple snippet.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AddTwoNumberHandler</span> : Handler&lt;AddTwoNumberRequest&gt;
{
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> Response HandleRequest(AddTwoNumberRequest request)
    {
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> MathOperationResult(request.FirstAddend + request.SecondAddend);
    }
}
</code></pre></td></tr></table></div></div><p>The code to implement a business operation is really minimal, just inherit from <strong>Handler&lt;AddTwoNumber></strong> override the Handle request and <strong>let the infrastructure takes care of everything else</strong>. A working example <a href=http://www.codewrecks.com/Files/requestresponsemef.zip>can be downloaded here</a> and in future posts I will explain all the other parts of this infrastructure related to MEF and runtime discovering of plugin.</p><p>Gian Maria</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/software-architecture/>Software Architecture</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/architecture/>Architecture</a>, <a class=tag href=/tags/mef/>MEF</a>, <a class=tag href=/tags/wcf/>Wcf</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2012/04/troubleshoot-wcf-exception/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Troubleshoot WCF exception</a></div><div class="next-entry sep-before"><a href=/post/old/2012/04/the-c-project-xxx-is-targeting-net-frameworkprofilefull-which-is-not-installed-on-this-machine-error/><span class=screen-reader-text>Next post: </span>The C project xxx is targeting NET FrameworkhellipProfileFull which is not installed on this machine error<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>