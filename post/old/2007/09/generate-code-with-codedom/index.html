<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Code generators are really useful because they could cut down the time needed to write tedious code. There are a very good code generator called CodeSmith, with an old version that is freeware, but it is possible to generate code with own code with the help of CodeDom. CodeDom namespace contains a lot of classes useful to define code that can be generated in various languages by a specific CodeDomProvider, let’s see an example."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Generate code with CodeDom • Codewrecks"><meta property="og:description" content="Code generators are really useful because they could cut down the time needed to write tedious code. There are a very good code generator called CodeSmith, with an old version that is freeware, but it is possible to generate code with own code with the help of CodeDom. CodeDom namespace contains a lot of classes useful to define code that can be generated in various languages by a specific CodeDomProvider, let’s see an example."><meta property="og:url" content="https://www.codewrecks.com/post/old/2007/09/generate-code-with-codedom/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="NET framework"><meta property="article:published_time" content="2007-09-13T04:00:37+02:00"><meta property="article:modified_time" content="2007-09-13T04:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Generate code with CodeDom • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2007/09/generate-code-with-codedom/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Generate code with CodeDom</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Generate code with CodeDom</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2007-09-13T04:00:37+02:00>2007, Sep 13</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>3 mins read</span></div></div></header><div class="container entry-content"><p>Code generators are really useful because they could cut down the time needed to write tedious code. There are a very good code generator called CodeSmith, with an old version that is freeware, but it is possible to generate code with own code with the help of CodeDom. CodeDom namespace contains a lot of classes useful to define code that can be generated in various languages by a specific CodeDomProvider, let’s see an example.</p><p>classGenerator {</p><p>privateCodeNamespace mNamespace;<br>privateCodeTypeDeclaration mTypeDeclaration;<br>public Generator() {<br>mNamespace = newCodeNamespace(“MyNamespace”);<br>mTypeDeclaration = newCodeTypeDeclaration(“MyClass”);<br>mTypeDeclaration.IsClass = true;<br>mTypeDeclaration.Attributes = MemberAttributes.Public;<br>mNamespace.Types.Add(mTypeDeclaration);<br>}</p><p>I build a simple class called Generator, it contains a CodeNamespace and a CodeTypeDeclaration, in the constructor I create a namespace and then I define a class called MyClass. As you can see the CodeDom namespace provide a way for you to define namespace and classes without worrying of the language that will be used, let’s see how to define a property. First of all the code to generate a private field</p><p>CodeMemberField objReference = newCodeMemberField(typeof(Person), “mRoot”);<br>objReference.Attributes = MemberAttributes.Private;<br>mTypeDeclaration.Members.Add(objReference);</p><p>This is simple code, create a CodeMembertField giving the type of the data (Person is a simple class defined into the same assembly of the generator) and then you can refine the behavior of the field with the Attributes property, specifying that the field is private. Now it is time to create the wrapper property.</p><p>CodeMemberProperty objProps = newCodeMemberProperty();<br>objProps.Name = “Root”;<br>objProps.Type = newCodeTypeReference(typeof(Person));<br>objProps.Attributes = MemberAttributes.Public;<br>objProps.GetStatements.Add(<br>newCodeMethodReturnStatement(<br>newCodeFieldReferenceExpression(<br>newCodeThisReferenceExpression(), “mRoot”)));<br>objProps.SetStatements.Add(<br>newCodeAssignStatement(<br>newCodeFieldReferenceExpression(<br>newCodeThisReferenceExpression(), “mRoot”),<br>newCodePropertySetValueReferenceExpression()));<br>mTypeDeclaration.Members.Add(objProps);</p><p>Now things become more complicated. The major problem working with CodeDom is that the body of the various methods or properties must be written with no language in mind, so there is a lot of code, only to define a simple property. First of all we define a new CodeMemberProperty object, then specify the name and the type of the property and finally we must add the statements into the GetStatements or the SetStatements collection. These collection are special collection that can store object deriving from the base class CodeStatement, a class used to define a statement in.NET. The only instruction for the get part is a simple “return mRoot” in C#, but we need to create a <em>CodeMethodReturnStatement</em> a particular statement that return something. The constructor of this class accept a CodeExpression, in our situation we can simply use a CodeFieldReferenceExpression capable to store the concept of a reference to a field, this class accept two values: the first is a reference to an object, in our case a CodeThisReferenceExpression to specify “this” then we specify the name of the parameter&mldr;whoa&mldr;quite a complex thing only to specify a single statement. The setter part is similar, but is more complex even if in C# we could write “mRoot = value”. We must use a CodeAssignStatement, then the same reference to the mRoot field and finally a CodePropertySetValueReferecenExpression that express the concept of the value part of a setter property.</p><p>At this point someone could really ask itself if codedom is really useful, the real usefulness is this.</p><p>privatevoid GenerateAndDump(CodeDomProvider provider) {<br>StringBuilder sb = newStringBuilder();<br>TextWriter tw = newStringWriter(sb);<br>provider.GenerateCodeFromNamespace(mNamespace, tw, newCodeGeneratorOptions());<br>tw.Close();<br>Console.WriteLine(sb.ToString());<br>}</p><p>This is a simple function that dump to console the namespace build with the preceding code, you can invoke this function in this way.</p><p>GenerateAndDump(newCSharpCodeProvider());<br>GenerateAndDump(newVBCodeProvider());</p><p>This generates code in C# or in Vb from the same definition seen before. Quite an interesting thing for a code generator tool :D.</p><p>Alk.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/net-framework/>NET framework</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/net-framework/>NET framework</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2007/09/how-to-add-reference-to-microsoftvisualstudiodesignerinterfaces/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>How to add reference to MicrosoftVisualStudioDesignerInterfaces</a></div><div class="next-entry sep-before"><a href=/post/old/2007/09/custom-services-failed-to-start-even-if-automatic-start-is-enabled/><span class=screen-reader-text>Next post: </span>Custom services failed to start even if automatic start is enabled<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>