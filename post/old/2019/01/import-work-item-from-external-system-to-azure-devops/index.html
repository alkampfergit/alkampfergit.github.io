<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In previous post I’ve dealt with exporting Work Item information in Word file with AzureDevOps API, now I want to deal with the inverse operation, importing data from external service into Azure DevOps. If the source service is a Team Foundation Server, you can use the really good tool by Naked Agility Ltd you can find in marketplace , you can also have a shot at the official migration tool if you need to migrate an entire collection, but if you have some data to import from an external system, using API can be a viable solution."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Import Work Item from external system to Azure DevOps • Codewrecks"><meta property="og:description" content="In previous post I’ve dealt with exporting Work Item information in Word file with AzureDevOps API, now I want to deal with the inverse operation, importing data from external service into Azure DevOps. If the source service is a Team Foundation Server, you can use the really good tool by Naked Agility Ltd you can find in marketplace , you can also have a shot at the official migration tool if you need to migrate an entire collection, but if you have some data to import from an external system, using API can be a viable solution."><meta property="og:url" content="https://www.codewrecks.com/post/old/2019/01/import-work-item-from-external-system-to-azure-devops/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="General"><meta property="article:published_time" content="2019-01-19T15:00:37+02:00"><meta property="article:modified_time" content="2019-01-19T15:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Import Work Item from external system to Azure DevOps • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2019/01/import-work-item-from-external-system-to-azure-devops/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Import Work Item from external system to Azure DevOps</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Import Work Item from external system to Azure DevOps</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2019-01-19T15:00:37+02:00>2019, Jan 19</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>10 mins read</span></div></div></header><div class="container entry-content"><p>In previous post I’ve dealt with <a href=http://www.codewrecks.com/blog/index.php/2018/12/31/create-word-document-from-work-items/>exporting Work Item information in Word file with AzureDevOps API</a>, now I want to deal with the inverse operation, <strong>importing data from external service into Azure DevOps.</strong> <strong>If the source service is a Team Foundation Server,</strong> <a href="https://marketplace.visualstudio.com/items?itemName=nkdagility.vsts-sync-migration"><strong>you can use the really good tool by Naked Agility Ltd you can find in marketplace</strong></a> <strong>,</strong> you can also have a shot at the <a href=https://azure.microsoft.com/en-us/services/devops/migrate/>official migration tool</a> if you need to migrate an entire collection, but if you have some data to import from an external system, using API can be a viable solution.</p><p>I’ve created a simple <a href=https://github.com/alkampfergit/AzureDevOpsPlayground>project in Github</a> to demonstrate basic usage of API to import data into Azure DevOps (both server and online version), where I’m dealing only with the Azure DevOps parts, <strong>leaving to the user the burden to implement code to extract data from source system</strong>.</p><blockquote><p>If you need to import data to a System, it is better not to assume where the data is coming from. Having only to deal with the import part, you leave the options to other to do the work of getting data from the source server.</p></blockquote><p><strong>The code uses a MigrationItem class to store all the information we support to migrate data to Azure DevOps,</strong> this class contains only a string field to identify the unique id in the source system, as well as the work item type to create. Then it contains a list of MigrationItemVersion that will represent the content of the data in the original system during the time. In this proof of concept I support only Title description and the date of the modification. T <strong>his structure is needed because I want to migrate full history from the original system, not only the snapshot of latest version, so I need to know how the original data was during the time.</strong><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MigrationItem</span>
{
    <span style=color:#66d9ef>public</span> MigrationItem()
    {
        _versions = <span style=color:#66d9ef>new</span> List&lt;MigrationItemVersion&gt;();
    }

    <span style=color:#75715e>/// &lt;summary&gt;
</span><span style=color:#75715e></span>    <span style=color:#75715e>/// This is the original Id of original system to keep track of what was already
</span><span style=color:#75715e></span>    <span style=color:#75715e>/// imported.
</span><span style=color:#75715e></span>    <span style=color:#75715e>/// &lt;/summary&gt;
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> String OriginalId { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }

    <span style=color:#75715e>/// &lt;summary&gt;
</span><span style=color:#75715e></span>    <span style=color:#75715e>/// You need to specify type of workitem to be used during import.
</span><span style=color:#75715e></span>    <span style=color:#75715e>/// &lt;/summary&gt;
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> String WorkItemDestinationType { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> List&lt;MigrationItemVersion&gt; _versions;
</code></pre></td></tr></table></div></div></p><p>To make this code run you need to do a couple of thing, first of all you need to create a customized process from one of the three base process and add at least one text field to store the original id.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image-6.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-6.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-6.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Adding a custom field to store the original id of  imported work item</em></p><p><strong>This field is really important, because will help the user to correlate Imported Work Item to data in the original system,</strong> thus allowing import tool to identify created work Item to fix or re-import some of the Work Items.</p><blockquote><p>Whenever you import or move data between systems, at least you need to have a unique identifier of data in the original system to be stored into the imported Work Item.</p></blockquote><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image-7.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-7.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-7.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Custom original id on a imported Work Item.</em></p><p>As you can see in <strong>Figure 2</strong> this information is readonly, because it is used only by the importer and should never be changed by a Human, you can obtain this with a simple Work Item rule.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image-8.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-8.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-8.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Make OriginalId field Readonly</em></p><p>This will allow me to avoid users to mess and change this number. You can appreciate how easy it is to modify the template and create new fields and rules on Azure DevOps.</p><blockquote><p>Thanks to process inheritance, it is really simple to modify the process in Azure DevOps adding information specific to own process, like the id of original item in case of an import.</p></blockquote><p><strong>Now that everything is in place you need to add the user that is performing the import</strong> <a href=http://www.codewrecks.com/blog/index.php/2015/10/07/how-to-add-a-user-to-project-collection-service-account-in-tfs-vso/><strong>as member of Project Collection Service Account</strong></a> <strong>,</strong> this specific group will allow the user to perform action on behalf of other. This is a very special permission, but you should use it if you want to perform a migration with high fidelity.</p><p>Once migration is finished, you can remove the user from the Project Collection Service Account and restore it to standard permission. Remember, since the sample project uses Access token to authenticate, be sure that the user that generated the token is a member of Project Collection Service Account group before running the test migration tool.</p><blockquote><p>Being part of Project Collection Service Account allows a user to impersonate others as well as bypass some of the validation rules for the Work Item. This is needed to perform a change to Work Item in the past and on behalf of other user.</p></blockquote><p>Now it came the code part, that, thanks to Azure Devops API it is really simple. I do not descend into details of connection and interaction, because it was something I already discussed <a href=http://www.codewrecks.com/blog/index.php/2018/12/31/create-word-document-from-work-items/>in another post</a>, this time I’m interested in <strong>how I can create a new Work Item and save multiple versions of it to recreate the history.</strong><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;Boolean&gt; ImportWorkItemAsync(MigrationItem itemToMigrate)
{
    <span style=color:#66d9ef>var</span> existingWorkItem = GetWorkItem(itemToMigrate.OriginalId);
    <span style=color:#66d9ef>if</span> (existingWorkItem != <span style=color:#66d9ef>null</span>)
    {
        Log.Information(<span style=color:#e6db74>&#34;A workitem with originalId {originalId} already exists, it will be deleted&#34;</span>, itemToMigrate.OriginalId);
        connection.WorkItemStore.DestroyWorkItems(<span style=color:#66d9ef>new</span>[] { existingWorkItem.Id });
    }
</code></pre></td></tr></table></div></div></p><p>The core method is the ImportWorkItemAsync, that takes a MigrationItem to create the new work item. <strong>In the very first line I simply look for a work item that was already bound to that external item, if it is present I simply destroy it.</strong> This approach is radical, but it allows me to issue multiple test import runs without the hassle to deleting everything before each import. More important, if some of the Work Item where imported not correctly, I can simply re-export them and the corresponding Work Item will be recreated correctly.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>private</span> WorkItem GetWorkItem(String originalId)
{
    <span style=color:#66d9ef>var</span> existingWorkItems = connection
       .WorkItemStore
       .Query(<span style=color:#e6db74>$@&#34;select * from  workitems where {fieldWithOriginalId} = &#39;&#34;</span> + originalId + <span style=color:#e6db74>&#34;&#39;&#34;</span>);
    <span style=color:#66d9ef>return</span> existingWorkItems.OfType&lt;WorkItem&gt;().FirstOrDefault();
}
</code></pre></td></tr></table></div></div><p><strong>The nice stuff about customization, is that I can query Work Item Store using condition on my new defined field.</strong> To leave everything flexible, I can specify the name of the field created in Figure 1 to command line. The whole command line to the example looks like this.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>--address https://gianmariaricci.visualstudio.com 
--tokenfile C:<span style=color:#ae81ff>\d</span>evelop<span style=color:#ae81ff>\C</span>rypted<span style=color:#ae81ff>\p</span>atOri.txt 
--teamproject TestMigration 
--originalIdField custom_originalId</code></pre></td></tr></table></div></div><p>Once we are sure that the system does not contains a Work Item related to that external id,the code will create a new Work Item In memory</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>private</span> WorkItem CreateWorkItem(MigrationItem migrationItem)
{
    WorkItemType type = <span style=color:#66d9ef>null</span>;
    <span style=color:#66d9ef>try</span>
    {
        type = teamProject.WorkItemTypes[migrationItem.WorkItemDestinationType];
    }
    <span style=color:#66d9ef>catch</span> (WorkItemTypeDeniedOrNotExistException) { }<span style=color:#75715e>//ignore the exception will be logged  
</span><span style=color:#75715e></span>
    <span style=color:#66d9ef>if</span> (type == <span style=color:#66d9ef>null</span>)
    {
        Log.Error(<span style=color:#e6db74>&#34;Unable to find work item type {WorkItemDestinationType}&#34;</span>, migrationItem.WorkItemDestinationType);
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
    }

    WorkItem workItem = <span style=color:#66d9ef>new</span> WorkItem(type);
    Log.Information(<span style=color:#e6db74>&#34;Created Work Item for type {workItemType} related to original id {originalId}&#34;</span>, workItem.Type.Name, migrationItem.OriginalId);

    <span style=color:#75715e>//now start creating basic value that we need, like the original id 
</span><span style=color:#75715e></span>    workItem[fieldWithOriginalId] = migrationItem.OriginalId;
    <span style=color:#66d9ef>return</span> workItem;
}
</code></pre></td></tr></table></div></div><p>The type of the Work Item to create is part of MigrationItem information, and the code simply verify that such type of Work Item really exists in current team project. If everything is ok, the code create a new WorkItem in memory using that type, then populate the original id field. <strong>This structure allows me to query the original system, then for each Migration Item I can decide destination type in Azure Devops.</strong> Last step is iterate through all the versions of the original item, and save every change to Work Item store to recreate the history of the original MigrationItem.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>//now that we have work item, we need to start creating all the versions
</span><span style=color:#75715e></span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; itemToMigrate.Versions.Count(); i++)
{
    <span style=color:#66d9ef>var</span> version = itemToMigrate.GetVersionAt(i);
    workItem.Fields&amp;<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>91</span>;<span style=color:#e6db74>&#34;System.ChangedDate&#34;</span>&amp;<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>93</span>;.Value = version.VersionTimestamp;
    workItem.Fields&amp;<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>91</span>;<span style=color:#e6db74>&#34;System.ChangedBy&#34;</span>&amp;<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>93</span>;.Value = version.AuthorEmail;
    <span style=color:#66d9ef>if</span> (i == <span style=color:#ae81ff>0</span>)
    {
        workItem.Fields&amp;<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>91</span>;<span style=color:#e6db74>&#34;System.CreatedBy&#34;</span>&amp;<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>93</span>;.Value = version.AuthorEmail;
        workItem.Fields&amp;<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>91</span>;<span style=color:#e6db74>&#34;System.CreatedDate&#34;</span>&amp;<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#ae81ff>93</span>;.Value = version.VersionTimestamp;
    }
    workItem.Title = version.Title;
    workItem.Description = version.Description;
    <span style=color:#66d9ef>var</span> validation = workItem.Validate();
    <span style=color:#66d9ef>if</span> (validation.Count &gt; <span style=color:#ae81ff>0</span>)
    {
        Log.Error(<span style=color:#e6db74>&#34;N°{errCount} validation errors for work Item {workItemId} originalId {originalId}&#34;</span>, validation.Count, workItem.Id, itemToMigrate.OriginalId);
        <span style=color:#66d9ef>foreach</span> (Field error <span style=color:#66d9ef>in</span> validation)
        {
            Log.Error(<span style=color:#e6db74>&#34;Version {version}: We have validation error for work Item {workItemId} originalId {originalId} - Field: {name} ErrorStatus {errorStatus} Value {value}&#34;</span>, i, workItem.Id, itemToMigrate.OriginalId, error.Name, error.Status, error.Value);
        }
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
    }
    workItem.Save();
    <span style=color:#66d9ef>if</span> (i == <span style=color:#ae81ff>0</span>)
    {
        Log.Information(<span style=color:#e6db74>&#34;Saved for the first time Work Item for type {workItemType} with id {workItemId} related to original id {originalId}&#34;</span>, workItem.Type.Name, workItem.Id, itemToMigrate.OriginalId);
    }
    <span style=color:#66d9ef>else</span>
    {
        Log.Debug(<span style=color:#e6db74>&#34;Saved iteration {i} for original id {originalId}&#34;</span>, i, itemToMigrate.OriginalId);
    }
}

<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</code></pre></td></tr></table></div></div><p><strong>The above code migrate only the Title, but nevertheless allows me to verify that I’m able to import not only a snapshot of Work Item, but a full history.</strong> As you can see this is really simple, for each iteration I only need to populate System.ChangedDate and System.ChangedBy, and in the first iteration I can also set System.CreatedBy.</p><p>One rule is in place, you cannot save with a date that is not greater that the date used for last save, this will force you to import all the versions in the correct order. Except this you can simply save with a date in the past and as a different user.</p><p>Before saving Work Item <strong>I simply issue a call to the Validate() method, that is able to determine any validation error before saving the Work Item</strong> , in case of error, I logged it then return false to inform the caller that Work Item was not fully imported.</p><p>This is a simple test to export some bogus data.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>MigrationItem mi = <span style=color:#66d9ef>new</span> MigrationItem();
mi.OriginalId = <span style=color:#e6db74>&#34;AA123&#34;</span>;
mi.WorkItemDestinationType = <span style=color:#e6db74>&#34;Product Backlog Item&#34;</span>;
mi.AddVersion(<span style=color:#66d9ef>new</span> MigrationItemVersion()
{
    AuthorEmail = <span style=color:#e6db74>&#34;alkampfer@outlook.com&#34;</span>,
    Description = <span style=color:#e6db74>&#34;Description&#34;</span>,
    Title = <span style=color:#e6db74>&#34;Title test&#34;</span>,
    VersionTimestamp = <span style=color:#66d9ef>new</span> DateTime(<span style=color:#ae81ff>2010</span>, <span style=color:#ae81ff>01</span>, <span style=color:#ae81ff>23</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>32</span>),
});

mi.AddVersion(<span style=color:#66d9ef>new</span> MigrationItemVersion()
{
    AuthorEmail = <span style=color:#e6db74>&#34;alkampfer@outlook.com&#34;</span>,
    Description = <span style=color:#e6db74>&#34;Description&#34;</span>,
    Title = <span style=color:#e6db74>&#34;Title Modified&#34;</span>,
    VersionTimestamp = <span style=color:#66d9ef>new</span> DateTime(<span style=color:#ae81ff>2011</span>, <span style=color:#ae81ff>01</span>, <span style=color:#ae81ff>23</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>32</span>),
});

mi.AddVersion(<span style=color:#66d9ef>new</span> MigrationItemVersion()
{
    AuthorEmail = <span style=color:#e6db74>&#34;alkampfer@outlook.com&#34;</span>,
    Description = <span style=color:#e6db74>&#34;Description&#34;</span>,
    Title = <span style=color:#e6db74>&#34;Title Modified Again&#34;</span>,
    VersionTimestamp = <span style=color:#66d9ef>new</span> DateTime(<span style=color:#ae81ff>2011</span>, <span style=color:#ae81ff>01</span>, <span style=color:#ae81ff>23</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>32</span>),
});

<span style=color:#66d9ef>var</span> importResult = importer.ImportWorkItemAsync(mi).Result;
</code></pre></td></tr></table></div></div><p>Launching test program I view this output:</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image-9.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-9.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-9.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Export output.</em></p><p>This is not the first run, so the logs informed me that an item bound to that original Id was already created and it was deleted, then informed me that a new Work Item is created and then updated for two times.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image-10.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-10.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/01/image_thumb-10.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Work Item was correctly created in Azure Devops Collection</em></p><p><strong>The nice stuff is that the work item History reports all the modification with the correct Date, and this can be done only because the user that generated the token is member of Collection Service Account group</strong>. (Do not forget to remove the user after finishing the import, or use a specific user for the import).</p><blockquote><p>Thanks to the great flexibility of Azure DevOps API you can easily imports data with full history to have a migration with higher fidelity than exporting last snapshot of the data.</p></blockquote><p>The only indication that the action was performed by an import is that the history shoved (Via Gian MAria Ricci –aka Alkampfer) that indicates that the action was not really performed by Alkampfer the Zoalord, but was instead done with impersonation. Nevertheless you can maintain full history in the code.</p><p><a href=https://github.com/alkampfergit/AzureDevOpsPlayground/tree/0.4.0>You can find full example In GitHub</a></p><p>Happy Azure DevOps.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/general/>general</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/general/>General</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2019/01/sonar-analysis-of-python-with-azure-devops-pipeline/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Sonar Analysis of Python with Azure DevOps pipeline</a></div><div class="next-entry sep-before"><a href=/post/old/2019/01/change-work-item-type-in-a-fresh-installation-of-azure-devops-server/><span class=screen-reader-text>Next post: </span>Change Work Item Type in a fresh installation of Azure DevOps server<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>