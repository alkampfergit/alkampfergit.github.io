<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="After being capable of running build and test in my GitHub action workflow, it is time to experiment with matrix to have the build run on multiple OSes. This can be tricky if you use (like me) some Docker Images (Mongodb, SqlServer). This because when you choose Windows machine, you are using Windows Container services , not standard Docker for Windows. This means that you are not able to run standard Docker container based on linux, but you need to use Windows Container based image."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="GitHub Actions second round • Codewrecks"><meta property="og:description" content="After being capable of running build and test in my GitHub action workflow, it is time to experiment with matrix to have the build run on multiple OSes. This can be tricky if you use (like me) some Docker Images (Mongodb, SqlServer). This because when you choose Windows machine, you are using Windows Container services , not standard Docker for Windows. This means that you are not able to run standard Docker container based on linux, but you need to use Windows Container based image."><meta property="og:url" content="https://www.codewrecks.com/post/old/2019/10/github-actions-second-round/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="GitHub Actions"><meta property="article:published_time" content="2019-10-05T09:00:37+02:00"><meta property="article:modified_time" content="2019-10-05T09:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>GitHub Actions second round • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2019/10/github-actions-second-round/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>GitHub Actions second round</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>GitHub Actions second round</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2019-10-05T09:00:37+02:00>2019, Oct 05</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>5 mins read</span></div></div></header><div class="container entry-content"><p>After being capable of running build and test in my GitHub action workflow, it is time to experiment with matrix to have the build run on multiple OSes. This can be tricky if you use (like me) some Docker Images (Mongodb, SqlServer). <strong>This because when you choose Windows machine, you are using Windows Container services</strong> , not standard Docker for Windows. This means that you are not able to run standard Docker container based on linux, but you need to use Windows Container based image.</p><blockquote><p>GitHub actions Windows based machines are running Windows Container, not Linux ones.</p></blockquote><p><strong>This is especially annoying for me because it seems that there is no SQL Server image available for Windows Server 2019</strong>.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image_thumb.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Docker image for Sql Server does not support Windows Server 2019.</em></p><p>Ok, I’m forced to use Windows server 2016, when I really have preferred to use Windows 2019, that has a much better support for containers.</p><p>Apart these difficulties, GitHub actions saved my day because it allows me to specify new variables depending on matrix values, thus <strong>allowing me to use different container commands for different operating systems</strong> , as you can see in <strong>Figure 2.</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image-1.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image_thumb-1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image_thumb-1.png alt=image></a></a> </p><p><em><strong>Figure 2</strong></em>: <em>Different mssSql and mongContainer variable values depending on operating system.</em></p><p>Thanks to the <em>include</em> directive, <strong>I’m able to give different value to job variables, I’m creating two new variables: msssql and mongoContainer, that contain the command line to start MsSql server and MongoDb containers.</strong> This is important because, in Windows, the image of MsSql container gaves me problem if I use ‘ instead of “. With include directive I’m able to specify a completely different run command line for different operating system.</p><p>This is also fundamental because I need to use two different container images for MsSql, in fact they are different for different operating systems. With linux I can use mcr.microsoft.com/mssql/server:2017-latest-ubuntu, while for Windows 2016 (but not for Windows 2019) I should use microsoft/mssql-server-windows-developer.</p><blockquote><p>Thanks to include: condition, I can change value for jobs variable depending on Matrix combinations</p></blockquote><p>The net result was that my action now runs in both operating systems.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image-2.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image_thumb-2.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image_thumb-2.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Action now runs on both operating systems, I still got error from mongo test because of problem in container in Windows, but this is a different story.</em></p><p>If I want to run my build and test also against.NET Core 3 Rc, I can simply add another value on dotnet matrix, et voilà, now I got 4 different runs of my workflow.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image-3.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image_thumb-3.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/image_thumb-3.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Running actions with matrix, cross product between all variables allows me to run action in different combination of operating system and.NET  Core framework.</em></p><p><strong>Thanks to the max-parallel: setting, I ask to the system to run only two build in parallel, but with fail-fast equal to false I’m asking to GitHub to always run all the combination, even if one previous combination fails.</strong> This allows me to always have all four actions run, regardless of the outcome of a previous action.</p><p><strong>I can also use Exclude to remove some combination from matrix cross product</strong> , in <strong>Figure 4</strong> I’m excluding running for.NET core 3 on windows machine</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/SNAGHTML181d66.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/SNAGHTML181d66_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/SNAGHTML181d66_thumb.png alt=SNAGHTML181d66></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Excluding a specific combination from matrix combination</em></p><p>This will generate a total of three runs, I will build both version of framework in linux machine, but only 2.2.401.net Framework on windows machine.</p><blockquote><p>Include and exclude are powerful action configurations, that allows to configure differently the job or completely exclude some matrix combination, allowing for fine grained control on job parallelism.</p></blockquote><p>Everything is really good, but here is some problems that I encountered while using Actions, but it is completely understandable because it is still in beta.</p><p>Running on Windows Machine is slower than Linux, I do not know if this is a problem of docker images, but in <strong>Figure 5</strong> you can see timing of the action in Linux (red square) and in Windows (blue square). I suspect that Windows machine runs in a much slower hardware. Nevertheless, pay attention at timing, if you are building.NET core, probably linux is the best choice (better container support and faster in GitHub actions).</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/SNAGHTML1d0571.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/SNAGHTML1d0571_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/SNAGHTML1d0571_thumb.png alt=SNAGHTML1d0571></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Timing running the action in Linux and Windows machine</em></p><p><strong>Another area where actions need improvement is the concept of a partially failing action, like we had for Years in Azure DevOps (TFS).</strong> The concept is: when I’m running a series of tests, I do not want the entire action job to stop if one of the test run fails, I want it to be reported failed, continue to the next step, and the entire action should be marked as “partially failing” if one of the job marked with continue-on-error failed. <strong>This kind of CI workflow is standard, do not stop the script, just continue and mark the single step as failed.</strong> It is true that GitHub actions <strong>have a continue-on-error property</strong> , but it simply report the step as succeded even if it fails, this is a real annoying missing feature.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/SNAGHTML41e080.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/SNAGHTML41e080_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/10/SNAGHTML41e080_thumb.png alt=SNAGHTML41e080></a></a></p><p><em><strong>Figure 6</strong></em>: <em>Continue-on-error actually mark the step as succeeded even if it fails.</em></p><p>As you can see from <strong>Figure 6</strong> , step failed (2 test failed), but the it is marked as successful (due to continue-on-error) and the overall execution is green. This is a real missing feature for complex project where you want to execute every steps and visualize which steps failed.</p><p>This second wave of test confirmed me that GitHub actions is a powerful build system, but it still need in its early day and need more work to be really usable in complex projects.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/github/>github</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/github-actions/>GitHub Actions</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2019/09/github-actions-error-pushing-with-workflow-modified/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>GitHub Actions Error pushing with workflow modified</a></div><div class="next-entry sep-before"><a href=/post/old/2019/10/vulnhub-tr0ll3-walktrough/><span class=screen-reader-text>Next post: </span>Vulnhub Tr0ll3 walktrough<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>