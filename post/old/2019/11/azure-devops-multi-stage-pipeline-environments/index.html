<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In a previous post on releasing with Multi Stage Pipeline and YAML code I briefly introduced the concept of environments. In that example I used an environment called single_env and you can be surprised that, by default, an environment is automatically created when the release runs. This happens because an environment can be seen as sets of resources used as target for deployments, but in the actual preview version, in Azure DevOps, you can only add Kubernetes resources."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Azure DevOps multi stage pipeline environments • Codewrecks"><meta property="og:description" content="In a previous post on releasing with Multi Stage Pipeline and YAML code I briefly introduced the concept of environments. In that example I used an environment called single_env and you can be surprised that, by default, an environment is automatically created when the release runs. This happens because an environment can be seen as sets of resources used as target for deployments, but in the actual preview version, in Azure DevOps, you can only add Kubernetes resources."><meta property="og:url" content="https://www.codewrecks.com/post/old/2019/11/azure-devops-multi-stage-pipeline-environments/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="devops"><meta property="article:tag" content="release"><meta property="article:published_time" content="2019-11-12T18:00:37+02:00"><meta property="article:modified_time" content="2019-11-12T18:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Azure DevOps multi stage pipeline environments • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2019/11/azure-devops-multi-stage-pipeline-environments/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Azure DevOps multi stage pipeline environments</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Azure DevOps multi stage pipeline environments</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2019-11-12T18:00:37+02:00>2019, Nov 12</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>In a previous post on <a href=http://www.codewrecks.com/blog/index.php/2019/10/21/release-app-with-azure-devops-multi-stage-pipeline/>releasing with Multi Stage Pipeline and YAML code</a> I briefly introduced the concept of environments. In that example I used an environment called single_env and <strong>you can be surprised that, by default, an environment is automatically created when the release runs.</strong> This happens because an environment can be seen as sets of resources used as target for deployments, but in the actual preview version, in Azure DevOps, you can only add Kubernetes resources. The question is: <strong>why have I used an environment to deploy an application to Azure if there is no connection between the environment and your azure resources?</strong> > At this stage of the preview, we can only connect Kubernetes to an environment, no other physical resource can be linked.</p><p>I have two answer for this, the first is: Multi State Release pipeline in YAML is still in preview and we know that it is still incomplete, the other is: an environment is a set of information and rules, and <strong>rules can be enforced even if there is no a direct connection with physical resources.</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb.png alt=image></a></a></p><p><em><strong>Figure 1</strong></em>: <em>Environment in Azure DevOps</em></p><p>As you see in Figure 1 a first advantage of environment is that I can immediately check its status. From the above picture I can immediately spot that I have a release successfully deployed on it. <strong>Clicking on the status opens pipeline details released on that environment.</strong> Clicking on Environment name opens environment detail page, where you can view all information for the environment (name, and all release made on it) and it is possible to add resources and manage Security and Checks.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image-1.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-1.png alt=image></a></a></p><p><em><strong>Figure 2</strong></em>: <em>Security and Checks configuration for an environment.</em></p><p>Security is pretty straightforward, it is used to decide who can use and modify the environment, <strong>the real cool feature is the ability to create checks.</strong> If you click checks in <strong>Figure 2</strong> you are redirected on a page that lists all the checks that need to be done before the environment can be used as a target for deploy.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image-2.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-2.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-2.png alt=image></a></a></p><p><em><strong>Figure 3</strong></em>: <em>Creating a check for the environment.</em></p><p>As an example I created a simple manual approval, put myself as the only approver and add some instruction. Once a check was created, it is listed in the Checks list for the environment.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image-3.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-3.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-3.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Checks defined for the environment single_env</em></p><p>If I trigger another run, something interesting happens: after the build_test phase was completed , deploy stage is blocked by approval check.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image-4.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-4.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-4.png alt=image></a></a></p><p><em><strong>Figure 4</strong></em>: <em>Deploy stage was suspended because related environment has check to be fulfilled</em></p><blockquote><p>Check support in environment can be used to apply deployment gates for my environments, like manual approval for the standard Azure DevOps classic release pipeline</p></blockquote><p>Even if there is no physical link between the environment and my azure account where I’m deploying my application, azure pipeline detects that the environment has a check and block the execution of the script, as you can check in <strong>Figure 4</strong>.</p><p>Clicking on the check link in <strong>Figure 4</strong> opens a details with all checks that should be done before continuing with deploy script. In <strong>Figure 5</strong> you can check that the deploy is waiting for me to approve it, <strong>I can simply press the Approve button to have deploy script to start.</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image-5.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-5.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-5.png alt=image></a></a></p><p><em><strong>Figure 5</strong></em>: <em>Checks for deploy stage</em></p><p>Once an agent is available, deploy stage can now start because I’ve done all check for related environment.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image-6.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-6.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-6.png alt=image></a></a></p><p><em><strong>Figure 6</strong></em>: <em>Deploy stage started, all the check are passed.</em></p><p>Once deploy operation finished, I can always verify checks, in <strong>Figure 7</strong> I can verify <strong>how easy is to find who approved the release in that environment.</strong> <a href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image-7.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-7.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2019/11/image_thumb-7.png alt=image></a></a></p><p><em><strong>Figure 7</strong></em>: <em>Verifying the checks for deploy after pipeline finished.</em></p><p>Actually the only check available is manual approval, but I’m expecting more and more checks to be available in the future, so keeps an eye to future release notes.</p><p>Gian Maria.</p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/azure-devops/>Azure DevOps</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/devops/>DevOps</a>, <a class=tag href=/tags/release/>release</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2019/10/github-security-alerts/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>GitHub security Alerts</a></div><div class="next-entry sep-before"><a href=/post/old/2019/11/multiline-powershell-on-yaml-pipeline/><span class=screen-reader-text>Next post: </span>Multiline PowerShell on YAML pipeline<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>