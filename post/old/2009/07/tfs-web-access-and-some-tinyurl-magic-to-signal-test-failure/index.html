<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In the last post of Tfs series, I showed how to build a msbuild custom action to tweet when build test run fails. Using twitter can seem strange at first, and probably not so professional to associate to a project build, but this is not true. Twitter is a free service that can be consumed from many devices, you can use tool such as twitterDeck to manage all of your tweets in your desktop environment and to categorize them, but you can also use any mobile phone, so it is probably the most serious way to signal build problems to everyone is interested in the build process of a certain project."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Tfs Web access and some tinyurl magic to signal test failure • Codewrecks"><meta property="og:description" content="In the last post of Tfs series, I showed how to build a msbuild custom action to tweet when build test run fails. Using twitter can seem strange at first, and probably not so professional to associate to a project build, but this is not true. Twitter is a free service that can be consumed from many devices, you can use tool such as twitterDeck to manage all of your tweets in your desktop environment and to categorize them, but you can also use any mobile phone, so it is probably the most serious way to signal build problems to everyone is interested in the build process of a certain project."><meta property="og:url" content="https://www.codewrecks.com/post/old/2009/07/tfs-web-access-and-some-tinyurl-magic-to-signal-test-failure/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Tfs"><meta property="article:published_time" content="2009-07-06T07:00:37+02:00"><meta property="article:modified_time" content="2009-07-06T07:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Tfs Web access and some tinyurl magic to signal test failure • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2009/07/tfs-web-access-and-some-tinyurl-magic-to-signal-test-failure/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Tfs Web access and some tinyurl magic to signal test failure</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Tfs Web access and some tinyurl magic to signal test failure</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2009-07-06T07:00:37+02:00>2009, Jul 06</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>In the <a href=http://www.codewrecks.com/blog/index.php/2009/07/03/execute-custom-code-during-tfs-build/>last post</a> of Tfs series, I showed how  to build a msbuild custom action to tweet when build test run fails. Using <a href=http://twitter.com/>twitter</a> can seem strange at first, and probably not so professional to associate to a project build, but this is not true. Twitter is a free service that can be consumed from many devices, you can use tool such as <a href=http://tweetdeck.com/beta/>twitterDeck</a> to manage all of your tweets in your desktop environment and to categorize them, but you can also use any mobile phone, so it is probably the most serious way to signal build problems to everyone is interested in the build process of a certain project.</p><p>The only great limitation of twitter is that it cannot convey more than 140 characters, and it is difficult to give enough information to the user in such little space. Here is a typical result from a failure build</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image9.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb9.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb9.png alt=image></a></a></p><p>When anyone interested in the project looks at this message, he immediately know that something is gone wrong, but how can he know what exactly is gone wrong? To solve this problem we must do a couple of things.</p><p>The first step is installing the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=3ECD00BA-972B-4120-A8D5-3D38311893DE&displaylang=en">Visual Studio Team System Web Access 2008 SP1 Power Tool</a>, an extension to tfs that permits Tfs management from a web interface like this one.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image10.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb10.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb10.png alt=image></a></a></p><p>Since this site can use windows authentication to manage user permissions, you can even expose this site to the entire internet, so everyone that has permission, can manage Tfs server simply from a pc with a browser and internet access. I do not want to show you all the possibilities that the web access power tool can give to you, but I immediately noticed an interesting stuff: I can browse into the team build, then I can look at details of every build:</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image11.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb11.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb11.png alt=image></a></a></p><p>This pages shows me full details about the build, now if you look closely at the query string, you can see that it specify the build to show with the parameter <strong>builduri=vstfs///build/build/41</strong> ;) now is the time to do some other custom action. To tweet such a long url is impossible, but you can use <a href=http://tinyurl.com/>tinyurl</a> to shorten it to be tweeted without problem.</p><p>This means that I need another custom msbuild action, this one is slightly different from the one used to tweet the message, because it need to returns the string with the new url (the one returned by the tiny process). Here is the full task definition.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-CSharp data-lang=CSharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TinyUrlTask</span> : Task
{
<span style=color:#a6e22e>    [Required]</span>
    <span style=color:#66d9ef>public</span> String Url { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
<span style=color:#a6e22e>
</span><span style=color:#a6e22e>    [Output]</span>
    <span style=color:#66d9ef>public</span> String TinedUrl { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>bool</span> Execute()
    {
        TinedUrl = TinyUrl.MakeTinyUrl(Url);
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
    }
}
</code></pre></td></tr></table></div></div><p>The only difference with the tweeter task is the presence of a property marked with [Output] parameter, and in the Execute() method I simply call an external class that shorten the url with TinyUrl and then I stored the result of the task into TinedUrl output property. With such a definition I can modify the build script with this custom action to execute after tests are run</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;Target</span> <span style=color:#a6e22e>Name=</span><span style=color:#e6db74>&#34;AfterTest&#34;</span><span style=color:#f92672>&gt;</span>

    <span style=color:#75715e>&lt;!-- Refresh the build properties. --&gt;</span>
    <span style=color:#f92672>&lt;GetBuildProperties</span> <span style=color:#a6e22e>TeamFoundationServerUrl=</span><span style=color:#e6db74>&#34;$(TeamFoundationServerUrl)&#34;</span>
                                 <span style=color:#a6e22e>BuildUri=</span><span style=color:#e6db74>&#34;$(BuildUri)&#34;</span>
                                 <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34; &#39;$(IsDesktopBuild)&#39; != &#39;true&#39; &#34;</span><span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;Output</span> <span style=color:#a6e22e>TaskParameter=</span><span style=color:#e6db74>&#34;TestSuccess&#34;</span> <span style=color:#a6e22e>PropertyName=</span><span style=color:#e6db74>&#34;TestSuccess&#34;</span> <span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;/GetBuildProperties&gt;</span>

    <span style=color:#f92672>&lt;TinyUrlTask</span> <span style=color:#a6e22e>Url=</span><span style=color:#e6db74>&#34;http://10.0.0.200:10001/UI/Pages/Build/Details.aspx?builduri=$(BuildURI)&#34;</span><span style=color:#f92672>&gt;</span>
        <span style=color:#f92672>&lt;Output</span> <span style=color:#a6e22e>TaskParameter=</span><span style=color:#e6db74>&#34;TinedUrl&#34;</span> <span style=color:#a6e22e>ItemName=</span><span style=color:#e6db74>&#34;TinedBuildUrl&#34;</span> <span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;/TinyUrlTask&gt;</span>
    <span style=color:#f92672>&lt;TweetTask</span>
        <span style=color:#a6e22e>Condition=</span><span style=color:#e6db74>&#34;&#39;$(IsDesktopBuild)&#39; != &#39;true&#39; and &#39;$(TestSuccess)&#39; != &#39;true&#39;&#34;</span>
        <span style=color:#a6e22e>Username=</span><span style=color:#e6db74>&#34;alkampfer&#34;</span>
        <span style=color:#a6e22e>Password=</span><span style=color:#e6db74>&#34;xxxxxxxxx&#34;</span>
        <span style=color:#a6e22e>Tweet=</span><span style=color:#e6db74>&#34;Build TestFailed:@(TinedBuildUrl)&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/Target&gt;</span></code></pre></td></tr></table></div></div><p>The tiny url task is called passing the url that points to the build result, fortunately the only parameter that this page needs is the <strong>BuildUri</strong> , that is passed with querystring and is contained in the msbuild variable $(BuildURI). The result of this task is retrieved with the Output node, where you can specify the output property you want to know with the TaskParameter attribute and the propertygroup where to store this value in the ItemName attribute. The final effect is that the @(TinedBuildUrl) propertyGroup contains the encoded url returned by tinyurl server after the TinyUrlTask is invoked. Now you can simply call the same TweetTask of the previous post to tweet the link to the web page that shows the details of the build. If you commit some code that will make a single test fail you got a tweet like this.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image12.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb12.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb12.png alt=image></a></a></p><p>The great difference from the previous version, is that the tweet now contains a link that can be immediately clicked to browse build results.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image13.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb13.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/07/image-thumb13.png alt=image></a></a></p><p>Thanks to tinyurl, that long url was shortened into a twittable one and you can look at build detail with a single click, how cool :). Now you can simply create a twitter account for each build, and everyone interested in that project can follow the corresponding twitter account to be notified of each build failure, and for each tweet he got clickable link that immediately takes him to the page with the results of the failing build.</p><p>Managing projects in such a way is real fun!!!!</p><p>alk.</p><p>Tags: <a href=http://technorati.com/tag/Team%20Foundation%20Server>Team Foundation Server</a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/tfs/>Tfs</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2009/07/design-ui-first/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Design UI First</a></div><div class="next-entry sep-before"><a href=/post/old/2009/07/a-better-version-of-dtofactory/><span class=screen-reader-text>Next post: </span>A better version of dtofactory<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>