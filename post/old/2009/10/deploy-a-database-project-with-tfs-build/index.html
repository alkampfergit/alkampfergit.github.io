<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="When you develop web application you often have this scenario. Some people are testers, they are testing the application in dev all day, and they want always to test latest version. Moreover testers usually fills data into web application, so they want their data to be preserved between various deploy. If you simply clear all data in test database you will end with a lot of furious tester :) so do not even think to do this."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Deploy a database project with TFS Build • Codewrecks"><meta property="og:description" content="When you develop web application you often have this scenario. Some people are testers, they are testing the application in dev all day, and they want always to test latest version. Moreover testers usually fills data into web application, so they want their data to be preserved between various deploy. If you simply clear all data in test database you will end with a lot of furious tester :) so do not even think to do this."><meta property="og:url" content="https://www.codewrecks.com/post/old/2009/10/deploy-a-database-project-with-tfs-build/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="Tfs"><meta property="article:tag" content="TFS Build"><meta property="article:published_time" content="2009-10-06T09:00:37+02:00"><meta property="article:modified_time" content="2009-10-06T09:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Deploy a database project with TFS Build • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2009/10/deploy-a-database-project-with-tfs-build/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Deploy a database project with TFS Build</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Deploy a database project with TFS Build</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2009-10-06T09:00:37+02:00>2009, Oct 06</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class="container entry-content"><p>When you develop web application you often have this scenario. Some people are testers, they are testing the application in dev all day, and they want always to test latest version. Moreover testers usually fills data into web application, so they want their data to be preserved between various deploy. If you simply clear all data in test database you will end with a lot of furious tester :) so do not even think to do this.</p><p>If a developer needs to change database schema, we need to automate not only the deploy of the web application, but we need also to sync test database with the latest changes. This is necessary so the test site can work with the new version, but old data is preserved for the happiness of the testers.</p><p>This is quite simple using TFS and Database project. The situation is this one</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/10/image.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/10/image-thumb.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/10/image-thumb.png alt=image></a></a></p><p>When a developer does a check-in, the build server grabs the tip from TFS, then it runs the builds script and deploy the new version of the site in the test web server. At the same time test database gets updated with the latest database schema.</p><p>To accomplish database deployment is necessary to modify build script by hand. If you create a build script with the wizard and ask to the build machine to build a database project, the only stuff you will get is a build of the database project, not a deploy, and all artifacts are moved in the drop location.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/10/image1.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/10/image-thumb1.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/10/image-thumb1.png alt=image></a></a></p><p>What you really need is the ability to automatically deploy changes to a specific database, this task is quite simple and you can find some details <a href=http://msdn.microsoft.com/en-us/library/aa833165.aspx>here in msdn</a>, but we need to insert this command into the msbuild script. Here is the code</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;Target</span> <span style=color:#a6e22e>Name=</span><span style=color:#e6db74>&#34;AfterDropBuild&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;Message</span> <span style=color:#a6e22e>Text=</span><span style=color:#e6db74>&#34;Deploy of project database&#34;</span> <span style=color:#f92672>/&gt;</span>

    <span style=color:#f92672>&lt;MSBuild</span> 
        <span style=color:#a6e22e>Projects=</span><span style=color:#e6db74>&#34;$(SolutionRoot)\src\DbEdition\NorthwindTest\NorthwindTest\NorthwindTest.dbproj&#34;</span>
        <span style=color:#a6e22e>Properties=</span><span style=color:#e6db74>&#34;OutDir=$(DropLocation)\$(BuildNumber)\debug\;TargetDatabase=NorthwindCiTest;DefaultDataPath=C:\Program Files\Microsoft SQL Server\MSSQL.4\MSSQL\Data;TargetConnectionString=Data Source=VM2003R2_1\SQLTEST%3Buser=sa%3Bpwd=Pa$$w0rd;DeployToDatabase=true;&#34;</span> 
        <span style=color:#a6e22e>Targets=</span><span style=color:#e6db74>&#34;Deploy&#34;</span>  <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/Target&gt;</span></code></pre></td></tr></table></div></div><p>Wow, it is really simple, all you need is a simple call to a &lt;MSBuild> task inside the AfterDropBuild target. The MSbuild task needs only three properties, the first is the Targets one, that specifies witch action we want to do on the project, in this situation is <em>Deploy</em>. Then in the Peojects property we must specify the full path of the database project file, and it is quite simple using the <em>SolutionRoot</em> property that points to the root of the source. Finally we need to set <em>Properties</em> property, the most important one, used to override project properties.</p><p>In my example I need to deploy in a server with a different instance name and a different Data Path from the original one included in the project. Properties property of msbuild permits you to specify different pair property=value separated with semicolon (;). The properties I need to override are:</p><p><strong>OutDir=</strong> The directory where we can find all the files resulting from the compilation of the database project, the DropLocation is the easiest way to specify them</p><p><strong>TargetDatabase</strong> = the name of the database used to deploy the project, is NorthwindCiTest, where CI is Continuos Integrated :)</p><p><strong>DefaultDataPath=</strong> the phisical path where to locate files. In the original project I use D:\ disk that is the one used to store databases in dev machines.</p><p><strong>DeployToDatabase=</strong> a boolean that must be set to true to ask to update target database</p><p><strong>TargetConnectionString=</strong> the connection string used to access the sql server, in this example I used sa because I used some test VM, do not use sa in real environment.</p><p>A little note must be done for the TargetconnectionSTring, since a connection string usually contains semicolon, and since semicolon is used by msbuild to separate properties, to use semicolon in connection string or in other property value, you need to escape it with the code  %3B the usual <a href=http://www.december.com/html/spec/esccodes.html>Url Escaping</a>.</p><p>Now you can fire a build, and verify what is happened in the log.</p><p>*Task &ldquo;Message&rdquo;</p><p>  Deploy of project database*</p><p>Done executing task &ldquo;Message&rdquo;.</p><p>Task &ldquo;MSBuild&rdquo;</p><p>Global Properties:</p><p>OutDir=\tfsalkampfer\builds\TfsBuildScreencast\NorthwindTest_20091006.10\debug\</p><p>TargetDatabase=NorthwindCiTest</p><p>DefaultDataPath=C:\Program Files\Microsoft SQL Server\MSSQL.4\MSSQL\Data</p><p>TargetConnectionString=Data Source=VM2003R2_1\SQLTEST%3buser=sa%3bpwd=Pa%24%24w0rd</p><p>DeployToDatabase=true</p><p>In this first part you can verify that all variables are correctly overridden. If you scroll down the result file you can find details on the update operation</p><p>*Task &ldquo;SqlDeployTask&rdquo;</p><p>  Deployment script generated to:*</p><p>\tfsalkampfer\builds\TfsBuildScreencast\NorthwindTest_20091006.10\debug\NorthwindTest.sql</p><p>Creating NorthwindCiTest…</p><p>Creating dbo.Categories…</p><p>Creating dbo.Contacts…</p><p>Creating dbo.CustomerCustomerDemo…</p><p>Creating dbo.CustomerDemographics…</p><p>Creating dbo.Customers…</p><p>Creating dbo.Employees…</p><p>Creating dbo.EmployeeTerritories…</p><p>Creating dbo.Order Details…</p><p>Creating dbo.Orders…</p><p>Creating dbo.Products…</p><p>Creating dbo.Region…</p><p>Creating dbo.Shippers…</p><p>Creating dbo.Suppliers…</p><p>Creating dbo.Territories…</p><p>Creating dbo.Categories.CategoryName…</p><p>This is the first time I run the script against the server, so all tables gets created, I can verify that the database was correctly created going to the test server</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/10/image2.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/10/image-thumb2.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/10/image-thumb2.png alt=image></a></a></p><p>Et voila, the database was automatically deployed to the test instance of sql server thanks to TFS Build and with no effort :).</p><p>alk.</p><p>Tags: <a href=http://technorati.com/tag/TFS>TFS</a> <a href=http://technorati.com/tag/TFS%20build>TFS build</a> <a href=http://technorati.com/tag/Database>Database</a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/team-foundation-server/>Team Foundation Server</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/tfs/>Tfs</a>, <a class=tag href=/tags/tfs-build/>TFS Build</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2009/10/an-interesting-post/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>An interesting post</a></div><div class="next-entry sep-before"><a href=/post/old/2009/10/change-base-directory-of-a-site-in-iis/><span class=screen-reader-text>Next post: </span>Change base directory of a site in IIS<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>