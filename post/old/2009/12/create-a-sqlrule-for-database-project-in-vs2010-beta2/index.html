<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Custom Rule for database projects is one of my favorite extension point of Visual Studio 2008, and I blogged about it some time ago. Yesterday I tried to convert my sample rule for visual studio 2010 beta2, and there are a lot of things that are changed. The result will be a simple rule that force column name to be in form xxxx_xxxxxxxx as in the past example
First of all the extension needs to specify its details with attributes."><meta name=theme-color content="#ffcd00"><meta property="og:title" content="Create a SqlRule for database project in vs2010 beta2 • Codewrecks"><meta property="og:description" content="Custom Rule for database projects is one of my favorite extension point of Visual Studio 2008, and I blogged about it some time ago. Yesterday I tried to convert my sample rule for visual studio 2010 beta2, and there are a lot of things that are changed. The result will be a simple rule that force column name to be in form xxxx_xxxxxxxx as in the past example
First of all the extension needs to specify its details with attributes."><meta property="og:url" content="https://www.codewrecks.com/post/old/2009/12/create-a-sqlrule-for-database-project-in-vs2010-beta2/"><meta property="og:site_name" content="Codewrecks"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="DataDude"><meta property="article:published_time" content="2009-12-30T14:00:37+02:00"><meta property="article:modified_time" content="2009-12-30T14:00:37+02:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.74.3"><title>Create a SqlRule for database project in vs2010 beta2 • Codewrecks</title><link rel=canonical href=https://www.codewrecks.com/post/old/2009/12/create-a-sqlrule-for-database-project-in-vs2010-beta2/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><style>:root{--color-accent:#ffcd00}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1773115-4','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script src=https://www.codewrecks.com/js/jquery-eu-cookie-law-popup.js></script><link rel=stylesheet href=https://www.codewrecks.com/css/jquery-eu-cookie-law-popup.css></head><body class="page type-post"><div class=site><a class=screen-reader-text href=#content>Skip to Content</a><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu"><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/categories/>Categories</a></li><li class=item><a href=/about/>About</a></li><li class=item><a href=/privacy/>Privacy</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class="widget widget-breadcrumbs sep-after"><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><span>Create a SqlRule for database project in vs2010 beta2</span></li></ol></nav></section></div></div><header id=header class="header site-header"><div class="container sep-after"><div class=header-info><p class="site-title title">Codewrecks</p><p class="desc site-desc">Wrecks of code floating in the sea of internet</p></div></div></header><main id=content><article lang=en class=entry><header class="header entry-header"><div class="container sep-after"><div class=header-info><h1 class=title>Create a SqlRule for database project in vs2010 beta2</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on</span>
<time class=entry-date datetime=2009-12-30T14:00:37+02:00>2009, Dec 30</time></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>3 mins read</span></div></div></header><div class="container entry-content"><p>Custom Rule for database projects is one of my favorite extension point of Visual Studio 2008, and I blogged about <a href=http://www.codewrecks.com/blog/index.php/2009/11/28/database-edition-custom-rule/>it some time ago</a>. Yesterday I tried to convert my sample rule for visual studio 2010 beta2, and there are a lot of things that are changed. The result will be a simple rule that force column name to be in form xxxx_xxxxxxxx as in the past example</p><p>First of all the extension needs to specify its details with attributes. The DatabaseSchemaProviderCompatibility permits you to specify the version of the database the rule applies to, in my example a standard sqlDatabase, then the DataRuleAttirbute is used to specify name, id, description, and other attributes of the rule. Finally you need to specify a series of SupportedElementTypeAttribute to declare the kind of database objects you want to validate, for this example you simply need to specify ISqlColumn because I want only to validate column names.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image25.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb25.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb25.png alt=image></a></a></p><p>The important aspect is that all the strings passed to DataRuleAttribute needs to be included in a resource file, and the very first things to do is creating a suitable resource file.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image26.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb26.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb26.png alt=image></a></a></p><p>Then you need to populate it with name and description that you want to use in your rule.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image27.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb27.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb27.png alt=image></a></a></p><p>Now you can create a file that stores all these constants, for an easier use. As you can see the ResourceBaseName string is the name of the resource file.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image28.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb28.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb28.png alt=image></a></a></p><p>And the game is done. Now you only need to write the code that validate column names.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-CSharp data-lang=CSharp> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> IList&lt;DataRuleProblem&gt; Analyze(DataRuleSetting ruleSetting, DataRuleExecutionContext context)
        {
            List&lt;DataRuleProblem&gt; problems = <span style=color:#66d9ef>new</span> List&lt;DataRuleProblem&gt;();

            IList&lt;<span style=color:#66d9ef>string</span>&gt; nameParts = context.ModelElement.Name.Parts;
            IDatabaseColumn column = context.ModelElement <span style=color:#66d9ef>as</span> IDatabaseColumn;
            <span style=color:#66d9ef>if</span> (column == <span style=color:#66d9ef>null</span>)
                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
            <span style=color:#66d9ef>if</span> (nameParts.Count == <span style=color:#ae81ff>3</span>)
            {
                <span style=color:#66d9ef>if</span> (!Regex.Match(nameParts[<span style=color:#ae81ff>2</span>], <span style=color:#e6db74>@&#34;^\w{4}_\w*&#34;</span>).Success)
                {
                    <span style=color:#66d9ef>string</span> message = <span style=color:#66d9ef>string</span>.Format(
                        <span style=color:#e6db74>&#34;Column {0} of table {1}.{2} must have the form pref_columnname.&#34;</span>,
                         nameParts[<span style=color:#ae81ff>2</span>], nameParts[<span style=color:#ae81ff>0</span>], nameParts[<span style=color:#ae81ff>1</span>]);
                    DataRuleProblem p = <span style=color:#66d9ef>new</span> DataRuleProblem(<span style=color:#66d9ef>this</span>, message, context.ModelElement);

                    p.Severity = DataRuleProblemSeverity.Error;
                    problems.Add(p);
                }
            }
            <span style=color:#66d9ef>return</span> problems;
        }
</code></pre></td></tr></table></div></div><p>This rule is really simple, but it works. One of the most difficult aspect in writing such an extension, is having a knowledge of the structure used by the database edition to represent objects. An important thing is that you can write everywhere in the rule the line</p><p>System.Diagnostic.Debugger.Break</p><p>And when you build the test database project, you can debug visual studio, and you can inspect with the debugger whatever object you need.</p><p><a href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image29.png><a target=_blank href=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb29.png><img src=https://www.codewrecks.com/blog/wp-content/uploads/2009/12/image_thumb29.png alt=image></a></a></p><p>With the power of the debugger you can better understand data that is passed to the rule by the designer. To register the rule you need to copy into a specific Visual Studio folder, and register it in the gac. You can accomplish all with a series of post build actions.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>copy <span style=color:#e6db74>&#34;$(TargetDir)$(TargetName)$(TargetExt)&#34;</span> <span style=color:#e6db74>&#34;$(ProgramFiles)\Microsoft Visual Studio 10.0\VSTSDB\Extensions\$(TargetName)$(TargetExt)&#34;</span> /y

copy <span style=color:#e6db74>&#34;$(ProjectDir)$(TargetName).Extensions.xml&#34;</span> <span style=color:#e6db74>&#34;$(ProgramFiles)\Microsoft Visual Studio 10.0\VSTSDB\Extensions\$(TargetName).Extensions.xml&#34;</span> /y 

<span style=color:#e6db74>&#34;C:\Program Files\Microsoft SDKs\Windows\v7.0A\Bin\NETFX 4.0 Tools\gacutil.exe&#34;</span> /<span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;$(ProgramFiles)\Microsoft Visual Studio 10.0\VSTSDB\Extensions\$(TargetName)$(TargetExt)&#34;</span> 
</code></pre></td></tr></table></div></div><p>With these simple three lines we are copying the dll with the custom rule, register in the gat and copy the xml file with the description of the plugin, that is completely equal to the one used with the old example.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34; ?&gt;</span>
<span style=color:#f92672>&lt;extensions</span> 
  <span style=color:#a6e22e>assembly=</span><span style=color:#e6db74>&#34;&#34;</span> 
  <span style=color:#a6e22e>version=</span><span style=color:#e6db74>&#34;1&#34;</span> 
  <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;urn:Microsoft.Data.Schema.Extensions&#34;</span> 
  <span style=color:#a6e22e>xmlns:xsi=</span><span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> 
  <span style=color:#a6e22e>xsi:schemaLocation=</span><span style=color:#e6db74>&#34;urn:Microsoft.Data.Schema.Extensions Microsoft.Data.Schema.Extensions.xsd&#34;</span><span style=color:#f92672>&gt;</span>

    <span style=color:#f92672>&lt;extension</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;SqlRule.MyStylePrefixedTable&#34;</span>
                <span style=color:#a6e22e>assembly =</span><span style=color:#e6db74>&#34;SqlRule, Version=1.0.0.0, Culture=neutral, PublicKeyToken=cc8904c79a049792&#34;</span>
                <span style=color:#a6e22e>enabled=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/extensions&gt;</span></code></pre></td></tr></table></div></div><p>Alk.</p><p>Tags: <a href=http://technorati.com/tag/Visual%20Studio%202010>Visual Studio 2010</a></p></div><footer class=entry-footer><div class="container sep-before"><div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg><span class=screen-reader-text>Categories: </span><a class=category href=/categories/visual-studio/>Visual Studio</a></div><div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59A2 2 0 0120.59 13.41z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=screen-reader-text>Tags: </span><a class=tag href=/tags/datadude/>DataDude</a></div></div></footer></article><nav class=entry-nav><div class=container><div class="prev-entry sep-before">Leave comment in GitHub discussion page<a target=_blank href=https://github.com/alkampfergit/personal-blog/discussions> alkampfergit/personal-blog/discussions</a></div><div class="prev-entry sep-before"><a href=/post/old/2009/12/workflow-and-test-capability-not-enabled-in-lab-management/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Workflow and test capability not enabled in lab management</a></div><div class="next-entry sep-before"><a href=/post/old/2010/01/sata-and-e-sata/><span class=screen-reader-text>Next post: </span>SATA and E-Sata<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg></span></a></div></div></nav></main><footer id=footer class=footer><div class="container sep-before"><section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu"><ul><li><a href=https://github.com/alkampfergit target=_blank rel=noopener><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/alkampfer target=_blank rel=noopener><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><title>Twitter icon</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:alkampfer@nablasoft.com target=_blank rel=noopener><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://linkedin.com/in/gianmariaricci target=_blank rel=noopener><span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2020-2022 Ricci Gian Maria</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script>console.log("this is cookie law");$(document).euCookieLawPopup().init({cookiePolicyUrl:'/privacy/',popupPosition:'top',colorStyle:'default',compactStyle:false,popupTitle:'This website is using cookies',popupText:'By continuing I assume your permission to deploy cookies, as detailed in the Privacy &amp; Cookies Policy.',buttonContinueTitle:'Continue',buttonLearnmoreTitle:'Learn more about this site Privacy &amp; Cookies Policy',buttonLearnmoreOpenInNewWindow:true,agreementExpiresInDays:30,autoAcceptCookiePolicy:false,htmlMarkup:null});</script></body></html>