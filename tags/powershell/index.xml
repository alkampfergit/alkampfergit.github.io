<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PowerShell on Codewrecks</title><link>https://www.codewrecks.com/tags/powershell/</link><description>Recent content in PowerShell on Codewrecks</description><generator>Hugo</generator><language>en</language><lastBuildDate>Mon, 11 Dec 2023 10:00:42 +0200</lastBuildDate><atom:link href="https://www.codewrecks.com/tags/powershell/index.xml" rel="self" type="application/rss+xml"/><item><title>Running GitVersion in Azure DevOps pipeline with dontet tool</title><link>https://www.codewrecks.com/post/azdo/pipeline/gitversion-powershell/</link><pubDate>Mon, 11 Dec 2023 10:00:42 +0200</pubDate><guid>https://www.codewrecks.com/post/azdo/pipeline/gitversion-powershell/</guid><description>&lt;p>For me, running GitVersion as part of a Pipeline is a golden standard. I barely &lt;strong>remember a pipeline that does not use GitVersion&lt;/strong> as first task. The reason is simple, it allows me, at least, to give a better naming to build names. Instead of having meaningless date base number I have a semantic build &lt;strong>that immediately gives me the idea of what was built&lt;/strong>.&lt;/p>
&lt;blockquote>
&lt;p>At least GitVersion can give a better name to a build, so why not using it?&lt;/p></description></item><item><title>Return value in PowerShell, a typical error</title><link>https://www.codewrecks.com/post/general/powershell/powershell-return-value/</link><pubDate>Sat, 17 Apr 2021 08:00:00 +0200</pubDate><guid>https://www.codewrecks.com/post/general/powershell/powershell-return-value/</guid><description>&lt;p>When you create a function in PowerShell you need to remember that if you write output, this will &lt;a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_return?view=powershell-7.1">be included in the returned value&lt;/a>. This means that &lt;strong>if you end your function with return $something you would not get only the content of the variable $something but every output that you did in the function&lt;/strong>.&lt;/p>
&lt;p>For this reason you need to be super careful not to use Write-Output, because all the output will be included in the returned value.&lt;/p></description></item><item><title>How to handle errors in PowerShell script used in Azure DevOps pipeline</title><link>https://www.codewrecks.com/post/general/powershell/pipeline-and-powershell-return-code/</link><pubDate>Sun, 15 Nov 2020 08:00:00 +0200</pubDate><guid>https://www.codewrecks.com/post/general/powershell/pipeline-and-powershell-return-code/</guid><description>&lt;p>Building with PowerShell or other scripting engine is a really nice option because you can &lt;strong>reuse the script in almost any Continuous Integration engine&lt;/strong> with a minimal effort, but sometimes there are tools that causes some headache.&lt;/p>
&lt;p>I had problem with tooling like yarn and npm when they are run in Azure DevOps pipeline, the problem is that &lt;strong>when the tool emit a warning, pipeline engine consider it an error and make the build fails&lt;/strong>. This happens usually because it is common to run PowerShell scripts in Azure DevOps pipeline with the option failOnStdErr to true&lt;/p></description></item><item><title>Automatic publish PowerShell Gallery with GitHub Actions</title><link>https://www.codewrecks.com/post/general/powershell-gallery-publish/</link><pubDate>Mon, 26 Oct 2020 18:00:00 +0200</pubDate><guid>https://www.codewrecks.com/post/general/powershell-gallery-publish/</guid><description>&lt;p>Publishing &lt;a href="http://www.codewrecks.com/post/general/powershell-gallery/">PowerShell helper functions&lt;/a> to PowerShell gallery is a good solution to &lt;strong>maximize reuse on Build and general Scripting for DevOps mundane tasks.&lt;/strong> On &lt;a href="https://github.com/AlkampferOpenSource/powershell-build-utils">this GitHub repository&lt;/a> I&amp;rsquo;ve put some simple build utilities that can &lt;strong>be published on PowerShell gallery&lt;/strong>.&lt;/p>
&lt;p>To streamline the process I&amp;rsquo;ve decided to &lt;strong>automate publish process with GitHub actions&lt;/strong>, because this is the typical scenario where GH Actions shine. First of all I&amp;rsquo;ve reorganized my sources to create a &lt;strong>single PowerShell file for each function, then I&amp;rsquo;ve found this &lt;a href="https://evotec.xyz/powershell-single-psm1-file-versus-multi-file-modules/">excellent post&lt;/a> that explain how to combine all files into a unique file to maximize performances.&lt;/strong>&lt;/p></description></item><item><title>Set ip of WSL2 machine in host file</title><link>https://www.codewrecks.com/post/general/powershell/wsl2-set-ip-in-hosts/</link><pubDate>Sat, 01 Aug 2020 08:00:00 +0200</pubDate><guid>https://www.codewrecks.com/post/general/powershell/wsl2-set-ip-in-hosts/</guid><description>&lt;p>I have a WSL2 ubuntu installation where I have SAMBA installed and I really need it to answer to a specific name, something like \ubuntuwsl.&lt;/p>
&lt;blockquote>
&lt;p>In WSL2 the machine got its IP assigned from Hyper-V so it is dynamic and change at each reboot&lt;/p>&lt;/blockquote>
&lt;p>To solve this problem it is interesting to look on &lt;strong>how you can interact to your WSL2 distribution from PowerShell&lt;/strong>, this exercise will show you how powerful WSL2 is. First of all you can execute shell command directly from PowerShell. As an example this is how I can start SAMBA daemon directly from PowersShell&lt;/p></description></item><item><title>How to locate most recent MSBuild.exe using PowerShell</title><link>https://www.codewrecks.com/post/general/find-msbuild-location-in-powershell/</link><pubDate>Sun, 26 Jul 2020 08:00:00 +0200</pubDate><guid>https://www.codewrecks.com/post/general/find-msbuild-location-in-powershell/</guid><description>&lt;p>If you want to build a Full Framework based project from PowerShell, &lt;strong>you need to locate MsBuild.exe tool tool to compile your project&lt;/strong>. You can indeed &amp;ldquo;open developer command prompt&amp;rdquo; to have a CommandLine with all needed tools in the %PATH%, but if you want to create a generic PowerShell script that uses MsBuild, knowing its location is probably a must.&lt;/p>
&lt;p>There are some solutions in the internet, but &lt;strong>I&amp;rsquo;ve found a nice module called VSSetup that can helps locating MsBuild&lt;/strong> because it gives you interesting information for every version of Visual Studio installed in the system (from VS2017 and subsequent versions).&lt;/p></description></item><item><title>Publish PowerShell functions to PowerShell Gallery</title><link>https://www.codewrecks.com/post/general/powershell-gallery/</link><pubDate>Sun, 28 Jun 2020 08:00:00 +0200</pubDate><guid>https://www.codewrecks.com/post/general/powershell-gallery/</guid><description>&lt;p>I&amp;rsquo;m a great fan of PowerShell script for build and release, even if Azure DevOps, GitHub Actions, TeamCity or Jenkins have pre-made task for common operations (zipping, file handling, etc). I always like using PowerShell scripts to do most of the job and the reason is simple: &lt;strong>PowerShell scripts are easy to test, easy to understand and are not bound to a specific CI/CD engine&lt;/strong>.&lt;/p>
&lt;p>Since I&amp;rsquo;m not a real PowerShell expert, during the years I&amp;rsquo;ve made some functions I reuse across projects, but I didn&amp;rsquo;t organize them, leading to some confusion over the years.&lt;/p></description></item><item><title>Publish a website available only in some branches with VSTS build</title><link>https://www.codewrecks.com/post/old/2017/07/publish-a-website-available-only-in-some-branches-with-vsts-build/</link><pubDate>Mon, 03 Jul 2017 16:00:37 +0200</pubDate><guid>https://www.codewrecks.com/post/old/2017/07/publish-a-website-available-only-in-some-branches-with-vsts-build/</guid><description>&lt;p>I have several builds that publish some web projects using standard msbuild task. Here is a sample configuration.&lt;/p>
&lt;p>&lt;a href="https://www.codewrecks.com/blog/wp-content/uploads/2017/07/image.png">&lt;a target="_blank" href="https://www.codewrecks.com/blog/wp-content/uploads/2017/07/image_thumb.png"> &lt;img src="https://www.codewrecks.com/blog/wp-content/uploads/2017/07/image_thumb.png" alt="Simple image that shows the configuration of a Msbuild Task used to publish a web project." />&lt;/a>&lt;/a>&lt;/p>
&lt;p>&lt;em>&lt;strong>Figure 1&lt;/strong>&lt;/em>: &lt;em>Publishing a web site with msbuild task.&lt;/em>&lt;/p>
&lt;p>This is super simple thanks to MsBuild task and a bit of MSBuild arguments, but quite often I face an annoying problem: &lt;strong>what about a new project that lives only on certain branches, but I need to publish in the build only if exists?&lt;/strong> &amp;gt; &lt;strong>Sometimes you need to execute some task in a build only if a file exists on disk (ex: a csproj file)&lt;/strong> Suppose this new Jarvis.Catalog.Web project exists today in a feature called feature/xyz, then the feature will be closed to develop in the future then will be merged to a release branch and finally on master branch. This poses a problem, &lt;strong>the MsBuild task to publish the web project will fail for every branch where that specific web project still does not exists.&lt;/strong> This is super annoying because you can set the build not to fail if this specific task failed, but this will mistakenly mark all build as partially succeeded only because that project still is not on that branch.&lt;/p></description></item><item><title>Troubleshoot a failing build a Winrm story</title><link>https://www.codewrecks.com/post/old/2017/06/troubleshoot-a-failing-build-a-winrm-story/</link><pubDate>Sat, 03 Jun 2017 08:00:37 +0200</pubDate><guid>https://www.codewrecks.com/post/old/2017/06/troubleshoot-a-failing-build-a-winrm-story/</guid><description>&lt;p>&lt;strong>Many VSTS build and deploy tasks are based on Winrm to operate on a remote machine&lt;/strong> , one of the most common is the “Deploy Test Agent on” that will install a test agent on a remote machine.&lt;/p>
&lt;p>&lt;a href="https://www.codewrecks.com/blog/wp-content/uploads/2017/05/image-14.png">&lt;a target="_blank" href="https://www.codewrecks.com/blog/wp-content/uploads/2017/05/image_thumb-14.png"> &lt;img src="https://www.codewrecks.com/blog/wp-content/uploads/2017/05/image_thumb-14.png" alt="This image shows the deploy test agent task on a standard build" />&lt;/a>&lt;/a>&lt;/p>
&lt;p>&lt;em>&lt;strong>Figure 1&lt;/strong>&lt;/em>: &lt;em>Task to install a TestAgent on a different machine&lt;/em>&lt;/p>
&lt;p>If you are not in a domain &lt;a href="https://msdn.microsoft.com/en-us/library/aa384426%28v=vs.85%29.aspx">Winrm&lt;/a> can be a really thought opponent, especially because the target machine is not part of the same domain and is not trusted. Usually you configure the build, insert all password but when you run the build you incurr in an error like this one.&lt;/p></description></item><item><title>Run Pester in VSTS Build</title><link>https://www.codewrecks.com/post/old/2017/05/run-pester-in-vsts-build/</link><pubDate>Sun, 28 May 2017 08:00:37 +0200</pubDate><guid>https://www.codewrecks.com/post/old/2017/05/run-pester-in-vsts-build/</guid><description>&lt;p>I’m not a great expert of PowerShell, but during last years I’ve written some custom utilities I’m using for various projects. The main problem is that I’ve scattered all these scripts on multiple projects and usually I need time to find the latest version of a script that does X.&lt;/p>
&lt;blockquote>
&lt;p>Scattering PowerShell scripts all around your projects lead to error and a maintenance nightmare&lt;/p>&lt;/blockquote>
&lt;p>To avoid this problem, &lt;strong>the obvious solution is starting a consolidation of PowerShell scripts and the obvious location is a Git repository hosted in VSTS&lt;/strong>. Now that I’m starting script consolidation, I want also to create some Unit Test With Pester to helps me developing and obviously I want Pester Unit Tests to run inside a VSTS Build.&lt;/p></description></item><item><title>How to manage PowerShell installation scripts</title><link>https://www.codewrecks.com/post/old/2016/06/how-to-manage-powershell-installation-scripts/</link><pubDate>Sat, 18 Jun 2016 06:00:37 +0200</pubDate><guid>https://www.codewrecks.com/post/old/2016/06/how-to-manage-powershell-installation-scripts/</guid><description>&lt;p>In  &lt;a href="http://www.codewrecks.com/blog/index.php/2016/06/03/create-a-release-manager-in-tfs-with-powershell-and-zipped-artifacts/">previous post&lt;/a> I explained how I like to release software using a simple paradigm:&lt;/p>
&lt;blockquote>
&lt;p>build produces one zipped file with everything needed for a release, then a PowerShell scripts accepts the path of this zipped release and installation parameters and executes every step to install/upgrade the software.&lt;/p>&lt;/blockquote>
&lt;p>This approach has numerous advantages, first of all &lt;strong>you can always test script with PowerShell ISE in a Developer Machine&lt;/strong>. Just download from build artifacts the version you want to use for test, load installation script in PowerShell ISE, then run the script, and if something went wrong (the script has a bug or needs to be updated) just debug and modify it until it works.&lt;/p></description></item><item><title>Using PowerShell scripts to deploy your software</title><link>https://www.codewrecks.com/post/old/2016/06/using-powershell-scripts-to-deploy-your-software/</link><pubDate>Fri, 03 Jun 2016 12:00:37 +0200</pubDate><guid>https://www.codewrecks.com/post/old/2016/06/using-powershell-scripts-to-deploy-your-software/</guid><description>&lt;p>I often use PowerShell scripts to package a “release” of a software during a build because it gives me a lots of flexibility.&lt;/p>
&lt;p>&lt;a href="http://www.codewrecks.com/blog/index.php/2015/06/30/manage-artifacts-with-tfs-build-vnext/">Manage artifacts with TFS Build vNext&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://www.codewrecks.com/blog/index.php/2016/01/30/different-approaches-for-publishing-artifacts-in-build-vnext/">Different approaches for publishing Artifacts in build vNext&lt;/a>&lt;/p>
&lt;p>&lt;strong>The advantage of using PowerShell is complete control over what will be included in the “release” package&lt;/strong>. This allows you to manipulate configuration files, remove unnecessary files, copy files from somewhere else in the repository, etc etc.&lt;/p></description></item><item><title>Avoid using Shell command in PowerShell scipts</title><link>https://www.codewrecks.com/post/old/2016/05/avoid-using-shell-command-in-powershell-scipts/</link><pubDate>Fri, 27 May 2016 15:00:37 +0200</pubDate><guid>https://www.codewrecks.com/post/old/2016/05/avoid-using-shell-command-in-powershell-scipts/</guid><description>&lt;p>I have setup scripts that are used to install software, they are simply based on this paradigm&lt;/p>
&lt;blockquote>
&lt;p>The build produces a zip file that contains everything needed to install the software, then we have a script that accepts the zip file as parameter as well as some other parameters and does install sofwtare on a local machine&lt;/p>&lt;/blockquote>
&lt;p>This simple paradigm is perfect, because &lt;strong>we can manually install a software launching powershell, or we can create a Chocolatey package to automate the installation.&lt;/strong> Clearly you can use the very same script to release the software inside TFS Release Management.&lt;/p></description></item><item><title>How to Deploy Web Site with PowerShell DSC</title><link>https://www.codewrecks.com/post/old/2014/06/how-to-deploy-web-site-with-powershell-dsc/</link><pubDate>Wed, 11 Jun 2014 05:00:37 +0200</pubDate><guid>https://www.codewrecks.com/post/old/2014/06/how-to-deploy-web-site-with-powershell-dsc/</guid><description>&lt;p>I do not want to create another tutorial on DSC and I suggest you reading some introductory articles like: &lt;a href="http://blogs.technet.com/b/privatecloud/archive/2013/08/30/introducing-powershell-desired-state-configuration-dsc.aspx">Introducing PowerShell Desired State Configuration&lt;/a> before reading this article. Since I’m pretty new with PowerShell and I’m starting experimenting with DSC I decided to &lt;strong>start creating a script to deploy my favorite test application (TailspinToys :) ) on a single Windows 2012 R2 server using only DSC&lt;/strong>. This post aims to share my thought on the subject.&lt;/p></description></item><item><title>Automatically Deploy PowerShell modules to Build Agents in TFS</title><link>https://www.codewrecks.com/post/old/2014/02/automatically-deploy-powershell-modules-to-build-agents-in-tfs/</link><pubDate>Fri, 21 Feb 2014 08:00:37 +0200</pubDate><guid>https://www.codewrecks.com/post/old/2014/02/automatically-deploy-powershell-modules-to-build-agents-in-tfs/</guid><description>&lt;p>I’ve done some blog post on customizing TFS Build with PowerShell scripts and the very first question I got from this approach is&lt;/p>
&lt;blockquote>
&lt;p>How can I store some PowerShell modules “somewhere” and have them available for all Build Agents?&lt;/p>&lt;/blockquote>
&lt;p>This is a real good question, but sadly enough it has no out-of-the-box answer. Luckily enough you can solve this with a little bit of PowerShell knowledge. Please be aware &lt;strong>that this solution is based on some assumption on how TFS build actually works and is not guaranteed to be stable in the future&lt;/strong> , but I’d like to share with you all if you want to try into your environment.&lt;/p></description></item></channel></rss>